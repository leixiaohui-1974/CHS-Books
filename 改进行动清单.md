# CHS-Books 改进行动清单

**创建日期**: 2025-10-30
**目标**: 将整体完整度从50%提升到95%+

---

## 🔥 Phase 1: 紧急修复（1周内，必须完成）

### ✅ 任务1.1: 第2本书生成PNG图形（最高优先级）

**工作量**: 2-3天
**影响**: 完整度0% → 86%

**执行步骤**:
```bash
cd /home/user/CHS-Books/books/open-channel-hydraulics/code/examples

# 批量运行生成PNG（案例1-23，已有main.py）
for i in {01..23}; do
    case="case_${i}_"*
    if [ -d "$case" ] && [ -f "$case/main.py" ]; then
        echo "===== 运行 $case ====="
        cd "$case"
        python main.py
        echo "生成的PNG文件："
        ls -lh *.png 2>/dev/null || echo "  无PNG生成（检查代码）"
        cd ..
    fi
done

# 案例25-26-28（已有main.py）
for case in case_25_water_hammer case_26_moc case_28_surge_tank; do
    if [ -f "$case/main.py" ]; then
        echo "===== 运行 $case ====="
        cd "$case"
        python main.py
        ls -lh *.png 2>/dev/null || echo "  无PNG生成（检查代码）"
        cd ..
    fi
done
```

**预期产出**: 约60-90个PNG文件

**检查完成**:
```bash
# 统计PNG文件数
find books/open-channel-hydraulics/code/examples/case_* -name "*.png" | wc -l
# 应该从0变为60+
```

---

### ✅ 任务1.2: 第2本书补充缺失的main.py

**工作量**: 1-2天
**影响**: 完整度86% → 100%

**需要补充4个main.py**:

#### 1. case_24_siphon/main.py（虹吸管流动）
```python
# 参考case_21_pipe_flow的结构
# 实现虹吸管启动、运行、破坏三个阶段
# 可视化：压力分布、流量变化、虹吸高度影响
```

#### 2. case_27_pump_transients/main.py（泵站瞬变）
```python
# 参考case_25_water_hammer的MOC方法
# 增加泵特性曲线、惯性效应、停泵水锤
# 可视化：压力波传播、流量衰减、飞轮保护效果
```

#### 3. case_29_channel_pipe/main.py（渠道-管道耦合）
```python
# 参考case_13_unsteady（渠道）+ case_25_water_hammer（管道）
# 耦合边界：流量连续、水头匹配
# 可视化：渠道水位、管道压力、耦合点流量
```

#### 4. case_30_comprehensive/main.py（综合应用）
```python
# 集成前面29个案例的核心技术
# 选择1-2个典型工程场景（如南水北调某段）
# 可视化：多指标对比、性能评估
```

**模板代码框架**:
```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
案例XX: [标题]
"""
import numpy as np
import matplotlib.pyplot as plt
import sys
sys.path.append('../..')
from models.channel import Channel
from solvers.saint_venant import SaintVenantSolver

def part1_xxx():
    """演示1：XXX"""
    print("\n演示1：XXX")
    # ... 实现代码 ...
    plt.savefig('part1_xxx.png')
    print("图形已保存: part1_xxx.png")

def part2_yyy():
    """演示2：YYY"""
    # ...

def main():
    print("="*60)
    print("案例XX: [标题]")
    print("="*60)
    part1_xxx()
    part2_yyy()
    # ...

if __name__ == "__main__":
    main()
```

**检查完成**:
```bash
# 验证4个文件已创建并可运行
for case in case_24_siphon case_27_pump_transients case_29_channel_pipe case_30_comprehensive; do
    python books/open-channel-hydraulics/code/examples/$case/main.py
done
```

---

### ✅ 任务1.3: 第3本书补充README.md

**工作量**: 0.5天
**影响**: 改善项目可发现性

**创建文件**: `books/canal-pipeline-control/README.md`

**内容大纲** (~15KB):
```markdown
# 渠道与管道控制（Canal and Pipeline Control）

## 简介
本书系统讲解明渠与压力管道的现代控制理论与方法...

## 特色
- ✅ 20个完整案例（100%）
- ✅ 集成前沿技术（POD、DMD、SINDy、数字孪生）
- ✅ 实际工程导向（南水北调、跨流域调水）

## 目录结构
```
canal-pipeline-control/
├── code/
│   ├── examples/          # 20个案例
│   ├── models/            # 核心模型
│   └── utils/             # 工具函数
└── 教程提纲-v3.0-完整版.md
```

## 案例索引
| 编号 | 案例名称 | 技术要点 | 难度 |
|------|---------|---------|------|
| 01 | 单段PID控制 | 经典PID | ⭐ |
| 02 | 多点PID控制 | 分布式控制 | ⭐⭐ |
| ... | ... | ... | ... |
| 20 | 南水北调数字孪生 | 综合集成 | ⭐⭐⭐⭐⭐ |

## 快速开始
```bash
# 安装依赖
pip install -r requirements.txt

# 运行案例1
cd code/examples/case_01_single_reach_pid
python main.py
```

## 核心技术栈
- 模型降阶: POD, DMD, Galerkin
- 系统辨识: N4SID, SINDy
- 状态估计: EKF, UKF
- 高级控制: MPC, 自适应, 鲁棒, 智能
- 数字孪生: 虚实映射, 预测维护

## 引用
如果本书对您的研究有帮助，请引用...

## 许可
[选择许可证]

## 联系
...
```

**同时创建**: `requirements.txt`
```txt
numpy>=1.20.0
scipy>=1.7.0
matplotlib>=3.3.0
```

---

## 🟡 Phase 2: 重要补充（2周内）

### ✅ 任务2.1: 第1本书补充缺失内容

**工作量**: 1天

#### 补充3个README:
1. `case_02_cooling_tower/README.md` (~5KB)
   - 冷却塔水箱控制系统
   - 温度-水位-流量三变量耦合
   - 参考case_01的README结构

2. `case_03_water_supply_station/README.md` (~5KB)
   - 供水站水箱群控制
   - 多水箱协调、压力平衡
   - 参考case_02结构

3. `case_04_pid_tuning/README.md` (~5KB)
   - PID参数整定方法
   - Ziegler-Nichols、Cohen-Coon、经验法
   - 参考案例6的README

#### 生成2个案例的PNG:
```bash
# case_07_cascade_control
cd books/water-system-control/code/examples/case_07_cascade_control
python main.py  # 应生成3-4个PNG

# case_09_system_modeling
cd ../case_09_system_modeling
python main.py  # 应生成3-4个PNG
```

---

### ✅ 任务2.2: 添加LICENSE文件（所有三本书）

**工作量**: 0.5天

**选择许可**:
- **MIT License**（推荐）- 最宽松，适合教育项目
- **Apache 2.0** - 明确专利授权
- **CC BY-NC-SA 4.0** - 教育用途，要求署名

**执行**:
```bash
# MIT License模板
cat > books/water-system-control/LICENSE << 'EOF'
MIT License

Copyright (c) 2025 [您的名字]

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction...
EOF

# 复制到其他两本书
cp books/water-system-control/LICENSE books/open-channel-hydraulics/
cp books/water-system-control/LICENSE books/canal-pipeline-control/
```

---

### ✅ 任务2.3: 添加setup.py（所有三本书）

**工作量**: 1天

**第1本书示例**:
```python
# books/water-system-control/setup.py
from setuptools import setup, find_packages

setup(
    name="water-system-control",
    version="1.0.0",
    author="[您的名字]",
    description="案例驱动的水系统控制教程",
    packages=find_packages(where="code"),
    package_dir={"": "code"},
    install_requires=[
        "numpy>=1.20.0",
        "scipy>=1.7.0",
        "matplotlib>=3.3.0",
    ],
    python_requires=">=3.8",
)
```

**安装测试**:
```bash
cd books/water-system-control
pip install -e .  # 可编辑模式安装
python -c "from models.water_tank.single_tank import SingleTank; print('OK')"
```

---

## 🟢 Phase 3: 增强优化（1个月内）

### ✅ 任务3.1: 测试完善

**第1本书**（当前0个测试）:
```bash
mkdir -p books/water-system-control/tests
cd books/water-system-control/tests

# 创建测试文件
cat > test_single_tank.py << 'EOF'
import pytest
import sys
sys.path.append('../code')
from models.water_tank.single_tank import SingleTank

def test_single_tank_initialization():
    tank = SingleTank(A=1.0, h0=2.0)
    assert tank.A == 1.0
    assert tank.h == 2.0

def test_single_tank_step():
    tank = SingleTank(A=1.0, h0=2.0)
    tank.step(dt=0.1, q_in=0.1, q_out=0.05)
    assert tank.h > 2.0  # 入流大于出流，水位上升
EOF

# 运行测试
pytest test_single_tank.py -v
```

**第3本书**（当前无tests目录）:
- 创建tests/目录
- 至少测试models/和utils/模块
- 参考第2本书的测试结构（34个测试文件）

---

### ✅ 任务3.2: 文档增强

**第3本书docs/zh目录**:
```bash
mkdir -p books/canal-pipeline-control/docs/zh

# 创建核心文档
cat > books/canal-pipeline-control/docs/zh/教学大纲.md
cat > books/canal-pipeline-control/docs/zh/理论基础.md
cat > books/canal-pipeline-control/docs/zh/安装指南.md
cat > books/canal-pipeline-control/docs/zh/常见问题.md
```

**所有书添加贡献指南**:
```markdown
# CONTRIBUTING.md

## 如何贡献

### 报告问题
- 使用GitHub Issues
- 提供复现步骤
- 附上错误信息

### 提交代码
1. Fork仓库
2. 创建特性分支
3. 提交Pull Request

### 代码规范
- 遵循PEP 8
- 添加文档字符串
- 包含单元测试
```

---

### ✅ 任务3.3: 国际化（英文文档）

**优先级**: 第3本书 > 第1本书 > 第2本书

**翻译内容**:
1. README.md → README_EN.md
2. 主要文档翻译到docs/en/
3. 案例README摘要翻译

**工具**: 可使用AI辅助翻译 + 人工校对

---

## 📊 进度跟踪

### 完整度目标

| 阶段 | 第1本 | 第2本 | 第3本 | 总体 |
|------|-------|-------|-------|------|
| 当前 | 75% | 0% | 100% | 50% |
| Phase 1后 | 75% | 100% | 100% | 88% |
| Phase 2后 | 100% | 100% | 100% | 100% |
| Phase 3后 | 100%+ | 100%+ | 100%+ | 100%+ |

### 检查清单

**Phase 1**:
- [ ] 第2本书30个案例生成PNG（26个有main.py的）
- [ ] 第2本书补充4个main.py
- [ ] 第3本书创建README.md
- [ ] 第3本书创建requirements.txt

**Phase 2**:
- [ ] 第1本书补充3个README
- [ ] 第1本书生成2个案例的PNG
- [ ] 所有书添加LICENSE
- [ ] 所有书添加setup.py

**Phase 3**:
- [ ] 第1本书添加15个测试
- [ ] 第3本书创建tests目录
- [ ] 第3本书创建docs/zh目录
- [ ] 所有书添加CONTRIBUTING.md
- [ ] 开始英文文档翻译

---

## 🚀 快速启动脚本

将以下脚本保存为 `quick_fix.sh` 并执行：

```bash
#!/bin/bash
# CHS-Books 快速修复脚本

echo "======================================"
echo "CHS-Books 快速修复 - Phase 1"
echo "======================================"

# 任务1: 第2本书生成PNG
echo -e "\n[1/3] 第2本书生成PNG..."
cd /home/user/CHS-Books/books/open-channel-hydraulics/code/examples

png_count_before=$(find . -name "*.png" | wc -l)
echo "当前PNG数量: $png_count_before"

for i in {01..23}; do
    case_dir=$(ls -d case_${i}_* 2>/dev/null | head -1)
    if [ -d "$case_dir" ] && [ -f "$case_dir/main.py" ]; then
        echo "  运行 $case_dir..."
        cd "$case_dir"
        timeout 120 python main.py > /dev/null 2>&1
        cd ..
    fi
done

# 案例25-26-28
for case in case_25_water_hammer case_26_moc case_28_surge_tank; do
    if [ -f "$case/main.py" ]; then
        echo "  运行 $case..."
        cd "$case"
        timeout 120 python main.py > /dev/null 2>&1
        cd ..
    fi
done

png_count_after=$(find . -name "*.png" | wc -l)
echo "生成PNG数量: $((png_count_after - png_count_before))"

# 任务2: 创建第3本书README
echo -e "\n[2/3] 创建第3本书README..."
cd /home/user/CHS-Books/books/canal-pipeline-control
if [ ! -f README.md ]; then
    echo "创建README.md..."
    # 在此插入README内容
fi

# 任务3: 创建requirements.txt
echo -e "\n[3/3] 创建requirements.txt..."
if [ ! -f requirements.txt ]; then
    cat > requirements.txt << 'EOF'
numpy>=1.20.0
scipy>=1.7.0
matplotlib>=3.3.0
EOF
    echo "已创建requirements.txt"
fi

echo -e "\n======================================"
echo "Phase 1 完成！"
echo "======================================"
```

---

## 📞 需要帮助？

如果在执行过程中遇到问题，请：

1. 检查Python环境（python --version，应>=3.8）
2. 检查依赖安装（pip list）
3. 查看错误日志
4. 参考已完成的案例作为模板

**预估总工作量**:
- Phase 1: 3-4天
- Phase 2: 2-3天
- Phase 3: 10-15天
- **总计: 15-22天**

**建议执行顺序**: Phase 1 → Phase 2 → Phase 3

---

**最后更新**: 2025-10-30
**下一步**: 立即开始Phase 1任务1.1（第2本书PNG生成）
