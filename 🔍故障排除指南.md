# 🔍 故障排除指南

> 快速解决使用15本考研书系列时遇到的常见问题

---

## 📋 目录

1. [安装问题](#安装问题)
2. [运行问题](#运行问题)
3. [显示问题](#显示问题)
4. [数据问题](#数据问题)
5. [性能问题](#性能问题)
6. [系统兼容性问题](#系统兼容性问题)

---

## 🔧 安装问题

### 问题1：pip install 失败

#### 症状
```
ERROR: Could not find a version that satisfies the requirement...
```

#### 原因
- 网络问题
- pip版本过低
- Python版本不兼容

#### 解决方案

**方案A：使用国内镜像**
```bash
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple -r 📦requirements.txt
```

**方案B：升级pip**
```bash
python -m pip install --upgrade pip
pip install -r 📦requirements.txt
```

**方案C：逐个安装**
```bash
pip install numpy
pip install scipy
pip install pandas
pip install matplotlib
pip install seaborn
pip install tqdm
```

**方案D：使用conda（如果可用）**
```bash
conda install numpy scipy pandas matplotlib seaborn
pip install tqdm
```

---

### 问题2：权限错误

#### 症状
```
PermissionError: [Errno 13] Permission denied
```

#### 解决方案

**Windows**:
```bash
# 方法1：以管理员身份运行
# 右键命令提示符 → 以管理员身份运行

# 方法2：安装到用户目录
pip install --user -r 📦requirements.txt
```

**macOS/Linux**:
```bash
# 方法1：使用--user标志
pip install --user -r 📦requirements.txt

# 方法2：使用虚拟环境（推荐）
python -m venv venv
source venv/bin/activate
pip install -r 📦requirements.txt

# 不推荐：使用sudo（可能破坏系统Python）
# sudo pip install ...  # 不要这样做！
```

---

### 问题3：找不到Python

#### 症状
```
'python' is not recognized as an internal or external command
```

#### 解决方案

**Windows**:
```bash
# 使用python3
python3 --version

# 或添加到PATH
# 控制面板 → 系统 → 高级系统设置 → 环境变量
# 添加Python安装路径到Path
```

**macOS/Linux**:
```bash
# 使用python3
python3 --version

# 创建别名（临时）
alias python=python3

# 永久别名（添加到~/.bashrc或~/.zshrc）
echo "alias python=python3" >> ~/.bashrc
source ~/.bashrc
```

---

## 🏃 运行问题

### 问题4：ModuleNotFoundError

#### 症状
```python
ModuleNotFoundError: No module named 'numpy'
```

#### 原因
- 依赖未安装
- 使用了错误的Python解释器
- 虚拟环境未激活

#### 解决方案

**检查并修复**:
```bash
# 1. 检查Python解释器
which python  # macOS/Linux
where python  # Windows

# 2. 检查已安装的包
pip list | grep numpy

# 3. 确认虚拟环境已激活
# 命令提示符应显示 (venv)

# 4. 重新安装依赖
pip install -r 📦requirements.txt

# 5. 验证安装
python -c "import numpy; print(numpy.__version__)"
```

---

### 问题5：脚本无法执行

#### 症状（Linux/macOS）
```
bash: ./🚀一键启动脚本.sh: Permission denied
```

#### 解决方案
```bash
# 添加执行权限
chmod +x 🚀一键启动脚本.sh
chmod +x 🔄快速更新脚本.sh

# 然后运行
./🚀一键启动脚本.sh
```

#### 症状（Windows）
```
无法识别 .sh 文件
```

#### 解决方案
```bash
# Windows用户使用Git Bash或WSL
# 或直接运行Python脚本
python 🤖学习助手CLI.py
```

---

### 问题6：编码错误

#### 症状
```python
UnicodeDecodeError: 'ascii' codec can't decode byte...
```

#### 解决方案

**Windows CMD**:
```bash
# 设置代码页为UTF-8
chcp 65001
```

**Python脚本中**:
```python
# 在脚本开头添加
import sys
import io
sys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding='utf-8')
sys.stderr = io.TextIOWrapper(sys.stderr.buffer, encoding='utf-8')
```

**全局配置（Python 3.7+）**:
```bash
# 设置环境变量
export PYTHONUTF8=1  # Linux/macOS
set PYTHONUTF8=1     # Windows
```

---

## 🎨 显示问题

### 问题7：Matplotlib中文显示为方框

#### 症状
图表中文显示为 `□□□` 或乱码

#### 解决方案

**Windows**:
```python
import matplotlib.pyplot as plt
import matplotlib
matplotlib.rcParams['font.sans-serif'] = ['SimHei']  # 黑体
matplotlib.rcParams['axes.unicode_minus'] = False    # 负号显示
```

**macOS**:
```python
matplotlib.rcParams['font.sans-serif'] = ['Arial Unicode MS']
matplotlib.rcParams['axes.unicode_minus'] = False
```

**Linux**:
```bash
# 1. 安装中文字体
sudo apt install fonts-wqy-zenhei fonts-wqy-microhei

# 2. 在Python中配置
matplotlib.rcParams['font.sans-serif'] = ['WenQuanYi Zen Hei']
matplotlib.rcParams['axes.unicode_minus'] = False

# 3. 清除Matplotlib缓存
rm -rf ~/.cache/matplotlib
```

**通用方法（指定字体文件）**:
```python
from matplotlib.font_manager import FontProperties
font = FontProperties(fname='/path/to/your/font.ttf')
plt.title('标题', fontproperties=font)
```

---

### 问题8：图表不显示

#### 症状
运行代码后没有图表弹出

#### 解决方案

**后端问题**:
```python
import matplotlib
# 在导入pyplot之前设置后端
matplotlib.use('TkAgg')  # 或 'Qt5Agg', 'MacOSX'
import matplotlib.pyplot as plt
```

**显示问题**:
```python
# 确保调用了show()
plt.plot([1, 2, 3])
plt.show()  # 必须调用

# 或使用交互模式
plt.ion()  # 打开交互模式
plt.plot([1, 2, 3])
plt.pause(0.1)
```

**Jupyter中**:
```python
# 在第一个单元格添加
%matplotlib inline
# 或
%matplotlib notebook
```

---

### 问题9：终端中文乱码

#### 症状
```
中æ–‡ä¹±ç 
```

#### 解决方案

**Windows CMD**:
```bash
chcp 65001
```

**Windows PowerShell**:
```powershell
[Console]::OutputEncoding = [System.Text.Encoding]::UTF8
```

**Linux/macOS**:
```bash
# 检查locale
locale

# 设置UTF-8（添加到~/.bashrc）
export LANG=en_US.UTF-8
export LC_ALL=en_US.UTF-8
```

---

## 💾 数据问题

### 问题10：数据文件读取失败

#### 症状
```python
FileNotFoundError: [Errno 2] No such file or directory
```

#### 解决方案

**检查路径**:
```python
import os
from pathlib import Path

# 方法1：使用绝对路径
data_file = "/workspace/learning_data.json"

# 方法2：使用相对路径（相对于脚本位置）
script_dir = Path(__file__).parent
data_file = script_dir / "learning_data.json"

# 方法3：检查文件是否存在
if not os.path.exists(data_file):
    print(f"文件不存在: {data_file}")
```

**Windows路径分隔符**:
```python
# 错误：使用反斜杠
path = "C:\Users\name\file.txt"  # 会被转义

# 正确：使用原始字符串
path = r"C:\Users\name\file.txt"

# 或使用正斜杠
path = "C:/Users/name/file.txt"

# 或使用Path（推荐）
from pathlib import Path
path = Path("C:/Users/name/file.txt")
```

---

### 问题11：JSON数据损坏

#### 症状
```python
json.decoder.JSONDecodeError: Expecting value
```

#### 解决方案

**备份和恢复**:
```python
import json
import shutil
from pathlib import Path

def fix_json_data():
    data_file = Path("learning_data.json")
    backup_file = Path("learning_data.json.bak")
    
    try:
        # 尝试读取
        with open(data_file, 'r', encoding='utf-8') as f:
            data = json.load(f)
        print("✅ 数据文件正常")
        return data
    except json.JSONDecodeError:
        print("❌ JSON数据损坏")
        
        # 检查备份
        if backup_file.exists():
            print("📂 发现备份文件，尝试恢复...")
            shutil.copy(backup_file, data_file)
            with open(data_file, 'r', encoding='utf-8') as f:
                return json.load(f)
        else:
            print("🔄 创建新的数据文件")
            return initialize_data()

def initialize_data():
    """初始化默认数据"""
    return {
        "daily_records": [],
        "books_progress": {},
        "projects": {}
    }
```

**定期备份**:
```python
def save_with_backup(data, filename="learning_data.json"):
    """保存数据并创建备份"""
    data_file = Path(filename)
    backup_file = Path(f"{filename}.bak")
    
    # 如果原文件存在，创建备份
    if data_file.exists():
        shutil.copy(data_file, backup_file)
    
    # 保存新数据
    with open(data_file, 'w', encoding='utf-8') as f:
        json.dump(data, f, ensure_ascii=False, indent=2)
```

---

## ⚡ 性能问题

### 问题12：程序运行缓慢

#### 症状
数据分析或可视化非常慢

#### 解决方案

**优化NumPy性能**:
```bash
# 安装Intel MKL加速的NumPy（Intel CPU）
pip uninstall numpy
pip install numpy[mkl]

# 或使用conda安装（包含MKL）
conda install numpy
```

**使用进度条**:
```python
from tqdm import tqdm
import time

# 循环中显示进度
for i in tqdm(range(1000), desc="处理中"):
    # 你的代码
    time.sleep(0.01)
```

**优化数据处理**:
```python
import numpy as np
import pandas as pd

# 错误：使用循环
total = 0
for i in range(len(data)):
    total += data[i]

# 正确：使用向量化操作
total = np.sum(data)

# Pandas也应该避免循环
# 错误
for idx, row in df.iterrows():
    df.at[idx, 'new_col'] = row['col1'] + row['col2']

# 正确
df['new_col'] = df['col1'] + df['col2']
```

---

### 问题13：内存不足

#### 症状
```
MemoryError
```

#### 解决方案

**分批处理**:
```python
# 大数据分批处理
chunk_size = 1000
for i in range(0, len(data), chunk_size):
    chunk = data[i:i+chunk_size]
    process(chunk)
    # 处理完及时释放
    del chunk
```

**使用生成器**:
```python
# 错误：一次性加载所有数据
def load_all_data():
    return [process(item) for item in huge_dataset]

# 正确：使用生成器
def load_data_generator():
    for item in huge_dataset:
        yield process(item)
```

**减少图表分辨率**:
```python
# 保存图表时降低DPI
plt.savefig('plot.png', dpi=100)  # 而不是300
```

---

## 🖥️ 系统兼容性问题

### 问题14：Windows文件名太长

#### 症状
```
OSError: [Errno 63] File name too long
```

#### 解决方案

**修改文件名**:
```python
# 使用较短的文件名
# 错误
filename = "学习报告-2025-11-12-包含所有书籍进度和详细分析.md"

# 正确
filename = "学习报告-20251112.md"
```

**使用短路径**:
```bash
# 将项目放在较短的路径
C:\Projects\15books\
# 而不是
C:\Users\VeryLongUsername\Documents\MyProjects\15books\
```

---

### 问题15：macOS安全限制

#### 症状
```
"Python" cannot be opened because the developer cannot be verified.
```

#### 解决方案
```bash
# 临时允许
sudo xattr -r -d com.apple.quarantine /path/to/python

# 或在系统偏好设置中
# 系统偏好设置 → 安全性与隐私 → 通用 → 仍要打开
```

---

### 问题16：Linux依赖缺失

#### 症状
```
ImportError: libXXX.so: cannot open shared object file
```

#### 解决方案

**Ubuntu/Debian**:
```bash
# Matplotlib依赖
sudo apt install python3-tk

# 图形库依赖
sudo apt install libfreetype6-dev libpng-dev

# 完整开发工具
sudo apt install build-essential python3-dev
```

**CentOS/RHEL**:
```bash
sudo yum install python3-tkinter
sudo yum install freetype-devel libpng-devel
sudo yum groupinstall "Development Tools"
```

---

## 🆘 获取更多帮助

### 诊断信息收集

运行以下命令收集诊断信息：

```bash
# 1. Python版本
python --version

# 2. pip版本
pip --version

# 3. 已安装包列表
pip list

# 4. 系统信息
uname -a  # Linux/macOS
systeminfo  # Windows

# 5. 环境变量
env | grep PYTHON  # Linux/macOS
set | findstr PYTHON  # Windows

# 6. 运行验证脚本
python 🔧项目验证脚本.py > diagnostic_report.txt 2>&1
```

### 报告问题

在报告问题时，请提供：

1. **错误信息**：完整的错误堆栈
2. **系统信息**：操作系统、Python版本
3. **复现步骤**：如何触发错误
4. **已尝试的解决方案**：你已经尝试过什么

**提交Issue模板**:
```markdown
### 问题描述
简要描述问题

### 错误信息
​```
粘贴完整错误堆栈
​```

### 环境信息
- 操作系统：
- Python版本：
- 相关库版本：

### 复现步骤
1. 第一步...
2. 第二步...

### 已尝试的解决方案
- 尝试了XXX，结果XXX
```

---

## 📚 相关资源

- [🛠️安装部署指南.md](./🛠️安装部署指南.md) - 详细安装说明
- [❓常见问题FAQ.md](./❓常见问题FAQ.md) - 更多常见问题
- [README.md](./README.md) - 项目主页
- [CONTRIBUTING.md](./CONTRIBUTING.md) - 贡献指南

---

## ✅ 问题解决检查清单

问题解决后，请确认：

- [ ] 问题已完全解决
- [ ] 了解了问题原因
- [ ] 记录了解决方案（便于后续参考）
- [ ] 验证了修复不会引入新问题
- [ ] 更新了相关配置（如需要）

---

**💡 提示**：90%的问题都可以通过以下方式解决：
1. 使用国内镜像安装依赖
2. 使用虚拟环境隔离
3. 检查Python版本和解释器
4. 正确配置字符编码

---

**© 2025 15本考研书系列开发组**

**版本**: v1.5  
**更新**: 2025-11-12
