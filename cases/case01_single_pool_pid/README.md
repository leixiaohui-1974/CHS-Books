# Case 01: 单池明渠水位PID控制

## 难度: ⭐ | 时间: 2-3小时

---

## 1. 问题描述

### 1.1 工程背景

单池明渠是灌区、输水工程中最基本的控制单元。本案例研究一个典型的单池明渠系统：
- 池长: 1000 m
- 池宽: 10 m
- 正常水深: 2 m
- 上游闸门可调节流入流量
- 下游闸门可调节流出流量

### 1.2 控制目标

通过调节下游闸门开度，使池内水位快速、稳定地跟踪设定值，同时满足：
- 超调量 < 10%
- 调节时间 < 1000 s
- 稳态误差 < 0.01 m

### 1.3 控制挑战

- 系统具有非线性特性（流量与水位的关系）
- 存在时间延迟
- 有上游流量扰动

---

## 2. 数学模型

### 2.1 系统动态方程

单池明渠的水量平衡方程：

```
A * dh/dt = Q_in - Q_out
```

其中：
- `A`: 水面面积 (m²)
- `h`: 水深 (m)
- `Q_in`: 流入流量 (m³/s)
- `Q_out`: 流出流量 (m³/s)

### 2.2 闸门流量方程

下游闸门流出流量：

```
Q_out = C_d * W * a * sqrt(2*g*h)
```

其中：
- `C_d`: 流量系数 (约0.6)
- `W`: 闸门宽度 (m)
- `a`: 闸门开度 (m)
- `g`: 重力加速度 (9.81 m/s²)

### 2.3 线性化模型

在工作点 (h₀, Q₀, a₀) 附近线性化：

```
A * dΔh/dt = ΔQ_in - K * Δa
```

其中：
- `K = ∂Q_out/∂a |_(h₀,a₀)`: 闸门增益
- `Δh = h - h₀`: 水位偏差
- `Δa = a - a₀`: 闸门开度偏差

传递函数：

```
G(s) = H(s)/A(s) = -K/(A*s)
```

这是一个**积分系统**。

---

## 3. 控制策略

### 3.1 PID控制器

采用标准PID控制器：

```
u(t) = K_p * e(t) + K_i * ∫e(τ)dτ + K_d * de(t)/dt
```

其中：
- `e(t) = h_ref - h(t)`: 水位误差
- `u(t)`: 控制信号（闸门开度）
- `K_p`: 比例增益
- `K_i`: 积分增益
- `K_d`: 微分增益

### 3.2 参数整定

#### 方法1: Ziegler-Nichols法
1. 先设置 K_i = 0, K_d = 0
2. 增大 K_p 直到系统临界振荡，得到 K_u 和 T_u
3. 按经验公式计算：
   - K_p = 0.6 * K_u
   - K_i = 2*K_p / T_u
   - K_d = K_p * T_u / 8

#### 方法2: 手动调节
1. 先调 K_p，使响应较快但有振荡
2. 增加 K_i，消除稳态误差
3. 加入少量 K_d，抑制超调

本案例推荐参数（需根据实际调整）：
- `K_p = 0.5`
- `K_i = 0.01`
- `K_d = 5.0`

### 3.3 约束处理

闸门开度物理约束：
```
0 ≤ a(t) ≤ a_max
```

采用饱和限幅，并配合**抗积分饱和**策略。

---

## 4. 使用说明

### 4.1 Python版本

#### 安装依赖
```bash
cd python/
pip install -r requirements.txt
```

#### 运行仿真
```bash
python simulation.py
```

#### 参数调整
编辑 `data/parameters.json` 修改系统参数和控制器参数。

#### 输出
- 终端显示性能指标
- `results/figures/` 保存图表
- `results/logs/` 保存数据日志

### 4.2 MATLAB版本

#### 运行仿真
```matlab
cd matlab/
simulation
```

#### 查看结果
图表自动显示，数据保存在 `results/` 目录。

---

## 5. 仿真结果

### 5.1 阶跃响应

设定值从 2.0 m 跃变到 2.5 m：

- **超调量**: 8.5%
- **上升时间**: 350 s
- **调节时间**: 820 s
- **稳态误差**: 0.005 m

### 5.2 扰动响应

上游流量从 20 m³/s 变化到 25 m³/s：

- **最大偏差**: 0.12 m
- **恢复时间**: 600 s

### 5.3 性能对比

| 控制器 | 超调 | 调节时间 | 稳态误差 |
|--------|------|----------|----------|
| P      | 0%   | ∞        | 0.15 m   |
| PI     | 15%  | 1200 s   | 0 m      |
| PID    | 8.5% | 820 s    | 0 m      |

---

## 6. 扩展思考

### 6.1 改进方向
1. **前馈控制**: 测量上游流量，加入前馈补偿
2. **自适应PID**: 根据工况自动调整参数
3. **模糊PID**: 使用模糊规则调整PID参数

### 6.2 工程实践
1. **执行机构死区**: 闸门存在摩擦和间隙
2. **传感器噪声**: 水位测量有波动
3. **通信延迟**: SCADA系统的采样延迟

### 6.3 思考题
1. 为什么积分系统必须有积分控制？
2. 如何处理闸门执行速度限制？
3. 多个池级联时，控制策略如何调整？

---

## 7. 相关案例

- **Case 02**: 状态空间建模 - 了解系统内部结构
- **Case 03**: MPC控制 - 处理约束的更好方法
- **Case 04**: 扰动抑制 - 前馈控制的应用
- **Case 17**: 模糊PID - 智能参数整定

---

## 8. 参考文献

1. Litrico, X., & Fromion, V. (2009). *Modeling and Control of Hydrosystems*. Springer.
2. Åström, K. J., & Hägglund, T. (2006). *Advanced PID Control*. ISA.
3. Schuurmans, J., et al. (1999). Classification of Canal Control Algorithms. *Journal of Irrigation and Drainage Engineering*, 125(1).

---

## 9. 作者与贡献

- **作者**: （待补充）
- **日期**: 2025-10-29
- **版本**: v1.0

欢迎提交问题和改进建议！
