# 📋 前端用户系统测试指南

**测试日期**: 2025-11-12  
**系统版本**: V1.1  
**测试范围**: 用户注册、登录、个人中心

---

## 🚀 快速开始

### 1. 启动后端服务

```bash
cd /workspace/platform/backend

# 确保数据库迁移已完成
alembic upgrade head

# 启动FastAPI服务
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

### 2. 启动前端服务

```bash
cd /workspace/platform/frontend

# 安装依赖（如果还没有）
npm install

# 启动开发服务器
npm run dev
```

### 3. 访问应用

```
前端地址: http://localhost:3000
后端API: http://localhost:8000
API文档: http://localhost:8000/docs
```

---

## 📝 测试清单

### ✅ 用户注册流程测试

#### 测试用例 1: 邮箱注册（正常流程）

**步骤**:
1. 访问 `http://localhost:3000/register`
2. 步骤1: 输入用户名 `testuser001`
3. 选择"邮箱注册"
4. 输入邮箱 `testuser001@example.com`
5. 点击"下一步"
6. 步骤2: 输入密码 `Test1234`
7. 确认密码 `Test1234`
8. 点击"下一步"
9. 步骤3: 点击"获取验证码"
10. 输入收到的验证码 (6位数字)
11. 勾选"同意服务条款"
12. 点击"完成注册"

**预期结果**:
- ✅ 每个步骤表单验证正常
- ✅ 用户名唯一性检查工作正常
- ✅ 验证码成功发送到邮箱
- ✅ 注册成功后自动登录
- ✅ 跳转到 `/dashboard` 页面
- ✅ 显示成功提示消息

**注意事项**:
- 需要配置有效的SMTP服务器才能接收验证码
- 或者从后端日志中查看验证码（开发模式）

---

#### 测试用例 2: 手机注册（正常流程）

**步骤**:
1. 访问 `http://localhost:3000/register`
2. 步骤1: 输入用户名 `testuser002`
3. 选择"手机注册"
4. 输入手机号 `13800138000`
5. 点击"下一步"
6. 步骤2: 输入密码 `Test1234`
7. 确认密码 `Test1234`
8. 点击"下一步"
9. 步骤3: 点击"获取验证码"
10. 输入验证码
11. 勾选"同意服务条款"
12. 点击"完成注册"

**预期结果**:
- ✅ 手机号格式验证正常
- ✅ 验证码发送成功
- ✅ 注册成功

**注意事项**:
- 需要配置阿里云SMS服务
- 开发模式下可能需要从后端日志查看验证码

---

#### 测试用例 3: 注册异常情况

**测试点 A: 用户名已存在**
```
1. 输入已存在的用户名
2. 预期: 显示"用户名已被使用"错误
```

**测试点 B: 邮箱已存在**
```
1. 输入已注册的邮箱
2. 预期: 显示"邮箱已被使用"错误
```

**测试点 C: 密码不符合要求**
```
1. 输入弱密码（如"123456"）
2. 预期: 显示"密码必须包含大小写字母和数字"
```

**测试点 D: 两次密码不一致**
```
1. 确认密码输入不同的值
2. 预期: 显示"两次输入的密码不一致"
```

**测试点 E: 验证码错误**
```
1. 输入错误的验证码
2. 预期: 后端返回"验证码错误"
```

**测试点 F: 验证码过期**
```
1. 等待5分钟后输入验证码
2. 预期: 后端返回"验证码已过期"
```

---

### ✅ 用户登录流程测试

#### 测试用例 4: 账号密码登录

**步骤**:
1. 访问 `http://localhost:3000/login`
2. 切换到"账号登录" Tab
3. 输入用户名 `testuser001`
4. 输入密码 `Test1234`
5. 勾选"记住我"（可选）
6. 点击"登录"

**预期结果**:
- ✅ 登录成功
- ✅ 跳转到 `/dashboard`
- ✅ Token保存到localStorage
- ✅ 显示成功提示

**测试点 A: 使用邮箱登录**
```
1. 输入 testuser001@example.com
2. 输入密码
3. 预期: 登录成功
```

**测试点 B: 使用手机号登录**
```
1. 输入 13800138000
2. 输入密码
3. 预期: 登录成功
```

**测试点 C: 错误密码**
```
1. 输入正确用户名
2. 输入错误密码
3. 预期: 显示"登录失败，请检查用户名和密码"
```

**测试点 D: 不存在的用户**
```
1. 输入不存在的用户名
2. 预期: 显示登录失败提示
```

---

#### 测试用例 5: 短信验证码登录

**步骤**:
1. 访问 `http://localhost:3000/login`
2. 切换到"短信登录" Tab
3. 输入手机号 `13800138000`
4. 点击"获取验证码"
5. 输入收到的验证码
6. 点击"登录"

**预期结果**:
- ✅ 验证码发送成功
- ✅ 登录成功
- ✅ 跳转到 `/dashboard`

**测试点 A: 验证码倒计时**
```
1. 点击"获取验证码"
2. 预期: 显示"60秒后重发"倒计时
3. 按钮变为禁用状态
4. 60秒后恢复可点击
```

**测试点 B: 错误验证码**
```
1. 输入错误的验证码
2. 预期: 显示"验证码错误"
```

---

#### 测试用例 6: 记住登录状态

**步骤**:
1. 登录时勾选"记住我"
2. 登录成功
3. 关闭浏览器
4. 重新打开浏览器
5. 访问需要登录的页面（如 `/profile`）

**预期结果**:
- ✅ 无需重新登录
- ✅ Token仍然有效
- ✅ 自动加载用户信息

---

### ✅ 个人中心测试

#### 测试用例 7: 查看个人信息

**步骤**:
1. 登录成功后
2. 访问 `http://localhost:3000/profile`

**预期结果**:
- ✅ 显示用户头像
- ✅ 显示用户名和全名
- ✅ 显示会员状态和认证标识
- ✅ 显示个人简介
- ✅ 显示学习统计数据
- ✅ 显示账号详细信息
- ✅ 显示安全设置

**检查项**:
```
□ 用户ID正确
□ 用户名正确
□ 邮箱正确（含验证状态）
□ 手机号正确（含验证状态）
□ 注册时间格式正确
□ 最后登录时间正确
□ 账号状态显示正确
□ 学习时长格式化正确
□ 登录次数正确
```

---

#### 测试用例 8: 编辑个人资料

**步骤**:
1. 在个人中心点击"编辑资料"
2. 修改"全名"为 `张三`
3. 修改"个人简介"为 `热爱学习的工程师`
4. 点击"保存"

**预期结果**:
- ✅ Modal弹窗显示
- ✅ 表单预填充当前值
- ✅ 保存成功提示
- ✅ 页面信息自动更新
- ✅ Modal自动关闭

**测试点 A: 取消编辑**
```
1. 点击"编辑资料"
2. 修改内容
3. 点击"取消"
4. 预期: Modal关闭，内容未保存
```

---

#### 测试用例 9: 修改密码

**步骤**:
1. 在"安全设置"中点击密码的"修改"按钮
2. 输入当前密码 `Test1234`
3. 输入新密码 `NewPass1234`
4. 确认新密码 `NewPass1234`
5. 点击"确认修改"

**预期结果**:
- ✅ Modal弹窗显示
- ✅ 密码验证规则正常工作
- ✅ 修改成功提示
- ✅ 自动跳转到登录页
- ✅ 需要重新登录

**测试点 A: 当前密码错误**
```
1. 输入错误的当前密码
2. 预期: 显示"当前密码错误"
```

**测试点 B: 新密码不符合要求**
```
1. 输入弱密码
2. 预期: 显示密码强度错误
```

**测试点 C: 两次新密码不一致**
```
1. 确认密码输入不同值
2. 预期: 显示"两次输入的密码不一致"
```

**测试点 D: 验证修改生效**
```
1. 修改密码成功
2. 使用新密码登录
3. 预期: 登录成功
4. 使用旧密码登录
5. 预期: 登录失败
```

---

#### 测试用例 10: 退出登录

**步骤**:
1. 在个人中心点击"退出登录"
2. 在确认对话框中点击"确定"

**预期结果**:
- ✅ 显示确认对话框
- ✅ 退出成功提示
- ✅ 跳转到登录页
- ✅ Token被清除
- ✅ 无法访问需要认证的页面

**测试点 A: 取消退出**
```
1. 点击"退出登录"
2. 点击"取消"
3. 预期: 对话框关闭，保持登录状态
```

---

### ✅ 忘记密码流程测试

#### 测试用例 11: 忘记密码

**步骤**:
1. 在登录页点击"忘记密码？"
2. 输入邮箱 `testuser001@example.com`
3. 点击"发送重置链接"

**预期结果**:
- ✅ 发送成功提示
- ✅ 显示成功页面
- ✅ 邮件发送到指定邮箱
- ✅ 邮件包含重置链接

**测试点 A: 邮箱不存在**
```
1. 输入未注册的邮箱
2. 预期: 可能显示"邮箱不存在"或为了安全仍显示成功
```

---

### ✅ Token刷新测试

#### 测试用例 12: 自动刷新Token

**步骤**:
1. 登录成功
2. 等待Token即将过期（如29分钟，如果30分钟过期）
3. 发起任意API请求

**预期结果**:
- ✅ 自动使用refresh_token刷新access_token
- ✅ 请求成功
- ✅ 用户无感知

**测试点 A: Refresh Token过期**
```
1. 等待Refresh Token过期（如7天）
2. 发起请求
3. 预期: 自动跳转到登录页
```

---

### ✅ 路由保护测试

#### 测试用例 13: 未登录访问受保护页面

**步骤**:
1. 清除所有Token（localStorage）
2. 直接访问 `http://localhost:3000/profile`

**预期结果**:
- ✅ 自动跳转到 `/login?redirect=/profile`
- ✅ 登录成功后自动跳转回 `/profile`

**测试点**:
```
受保护页面:
□ /profile
□ /dashboard
□ /settings
□ /achievements

公开页面:
□ /
□ /login
□ /register
□ /forgot-password
```

---

### ✅ 响应式设计测试

#### 测试用例 14: 移动端适配

**测试设备**:
- 桌面端 (>1200px)
- 平板端 (768px - 1200px)
- 手机端 (<768px)

**检查项**:
```
注册页面:
□ 卡片宽度自适应
□ 步骤指示器在移动端正常显示
□ 按钮在移动端全宽
□ 输入框大小适配

登录页面:
□ Tab切换正常
□ OAuth按钮在移动端单列显示
□ 表单元素自适应

个人中心:
□ 头像和信息在移动端垂直排列
□ 统计卡片在移动端单列
□ Modal在移动端全屏或适配
```

---

## 🐛 常见问题排查

### 问题 1: 验证码收不到

**可能原因**:
- SMTP配置不正确
- 邮箱被拦截为垃圾邮件

**解决方法**:
1. 检查后端 `.env` 文件中的SMTP配置
2. 查看后端日志中的验证码（开发模式）
3. 检查垃圾邮件文件夹

---

### 问题 2: 登录后立即跳转到登录页

**可能原因**:
- Token没有正确保存
- CORS配置问题

**解决方法**:
1. 打开浏览器开发者工具
2. 检查 localStorage 是否有 `access_token`
3. 检查后端CORS配置
4. 查看浏览器控制台错误

---

### 问题 3: API请求失败

**可能原因**:
- 后端服务未启动
- 前端API地址配置错误
- CORS问题

**解决方法**:
1. 确认后端服务运行在 `http://localhost:8000`
2. 检查 `.env.local` 中的 `NEXT_PUBLIC_API_URL`
3. 查看浏览器Network面板
4. 查看后端日志

---

### 问题 4: 页面样式错误

**可能原因**:
- CSS文件未导入
- Ant Design样式冲突

**解决方法**:
1. 检查CSS文件路径
2. 清除浏览器缓存
3. 重启开发服务器

---

## 📊 测试报告模板

### 测试结果记录

```
测试日期: ________
测试人员: ________
测试环境: □ 开发 □ 生产

功能测试:
□ 用户注册 - 邮箱      [ ] 通过  [ ] 失败  备注:_______
□ 用户注册 - 手机      [ ] 通过  [ ] 失败  备注:_______
□ 账号密码登录         [ ] 通过  [ ] 失败  备注:_______
□ 短信验证码登录       [ ] 通过  [ ] 失败  备注:_______
□ 查看个人信息         [ ] 通过  [ ] 失败  备注:_______
□ 编辑个人资料         [ ] 通过  [ ] 失败  备注:_______
□ 修改密码            [ ] 通过  [ ] 失败  备注:_______
□ 退出登录            [ ] 通过  [ ] 失败  备注:_______
□ 忘记密码            [ ] 通过  [ ] 失败  备注:_______
□ Token刷新          [ ] 通过  [ ] 失败  备注:_______
□ 路由保护            [ ] 通过  [ ] 失败  备注:_______

界面测试:
□ 桌面端显示          [ ] 通过  [ ] 失败  备注:_______
□ 平板端显示          [ ] 通过  [ ] 失败  备注:_______
□ 手机端显示          [ ] 通过  [ ] 失败  备注:_______

性能测试:
□ 页面加载速度        [ ] 通过  [ ] 失败  备注:_______
□ API响应速度         [ ] 通过  [ ] 失败  备注:_______

安全测试:
□ 密码强度验证        [ ] 通过  [ ] 失败  备注:_______
□ Token安全          [ ] 通过  [ ] 失败  备注:_______
□ 输入验证            [ ] 通过  [ ] 失败  备注:_______

总体评价: _________________________________
建议改进: _________________________________
```

---

## 🎯 下一步计划

测试完成后，根据结果决定：

1. **如果测试通过**: 
   - 准备生产部署
   - 开始V1.2功能开发（OAuth, 2FA, SMS）

2. **如果发现问题**: 
   - 记录bug详情
   - 修复问题
   - 重新测试

---

**祝测试顺利！** 🎉
