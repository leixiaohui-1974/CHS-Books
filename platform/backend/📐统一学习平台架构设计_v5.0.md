# ğŸ“ ç»Ÿä¸€å­¦ä¹ å¹³å°æ¶æ„è®¾è®¡ v5.0

## ğŸ¯ è®¾è®¡ç›®æ ‡

åŸºäºç”¨æˆ·åé¦ˆ"åˆ‡æ¢ä¹¦ç¨¿ï¼Œä¸­é—´çš„ç« èŠ‚æ˜¯ç©ºçš„ï¼Œå¦å¤–ï¼Œè¿™ä¸ªæ€ä¹ˆè¡”æ¥åˆ°è¿™æœ¬ä¹¦çš„æ‰€æœ‰æ¡ˆä¾‹é‡Œé¢"ï¼Œé‡æ–°è®¾è®¡ä¸€ä¸ª**ä»¥æ•™æä¸ºä¸»çº¿ã€æ¡ˆä¾‹ä¸ºå®è·µ**çš„ç»Ÿä¸€å­¦ä¹ å¹³å°ã€‚

---

## ğŸ” å½“å‰é—®é¢˜åˆ†æ

### 1. ç« èŠ‚æ˜¾ç¤ºä¸ºç©º
- **åŸå› **: å‰ç«¯æŸ¥è¯¢æ•™ææ—¶ï¼Œåç«¯APIè¿”å›çš„ç« èŠ‚æ•°æ®ä¸å®Œæ•´
- **å®é™…æƒ…å†µ**: æ•°æ®åº“ä¸­æœ‰622ä¸ªç« èŠ‚ï¼Œä½†å‰ç«¯æ˜¾ç¤º"æš‚æ— ç« èŠ‚"
- **æ ¹æœ¬é—®é¢˜**: APIè¿”å›æ ¼å¼æˆ–å‰ç«¯æ¸²æŸ“é€»è¾‘æœ‰é—®é¢˜

### 2. æ•™æä¸æ¡ˆä¾‹åˆ†ç¦»
- **ç°çŠ¶**: æ•™æå’Œæ¡ˆä¾‹æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„é€‰é¡¹å¡
- **é—®é¢˜**: ç”¨æˆ·æ— æ³•ç›´è§‚çœ‹åˆ°æ•™æç« èŠ‚å¯¹åº”çš„å®è·µæ¡ˆä¾‹
- **æ•°æ®**: æ•°æ®åº“ä¸­å·²æœ‰243ä¸ªç« èŠ‚-æ¡ˆä¾‹å…³è”ï¼Œä½†æœªå±•ç¤º

### 3. å­¦ä¹ è·¯å¾„ä¸æ¸…æ™°
- **ç°çŠ¶**: ç”¨æˆ·éœ€è¦æ‰‹åŠ¨åœ¨æ•™æå’Œæ¡ˆä¾‹ä¹‹é—´åˆ‡æ¢
- **é—®é¢˜**: ç¼ºä¹"ç†è®ºâ†’å®è·µâ†’åæ€"çš„å­¦ä¹ é—­ç¯
- **ç›®æ ‡**: æä¾›ä¸€ä½“åŒ–çš„å­¦ä¹ ä½“éªŒ

---

## ğŸ¨ æ–°æ¶æ„è®¾è®¡

### æ€»ä½“å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“š æ°´ç³»ç»Ÿæ§åˆ¶ç†è®ºæ•™ç¨‹                                    [ğŸ¨ ä¸»é¢˜]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        â”‚                                              â”‚              â”‚
â”‚  æ•™æ   â”‚           ğŸ“– ç« èŠ‚å†…å®¹                        â”‚   ğŸ¤– AIåŠ©æ‰‹  â”‚
â”‚  ç›®å½•   â”‚                                              â”‚              â”‚
â”‚        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   [å¯¹è¯æ¡†]   â”‚
â”‚ ğŸ“– æ•™æ1 â”‚  â”‚ ç¬¬1ç«  æ§åˆ¶ç³»ç»ŸåŸºç¡€                    â”‚   â”‚              â”‚
â”‚  â”œ 1.1  â”‚  â”‚                                      â”‚   â”‚   [è¾“å…¥æ¡†]   â”‚
â”‚  â”œ 1.2  â”‚  â”‚ 1.1 æ§åˆ¶ç³»ç»Ÿæ¦‚è¿°                      â”‚   â”‚   [å‘é€]     â”‚
â”‚  â”” 1.3  â”‚  â”‚   æ§åˆ¶ç³»ç»Ÿæ˜¯æŒ‡...ï¼ˆMarkdownå†…å®¹ï¼‰      â”‚   â”‚              â”‚
â”‚         â”‚  â”‚                                      â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“– æ•™æ2 â”‚  â”‚ ğŸ“Š æœ¬ç« ç»Ÿè®¡:                          â”‚   â”‚   ğŸ’» ç»ˆç«¯    â”‚
â”‚  â”œ 2.1  â”‚  â”‚   â€¢ é¢„è®¡å­¦æ—¶: 2å°æ—¶                   â”‚   â”‚              â”‚
â”‚  â”” 2.2  â”‚  â”‚   â€¢ çŸ¥è¯†ç‚¹: 5ä¸ª                       â”‚   â”‚   [è¾“å‡º]     â”‚
â”‚         â”‚  â”‚   â€¢ é…å¥—æ¡ˆä¾‹: 3ä¸ª                     â”‚   â”‚   [æ¸…ç©º]     â”‚
â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚              â”‚
â”‚         â”‚                                              â”‚              â”‚
â”‚         â”‚  ğŸ’¡ é…å¥—å®è·µæ¡ˆä¾‹                              â”‚              â”‚
â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚              â”‚
â”‚         â”‚  â”‚ ğŸ’§ æ¡ˆä¾‹1: å®¶åº­æ°´å¡”è‡ªåŠ¨ä¾›æ°´ç³»ç»Ÿ          â”‚   â”‚              â”‚
â”‚         â”‚  â”‚   å…³è”ç±»å‹: å®è·µç»ƒä¹  | ç›¸å…³åº¦: â­â­â­â­â­  â”‚   â”‚              â”‚
â”‚         â”‚  â”‚   [ğŸ“– æŸ¥çœ‹æ–‡æ¡£] [â–¶ï¸ è¿è¡Œä»£ç ]           â”‚   â”‚              â”‚
â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚              â”‚
â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚              â”‚
â”‚         â”‚  â”‚ ğŸ­ æ¡ˆä¾‹2: å·¥ä¸šå†·å´å¡”ç²¾ç¡®æ°´ä½æ§åˆ¶        â”‚   â”‚              â”‚
â”‚         â”‚  â”‚   å…³è”ç±»å‹: ç†è®ºéªŒè¯ | ç›¸å…³åº¦: â­â­â­â­    â”‚   â”‚              â”‚
â”‚         â”‚  â”‚   [ğŸ“– æŸ¥çœ‹æ–‡æ¡£] [â–¶ï¸ è¿è¡Œä»£ç ]           â”‚   â”‚              â”‚
â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚              â”‚
â”‚         â”‚                                              â”‚              â”‚
â”‚         â”‚  ğŸ”— ç›¸å…³çŸ¥è¯†ç‚¹                                â”‚              â”‚
â”‚         â”‚  â€¢ åé¦ˆæ§åˆ¶åŸç† â†’ [çŸ¥è¯†åº“]                    â”‚              â”‚
â”‚         â”‚  â€¢ PIDæ§åˆ¶å™¨ â†’ [çŸ¥è¯†åº“]                      â”‚              â”‚
â”‚         â”‚                                              â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ æ ¸å¿ƒè®¾è®¡ç†å¿µ

### 1. ä»¥æ•™æä¸ºä¸»çº¿
- å·¦ä¾§é¢æ¿ï¼šå®Œæ•´çš„æ•™æç›®å½•æ ‘
- ç‚¹å‡»ç« èŠ‚ â†’ ä¸»è§†å›¾æ˜¾ç¤ºç« èŠ‚å†…å®¹ + é…å¥—æ¡ˆä¾‹
- æ•™ææ˜¯"è·¯çº¿å›¾"ï¼Œæ¡ˆä¾‹æ˜¯"å®è·µç«™"

### 2. æ— ç¼è¡”æ¥æ¡ˆä¾‹
- æ¯ä¸ªç« èŠ‚ä¸‹æ–¹è‡ªåŠ¨æ˜¾ç¤ºå…³è”çš„æ¡ˆä¾‹åˆ—è¡¨
- æ˜¾ç¤ºå…³è”ç±»å‹ï¼ˆç†è®ºéªŒè¯/å®è·µç»ƒä¹ /æ‰©å±•å­¦ä¹ /å¯¹æ¯”åˆ†æï¼‰
- æ˜¾ç¤ºç›¸å…³åº¦ï¼ˆæ˜Ÿçº§è¯„åˆ†ï¼‰
- ä¸€é”®åˆ‡æ¢åˆ°æ¡ˆä¾‹æ–‡æ¡£æˆ–ä»£ç è¿è¡Œ

### 3. å­¦ä¹ é—­ç¯
```
ç†è®ºå­¦ä¹  (ç« èŠ‚å†…å®¹)
    â†“
å®è·µåº”ç”¨ (æ¡ˆä¾‹è¿è¡Œ)
    â†“
AIè¾…å¯¼ (ç­”ç–‘è§£æƒ‘)
    â†“
çŸ¥è¯†å·©å›º (çŸ¥è¯†åº“é“¾æ¥)
```

---

## ğŸ“Š æ•°æ®æµè®¾è®¡

### APIè®¾è®¡

#### 1. è·å–æ•™æç›®å½•æ ‘
```
GET /api/textbooks/tree
è¿”å›: æ‰€æœ‰æ•™æåŠå…¶ç« èŠ‚çš„æ ‘å½¢ç»“æ„
```

#### 2. è·å–ç« èŠ‚è¯¦æƒ…ï¼ˆå«æ¡ˆä¾‹ï¼‰
```
GET /api/textbooks/{book_id}/chapters/{chapter_id}/full
è¿”å›: 
{
  "chapter": {
    "id": "xxx",
    "title": "æ§åˆ¶ç³»ç»Ÿæ¦‚è¿°",
    "content": "...",
    "metadata": {...}
  },
  "related_cases": [
    {
      "case_id": "case1",
      "title": "å®¶åº­æ°´å¡”è‡ªåŠ¨ä¾›æ°´ç³»ç»Ÿ",
      "relation_type": "practice",
      "relevance_score": 0.95,
      "description": "æœ¬æ¡ˆä¾‹ç”¨äºå®è·µæœ¬ç« çš„åé¦ˆæ§åˆ¶åŸç†"
    }
  ],
  "related_knowledge": [
    {"id": "kb1", "title": "åé¦ˆæ§åˆ¶åŸç†"}
  ]
}
```

#### 3. è·å–æ¡ˆä¾‹è¯¦æƒ…
```
GET /api/cases/{case_id}/full
è¿”å›: æ¡ˆä¾‹çš„READMEã€ä»£ç ã€è¿è¡Œç»“æœ
```

---

## ğŸ¯ å‰ç«¯å®ç°æ–¹æ¡ˆ

### 1. å·¦ä¾§é¢æ¿ï¼šæ•™æç›®å½•æ ‘

```javascript
// æ•°æ®ç»“æ„
{
  "textbooks": [
    {
      "id": 1,
      "title": "æ°´ç³»ç»Ÿæ§åˆ¶è®º",
      "chapters": [
        {
          "id": "c1",
          "chapter_number": "1",
          "title": "æ§åˆ¶ç³»ç»ŸåŸºç¡€",
          "level": 1,
          "children": [
            {
              "id": "c1.1",
              "chapter_number": "1.1",
              "title": "æ§åˆ¶ç³»ç»Ÿæ¦‚è¿°",
              "level": 2,
              "has_cases": true,  // æ ‡è¯†æœ‰é…å¥—æ¡ˆä¾‹
              "case_count": 3
            }
          ]
        }
      ]
    }
  ]
}

// æ¸²æŸ“é€»è¾‘
function renderTextbookTree(textbooks) {
  return textbooks.map(book => `
    <div class="textbook-node">
      <div class="textbook-title" onclick="toggleBook(${book.id})">
        ğŸ“– ${book.title}
      </div>
      <div class="chapter-list" id="book-${book.id}">
        ${renderChapters(book.chapters)}
      </div>
    </div>
  `);
}

function renderChapters(chapters) {
  return chapters.map(ch => `
    <div class="chapter-node level-${ch.level}">
      <div class="chapter-title" onclick="loadChapter('${ch.id}')">
        ${ch.chapter_number} ${ch.title}
        ${ch.has_cases ? '<span class="case-badge">ğŸ’¡' + ch.case_count + '</span>' : ''}
      </div>
      ${ch.children ? renderChapters(ch.children) : ''}
    </div>
  `);
}
```

### 2. ä¸»è§†å›¾ï¼šç« èŠ‚å†…å®¹ + æ¡ˆä¾‹åˆ—è¡¨

```javascript
async function loadChapter(chapterId) {
  showLoading();
  
  const response = await fetch(`/api/textbooks/chapters/${chapterId}/full`);
  const data = await response.json();
  
  const html = `
    <div class="chapter-view">
      <!-- ç« èŠ‚å†…å®¹ -->
      <div class="chapter-content">
        <h1>${data.chapter.title}</h1>
        <div class="chapter-meta">
          <span>ğŸ“– é¢„è®¡å­¦æ—¶: ${data.chapter.estimated_minutes}åˆ†é’Ÿ</span>
          <span>ğŸ¯ éš¾åº¦: ${data.chapter.difficulty}</span>
          <span>ğŸ’¡ æ¡ˆä¾‹: ${data.related_cases.length}ä¸ª</span>
        </div>
        <div class="chapter-body">
          ${marked.parse(data.chapter.content)}
        </div>
      </div>
      
      <!-- é…å¥—æ¡ˆä¾‹åˆ—è¡¨ -->
      ${data.related_cases.length > 0 ? `
        <div class="related-cases">
          <h2>ğŸ’¡ é…å¥—å®è·µæ¡ˆä¾‹</h2>
          ${renderRelatedCases(data.related_cases)}
        </div>
      ` : ''}
      
      <!-- ç›¸å…³çŸ¥è¯†ç‚¹ -->
      ${data.related_knowledge.length > 0 ? `
        <div class="related-knowledge">
          <h3>ğŸ”— ç›¸å…³çŸ¥è¯†ç‚¹</h3>
          ${renderKnowledgeLinks(data.related_knowledge)}
        </div>
      ` : ''}
    </div>
  `;
  
  document.getElementById('mainView').innerHTML = html;
}

function renderRelatedCases(cases) {
  return cases.map(c => `
    <div class="case-card">
      <div class="case-header">
        <h3>${c.icon} ${c.title}</h3>
        <div class="case-meta">
          <span class="relation-type">${getRelationType(c.relation_type)}</span>
          <span class="relevance-score">${'â­'.repeat(Math.round(c.relevance_score * 5))}</span>
        </div>
      </div>
      <p class="case-description">${c.description}</p>
      <div class="case-actions">
        <button onclick="viewCaseDoc('${c.case_id}')">ğŸ“– æŸ¥çœ‹æ–‡æ¡£</button>
        <button onclick="runCaseCode('${c.case_id}')">â–¶ï¸ è¿è¡Œä»£ç </button>
      </div>
    </div>
  `).join('');
}

function getRelationType(type) {
  const types = {
    'theory': 'ç†è®ºéªŒè¯',
    'practice': 'å®è·µç»ƒä¹ ',
    'extension': 'æ‰©å±•å­¦ä¹ ',
    'comparison': 'å¯¹æ¯”åˆ†æ'
  };
  return types[type] || type;
}
```

### 3. æ¡ˆä¾‹æŸ¥çœ‹/è¿è¡Œ

```javascript
// æŸ¥çœ‹æ¡ˆä¾‹æ–‡æ¡£
async function viewCaseDoc(caseId) {
  const response = await fetch(`/api/cases/${caseId}/full`);
  const data = await response.json();
  
  // åœ¨ä¸»è§†å›¾ä¸­æ‰“å¼€æ¡ˆä¾‹æ–‡æ¡£ï¼ˆä¿ç•™ç« èŠ‚å†…å®¹åœ¨é¡¶éƒ¨ï¼‰
  const caseView = document.createElement('div');
  caseView.className = 'case-overlay';
  caseView.innerHTML = `
    <div class="case-overlay-content">
      <div class="case-overlay-header">
        <h2>${data.title}</h2>
        <button onclick="closeCaseOverlay()">âœ•</button>
      </div>
      <div class="case-overlay-body">
        ${marked.parse(data.readme)}
      </div>
    </div>
  `;
  
  document.body.appendChild(caseView);
}

// è¿è¡Œæ¡ˆä¾‹ä»£ç 
async function runCaseCode(caseId) {
  // åˆ‡æ¢åˆ°IDEè§†å›¾
  switchView('ide');
  
  // åŠ è½½æ¡ˆä¾‹ä»£ç åˆ°ç¼–è¾‘å™¨
  const response = await fetch(`/api/cases/${caseId}/full`);
  const data = await response.json();
  
  // åœ¨Monaco Editorä¸­æ˜¾ç¤ºä»£ç 
  if (window.editor) {
    window.editor.setValue(data.code);
  }
  
  // è‡ªåŠ¨è¿è¡Œ
  runCode();
}
```

---

## ğŸ”„ åç«¯APIå®ç°

### æ–°å¢APIç«¯ç‚¹

```python
# textbook_routes.py

@router.get("/tree")
async def get_textbook_tree(db = Depends(get_db)):
    """è·å–æ‰€æœ‰æ•™æçš„æ ‘å½¢ç»“æ„"""
    textbooks = db.query(Textbook).filter(Textbook.is_published == 1).all()
    
    result = []
    for book in textbooks:
        chapters = db.query(TextbookChapter).filter(
            TextbookChapter.textbook_id == book.id
        ).order_by(TextbookChapter.order_num).all()
        
        # æ„å»ºæ ‘å½¢ç»“æ„
        chapter_tree = build_chapter_tree(chapters, db)
        
        result.append({
            "id": book.id,
            "title": book.title,
            "description": book.description,
            "total_chapters": len(chapters),
            "chapters": chapter_tree
        })
    
    return {"success": True, "textbooks": result}

@router.get("/chapters/{chapter_id}/full")
async def get_chapter_full(chapter_id: str, db = Depends(get_db)):
    """è·å–ç« èŠ‚è¯¦æƒ…ï¼ˆå«å…³è”æ¡ˆä¾‹å’ŒçŸ¥è¯†ç‚¹ï¼‰"""
    chapter = db.query(TextbookChapter).filter(
        TextbookChapter.id == chapter_id
    ).first()
    
    if not chapter:
        raise HTTPException(status_code=404, detail="Chapter not found")
    
    # è·å–å…³è”æ¡ˆä¾‹
    case_mappings = db.query(ChapterCaseMapping).filter(
        ChapterCaseMapping.chapter_id == chapter_id
    ).order_by(ChapterCaseMapping.order_num).all()
    
    related_cases = []
    for mapping in case_mappings:
        # ä»æ¡ˆä¾‹ç³»ç»Ÿè·å–æ¡ˆä¾‹ä¿¡æ¯
        case_info = get_case_info(mapping.case_id)
        if case_info:
            related_cases.append({
                "case_id": mapping.case_id,
                "title": case_info['title'],
                "icon": case_info.get('icon', 'ğŸ“¦'),
                "relation_type": mapping.relation_type,
                "relevance_score": mapping.relevance_score,
                "description": mapping.description or case_info.get('description', '')
            })
    
    # è·å–å…³è”çŸ¥è¯†ç‚¹
    knowledge_mappings = db.query(ChapterKnowledgeMapping).filter(
        ChapterKnowledgeMapping.chapter_id == chapter_id
    ).all()
    
    related_knowledge = []
    for mapping in knowledge_mappings:
        kb_info = get_knowledge_info(mapping.knowledge_id)
        if kb_info:
            related_knowledge.append(kb_info)
    
    return {
        "success": True,
        "chapter": {
            "id": chapter.id,
            "title": chapter.title,
            "chapter_number": chapter.chapter_number,
            "content": chapter.content,
            "summary": chapter.summary,
            "difficulty": chapter.difficulty.value if chapter.difficulty else "beginner",
            "estimated_minutes": chapter.estimated_minutes,
            "learning_objectives": chapter.learning_objectives,
            "word_count": chapter.word_count
        },
        "related_cases": related_cases,
        "related_knowledge": related_knowledge
    }

def build_chapter_tree(chapters, db):
    """æ„å»ºç« èŠ‚æ ‘å½¢ç»“æ„"""
    # æŒ‰levelå’Œorder_numæ’åº
    chapter_dict = {c.id: {
        "id": c.id,
        "chapter_number": c.chapter_number,
        "title": c.title,
        "level": c.level,
        "parent_id": c.parent_id,
        "children": [],
        "case_count": db.query(ChapterCaseMapping).filter(
            ChapterCaseMapping.chapter_id == c.id
        ).count(),
        "has_cases": db.query(ChapterCaseMapping).filter(
            ChapterCaseMapping.chapter_id == c.id
        ).count() > 0
    } for c in chapters}
    
    # æ„å»ºæ ‘
    root_chapters = []
    for ch_id, ch_data in chapter_dict.items():
        if ch_data['parent_id']:
            parent = chapter_dict.get(ch_data['parent_id'])
            if parent:
                parent['children'].append(ch_data)
        else:
            root_chapters.append(ch_data)
    
    return root_chapters

def get_case_info(case_id):
    """ä»æ¡ˆä¾‹ç³»ç»Ÿè·å–æ¡ˆä¾‹ä¿¡æ¯"""
    # å®ç°æ¡ˆä¾‹ä¿¡æ¯è·å–é€»è¾‘
    # å¯ä»¥ä»allCases.jsonæˆ–æ•°æ®åº“ä¸­è¯»å–
    pass
```

---

## ğŸ¨ CSSæ ·å¼è®¾è®¡

```css
/* æ•™æç›®å½•æ ‘ */
.textbook-node {
    margin-bottom: 10px;
}

.textbook-title {
    font-weight: bold;
    padding: 8px;
    background: #2d2d30;
    border-left: 3px solid #007acc;
    cursor: pointer;
    transition: all 0.2s;
}

.textbook-title:hover {
    background: #3e3e42;
}

.chapter-list {
    padding-left: 10px;
}

.chapter-node {
    margin: 2px 0;
}

.chapter-node.level-1 {
    padding-left: 10px;
    font-weight: bold;
}

.chapter-node.level-2 {
    padding-left: 25px;
}

.chapter-node.level-3 {
    padding-left: 40px;
}

.chapter-title {
    padding: 5px 8px;
    cursor: pointer;
    border-radius: 3px;
    transition: all 0.2s;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.chapter-title:hover {
    background: #3e3e42;
    transform: translateX(3px);
}

.case-badge {
    background: #007acc;
    color: white;
    padding: 2px 6px;
    border-radius: 10px;
    font-size: 11px;
}

/* é…å¥—æ¡ˆä¾‹å¡ç‰‡ */
.related-cases {
    margin-top: 40px;
    padding: 20px;
    background: #1e1e1e;
    border-radius: 8px;
}

.related-cases h2 {
    color: #007acc;
    margin-bottom: 20px;
}

.case-card {
    background: #2d2d30;
    border: 1px solid #454545;
    border-radius: 5px;
    padding: 15px;
    margin-bottom: 15px;
    transition: all 0.3s;
}

.case-card:hover {
    border-color: #007acc;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 122, 204, 0.2);
}

.case-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.case-header h3 {
    color: #cccccc;
    margin: 0;
}

.case-meta {
    display: flex;
    gap: 10px;
    align-items: center;
}

.relation-type {
    background: #3e3e42;
    color: #cccccc;
    padding: 3px 8px;
    border-radius: 3px;
    font-size: 12px;
}

.relevance-score {
    color: #ffd700;
    font-size: 14px;
}

.case-description {
    color: #858585;
    font-size: 13px;
    margin: 10px 0;
    line-height: 1.5;
}

.case-actions {
    display: flex;
    gap: 10px;
    margin-top: 15px;
}

.case-actions button {
    flex: 1;
    padding: 8px 15px;
    border: 1px solid #454545;
    background: #2d2d30;
    color: #cccccc;
    border-radius: 3px;
    cursor: pointer;
    transition: all 0.2s;
}

.case-actions button:hover {
    background: #007acc;
    border-color: #007acc;
    color: white;
}

/* æ¡ˆä¾‹æµ®å±‚ */
.case-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.8);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
}

.case-overlay-content {
    background: #1e1e1e;
    border: 1px solid #454545;
    border-radius: 8px;
    width: 90%;
    max-width: 1200px;
    max-height: 90vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

.case-overlay-header {
    padding: 15px 20px;
    border-bottom: 1px solid #454545;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.case-overlay-body {
    padding: 20px;
    overflow-y: auto;
    flex: 1;
}
```

---

## ğŸ“‹ å®æ–½è®¡åˆ’

### Phase 1: åç«¯APIå¼€å‘ï¼ˆ1-2å¤©ï¼‰
1. âœ… æ£€æŸ¥æ•°æ®åº“æ•°æ®ï¼ˆå·²å®Œæˆï¼‰
2. â³ å®ç°`GET /api/textbooks/tree`
3. â³ å®ç°`GET /api/textbooks/chapters/{id}/full`
4. â³ å®ç°è¾…åŠ©å‡½æ•°ï¼ˆç« èŠ‚æ ‘æ„å»ºã€æ¡ˆä¾‹ä¿¡æ¯è·å–ï¼‰

### Phase 2: å‰ç«¯é‡æ„ï¼ˆ2-3å¤©ï¼‰
1. â³ é‡æ„å·¦ä¾§é¢æ¿ä¸ºæ•™æç›®å½•æ ‘
2. â³ å®ç°ç« èŠ‚å†…å®¹ + æ¡ˆä¾‹åˆ—è¡¨çš„æ··åˆè§†å›¾
3. â³ å®ç°æ¡ˆä¾‹æŸ¥çœ‹/è¿è¡ŒåŠŸèƒ½
4. â³ ä¼˜åŒ–CSSæ ·å¼

### Phase 3: æµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆ1å¤©ï¼‰
1. â³ æµ‹è¯•æ‰€æœ‰æ•™æçš„ç« èŠ‚åŠ è½½
2. â³ æµ‹è¯•ç« èŠ‚-æ¡ˆä¾‹å…³è”
3. â³ ä¼˜åŒ–æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒ
4. â³ ä¿®å¤å‘ç°çš„bug

---

## ğŸ¯ é¢„æœŸæ•ˆæœ

### ç”¨æˆ·ä½“éªŒæ”¹è¿›
1. **å­¦ä¹ è·¯å¾„æ¸…æ™°**: ä»æ•™æç›®å½•ç›´æ¥çœ‹åˆ°å®Œæ•´å­¦ä¹ è·¯å¾„
2. **ç†è®ºå®è·µç»“åˆ**: æ¯ä¸ªç« èŠ‚ä¸‹æ–¹ç›´æ¥æ˜¾ç¤ºé…å¥—æ¡ˆä¾‹
3. **æ“ä½œæµç•…**: æ— éœ€åœ¨ä¸åŒé¡µé¢/é€‰é¡¹å¡é—´åˆ‡æ¢
4. **å…³è”æ˜ç¡®**: æ¸…æ¥šåœ°çœ‹åˆ°æ¡ˆä¾‹ä¸ç« èŠ‚çš„å…³è”ç±»å‹å’Œç›¸å…³åº¦

### æ•°æ®å±•ç¤ºå®Œæ•´
1. **ç« èŠ‚å†…å®¹**: 622ä¸ªç« èŠ‚å…¨éƒ¨å¯æŸ¥çœ‹
2. **æ¡ˆä¾‹å…³è”**: 243ä¸ªç« èŠ‚-æ¡ˆä¾‹å…³è”å…¨éƒ¨å±•ç¤º
3. **çŸ¥è¯†é“¾æ¥**: ç›¸å…³çŸ¥è¯†ç‚¹å¯å¿«é€Ÿè·³è½¬

---

## ğŸ“ æ€»ç»“

è¿™ä¸ªæ–°è®¾è®¡å°†è§£å†³å½“å‰çš„ä¸‰ä¸ªæ ¸å¿ƒé—®é¢˜ï¼š
1. âœ… **ç« èŠ‚æ˜¾ç¤ºä¸ºç©º** â†’ é€šè¿‡æ–°APIæ­£ç¡®åŠ è½½æ‰€æœ‰ç« èŠ‚
2. âœ… **æ•™æä¸æ¡ˆä¾‹åˆ†ç¦»** â†’ åœ¨æ¯ä¸ªç« èŠ‚ä¸‹æ–¹æ˜¾ç¤ºé…å¥—æ¡ˆä¾‹
3. âœ… **å­¦ä¹ è·¯å¾„ä¸æ¸…æ™°** â†’ æä¾›"æ•™æ-ç« èŠ‚-æ¡ˆä¾‹"çš„å®Œæ•´å­¦ä¹ è·¯å¾„

è¿™æ˜¯ä¸€ä¸ª**ä»¥å†…å®¹ä¸ºä¸­å¿ƒ**çš„è®¾è®¡ï¼Œè€Œä¸æ˜¯**ä»¥åŠŸèƒ½ä¸ºä¸­å¿ƒ**çš„è®¾è®¡ã€‚ç”¨æˆ·çš„å­¦ä¹ æµç¨‹æ˜¯ï¼š
```
é€‰æ‹©æ•™æ â†’ æµè§ˆç« èŠ‚ â†’ å­¦ä¹ ç†è®º â†’ æŸ¥çœ‹æ¡ˆä¾‹ â†’ è¿è¡Œä»£ç  â†’ å·©å›ºçŸ¥è¯†
```

æ‰€æœ‰è¿™äº›æ­¥éª¤éƒ½åœ¨ä¸€ä¸ªç»Ÿä¸€çš„ç•Œé¢ä¸­å®Œæˆï¼Œæ— éœ€åˆ‡æ¢é¡µé¢ã€‚

