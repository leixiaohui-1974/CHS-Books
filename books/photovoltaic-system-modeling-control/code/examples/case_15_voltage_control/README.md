# æ¡ˆä¾‹15: ç”µå‹æ§åˆ¶

## ğŸ“– æ•™å­¦ç›®æ ‡

æŒæ¡å…‰ä¼å¹¶ç½‘é€†å˜å™¨çš„ç”µå‹æ§åˆ¶æŠ€æœ¯ï¼ŒåŒ…æ‹¬ç›´æµæ¯çº¿ç”µå‹æ§åˆ¶å’Œäº¤æµè¾“å‡ºç”µå‹æ§åˆ¶ã€‚

**æ ¸å¿ƒå†…å®¹**:
1. ç›´æµæ¯çº¿ç”µå‹æ§åˆ¶åŸç†
2. äº¤æµç”µå‹åŒç¯æ§åˆ¶ç»“æ„
3. å‰é¦ˆè¡¥å¿ä¸è§£è€¦æ§åˆ¶
4. å‚æ•°æ•´å®šä¸æ€§èƒ½ä¼˜åŒ–

---

## ğŸ¯ æ ¸å¿ƒç†è®º

### 1. ç›´æµç”µå‹æ§åˆ¶

#### æ§åˆ¶ç›®æ ‡
ç¨³å®šç›´æµæ¯çº¿ç”µå‹ \( V_{dc} \)ï¼ŒæŠ‘åˆ¶è´Ÿè½½åŠŸç‡æ³¢åŠ¨çš„å½±å“ã€‚

#### æ•°å­¦æ¨¡å‹
ç›´æµä¾§åŠŸç‡å¹³è¡¡æ–¹ç¨‹ï¼š
\[
C_{dc} \frac{dV_{dc}}{dt} = i_{pv} - i_{inv}
\]

å…¶ä¸­ï¼š
- \( C_{dc} \): ç›´æµä¾§ç”µå®¹
- \( i_{pv} \): å…‰ä¼è¾“å…¥ç”µæµ
- \( i_{inv} \): é€†å˜å™¨è¾“å…¥ç”µæµ

#### PIæ§åˆ¶å™¨è®¾è®¡
\[
i_{ref} = K_p (V_{ref} - V_{dc}) + K_i \int (V_{ref} - V_{dc}) dt
\]

å‚æ•°æ•´å®šï¼ˆæ ¹æ®æœŸæœ›å¸¦å®½ \( \omega_c \)ï¼‰ï¼š
\[
\begin{cases}
K_p = 2 C_{dc} \omega_c \\
K_i = C_{dc} \omega_c^2
\end{cases}
\]

#### å‰é¦ˆè¡¥å¿
\[
i_{ref} = i_{ref,PI} + \frac{P_{load}}{V_{dc}}
\]

**ä¼˜ç‚¹**: æé«˜è´Ÿè½½æ‰°åŠ¨æŠ‘åˆ¶èƒ½åŠ›ï¼Œå‡å°ç”µå‹è·Œè½ã€‚

---

### 2. äº¤æµç”µå‹æ§åˆ¶ï¼ˆåŒç¯ï¼‰

#### æ§åˆ¶ç»“æ„
```python
        +------+       +------+       +------+
V_ref â†’ | ç”µå‹ç¯ | â†’ | ç”µæµç¯ | â†’ | é€†å˜å™¨ | â†’ V_out
        | (PI) |     | (PI) |     | +PWM |
        +------+       +------+       +------+
            â†‘              â†‘              â†‘
            â””â”€â”€â”€â”€ V_meas â”€â”€â”´â”€â”€â”€â”€ I_meas â”€â”€â”˜
```

#### ç”µå‹å¤–ç¯ï¼ˆæ…¢ï¼‰
è¾“å‡ºç”µæµå‚è€ƒï¼š
\[
i_{ref} = K_{p,v}(V_{ref} - V_c) + K_{i,v}\int(V_{ref} - V_c)dt
\]

å¸¦å®½è®¾è®¡ï¼š\( f_v \approx 200 \text{Hz} \)

#### ç”µæµå†…ç¯ï¼ˆå¿«ï¼‰
è¾“å‡ºç”µå‹æŒ‡ä»¤ï¼š
\[
v_{out} = K_{p,i}(i_{ref} - i_L) + K_{i,i}\int(i_{ref} - i_L)dt
\]

å¸¦å®½è®¾è®¡ï¼š\( f_i \approx 2 \text{kHz} \)

#### è§£è€¦æ§åˆ¶
LCæ»¤æ³¢å™¨åŠ¨æ€ï¼š
\[
\begin{cases}
L \frac{di_L}{dt} = v_{out} - v_C - Ri_L \\
C \frac{dv_C}{dt} = i_L - i_{load}
\end{cases}
\]

**è§£è€¦å‰é¦ˆ**:
- è´Ÿè½½ç”µæµå‰é¦ˆ: \( i_{ref} \leftarrow i_{ref} + i_{load} \)
- ç”µå®¹ç”µå‹å‰é¦ˆ: \( v_{out} \leftarrow v_{out} + v_C \)

**æ•ˆæœ**: æ”¹å–„åŠ¨æ€å“åº”ï¼Œå‡å°è°ƒèŠ‚æ—¶é—´ã€‚

---

### 3. ä¸‰ç›¸åŒç¯æ§åˆ¶ï¼ˆdqåæ ‡ç³»ï¼‰

#### ç³»ç»Ÿç»“æ„
```python
       DCç”µå‹ç¯        dqç”µæµç¯
V_dc â†’ [  PI  ] â†’ i_d â†’ [ PI + è§£è€¦ ] â†’ v_abc
                  i_q=0
```

#### ä¼˜åŠ¿
- DCç”µå‹æ§åˆ¶ç¨³å®šæ¯çº¿
- dqç”µæµæ§åˆ¶å®ç°è§£è€¦
- ç‹¬ç«‹è°ƒèŠ‚æœ‰åŠŸ/æ— åŠŸåŠŸç‡

---

## ğŸ’» ä»£ç å®ç°

### 1. DCç”µå‹æ§åˆ¶å™¨

```python
from models.inverter_control import DCVoltageController

# å‚æ•°è®¾è®¡
C_dc = 2000e-6  # 2000Î¼F
omega_c = 2 * np.pi * 100  # 100Hzå¸¦å®½
Kp = 2 * C_dc * omega_c
Ki = C_dc * omega_c ** 2

# åˆ›å»ºæ§åˆ¶å™¨
dc_ctrl = DCVoltageController(Kp, Ki, C_dc, v_nominal=400.0, i_limit=50.0)

# è¿è¡Œæ§åˆ¶
i_ref = dc_ctrl.update(
    v_ref=400.0,           # å‚è€ƒç”µå‹
    v_measured=390.0,      # æµ‹é‡ç”µå‹
    dt=1e-4,               # æ—¶é—´æ­¥é•¿
    p_load=2000.0,         # è´Ÿè½½åŠŸç‡ï¼ˆå‰é¦ˆï¼‰
    enable_feedforward=True
)
```python

### 2. ACç”µå‹æ§åˆ¶å™¨ï¼ˆåŒç¯ï¼‰

```python
from models.inverter_control import ACVoltageController

# ç”µå‹ç¯å‚æ•°
omega_v = 2 * np.pi * 200  # 200Hz
Kp_v = 2 * C * omega_v
Ki_v = C * omega_v ** 2

# ç”µæµç¯å‚æ•°
omega_i = 2 * np.pi * 2000  # 2kHz
Kp_i = L * omega_i
Ki_i = R * omega_i

# åˆ›å»ºæ§åˆ¶å™¨
ac_ctrl = ACVoltageController(
    Kp_v, Ki_v, Kp_i, Ki_i, 
    L=5e-3, C=20e-6, omega=2*np.pi*50,
    v_limit=50.0, i_limit=400.0
)

# è¿è¡Œæ§åˆ¶
v_out = ac_ctrl.update(
    v_ref=311.0,           # 220Vrms * âˆš2
    v_measured=300.0,      # æµ‹é‡ç”µå®¹ç”µå‹
    i_measured=10.0,       # æµ‹é‡ç”µæ„Ÿç”µæµ
    dt=1e-4,
    i_load=5.0,            # è´Ÿè½½ç”µæµï¼ˆå‰é¦ˆï¼‰
    enable_decoupling=True
)
```python

### 3. ä¸‰ç›¸åŒç¯æ§åˆ¶å™¨

```python
from models.inverter_control import DualLoopVoltageController

ctrl = DualLoopVoltageController(
    Kp_v=0.5, Ki_v=100, C_dc=2000e-6,      # ç”µå‹ç¯
    Kp_i=0.5, Ki_i=100, L=5e-3, omega=2*np.pi*50,  # ç”µæµç¯
    v_dc_nominal=400.0, i_limit=50.0, v_limit=400.0
)

# è¿è¡Œæ§åˆ¶
v_a, v_b, v_c = ctrl.update(
    v_dc_ref=400.0,          # DCç”µå‹å‚è€ƒ
    v_dc_measured=390.0,     # æµ‹é‡DCç”µå‹
    i_a=10.0, i_b=-5.0, i_c=-5.0,  # ä¸‰ç›¸ç”µæµ
    theta=0.0,               # Parkå˜æ¢è§’åº¦
    dt=1e-4,
    p_load=2000.0,           # è´Ÿè½½åŠŸç‡ï¼ˆå‰é¦ˆï¼‰
    i_q_ref=0.0,             # æ— åŠŸç”µæµå‚è€ƒ
    enable_feedforward=True,
    enable_decoupling=True
)
```matlab

---

## ğŸ§ª å®éªŒå†…å®¹

### å®éªŒ1: ç›´æµæ¯çº¿ç”µå‹æ§åˆ¶

**å®éªŒç›®çš„**: éªŒè¯DCç”µå‹æ§åˆ¶å™¨çš„ç¨³å®šæ€§å’Œè´Ÿè½½æ‰°åŠ¨æŠ‘åˆ¶èƒ½åŠ›

**å®éªŒæ­¥éª¤**:
1. è®¾ç½®ç³»ç»Ÿå‚æ•° (C=2000Î¼F, V_nom=400V)
2. è®¾è®¡PIå‚æ•° (å¸¦å®½100Hz)
3. æ–½åŠ é˜¶è·ƒè´Ÿè½½å˜åŒ– (1kW â†’ 2kW â†’ 3kW)
4. è§‚å¯Ÿç”µå‹å“åº”å’Œè°ƒèŠ‚æ—¶é—´

**é¢„æœŸç»“æœ**:
- ç”µå‹è°ƒæ•´ç‡ < 5%
- ç¨³æ€è¯¯å·® < 1V
- å‰é¦ˆè¡¥å¿æœ‰æ•ˆæŠ‘åˆ¶æ‰°åŠ¨

### å®éªŒ2: äº¤æµç”µå‹åŒç¯æ§åˆ¶

**å®éªŒç›®çš„**: æµ‹è¯•åŒç¯æ§åˆ¶çš„è·Ÿè¸ªæ€§èƒ½å’Œè´Ÿè½½é€‚åº”æ€§

**å®éªŒæ­¥éª¤**:
1. è®¾ç½®LCæ»¤æ³¢å™¨å‚æ•° (L=5mH, C=20Î¼F)
2. è®¾è®¡åŒç¯å‚æ•° (ç”µå‹ç¯200Hz, ç”µæµç¯2kHz)
3. è·Ÿè¸ª50Hzæ­£å¼¦å‚è€ƒ
4. æ–½åŠ è´Ÿè½½çªå˜ (10Î© â†’ 5Î©)

**é¢„æœŸç»“æœ**:
- ç”µå‹è·Ÿè¸ªè¯¯å·® < 2%
- è´Ÿè½½çªå˜æ—¶ç”µå‹è·Œè½å°
- è§£è€¦æ§åˆ¶æ”¹å–„åŠ¨æ€

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### 1. DCç”µå‹æ§åˆ¶æ€§èƒ½

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | è¯´æ˜ |
|------|--------|------|
| ç¨³æ€ç”µå‹åå·® | < 1% | \|V_dc - V_ref\| / V_ref |
| ç”µå‹è°ƒæ•´ç‡ | < 5% | è´Ÿè½½å˜åŒ–æ—¶ç”µå‹æ³¢åŠ¨ |
| è°ƒèŠ‚æ—¶é—´ | < 50ms | è¾¾åˆ°ç¨³æ€çš„æ—¶é—´ |
| è¶…è°ƒé‡ | < 10% | é˜¶è·ƒå“åº”è¶…è°ƒ |

### 2. ACç”µå‹æ§åˆ¶æ€§èƒ½

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | è¯´æ˜ |
|------|--------|------|
| ç¨³æ€è·Ÿè¸ªè¯¯å·® | < 2% | RMSè¯¯å·® |
| THD | < 3% | æ€»è°æ³¢ç•¸å˜ç‡ |
| è´Ÿè½½è°ƒæ•´ç‡ | < 5% | è´Ÿè½½å˜åŒ–æ—¶ç”µå‹å˜åŒ– |
| åŠ¨æ€å“åº”æ—¶é—´ | < 2å‘¨æœŸ | è´Ÿè½½çªå˜æ¢å¤æ—¶é—´ |

### 3. åŒç¯æ§åˆ¶ä¼˜åŠ¿

| å¯¹æ¯”é¡¹ | å•ç¯æ§åˆ¶ | åŒç¯æ§åˆ¶ |
|--------|----------|----------|
| ç¨³æ€ç²¾åº¦ | ä¸€èˆ¬ | é«˜ |
| åŠ¨æ€å“åº” | æ…¢ | å¿« |
| è´Ÿè½½æ‰°åŠ¨æŠ‘åˆ¶ | å·® | å¥½ |
| å‚æ•°æ•´å®š | ç®€å• | å¤æ‚ |

---

## âš™ï¸ å·¥ç¨‹åº”ç”¨

### 1. å‚æ•°æ•´å®šæµç¨‹

**æ­¥éª¤1: ç¡®å®šæ§åˆ¶å¸¦å®½**
- DCç”µå‹ç¯: 50-200Hz (å…‰ä¼MPPTçš„1/10)
- ACç”µå‹ç¯: 100-500Hz (ç”µç½‘é¢‘ç‡çš„2-10å€)
- ACç”µæµç¯: 1-5kHz (å¼€å…³é¢‘ç‡çš„1/5-1/10)

**æ­¥éª¤2: è®¡ç®—æ§åˆ¶å™¨å‚æ•°**
- DCç”µå‹: \( K_p = 2C\omega_c, K_i = C\omega_c^2 \)
- ACç”µå‹: \( K_p = 2C\omega_v, K_i = C\omega_v^2 \)
- ACç”µæµ: \( K_p = L\omega_i, K_i = R\omega_i \)

**æ­¥éª¤3: ä»¿çœŸéªŒè¯**
- é˜¶è·ƒå“åº” (è¶…è°ƒã€è°ƒèŠ‚æ—¶é—´)
- é¢‘ç‡å“åº” (ç›¸ä½è£•åº¦ > 45Â°)
- è´Ÿè½½æ‰°åŠ¨ (ç”µå‹è·Œè½)

**æ­¥éª¤4: å®éªŒå¾®è°ƒ**
- é€‚å½“é™ä½å¢ç›Šæé«˜ç¨³å®šè£•åº¦
- å¢åŠ é™å¹…ä¿æŠ¤
- å¯ç”¨å‰é¦ˆå’Œè§£è€¦

### 2. å‰é¦ˆè¡¥å¿è®¾è®¡

**DCä¾§å‰é¦ˆ**:
\[
i_{ff} = \frac{P_{load}}{V_{dc}}
\]

**ä½œç”¨**: æ ¹æ®è´Ÿè½½åŠŸç‡ç›´æ¥è¡¥å¿æ‰€éœ€ç”µæµï¼Œå‡å°åé¦ˆæ§åˆ¶å‹åŠ›ã€‚

**ACä¾§å‰é¦ˆ**:
- è´Ÿè½½ç”µæµå‰é¦ˆ: è¡¥å¿è´Ÿè½½ç”µæµæ‰°åŠ¨
- ç”µå®¹ç”µå‹å‰é¦ˆ: æ”¹å–„å†…ç¯è¾“å‡º

### 3. é™å¹…ä¸ä¿æŠ¤

```python
# ç”µæµé™å¹…
i_ref = np.clip(i_ref, -i_max, i_max)

# ç”µå‹é™å¹…
v_out = np.clip(v_out, -v_max, v_max)

# é˜²é¥±å’Œç§¯åˆ†
if abs(v_out) >= v_max:
    integral = 0  # åœæ­¢ç§¯åˆ†
```

---

## ğŸ“ ä½œä¸šç»ƒä¹ 

### ç»ƒä¹ 1: å‚æ•°æ•´å®š
å·²çŸ¥ç³»ç»Ÿå‚æ•° C_dc=1000Î¼Fï¼Œè¦æ±‚ç”µå‹ç¯å¸¦å®½150Hzã€‚
1. è®¡ç®—Kpå’ŒKi
2. åˆ†æç›¸ä½è£•åº¦
3. ç»˜åˆ¶æ³¢ç‰¹å›¾

### ç»ƒä¹ 2: å‰é¦ˆè®¾è®¡
è®¾è®¡ä¸€ä¸ªDCç”µå‹æ§åˆ¶å™¨ï¼Œè¦æ±‚ï¼š
1. åŸºç¡€PIæ§åˆ¶ç¨³æ€è¯¯å·®<2V
2. æ·»åŠ åŠŸç‡å‰é¦ˆ
3. å¯¹æ¯”å‰é¦ˆå‰åçš„è´Ÿè½½æ‰°åŠ¨å“åº”

### ç»ƒä¹ 3: åŒç¯æ•´å®š
è®¾è®¡ACåŒç¯æ§åˆ¶å™¨ï¼ŒLCå‚æ•°ä¸ºL=3mH, C=30Î¼F:
1. ç¡®å®šç”µå‹ç¯å’Œç”µæµç¯å¸¦å®½æ¯”ä¾‹
2. è®¡ç®—PIå‚æ•°
3. ä»¿çœŸéªŒè¯è´Ÿè½½çªå˜å“åº”

### ç»ƒä¹ 4: è§£è€¦æ§åˆ¶
æ¨å¯¼ACåŒç¯æ§åˆ¶çš„è§£è€¦å‰é¦ˆé¡¹ï¼š
1. å†™å‡ºLCæ»¤æ³¢å™¨çŠ¶æ€æ–¹ç¨‹
2. åˆ†æè€¦åˆé¡¹
3. è®¾è®¡è§£è€¦è¡¥å¿
4. å¯¹æ¯”è§£è€¦å‰åçš„æ€§èƒ½

---

## ğŸ“š æ‰©å±•é˜…è¯»

### æ§åˆ¶ç†è®º
- çº§è”æ§åˆ¶ç³»ç»Ÿè®¾è®¡
- å‰é¦ˆ-åé¦ˆå¤åˆæ§åˆ¶
- æŠ—æ‰°åŠ¨æ§åˆ¶

### å·¥ç¨‹å®è·µ
- æ•°å­—å®ç°ï¼ˆç¦»æ•£åŒ–ã€é‡‡æ ·å»¶è¿Ÿï¼‰
- ä¼ æ„Ÿå™¨å™ªå£°æ»¤æ³¢
- æ­»åŒºè¡¥å¿

### è¿›é˜¶ç®—æ³•
- è‡ªé€‚åº”ç”µå‹æ§åˆ¶
- é¢„æµ‹ç”µå‹æ§åˆ¶
- æ»‘æ¨¡ç”µå‹æ§åˆ¶

---

## â“ å¸¸è§é—®é¢˜

**Q1: ä¸ºä»€ä¹ˆä½¿ç”¨åŒç¯æ§åˆ¶è€Œä¸æ˜¯å•ç¯ï¼Ÿ**
A: åŒç¯æ§åˆ¶å°†ç”µå‹æ§åˆ¶å’Œç”µæµæ§åˆ¶åˆ†ç¦»ï¼Œç”µå‹ç¯è°ƒèŠ‚ç¨³æ€ç²¾åº¦ï¼Œç”µæµç¯æå‡åŠ¨æ€å“åº”ï¼ŒåŒæ—¶ä¾¿äºé™æµä¿æŠ¤ã€‚

**Q2: ç”µå‹ç¯å’Œç”µæµç¯çš„å¸¦å®½å¦‚ä½•é€‰æ‹©ï¼Ÿ**
A: ç”µæµç¯å¸¦å®½åº”è¿œå¤§äºç”µå‹ç¯ï¼ˆé€šå¸¸10å€ä»¥ä¸Šï¼‰ï¼Œä¿è¯ç”µæµç¯å¿«é€Ÿè·Ÿè¸ªç”µå‹ç¯çš„æŒ‡ä»¤ï¼Œé¿å…ç¯è·¯è€¦åˆã€‚

**Q3: å‰é¦ˆè¡¥å¿ä»€ä¹ˆæ—¶å€™éœ€è¦ï¼Ÿ**
A: å½“è´Ÿè½½åŠŸç‡æ³¢åŠ¨å¤§æˆ–å¯¹åŠ¨æ€æ€§èƒ½è¦æ±‚é«˜æ—¶ï¼Œå‰é¦ˆèƒ½æ˜¾è‘—å‡å°ç”µå‹è·Œè½ï¼Œæå‡ç³»ç»Ÿæ€§èƒ½ã€‚

**Q4: dqåæ ‡ç³»ä¸Î±Î²åæ ‡ç³»å“ªä¸ªæ›´å¥½ï¼Ÿ**
A: dqåæ ‡ç³»å°†ACé‡è½¬ä¸ºDCé‡ï¼ŒPIæ§åˆ¶å™¨å¯å®ç°é›¶ç¨³æ€è¯¯å·®ï¼›Î±Î²åæ ‡ç³»éœ€è¦PRæ§åˆ¶å™¨ã€‚é€šå¸¸ä¸‰ç›¸ç³»ç»Ÿä¼˜å…ˆé€‰dqã€‚

---

## ğŸ“– å‚è€ƒæ–‡çŒ®

1. Mohan, N., et al. "Power Electronics: Converters, Applications, and Design"
2. Yazdani, A., et al. "Voltage-Sourced Converters in Power Systems"
3. Teodorescu, R., et al. "Grid Converters for Photovoltaic and Wind Power Systems"
4. IEEE Std 1547-2018 "Standard for Interconnection and Interoperability"

---

**å®éªŒæ—¶é—´**: 2-3å°æ—¶  
**éš¾åº¦ç­‰çº§**: â­â­â­â­  
**å‰ç½®çŸ¥è¯†**: æ¡ˆä¾‹13(PWM), æ¡ˆä¾‹14(ç”µæµæ§åˆ¶)
