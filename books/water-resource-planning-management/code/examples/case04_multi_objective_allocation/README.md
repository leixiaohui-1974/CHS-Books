# 案例2.1：区域水资源多目标优化配置

## 工程背景

某流域包含3个水源（地表水、地下水、再生水）和4个用水户（城市生活、工业、农业灌溉、生态环境），需要在满足各用水户需求的前提下，实现经济效益最大化和缺水量最小化的多目标优化配置。

## 案例目标

1. 掌握水资源优化配置方法
2. 理解多目标优化基本原理
3. 学习线性规划、遗传算法、PSO、NSGA-II
4. 能够进行Pareto前沿分析

## 主要内容

### 1. 问题描述

**决策变量**：x[i,j] - 水源i向用户j的配水量

**目标函数**：
- 目标1（最大化）：经济效益 = Σ(效益系数 × 配水量) - Σ(输水成本 × 配水量)
- 目标2（最小化）：缺水量 = Σmax(需水量 - 实际供水量, 0)

**约束条件**：
- 水源供水能力约束：Σ_j x[i,j] ≤ Q_i
- 需水保障约束：Σ_i x[i,j] ≥ α · D_j
- 非负约束：x[i,j] ≥ 0

### 2. 水源和用户信息

| 水源 | 供水能力 (万m³/d) | 开发成本 (元/m³) |
|------|------------------|------------------|
| 地表水 | 150 | 1.2 |
| 地下水 | 80 | 1.8 |
| 再生水 | 50 | 2.5 |

| 用户 | 需水量 (万m³/d) | 效益系数 (元/m³) | 保证率 |
|------|----------------|-----------------|--------|
| 城市生活 | 100 | 8.0 | 95% |
| 工业 | 80 | 12.0 | 90% |
| 农业灌溉 | 120 | 5.0 | 75% |
| 生态环境 | 30 | 3.0 | 80% |

### 3. 输水成本矩阵

|  | 城市 | 工业 | 农业 | 生态 |
|--|------|------|------|------|
| 地表水 | 0.5 | 0.6 | 0.4 | 0.3 |
| 地下水 | 0.8 | 0.7 | 0.9 | 1.0 |
| 再生水 | 0.6 | 0.5 | 1.2 | 0.4 |

## 技术路线

```python
问题建模
  ├─ 决策变量定义
  ├─ 目标函数构建
  └─ 约束条件设置
         ↓
方法1：线性规划
  ├─ 单目标优化（效益最大）
  ├─ 单目标优化（缺水最小）
  └─ 加权法多目标
         ↓
方法2：遗传算法（GA）
  ├─ 染色体编码
  ├─ 适应度函数
  └─ 遗传操作
         ↓
方法3：粒子群算法（PSO）
  ├─ 粒子初始化
  ├─ 速度和位置更新
  └─ 全局最优搜索
         ↓
方法4：NSGA-II
  ├─ 非支配排序
  ├─ 拥挤度计算
  └─ Pareto前沿
         ↓
结果分析
  ├─ 配置方案对比
  ├─ Pareto前沿分析
  ├─ 决策建议
  └─ 敏感性分析
```

## 数据说明

### 输入数据

**problem_config.yaml** - 问题配置
- sources: 水源信息（能力、成本）
- users: 用户信息（需求、效益、保证率）
- transport_costs: 输水成本矩阵

### 输出结果

- `lp_results.csv` - 线性规划结果
- `ga_results.csv` - 遗传算法结果
- `pso_results.csv` - PSO结果
- `pareto_front.csv` - Pareto前沿
- `figures/` - 可视化图表

## 运行方法

```bash
cd code/examples/case04_multi_objective_allocation
python main.py
```python

## 核心算法

### 1. 线性规划（LP）

**单目标转换**：
- 最大化效益：max Σ(benefit_j - cost_ij) × x_ij
- 最小化缺水：min Σ(demand_j - Σx_ij)

**加权法**：
```
min -w1·效益 + w2·缺水量
其中 w1 + w2 = 1
```python

### 2. 遗传算法（GA）

**染色体编码**：
- 实数编码：[x11, x12, ..., x34]（12个变量）

**适应度函数**：
```python
fitness = w1·benefit - w2·shortage - penalty·violation
```python

**遗传操作**：
- 选择：锦标赛选择
- 交叉：单点交叉
- 变异：高斯变异

### 3. 粒子群算法（PSO）

**速度更新**：
```
v = w·v + c1·r1·(pbest - x) + c2·r2·(gbest - x)
```python

**位置更新**：
```
x = x + v
```python

**参数**：
- w=0.7（惯性权重）
- c1=1.5（个体学习因子）
- c2=1.5（社会学习因子）

### 4. NSGA-II

**非支配排序**：
- 解A支配解B：A在所有目标上不差于B，且至少一个目标优于B

**拥挤度距离**：
```
distance_i = Σ(f_k(i+1) - f_k(i-1)) / (f_k_max - f_k_min)
```

## 预期结果

### 配置方案示例

**方案1（效益优先）**：
- 总配水量：280万m³/d
- 经济效益：1850万元/d
- 缺水量：50万m³/d
- 满足率：85%

**方案2（保障优先）**：
- 总配水量：280万m³/d
- 经济效益：1620万元/d
- 缺水量：25万m³/d
- 满足率：92%

**方案3（折中）**：
- 总配水量：280万m³/d
- 经济效益：1735万元/d
- 缺水量：35万m³/d
- 满足率：89%

### Pareto前沿

约30-50个非支配解，展示效益与缺水之间的权衡关系。

## 思考题

1. 为什么需要多目标优化？单目标优化有什么局限性？
2. Pareto前沿的物理意义是什么？如何选择最终方案？
3. GA、PSO、NSGA-II的优缺点对比？
4. 如何处理水质约束？
5. 考虑不确定性时，如何调整模型？

## 扩展方向

1. **动态优化**：考虑多时段配置
2. **不确定性**：随机规划、鲁棒优化
3. **水质约束**：水质-水量联合优化
4. **风险分析**：缺水风险评估
5. **决策支持**：交互式决策系统

## 参考文献

1. 周孝德. 水资源系统工程[M]. 北京: 中国水利水电出版社, 2015.
2. Deb K. Multi-objective Optimization Using Evolutionary Algorithms[M]. Wiley, 2001.
3. 水利部. 水资源配置技术导则 (SL 635-2012).

## 作者信息

- 案例编号：Case 2.1
- 难度等级：⭐⭐⭐⭐ (高级)
- 所需时间：6-8小时
- 更新日期：2025-11-02
