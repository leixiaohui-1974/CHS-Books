# 案例3.2：供水管网优化调度

## 工程背景

某城市供水系统包含多个水厂、泵站和用户区，需要在满足用户需水量和压力要求的前提下，通过优化调度降低运行成本，特别是泵站的电力消耗。系统需实时响应需水变化，保证供水安全。

## 案例目标

1. 理解供水管网水力特性
2. 掌握管网优化调度建模
3. 学习MPC在管网中的应用
4. 能够进行实时经济调度

## 主要内容

### 1. 管网系统

**系统组成**：
- 3个水厂（固定供水能力）
- 5个泵站（可调节）
- 8个用户区
- 管网连接

**调度目标**：
- 最小化泵站能耗
- 满足用户需水量
- 保证管网压力
- 响应需水波动

### 2. 管网建模

**水力方程**：
- 节点流量平衡：Σ Q_in = Σ Q_out
- 管道水头损失：h_f = λ(L/D)(v²/2g)
- 泵站扬程特性：H = a - bQ²

**优化模型**：
```
min Σ P_pump · Δt
s.t. 节点流量平衡
     管道水头损失
     压力约束
     泵站容量约束
```

### 3. 求解方法对比

| 方法 | 原理 | 优点 | 缺点 |
|------|------|------|------|
| 线性规划 | 简化模型 | 快速求解 | 精度有限 |
| 非线性规划 | 精确建模 | 高精度 | 计算慢 |
| MPC | 预测控制 | 滚动优化、处理约束 | 计算量大 |
| 启发式 | GA/PSO | 全局搜索 | 无保证 |

## 技术路线

```
管网建模
  ├─ 拓扑结构
  ├─ 水力方程
  └─ 设备特性
         ↓
方法1：线性规划
  ├─ 模型简化
  ├─ 决策变量
  └─ 约束线性化
         ↓
方法2：非线性规划
  ├─ 精确水力模型
  ├─ 梯度优化
  └─ 局部最优
         ↓
方法3：MPC调度
  ├─ 需水预测
  ├─ 滚动优化
  └─ 反馈修正
         ↓
性能评估
  ├─ 能耗对比
  ├─ 压力满足率
  ├─ 计算时间
  └─ 鲁棒性
```

## 核心算法

### 1. 管网水力计算

**Hardy-Cross方法**（管网平差）：
```
迭代修正流量，直至满足：
1. 节点流量平衡
2. 环路水头损失闭合
```

**Newton-Raphson方法**：
```
建立雅可比矩阵
迭代求解非线性方程组
```

### 2. 泵站优化调度

**单阶段优化**：
```
min Σ C_i(Q_i)
s.t. Σ Q_i = Q_demand
     Q_min ≤ Q_i ≤ Q_max
```

**多阶段MPC**：
```
min Σ_t Σ_i C_i(Q_i,t)
s.t. 水力约束
     泵站约束
     储水平衡
```

### 3. 能耗计算

**泵站功率**：
```
P = ρ·g·Q·H / η
```
其中：
- ρ：水密度（1000 kg/m³）
- g：重力加速度（9.81 m/s²）
- Q：流量（m³/s）
- H：扬程（m）
- η：效率

## 运行方法

```bash
cd code/examples/case08_network_dispatch
python main.py
```

## 预期结果

**线性规划**：
- 计算时间：< 1秒
- 能耗降低：15%
- 压力满足率：95%

**非线性规划**：
- 计算时间：5-10秒
- 能耗降低：25%
- 压力满足率：98%

**MPC调度**：
- 计算时间：10-20秒
- 能耗降低：30%
- 压力满足率：99%
- 预测性调整

## 思考题

1. 为什么管网优化是非线性问题？
2. MPC如何处理需水预测误差？
3. 如何平衡能耗与供水安全？
4. 实时调度的计算速度要求是什么？
5. 如何处理设备故障场景？

## 扩展方向

1. **水质调度**：余氯浓度优化
2. **多目标优化**：能耗-水质权衡
3. **需水预测**：时间序列/机器学习
4. **鲁棒调度**：考虑不确定性
5. **分层控制**：上层优化+下层控制

## 参考文献

1. 吴玉成. 给水管网优化设计与优化运行[M]. 中国建筑工业出版社, 2010.
2. Brdys MA, Ulanicki B. Operational Control of Water Systems[M]. Prentice Hall, 1994.
3. Rao ZH, Alvarruiz F. Use of an Artificial Neural Network to Capture the Domain Knowledge of a Conventional Hydraulic Simulation Model[J]. Journal of Hydroinformatics, 2007, 9(1): 15-24.

## 作者信息

- 案例编号：Case 3.2
- 难度等级：⭐⭐⭐⭐ (高级)
- 所需时间：8-10小时
- 更新日期：2025-11-02
