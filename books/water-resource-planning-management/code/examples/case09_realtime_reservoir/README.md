# 案例3.3：水库群实时优化调度

## 工程背景

某流域梯级水库群需要根据实时来水、用水需求和电力负荷进行动态调度。系统需要在满足防洪、发电、供水等多目标约束下，实现最优运行。实时调度需要快速响应，考虑预测误差和不确定性。

## 案例目标

1. 理解水库群实时调度特点
2. 掌握MPC在水库调度中的应用
3. 学习预测误差处理方法
4. 能够进行滚动优化调度

## 主要内容

### 1. 水库群系统

**系统特征**：
- 3座梯级水库
- 水力连接关系
- 多目标调度需求
- 实时信息更新

**调度目标**：
- 最大化发电量
- 满足防洪安全
- 保证供水需求
- 维持生态流量

### 2. 实时调度挑战

**不确定性**：
- 来水预测误差
- 负荷预测误差
- 设备状态波动

**约束**：
- 水位约束
- 出力约束
- 流量约束
- 水量平衡

**实时性**：
- 快速决策（< 1分钟）
- 滚动更新
- 反馈修正

## 技术路线

```
实时调度系统
  ├─ 信息采集
  │   ├─ 水位监测
  │   ├─ 流量监测
  │   └─ 负荷数据
  ├─ 短期预测
  │   ├─ 来水预测
  │   ├─ 负荷预测
  │   └─ 误差估计
  └─ 滚动优化
      ├─ MPC优化
      ├─ 约束处理
      └─ 反馈修正
            ↓
方法1：离线优化+实时修正
  ├─ 日前计划（DP）
  ├─ 实时偏差
  └─ PID修正
         ↓
方法2：滚动优化MPC
  ├─ 短期预测
  ├─ 优化决策
  └─ 滚动执行
         ↓
方法3：鲁棒MPC
  ├─ 考虑不确定性
  ├─ 多场景优化
  └─ 鲁棒决策
         ↓
性能评估
  ├─ 发电量
  ├─ 约束满足
  ├─ 计算时间
  └─ 鲁棒性
```

## 核心算法

### 1. MPC滚动优化

**预测模型**：
```
V_{t+1} = V_t + (I_t - Q_t) * Δt
```

**优化问题**：
```
max Σ_{t=0}^{H-1} P_t
s.t. 水量平衡
     水位约束
     流量约束
     出力约束
```

**滚动策略**：
1. 在t时刻，预测t到t+H
2. 求解优化问题
3. 执行第一步决策
4. 更新状态，移至t+1
5. 重复

### 2. 鲁棒MPC

**不确定集合**：
```
I_t ∈ [I_forecast - δ, I_forecast + δ]
```

**鲁棒优化**：
```
max min_{I∈Ω} Σ P_t(I)
```

### 3. 反馈修正

**状态估计**：
```
V_actual = V_measured
ΔV = V_actual - V_predicted
```

**修正策略**：
- 如果|ΔV| > threshold，重新优化
- 否则，按原计划执行

## 运行方法

```bash
cd code/examples/case09_realtime_reservoir
python main.py
```

## 预期结果

**离线+修正**：
- 计算时间：< 5秒
- 发电量：95%最优
- 约束满足：90%

**MPC滚动**：
- 计算时间：< 10秒
- 发电量：98%最优
- 约束满足：95%

**鲁棒MPC**：
- 计算时间：< 20秒
- 发电量：96%最优
- 约束满足：99%
- 鲁棒性强

## 思考题

1. MPC的预测时域如何选择？
2. 如何处理预测误差？
3. 实时调度如何保证计算速度？
4. 鲁棒MPC与随机MPC的区别？
5. 如何处理突发事件？

## 扩展方向

1. **自适应MPC**：在线参数调整
2. **学习型MPC**：数据驱动建模
3. **分层MPC**：多时间尺度协调
4. **分布式MPC**：多水库协同
5. **深度强化学习**：端到端调度

## 参考文献

1. 程春田, 申建建. 水电站/水库群优化调度[M]. 中国水利水电出版社, 2015.
2. Mayne DQ, et al. Constrained Model Predictive Control[J]. Automatica, 2000, 36(6): 789-814.
3. Rawlings JB, Mayne DQ. Model Predictive Control: Theory and Design[M]. Nob Hill Publishing, 2009.

## 作者信息

- 案例编号：Case 3.3
- 难度等级：⭐⭐⭐⭐⭐ (高级)
- 所需时间：10-12小时
- 更新日期：2025-11-02
