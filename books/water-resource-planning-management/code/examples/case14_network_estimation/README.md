# 案例5.2：供水管网状态估计

## 工程背景

供水管网系统庞大复杂，传感器布置成本高，无法在每个节点都安装监测设备。通过状态估计技术，利用有限的传感器数据和管网水力模型，可以推算整个管网的压力、流量分布，实现全网状态的实时感知。

## 案例目标

1. 理解管网状态估计问题
2. 掌握扩展卡尔曼滤波（EKF）应用
3. 学习虚拟传感器布置优化
4. 能够构建管网状态监测系统

## 主要内容

### 1. 管网状态估计问题

**状态变量**：
- 节点压力（部分可测）
- 管道流量（部分可测）
- 用户需水量（未知）

**观测变量**：
- 有限节点的压力测量
- 部分管道的流量测量

**目标**：
- 估计全网节点压力
- 估计全网管道流量
- 推算用户实际需水量

### 2. 技术挑战

**非线性**：
- 管道水头损失非线性
- 节点流量平衡非线性

**不确定性**：
- 需水量波动
- 测量噪声
- 模型误差

**实时性**：
- 快速计算
- 在线更新

## 技术路线

```
管网系统
  ├─ 拓扑结构
  ├─ 水力参数
  └─ 传感器布置
         ↓
物理模型
  ├─ 节点流量平衡
  ├─ 管道水头损失
  └─ 非线性方程组
         ↓
方法1：确定性计算
  ├─ 水力计算
  ├─ 直接求解
  └─ 无滤波
         ↓
方法2：EKF状态估计
  ├─ 状态定义
  ├─ 线性化
  ├─ 滤波更新
  └─ 全网估计
         ↓
方法3：虚拟传感器
  ├─ 压力软测量
  ├─ 流量软测量
  └─ 需水量推算
         ↓
性能评估
  ├─ 估计精度
  ├─ 覆盖范围
  └─ 计算效率
```

## 核心算法

### 1. 扩展卡尔曼滤波（EKF）

**状态方程**（非线性）：
```
x_k = f(x_{k-1}) + w_k
```

**观测方程**：
```
z_k = h(x_k) + v_k
```

**线性化**：
```
F = ∂f/∂x|_{x_{k-1}}
H = ∂h/∂x|_{x_k}
```

### 2. 管网水力方程

**节点流量平衡**：
```
Σ Q_in = Σ Q_out + D
```

**管道水头损失**（Hazen-Williams）：
```
h_f = 10.67*L*Q^{1.852}/(C^{1.852}*D^{4.87})
```

### 3. 虚拟传感器布置

**目标**：
- 最小传感器数量
- 最大可观性
- 成本约束

**方法**：
- 可观性矩阵分析
- 贪心选择算法
- 灵敏度分析

## 运行方法

```bash
cd code/examples/case14_network_estimation
python main.py
```

## 预期结果

**确定性方法**：
- 压力RMSE：~2.0 m
- 受噪声影响大
- 无不确定性量化

**EKF估计**：
- 压力RMSE：~0.8 m（降低60%）
- 平滑曲线
- 提供不确定性估计

**虚拟传感器**：
- 覆盖全网节点
- 精度：±5-8%
- 成本降低70%

## 思考题

1. EKF相比标准KF的优势是什么？
2. 管网状态估计的可观性如何判断？
3. 传感器数量与估计精度的关系？
4. 如何处理突发管道爆管？
5. 实时状态估计的计算瓶颈在哪里？

## 扩展方向

1. **无迹卡尔曼滤波（UKF）**：更高精度
2. **粒子滤波（PF）**：处理强非线性
3. **集成卡尔曼滤波（EnKF）**：大规模系统
4. **数据驱动**：机器学习辅助估计
5. **故障诊断**：漏损检测与定位

## 参考文献

1. Bargiela A, Hainsworth GD. Pressure and Flow Uncertainty in Water Systems[J]. Journal of Water Resources Planning and Management, 1989, 115(2): 212-229.
2. Kang D, Lansey K. Real-Time Demand Estimation and Confidence Limit Analysis for Water Distribution Systems[J]. Journal of Hydraulic Engineering, 2009, 135(10): 825-837.

## 作者信息

- 案例编号：Case 5.2
- 难度等级：⭐⭐⭐⭐⭐ (高级)
- 所需时间：8-10小时
- 更新日期：2025-11-02
