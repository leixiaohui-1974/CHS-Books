# 案例3.1：渠道实时调度与控制

## 工程背景

某灌溉渠道需要维持稳定的水位和流量，以满足下游用水需求。由于上游来水波动、闸门操作延迟、水力波动等因素，需要设计实时控制系统来保证渠道的稳定运行。

## 案例目标

1. 理解渠道水力学基本原理
2. 掌握PID控制器设计方法
3. 学习MPC模型预测控制
4. 能够进行实时调度仿真

## 主要内容

### 1. 渠道系统

**参数**：
- 长度：1000 m
- 宽度：10 m
- 底坡：0.001
- 曼宁系数：0.025

**控制目标**：
- 维持下游水位在目标值±0.1m
- 保证流量稳定供水
- 响应下游需水变化

### 2. 控制方法对比

| 方法 | 原理 | 优点 | 缺点 |
|------|------|------|------|
| PID | 反馈控制 | 简单、鲁棒 | 不考虑约束 |
| MPC | 预测控制 | 处理约束、前馈 | 计算复杂 |
| 前馈 | 干扰补偿 | 快速响应 | 需准确模型 |

## 技术路线

```python
渠道建模
  ├─ Saint-Venant方程
  ├─ 参数设置
  └─ 初始条件
         ↓
方法1：PID控制
  ├─ 参数整定
  ├─ 水位反馈
  └─ 闸门控制
         ↓
方法2：MPC控制
  ├─ 预测模型
  ├─ 滚动优化
  └─ 约束处理
         ↓
方法3：前馈+反馈
  ├─ 干扰预测
  ├─ 前馈补偿
  └─ PID修正
         ↓
性能评估
  ├─ 水位波动
  ├─ 控制精度
  ├─ 响应时间
  └─ 能耗分析
```

## 核心算法

### 1. PID控制

**控制律**：
```python
u(t) = Kp*e(t) + Ki*∫e(τ)dτ + Kd*de(t)/dt
```

**整定方法**：Ziegler-Nichols
```python
Kp = 0.6*Ku
Ki = 2*Kp/Tu  
Kd = Kp*Tu/8
```

### 2. MPC控制

**优化问题**：
```python
min Σ(||h-href||²_Q + ||Δu||²_R)
s.t. h_min ≤ h ≤ h_max
     u_min ≤ u ≤ u_max
     Saint-Venant方程
```

### 3. Saint-Venant方程

**连续方程**：
```python
∂A/∂t + ∂Q/∂x = 0
```

**动量方程**：
```python
∂Q/∂t + ∂(Q²/A)/∂x + gA(∂h/∂x + Sf - S0) = 0
```

## 运行方法

```bash
cd code/examples/case07_canal_control
python main.py
```

## 预期结果

**PID控制**：
- 超调：15%
- 调节时间：150s
- 稳态误差：±0.05m

**MPC控制**：
- 超调：5%
- 调节时间：100s
- 稳态误差：±0.02m

**前馈+反馈**：
- 超调：8%
- 调节时间：80s
- 稳态误差：±0.03m

## 思考题

1. 为什么渠道控制具有大延迟特性？
2. PID参数如何影响控制性能？
3. MPC相比PID有什么优势？
4. 如何处理测量噪声？
5. 实际工程中还需考虑哪些因素？

## 扩展方向

1. **分布式控制**：多闸门协调控制
2. **自适应控制**：参数在线调整
3. **鲁棒控制**：抗干扰能力
4. **数字孪生**：实时状态估计
5. **深度强化学习**：端到端控制

## 参考文献

1. 李远华. 明渠非恒定流数值模拟[M]. 河海大学出版社, 2008.
2. 王福军. 计算流体动力学分析[M]. 清华大学出版社, 2004.
3. Camacho EF, Bordons C. Model Predictive Control[M]. Springer, 2007.

## 作者信息

- 案例编号：Case 3.1
- 难度等级：⭐⭐⭐⭐ (高级)
- 所需时间：6-8小时
- 更新日期：2025-11-02
