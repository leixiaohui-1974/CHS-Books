# 案例4.2：水质异常智能检测

## 工程背景

供水系统的水质监测至关重要。传统的水质监测依赖人工采样和化验，周期长、成本高。本案例利用在线监测数据（pH、浊度、余氯、电导率等），采用机器学习方法进行实时异常检测，及时发现水质问题。

## 案例目标

1. 理解异常检测的基本原理
2. 掌握多种异常检测算法
3. 学习水质数据特征提取
4. 能够进行实时异常监控

## 主要内容

### 1. 水质监测指标

**常规指标**：
- pH值（6.5-8.5）
- 浊度（< 1 NTU）
- 余氯（0.3-4 mg/L）
- 电导率（< 1000 μS/cm）
- 温度（5-30°C）

**异常类型**：
- 点异常：单个测量值异常
- 上下文异常：在特定上下文中异常
- 集体异常：一系列点异常

### 2. 异常检测方法对比

| 方法 | 原理 | 优点 | 缺点 |
|------|------|------|------|
| 统计方法 | 3σ原则 | 简单快速 | 假设数据正态分布 |
| 孤立森林 | 随机分割 | 无监督、高效 | 参数敏感 |
| 自编码器 | 重构误差 | 捕捉复杂模式 | 需要较多数据 |
| 局部异常因子 | 密度估计 | 发现局部异常 | 计算复杂 |

## 技术路线

```
数据采集
  ├─ 在线监测
  ├─ 历史数据
  └─ 质控数据
         ↓
数据预处理
  ├─ 缺失值处理
  ├─ 异常值修复
  ├─ 数据归一化
  └─ 特征提取
         ↓
方法1：统计方法
  ├─ 3σ原则
  ├─ 箱线图法
  └─ Z-score
         ↓
方法2：孤立森林
  ├─ 随机分割树
  ├─ 异常分数
  └─ 阈值确定
         ↓
方法3：自编码器
  ├─ 编码器
  ├─ 解码器
  ├─ 重构误差
  └─ 异常判定
         ↓
结果分析
  ├─ 准确率、召回率
  ├─ ROC曲线
  ├─ 混淆矩阵
  └─ 实时监控
```

## 核心算法

### 1. 孤立森林（Isolation Forest）

**原理**：
- 异常点更容易被孤立
- 构建随机树进行分割
- 计算平均路径长度

**异常分数**：
```
score = 2^(-E(h(x))/c(n))
```
其中E(h(x))为平均路径长度

### 2. 自编码器（Autoencoder）

**结构**：
```
Input (n_features)
    ↓
Encoder: n → 32 → 16 → 8
    ↓
Latent Space (8)
    ↓
Decoder: 8 → 16 → 32 → n
    ↓
Output (n_features)
```

**异常分数**：
```
score = ||x - x̂||²
```
重构误差越大，越可能是异常

### 3. 局部异常因子（LOF）

**原理**：
- 比较样本的局部密度
- 计算k近邻密度
- LOF > 1表示异常

## 运行方法

```bash
cd code/examples/case11_anomaly_detection
python main.py
```

## 预期结果

**统计方法**：
- 准确率：85-90%
- 召回率：70-75%
- 计算速度：极快

**孤立森林**：
- 准确率：90-93%
- 召回率：85-88%
- 计算速度：快

**自编码器**：
- 准确率：93-95%
- 召回率：88-92%
- 计算速度：中等

## 思考题

1. 什么情况下应该使用统计方法？
2. 孤立森林如何处理高维数据？
3. 自编码器的重构误差阈值如何确定？
4. 如何处理不平衡数据？
5. 实时检测系统需要哪些功能？

## 扩展方向

1. **集成学习**：多模型投票
2. **在线学习**：模型增量更新
3. **多源融合**：结合多种传感器
4. **预警系统**：分级报警
5. **根因分析**：异常溯源

## 参考文献

1. Liu FT, et al. Isolation Forest[C]. ICDM, 2008: 413-422.
2. Breunig MM, et al. LOF: Identifying Density-Based Local Outliers[C]. ACM SIGMOD, 2000: 93-104.
3. Chandola V, et al. Anomaly Detection: A Survey[J]. ACM Computing Surveys, 2009, 41(3): 15.

## 作者信息

- 案例编号：Case 4.2
- 难度等级：⭐⭐⭐⭐ (高级)
- 所需时间：6-8小时
- 更新日期：2025-11-02
