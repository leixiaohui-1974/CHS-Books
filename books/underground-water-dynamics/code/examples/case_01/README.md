# 案例1：一维稳态地下水流动

## 学习目标

1. ✅ 理解达西定律和一维稳态渗流方程
2. ✅ 掌握有限差分法离散
3. ✅ 学习边界条件的处理
4. ✅ 进行手工计算验证
5. ✅ 掌握误差分析方法

## 问题描述

一个一维承压含水层：
- 长度 L = 1000 m
- 水力传导度 K = 10 m/day
- 左边界水头 h₀ = 20 m（第一类边界条件）
- 右边界水头 hₗ = 10 m（第一类边界条件）

求解：稳态水头分布 h(x)

## 理论基础

### 控制方程

一维稳态渗流方程（承压含水层）：

```python
d/dx(K * dh/dx) = 0
```

对于均质含水层（K为常数）：

```python
d²h/dx² = 0
```

### 解析解

线性分布：

```python
h(x) = h₀ + (hₗ - h₀) * x / L
```

### 达西定律

流速（达西速度）：

```python
v = -K * dh/dx
```

对于此问题：

```python
v = -K * (hₗ - h₀) / L = -10 * (10 - 20) / 1000 = 0.1 m/day
```

## 数值方法

### 有限差分离散

将区域划分为 nx 个节点，网格间距：

```python
dx = L / (nx - 1)
```

对内部节点 i，使用中心差分：

```python
K * (h[i+1] - 2*h[i] + h[i-1]) / dx² = 0
```

边界条件：
- h[0] = h₀ = 20
- h[nx-1] = hₗ = 10

### 矩阵形式

```python
A * h = b
```

其中 A 是三对角矩阵：

```json
[1    0    0   ...  0  ] [h₀]   [h₀]
[K  -2K    K   ...  0  ] [h₁]   [0 ]
[0    K  -2K   ...  0  ] [h₂] = [0 ]
[...            ...    ] [...]  [...]
[0    0    0   ...  1  ] [hₙ]   [hₗ]
```

## 运行代码

### 安装依赖

```bash
pip install numpy scipy matplotlib
```python

### 运行

```bash
cd code/examples/case_01
python case_01_1d_steady.py
```python

### 输出

程序将：
1. 输出问题参数
2. 计算解析解和数值解
3. 进行误差分析
4. 生成3张图：
   - `case_01_comparison.png`: 数值解与解析解对比
   - `case_01_velocity.png`: 达西速度分布
   - `case_01_convergence.png`: 网格收敛性分析

## 预期结果

### 数值精度

- RMSE < 1e-10 m（机器精度）
- 数值解与解析解完全吻合

### 流速

- 理论流速：0.1 m/day（常数）
- 数值流速：≈ 0.1 m/day

### 网格收敛性

随着网格加密，误差呈指数下降（对于此线性问题，误差极小）。

## 实验探索

### 实验1：改变水力传导度

修改 `K` 的值，观察：
- 流速如何变化？
- 水头分布形状是否改变？

```python
K = 5.0   # 试试其他值：1.0, 20.0, 100.0
```python

**预期**：流速与K成正比，但水头分布形状（线性）不变。

### 实验2：改变边界条件

修改边界水头：

```python
h0 = 25.0
hL = 5.0
```python

**预期**：水头梯度增大，流速增加。

### 实验3：添加源汇项

添加均匀补给（如降水）：

```python
R = 0.001  # m/day 补给率
source = R * np.ones(nx)
h = solve_1d_steady_gw(K, L, h0, hL, nx, source=source)
```python

**预期**：水头分布变为抛物线形。

### 实验4：非均质含水层

创建变化的K：

```python
K_field = np.linspace(5.0, 15.0, nx)  # K从5到15线性变化
```python

**注意**：需要修改求解器支持变化的K（案例3将详细讲解）。

## 手工计算示例

### 问题
给定：K=10 m/day, L=1000 m, h₀=20 m, hₗ=10 m

### 求解x=500m处的水头

解析解：
```
h(500) = 20 + (10 - 20) * 500 / 1000
       = 20 - 10 * 0.5
       = 20 - 5
       = 15 m
```python

### 求解流速

```
v = -K * (hₗ - h₀) / L
  = -10 * (10 - 20) / 1000
  = -10 * (-10) / 1000
  = 100 / 1000
  = 0.1 m/day
```

正值表示从左向右流动。

## 常见问题

### Q1: 为什么数值解与解析解完全相同？

**A**: 对于这个线性问题，有限差分法可以精确求解。误差仅来自浮点数运算的舍入误差。

### Q2: 网格数量对结果有影响吗？

**A**: 对此线性问题，网格数量 ≥ 2 即可获得精确解。但对非线性或复杂问题，需要足够细的网格。

### Q3: 如何验证代码的正确性？

**A**: 
1. 与解析解对比（本案例）
2. 网格收敛性检验
3. 质量守恒检查：流入量 = 流出量

## 延伸阅读

1. Bear, J. (1972). *Dynamics of Fluids in Porous Media*. Dover.
2. Freeze, R. A., & Cherry, J. A. (1979). *Groundwater*. Prentice Hall.
3. Wang, H. F., & Anderson, M. P. (1982). *Introduction to Groundwater Modeling*. Academic Press.

## 下一步

完成本案例后，继续学习：
- **案例2**：二维稳态流动与网格剖分
- **案例3**：非均质含水层模拟
- **案例4**：瞬态地下水流动
