# 案例4：瞬态地下水流动

## 学习目标

1. ✅ 理解瞬态渗流方程
2. ✅ 掌握时间离散方法（隐式/显式）
3. ✅ 学习储水系数的作用
4. ✅ 模拟抽水试验
5. ✅ 分析降落漏斗的演化
6. ✅ 掌握Theis解析解

## 问题描述

矩形承压含水层：
- 尺寸：Lx = 1000 m, Ly = 800 m
- 水力传导度：K = 10 m/day
- 储水系数：S = 0.001
- 初始水头：h₀ = 15 m（均匀分布）
- 边界条件：四周固定水头 15 m
- 抽水井：位于中心，抽水量 Q = 100 m³/day
- 模拟时长：50 day

## 理论基础

### 控制方程

二维瞬态渗流方程（均质承压含水层）：

```python
S * ∂h/∂t = K * (∂²h/∂x² + ∂²h/∂y²) + Q
```

其中：
- S: 储水系数（单位水头变化释放的水量）
- K: 水力传导度
- Q: 源汇项

### Theis解析解

对于无限大承压含水层中的单井抽水：

```python
s(r, t) = Q/(4πT) * W(u)
```

其中：
- s: 降深
- T = Kb: 导水系数（b为含水层厚度）
- W(u): 井函数
- u = r²S/(4Tt)

井函数：
```python
W(u) = -Ei(-u) = ∫[u,∞] e^(-y)/y dy
```

### 储水系数的物理意义

储水系数 S = S_s × b，其中：
- S_s: 单位储水系数
- b: 含水层厚度

对于承压含水层：
- S = 10^-5 ~ 10^-3（弹性释水）
- 主要来自水和固体骨架的压缩

对于潜水含水层：
- S_y = 0.01 ~ 0.3（重力排水）
- 主要来自孔隙空气排出

## 数值方法

### 时间离散

**隐式欧拉法（向后欧拉）**：

```python
S(h^(n+1) - h^n)/Δt = K∇²h^(n+1) + Q
```

优点：
- 无条件稳定
- 可以使用较大时间步长

缺点：
- 每个时间步需要求解线性方程组
- 计算量较大

**显式欧拉法（向前欧拉）**：

```python
S(h^(n+1) - h^n)/Δt = K∇²h^n + Q
```

优点：
- 直接计算，不需要求解方程组
- 编程简单

缺点：
- 需要满足CFL条件才稳定
- 时间步长受限

### CFL条件

对于显式方法，稳定性条件：

```python
K*Δt/S * (1/Δx² + 1/Δy²) ≤ 0.5
```

即：
```python
Δt ≤ 0.5 * S * min(Δx², Δy²) / K
```

## 运行代码

```bash
cd code/examples/case_04
python3 case_04_transient.py
```python

## 输出结果

程序将生成：

1. **case_04_final_head.png**: 最终时刻水头分布
2. **case_04_drawdown.png**: 降落漏斗
3. **case_04_well_head_time.png**: 井处水头时间变化
4. **case_04_drawdown_time.png**: 井处降深时间变化
5. **case_04_profile_comparison.png**: 降深剖面与Theis解对比
6. **case_04_multi_time.png**: 多个时刻的降深分布
7. **case_04_animation.gif**: 瞬态过程动画（可选）

## 预期结果

### 水头演化

- 初始：均匀分布 15 m
- 抽水开始后：井处水头下降
- 降落漏斗向外扩展
- 最终：达到准稳态（边界影响）

### 降深特征

- 井处降深最大
- 随径向距离增加而减小
- 随时间增加而增大
- 符合Theis解

### 时间尺度

特征时间：T_c = S*L²/K

对于本问题：
```
T_c = 0.001 × 1000² / 10 = 100 day
```python

## 实验探索

### 实验1：改变储水系数

试试不同的S值：

```python
S_values = [0.0001, 0.001, 0.01]
```python

**观察**：
- S越小，降深发展越快
- S越大，系统响应越慢

### 实验2：改变时间步长

比较隐式和显式方法：

```python
# 隐式方法（大时间步）
dt = 1.0, method='implicit'

# 显式方法（小时间步）
dt = 0.1, method='explicit'
```python

**观察**：
- 隐式方法稳定性更好
- 显式方法对时间步长敏感

### 实验3：多口井抽水

设置多个抽水井：

```python
source = np.zeros((nt, ny, nx))
# 井1
source[:, ny//3, nx//3] = -50.0 / (dx * dy)
# 井2
source[:, 2*ny//3, 2*nx//3] = -50.0 / (dx * dy)
```python

**观察**：降落漏斗的叠加效应。

### 实验4：间歇抽水

模拟抽水-停止-抽水循环：

```python
source = np.zeros((nt, ny, nx))
for t in range(nt):
    if (t // 20) % 2 == 0:  # 每20天切换一次
        source[t, well_i, well_j] = -Q_well / (dx * dy)
```python

**观察**：水位恢复过程。

### 实验5：阶梯抽水试验

逐步增加抽水量：

```python
for t in range(nt):
    if t < 20:
        Q = 50.0
    elif t < 40:
        Q = 100.0
    else:
        Q = 150.0
    source[t, well_i, well_j] = -Q / (dx * dy)
```python

**观察**：降深的阶梯响应。

## 常见问题

### Q1: 为什么需要储水系数S？

**A**: 储水系数表征含水层的"弹性"，决定了水头变化时释放或存储的水量。没有S，瞬态问题退化为稳态问题。

### Q2: 如何选择时间步长？

**A**: 
- **隐式方法**：根据精度要求，一般Δt = 0.1~1 day
- **显式方法**：必须满足CFL条件

### Q3: Theis解的适用条件？

**A**: 
1. 无限大含水层
2. 均质各向同性
3. 完全承压
4. 瞬时抽水
5. 完整井

本案例边界有限，长时间后会偏离Theis解。

### Q4: 如何处理井的奇异性？

**A**: 
1. 井筛模型（实际井半径）
2. 源汇项分布到周围单元
3. 使用更细的网格

### Q5: 降深何时达到稳态？

**A**: 
- 无限大含水层：永不稳态
- 有限边界：当边界影响到达抽水井
- 时间尺度：T_c = S*L²/K

## 数学推导补充

### Theis解推导

从径向流方程：
```
S * ∂h/∂t = T * (∂²h/∂r² + 1/r * ∂h/∂r)
```python

引入相似变换：
```
u = r²/(4Tt/S)
```python

得到降深：
```
s = Q/(4πT) * W(u)
```python

### 数值稳定性分析

对于显式方法，Von Neumann稳定性分析得到：

```
|1 - 2α(cos(kxΔx) + cos(kyΔy) - 2)| ≤ 1
```python

其中 α = KΔt/(SΔx²)

最严格条件：
```
α ≤ 0.25 (一维)
α ≤ 0.125 (二维)
```

## 下一步

完成本案例后，继续学习：
- **案例5**：有限元方法基础
- **案例6**：参数率定方法
- **案例7**：PEST自动率定
