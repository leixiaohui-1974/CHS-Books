# 案例3：非均质含水层模拟

## 学习目标

1. ✅ 理解非均质性的表征方法
2. ✅ 掌握分区参数设置
3. ✅ 学习随机场生成方法（地质统计）
4. ✅ 分析非均质性对流场的影响
5. ✅ 可视化非均质参数场

## 问题描述

矩形承压含水层，水力传导度K空间变化：
- 尺寸：Lx = 1000 m, Ly = 800 m
- 背景水力传导度：K = 10 m/day
- 边界条件：左边h=20m，右边h=10m，上下无流

## 四种场景

### 场景1：均质含水层（基准）
- K = 10 m/day（常数）
- 用于对比参考

### 场景2：低渗透透镜体
- 背景：K = 10 m/day
- 透镜体1：K = 1 m/day（低渗透）
- 透镜体2：K = 2 m/day（中等渗透）

### 场景3：高渗透通道
- 背景：K = 10 m/day
- 通道：K = 50 m/day（高渗透）

### 场景4：随机非均质场
- 对数正态分布
- 几何平均：K = 10 m/day
- 对数方差：σ² = 0.5
- 相关长度：λ = 200 m

## 理论基础

### 非均质渗流方程

```
∂/∂x(K(x,y) * ∂h/∂x) + ∂/∂y(K(x,y) * ∂h/∂y) = 0
```

其中K(x,y)是空间变化的水力传导度场。

### 非均质性类型

**1. 分层非均质**
- 水平方向层状分布
- 常见于沉积地层

**2. 透镜体**
- 局部异常区域
- 常见于古河道、粘土透镜体

**3. 各向异性**
- Kx ≠ Ky
- 常见于层状介质

**4. 随机非均质**
- 空间随机变化
- 需要地质统计方法

### 随机场生成方法

**协方差函数**（指数型）：

```
C(h) = σ² * exp(-|h|/λ)
```

其中：
- h: 距离
- σ²: 方差
- λ: 相关长度

**生成步骤**：
1. 构建协方差矩阵C
2. Cholesky分解：C = L*L^T
3. 生成随机数：z ~ N(0,1)
4. 相关随机场：Y = L*z
5. 对数正态变换：K = exp(μ + Y)

## 运行代码

```bash
cd code/examples/case_03
python3 case_03_heterogeneous.py
```

**注意**：随机场生成可能需要几分钟时间。

## 输出结果

程序将生成：

1. **case_03_K_fields.png**: 四种场景的K场对比
2. **case_03_head_fields.png**: 四种场景的水头分布
3. **case_03_centerline_comparison.png**: 中心线水头和K对比
4. **case_03_streamlines.png**: 流线图

## 预期结果

### 场景对比

| 场景 | K范围 | 水头标准差 | 特征 |
|------|-------|------------|------|
| 均质 | 10 | 最小 | 线性变化 |
| 低渗透透镜体 | 1-10 | 中等 | 流线绕行 |
| 高渗透通道 | 10-50 | 中等 | 流量集中 |
| 随机场 | 变化大 | 最大 | 不规则分布 |

### 关键发现

1. **低渗透透镜体**
   - 流线绕过低K区
   - 透镜体内水头梯度增大
   - 局部流速减小

2. **高渗透通道**
   - 流线向通道集中
   - 通道内流速增大
   - 优先流路形成

3. **随机非均质**
   - 水头分布不规则
   - 流场复杂多变
   - 难以预测

## 实验探索

### 实验1：改变透镜体大小

```python
zones = [{
    'x_range': (200, 800),  # 更大的透镜体
    'y_range': (200, 600),
    'K': 1.0
}]
```

**观察**：透镜体越大，影响范围越大。

### 实验2：改变K对比度

```python
# 强对比度
K_lens = 0.1  # 极低渗透

# 弱对比度
K_lens = 5.0  # 接近背景值
```

**观察**：对比度越大，流场扰动越明显。

### 实验3：改变相关长度

```python
# 短相关长度（小尺度变化）
correlation_length = 50.0

# 长相关长度（大尺度变化）
correlation_length = 500.0
```

**观察**：相关长度决定空间变异尺度。

### 实验4：多个透镜体

```python
zones = [
    {'x_range': (200, 300), 'y_range': (300, 400), 'K': 1.0},
    {'x_range': (400, 500), 'y_range': (400, 500), 'K': 2.0},
    {'x_range': (600, 700), 'y_range': (200, 300), 'K': 0.5}
]
```

**观察**：透镜体之间的相互影响。

### 实验5：各向异性

修改求解器支持各向异性：
```python
Kx = 20.0  # x方向
Ky = 5.0   # y方向（小于x方向）
```

**观察**：流线倾向于高渗透方向。

## 常见问题

### Q1: 为什么随机场生成很慢？

**A**: 需要构建和分解大的协方差矩阵（N×N）。
- 对于51×41=2091个节点，矩阵尺寸为2091×2091
- 可以使用更粗的网格或更快的算法（如FFT方法）

### Q2: 如何选择相关长度？

**A**: 
- 依赖于实际地质条件
- 典型值：50-500m
- 可以通过变异函数分析确定

### Q3: 对数方差的意义？

**A**: 
- σ²=0: 均质
- σ²=0.5: 中等变异
- σ²=1.0: 强变异
- σ²>2.0: 极强变异

### Q4: 如何处理各向异性？

**A**: 
需要修改求解器，使用张量形式的K：
```
K = [Kxx  Kxy]
    [Kxy  Kyy]
```

### Q5: 非均质性对模型精度的影响？

**A**: 
- 非均质性增加不确定性
- 需要更细的网格
- 需要参数率定（案例6-8）

## 数学推导补充

### 有效水力传导度

对于层状介质：

**水平方向**（算术平均）：
```
K_h = (K1*b1 + K2*b2 + ...) / (b1 + b2 + ...)
```

**垂直方向**（调和平均）：
```
1/K_v = (b1/K1 + b2/K2 + ...) / (b1 + b2 + ...)
```

### 地质统计学

**变异函数**：
```
γ(h) = 1/(2N) * Σ[Z(x+h) - Z(x)]²
```

**克里金插值**：
- 无偏估计
- 最小估计方差
- 考虑空间相关性

## 延伸阅读

1. Dagan, G. (1989). *Flow and Transport in Porous Formations*
2. Gelhar, L. W. (1993). *Stochastic Subsurface Hydrology*
3. Deutsch, C. V., & Journel, A. G. (1998). *GSLIB: Geostatistical Software Library*

## 下一步

完成本案例后，继续学习：
- **案例4**：瞬态地下水流动（已完成）
- **案例5**：有限元方法基础
- **案例6**：参数率定方法
