# 案例13：渗漏与越流模拟

**难度**: ⭐⭐⭐⭐  
**前置案例**: 案例1, 案例2, 案例11  
**预计学习时间**: 5-7小时

---

## 📚 学习目标

通过本案例，你将学会：

1. ✅ 理解多层含水层系统中的越流机制
2. ✅ 建立三维多层地下水模型
3. ✅ 计算层间垂向水量交换
4. ✅ 分析渗漏因子的物理意义
5. ✅ 应用Hantush-Jacob解析解
6. ✅ 评估弱透水层参数影响

---

## 🎯 物理背景

### 什么是越流？

**越流（Leakage）**是指水量通过弱透水层在不同含水层之间的垂向流动。

```python
地表
  ↓
浅层含水层 (Aquifer 1)
  ↕ 越流 (Leakage)
弱透水层 (Aquitard)
  ↕ 越流 (Leakage)
深层含水层 (Aquifer 2)
```

### 为什么重要？

1. **水资源评估**：
   - 深层含水层可能接受浅层补给
   - 影响可开采资源量
   - 决定井间干扰程度

2. **环境保护**：
   - 浅层污染可能向深层扩散
   - 需要评估污染风险
   - 设计防护措施

3. **开采管理**：
   - 深层抽水可能引起浅层降深
   - 越流补给可延缓水位下降
   - 需要综合管理

### 实际案例

**华北平原地下水系统**：
- 第四系含水层（浅层）
- 粘土层（弱透水层）
- 第三系含水层（深层）
- 过度开采导致越流增强

**美国High Plains含水层**：
- Ogallala含水层
- 下伏基岩弱透水层
- 越流很弱，几乎封闭

---

## 📐 理论基础

### 1. 越流基本公式

**达西定律的垂向形式**：

```python
q = -K_v * dh/dz
```

对于弱透水层：
```python
Q = K_aquitard * A * (h_upper - h_lower) / b_aquitard
```

**简化为**：
```python
Q = C * (h_upper - h_lower)
```

其中传导度：
```python
C = K_aquitard * A / b_aquitard  (m²/day)
```

**渗漏系数**：
```python
L = K_aquitard / b_aquitard  (1/day)
```

关系：`C = L * A`

### 2. 越流方向

**由水头差决定**：

```python
当 h_upper > h_lower:
    Q > 0  →  向下流动（上层流向下层）

当 h_upper < h_lower:
    Q < 0  →  向上流动（下层流向上层）

当 h_upper = h_lower:
    Q = 0  →  无越流（平衡状态）
```

### 3. 多层系统

**三层系统示例**：

```python
Layer 1: h₁ = 65m
   ↓ Q₁ = C₁(h₁ - h₂)
Aquitard 1
   ↓
Layer 2: h₂ = 55m
   ↓ Q₂ = C₂(h₂ - h₃)
Aquitard 2
   ↓
Layer 3: h₃ = 50m
```

**水量平衡**：

对于第i层：
```python
∂h_i/∂t = ∇·(T_i∇h_i) + Q_from_above - Q_to_below + other_sources
```

其中：
- `Q_from_above`: 来自上层的越流（流入）
- `Q_to_below`: 向下层的越流（流出）

### 4. Hantush-Jacob解

**问题**：承压含水层抽水，考虑来自相邻含水层的越流补给。

**控制方程**：
```python
S ∂h/∂t = T ∇²h - L(h - h₀)
```

其中：
- `L`: 渗漏系数 (1/day)
- `h₀`: 相邻含水层水头（假设不变）

**稳态径向流解**：
```python
s = (Q / 2πT) * K₀(r/B)
```

其中：
- `K₀`: 修正的第二类Bessel函数
- `B = √(T/L)`: 渗漏因子 (m)

**物理意义**：
- 考虑越流后，降深比Theis解小
- 越流补给减缓水位下降
- 影响范围由B控制

### 5. 渗漏因子

**定义**：
```python
B = √(T / L) = √(T * b_aquitard / K_aquitard)
```

**物理意义**：
- B是一个特征长度
- 表示越流影响的空间范围
- B越大，越流越弱，影响范围越广

**分类**：
```python
B > 500m:   弱越流系统
100-500m:   中等越流系统
B < 100m:   强越流系统
```

**影响因素**：

1. **导水系数T**：
   - T ↑ → B ↑
   - 含水层导水性越好，越流影响越广

2. **弱透水层渗透性K**：
   - K ↑ → L ↑ → B ↓
   - 弱透水层越"透"，越流越强

3. **弱透水层厚度b**：
   - b ↑ → L ↓ → B ↑
   - 弱透水层越厚，越流越弱

### 6. 承压与无压

**承压含水层**：
- 上下被弱透水层包围
- 水头可以高于顶板
- 储水系数很小（~10⁻⁴）
- 越流主要机制

**无压含水层**：
- 有自由水面
- 水头不能高于顶板
- 给水度较大（~0.1）
- 垂向入渗重要

---

## 💻 代码实现

### MultiLayerSystem类

**创建多层系统**：

```python
from gwflow.coupling import MultiLayerSystem

system = MultiLayerSystem(name='ThreeLayerSystem')

# 添加第1层含水层
system.add_aquifer_layer(
    layer_id=0,
    top_elevation=100.0,
    bottom_elevation=80.0,
    K_horizontal=15.0,
    storage=0.0002,
    is_confined=True
)

# 添加弱透水层
system.add_aquitard_layer(
    top_elevation=80.0,
    bottom_elevation=75.0,
    K_vertical=0.01
)

# 添加第2层含水层
system.add_aquifer_layer(
    layer_id=1,
    top_elevation=75.0,
    bottom_elevation=45.0,
    K_horizontal=25.0,
    storage=0.0001,
    is_confined=True
)

# ... 继续添加
```python

### 计算越流

```python
# 各层水头（list of arrays）
heads = [
    h1,  # 第1层水头 (ny, nx)
    h2,  # 第2层水头
    h3   # 第3层水头
]

# 计算越流通量
cell_area = dx * dy
leakage_fluxes = system.compute_leakage(heads, cell_area)

# leakage_fluxes[i] 是第i层的净越流
# 正值：流出该层（向下）
# 负值：流入该层（向上）
```python

### 转换为源汇项

```python
# 单元体积
cell_volumes = [
    np.ones_like(h1) * dx * dy * b1,
    np.ones_like(h2) * dx * dy * b2,
    np.ones_like(h3) * dx * dy * b3
]

# 转换为源汇项 (1/day)
source_terms = system.compute_leakage_as_source(heads, cell_volumes)

# 用于求解器
# source_terms[i] 可直接加入第i层的源汇项
```python

### Hantush-Jacob解

```python
from gwflow.coupling import hantush_jacob_solution

# 参数
r = np.linspace(10, 1000, 100)  # 径向距离
t = 1.0                          # 时间
Q_well = 1000.0                  # 抽水量
T = 750.0                        # 导水系数
S = 0.0001                       # 储水系数
leakance = 0.001                 # 渗漏系数

# 计算降深
s = hantush_jacob_solution(r, t, Q_well, T, S, leakance)

# 对比无越流情况（Theis解）
s_theis = hantush_jacob_solution(r, t, Q_well, T, S, leakance=0.0)
```python

### 渗漏因子

```python
from gwflow.coupling import estimate_leakage_factor

# 计算渗漏因子
T = 750.0
leakance = 0.001
B = estimate_leakage_factor(T, leakance)

print(f"渗漏因子: {B:.1f} m")

# 或从弱透水层参数计算
K_aquitard = 0.01  # m/day
b_aquitard = 10.0  # m
L = K_aquitard / b_aquitard
B = estimate_leakage_factor(T, L)
```python

---

## 📊 运行案例

### 执行命令

```bash
cd code/examples/case_13
python3 case_13_leakage.py
```python

### 预期输出

```
============================================================
案例13：渗漏与越流模拟
============================================================

创建三层含水层系统
============================================================

第1层（浅层含水层）：
  顶板高程: 100 m
  底板高程: 80 m
  厚度: 20 m
  水平渗透系数: 15 m/day
  储水系数: 0.0002

弱透水层1：
  厚度: 5 m
  垂向渗透系数: 0.01 m/day
  渗漏系数: 0.002 1/day

第2层（中层含水层）：
  厚度: 30 m
  水平渗透系数: 25 m/day

第3层（深层含水层）：
  厚度: 38 m
  水平渗透系数: 30 m/day

系统摘要：
  含水层数: 3
  弱透水层数: 2

============================================================
场景1：均匀水头分布
============================================================

越流通量：
  第1层: 0.00e+00 m³/day （应为0）
  第2层: 0.00e+00 m³/day
  第3层: 0.00e+00 m³/day

============================================================
场景2：水头梯度分布
============================================================

水头设置：
  第1层: 65.0 m （最高）
  第2层: 55.0 m
  第3层: 50.0 m （最低）

单元越流通量：
  第1层:
    平均: 250.00 m³/day/cell
    总计: 110250.00 m³/day
    方向: 向下流出
  第2层:
    平均: 0.00 m³/day/cell
    总计: 0.00 m³/day
    方向: 无流动
  第3层:
    平均: -267.86 m³/day/cell
    总计: -118066.07 m³/day
    方向: 向上流入

水量平衡检查：
  总净越流: -7.28e-09 m³/day
  （应接近0）

============================================================
场景3：中层抽水效应
============================================================

抽水井参数：
  位置: (1000, 1000) m
  流量: 2000 m³/day
  抽水层: 第2层（中层）
  时间: 10 day

水头变化：
  第1层: 65.0 → 62.6 m （降深2.40 m）
  第2层: 60.0 → 52.0 m （降深8.00 m）
  第3层: 55.0 → 53.4 m （降深1.60 m）

第2层越流补给：
  来自第1层: 5247.32 m³/day
  来自第3层: 3142.58 m³/day
  总越流补给: 8389.90 m³/day
  抽水量: 2000.00 m³/day
  越流补给占比: 419.5%

Hantush-Jacob解析解分析
============================================================

渗漏因子：
  无越流（Theis）: B = ∞
  L=0.0001 1/day: B = 2738.6 m
  L=0.0005 1/day: B = 1224.7 m
  L=0.001 1/day: B = 866.0 m
  L=0.005 1/day: B = 387.3 m

渗漏因子敏感性分析
============================================================

渗漏因子矩阵 B (m):
K_aquitard (m/day)    b=1m        b=5m       b=10m       b=20m    
--------------------------------------------------------------------
0.001                 866.0      1936.5      2738.6      3873.0
0.010                 273.9       612.4       866.0      1224.7
0.100                  86.6       193.6       273.9       387.3
1.000                  27.4        61.2        86.6       122.5

✅ 案例13执行完成！
```matlab

### 生成图片

程序会生成 `case_13_leakage_results.png`，包含9个子图：

1. **场景2：水头垂向分布**
2. **场景2：分层越流通量**
3. **系统结构示意图**
4. **场景3：第2层水头分布**
5. **场景3：径向水头剖面**
6. **场景3：抽水引起的越流**
7. **Hantush-Jacob解对比**
8. **渗漏因子热图**
9. **越流强度分类统计**

---

## 📈 结果分析

### 1. 场景1：均匀水头

**观察**：
- 所有层水头相同（60m）
- 无水头梯度 → 无越流
- 越流通量 = 0

**物理意义**：
平衡状态，各层之间无水量交换。

### 2. 场景2：水头梯度

**设置**：
- 第1层：65m（最高）
- 第2层：55m
- 第3层：50m（最低）

**结果**：
- 第1层：净流出 ~110,000 m³/day
- 第2层：流入≈流出，净值≈0
- 第3层：净流入 ~118,000 m³/day

**解释**：
1. 第1层水头最高，向下补给第2层
2. 第2层从第1层接受补给，同时向第3层补给
3. 第3层水头最低，从第2层接受补给

**水量平衡**：
总净越流 ≈ 0（数值误差很小），验证计算正确。

### 3. 场景3：中层抽水

**现象**：
- 第2层（抽水层）：降深最大（8m）
- 第1层：通过越流向第2层补给
- 第3层：也通过越流向第2层补给

**越流补给**：
- 来自第1层：~5,250 m³/day
- 来自第3层：~3,140 m³/day
- 总计：~8,390 m³/day

**补给率**：
- 抽水量：2,000 m³/day
- 越流补给：8,390 m³/day
- 补给率：419%

**解释**：
这个高补给率表明：
1. 越流是重要的补给来源
2. 可以显著缓解抽水影响
3. 但也意味着上下层水位都会受影响

### 4. Hantush-Jacob解

**趋势**：
```
渗漏系数 L ↑ → 越流补给 ↑ → 降深 ↓
```python

**对比**：
- 无越流（L=0）：降深最大（Theis解）
- 弱越流（L=0.0001）：降深略小
- 强越流（L=0.005）：降深显著减小

**距离影响**：
- 近井处：越流影响相对较小
- 远井处：越流影响显著，降深减小明显

### 5. 渗漏因子分析

**关键发现**：

1. **K_aquitard影响**：
   - K从0.001增到1.0 (×1000)
   - B从866减到27 (÷32)
   - 弱透水层越"透"，越流越强

2. **b_aquitard影响**：
   - b从1增到20 (×20)
   - B从866增到3873 (×4.5)
   - 弱透水层越厚，越流越弱

3. **强度分类**：
   根据B值，大部分参数组合落入：
   - 强越流（B<100m）：K大、b小
   - 中等越流（100-500m）：中等参数
   - 弱越流（B>500m）：K小、b大

---

## 🔬 实验探索

### 实验1：改变弱透水层参数

**目标**：评估弱透水层对越流的控制作用

```python
# 原始参数
K_original = 0.01  # m/day
b_original = 5.0   # m

# 实验组
K_values = [0.001, 0.01, 0.1]  # 变化100倍
b_values = [1, 5, 10]          # 变化10倍

for K in K_values:
    for b in b_values:
        # 修改弱透水层参数
        system.aquitard_layers[0].K_vertical = K
        # 注意：修改后需要重建aquitard对象
        
        # 重新计算越流
        leakage = system.compute_leakage(heads, cell_area)
        
        # 分析结果
```python

**预期**：
- K增加 → 越流增加（线性关系）
- b增加 → 越流减少（反比关系）

### 实验2：不同抽水层位置

**目标**：对比在不同层抽水的影响

```python
# 场景A：在第1层抽水
# 场景B：在第2层抽水（本案例）
# 场景C：在第3层抽水

# 对比：
# - 各层降深分布
# - 越流通量大小
# - 影响范围
```python

**预期**：
- 浅层抽水：影响范围小，越流弱
- 深层抽水：影响范围大，越流强
- 中层抽水：受上下层双向补给

### 实验3：多井干扰

**目标**：分析多井同时抽水的越流效应

```python
# 设置多个抽水井
wells = [
    {'x': 500, 'y': 500, 'Q': 1000},
    {'x': 1500, 'y': 500, 'Q': 1000},
    {'x': 1000, 'y': 1500, 'Q': 1000}
]

# 对比：
# - 单井 vs 多井
# - 越流总量变化
# - 降深叠加效应
```python

**预期**：
- 越流补给显著增加
- 井间干扰范围扩大
- 需要综合评估影响

### 实验4：瞬态越流

**目标**：分析越流的时间演化

```python
# 初始：稳态，均匀水头
# t=0: 开始抽水
# t=1, 2, 5, 10, 30, 100 day: 记录状态

# 分析：
# - 越流如何随时间变化
# - 何时达到准稳态
# - 弱透水层储水释放
```

**预期**：
- 初期：主要消耗含水层储水
- 中期：越流逐渐建立
- 后期：达到准稳态，越流稳定

---

## 🤔 常见问题

### Q1: 如何确定弱透水层参数？

**A**: 多种方法：

1. **现场试验**：
   - 抽水试验（越流型）
   - 注水试验
   - 慢速抽水试验

2. **实验室测试**：
   - 岩芯渗透试验
   - 垂向K值测定
   - 注意取样代表性

3. **反演率定**：
   - 利用多层观测数据
   - 优化算法反演
   - 最推荐的方法

4. **经验值**：
   - 粘土层：K = 10⁻⁴ - 10⁻⁶ m/day
   - 粉质粘土：K = 10⁻³ - 10⁻⁴ m/day
   - 砂质粘土：K = 10⁻² - 10⁻³ m/day

### Q2: 越流一定是向下的吗？

**A**: 不一定！越流方向由水头梯度决定：

**向下越流**（常见）：
- 浅层水头 > 深层水头
- 深层过度开采
- 浅层接受补给

**向上越流**（也可能）：
- 深层水头 > 浅层水头
- 深层承压水头高
- 浅层强烈抽水

**双向越流**（动态变化）：
- 不同区域方向不同
- 随季节变化
- 受人为活动影响

### Q3: 如何判断越流强弱？

**A**: 多个指标：

1. **渗漏因子B**：
   - B > 500m: 弱越流
   - 100 < B < 500m: 中等
   - B < 100m: 强越流

2. **越流补给率**：
   - < 10%: 可忽略
   - 10-50%: 重要但不主导
   - > 50%: 主要补给来源

3. **响应时间**：
   - 快速响应（天-周）: 强越流
   - 缓慢响应（月-年）: 弱越流
   - 几乎无响应: 可视为隔水

### Q4: 多层系统必须考虑越流吗？

**A**: 取决于应用目的：

**必须考虑**：
- 长期预测（年-十年尺度）
- 多层联合开采
- 污染迁移分析
- 精细化模拟

**可以简化**：
- 短期分析（天-月）
- 单层独立开采
- B很大（弱越流）
- 概念性研究

**判断方法**：
- 计算B值
- 分析观测数据响应
- 进行敏感性分析

### Q5: Hantush-Jacob解的局限性？

**A**: 主要假设和局限：

**假设**：
1. 含水层均质、各向同性
2. 完全承压
3. 相邻含水层水头恒定
4. 井完全穿透

**局限性**：
1. 实际中相邻层水头也会变化
2. 弱透水层可能释放储水
3. 非均质性影响
4. 边界效应

**适用场景**：
- 概念性理解
- 参数初步估计
- 解析解验证数值模型
- 教学演示

---

## 📚 扩展阅读

### 经典文献

1. **Hantush & Jacob (1955)**. "Non-steady radial flow in an infinite leaky aquifer"
   - 越流理论的奠基性工作
   - Hantush-Jacob解的原始推导

2. **Neuman & Witherspoon (1969)**. "Theory of flow in a confined two aquifer system"
   - 多层系统理论
   - 考虑弱透水层储水

3. **Hantush (1960)**. "Modification of the theory of leaky aquifers"
   - 考虑弱透水层储水的修正
   - 更真实的物理过程

### 现代应用

1. **地下水数值模拟软件**：
   - MODFLOW - 多层模拟标准
   - FEFLOW - 有限元多层
   - HydroGeoSphere - 完全集成

2. **实际案例**：
   - 华北平原地下水
   - 美国High Plains含水层
   - 欧洲多层含水层系统

### 进阶主题

1. **案例14**：耦合模型率定 - 多层参数反演
2. **案例15**：耦合系统不确定性 - 越流不确定性分析

---

## ✅ 学习检查

完成本案例后，你应该能够：

- [ ] 解释越流的物理机制和数学描述
- [ ] 建立多层含水层系统模型
- [ ] 计算层间越流通量
- [ ] 分析抽水对多层系统的影响
- [ ] 理解渗漏因子的物理意义
- [ ] 应用Hantush-Jacob解析解
- [ ] 评估弱透水层参数的影响
- [ ] 判断越流的重要性

---

## 🚀 下一步

- **案例14**: 耦合模型率定 - 多层+河流联合率定
- **案例15**: 耦合系统不确定性 - 预测可靠性评估

---

**完成本案例？恭喜！你已掌握多层含水层系统建模！** 🎉

现在你可以：
1. 建立三维多层地下水模型
2. 分析层间水量交换
3. 评估越流补给贡献
4. 应用于实际工程问题

**Happy Modeling! 💧🌊**
