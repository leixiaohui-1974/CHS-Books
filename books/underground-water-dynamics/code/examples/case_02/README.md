# 案例2：二维稳态地下水流动与网格剖分

## 学习目标

1. ✅ 理解二维稳态渗流方程
2. ✅ 掌握二维网格剖分方法
3. ✅ 学习不同边界条件的处理（Dirichlet和Neumann）
4. ✅ 进行网格独立性验证
5. ✅ 可视化二维水头场和流速场
6. ✅ 分析抽水井对流场的影响

## 问题描述

矩形承压含水层：
- 尺寸：Lx = 1000 m, Ly = 800 m
- 水力传导度：K = 10 m/day（均质）
- 边界条件：
  - 左边界：h = 20 m（Dirichlet）
  - 右边界：h = 10 m（Dirichlet）
  - 上下边界：dh/dn = 0（Neumann，无流边界）

## 理论基础

### 控制方程

二维稳态渗流方程（均质含水层）：

```
∂²h/∂x² + ∂²h/∂y² = 0
```

这是拉普拉斯方程。

### 边界条件

**第一类边界条件（Dirichlet）**：
- 左：h(0, y) = 20 m
- 右：h(Lx, y) = 10 m

**第二类边界条件（Neumann）**：
- 下：∂h/∂y(x, 0) = 0（无流）
- 上：∂h/∂y(x, Ly) = 0（无流）

### 理论预期

由于上下边界无流，且左右边界仅依赖于x，水头分布应该：
- 与y坐标无关（或变化很小）
- 在x方向呈线性分布
- 中心点水头：h(Lx/2, Ly/2) ≈ 15 m

## 数值方法

### 有限差分离散

对内部节点(i, j)，五点差分格式：

```
K[(h[i,j+1] - 2h[i,j] + h[i,j-1])/dx² + 
  (h[i+1,j] - 2h[i,j] + h[i-1,j])/dy²] = 0
```

### Neumann边界条件处理

对下边界（i=0），使用单侧差分：
```
(h[i+1,j] - h[i,j])/dy = 0
```

或者使用虚拟节点法：
```
h[-1,j] = h[1,j]
```

## 运行代码

```bash
cd code/examples/case_02
python3 case_02_2d_steady.py
```

## 输出结果

程序将生成：

1. **case_02_head_contour.png**: 水头等值线图
2. **case_02_velocity.png**: 流速场矢量图
3. **case_02_centerline.png**: 中心线水头与理论解对比
4. **case_02_grid_independence.png**: 网格独立性分析
5. **case_02_pumping.png**: 带抽水井的水头分布
6. **case_02_drawdown.png**: 抽水引起的降深

## 预期结果

### 水头分布

- 左边界：20 m
- 右边界：10 m
- 中心：≈ 15 m
- y方向变化：< 0.01 m（几乎不变）

### 流速

- x方向：≈ 0.1 m/day（常数）
- y方向：≈ 0（无流边界）

### 网格独立性

随着网格加密，中心点水头逐渐收敛到15.0 m。

## 实验探索

### 实验1：改变边界条件

试试不同的边界配置：

```python
# 四周都是Dirichlet边界
boundary_conditions = {
    'left': {'type': 'dirichlet', 'value': 20.0},
    'right': {'type': 'dirichlet', 'value': 10.0},
    'bottom': {'type': 'dirichlet', 'value': 15.0},
    'top': {'type': 'dirichlet', 'value': 15.0}
}
```

**观察**：水头分布会变为二维变化。

### 实验2：非均匀边界条件

左边界水头随y变化：

```python
h_left = np.linspace(18.0, 22.0, ny)  # 从18到22线性变化
boundary_conditions = {
    'left': {'type': 'dirichlet', 'value': h_left},
    'right': {'type': 'dirichlet', 'value': 10.0},
    'bottom': {'type': 'neumann', 'value': 0.0},
    'top': {'type': 'neumann', 'value': 0.0}
}
```

**观察**：流线会出现弯曲。

### 实验3：网格各向异性

试试非正方形网格：

```python
nx, ny = 101, 21  # x方向网格更密
```

**观察**：对精度的影响。

### 实验4：多口抽水井

设置多个抽水井：

```python
source = np.zeros((ny, nx))
# 井1
source[ny//3, nx//3] = -50.0 / (dx * dy)
# 井2
source[2*ny//3, 2*nx//3] = -50.0 / (dx * dy)
```

**观察**：降落漏斗的叠加效应。

### 实验5：补给区和抽水区

模拟灌溉补给和抽水的组合：

```python
source = np.zeros((ny, nx))
# 左侧补给区
source[:, :nx//4] = 0.001  # 均匀补给
# 右侧抽水井
source[ny//2, 3*nx//4] = -100.0 / (dx * dy)
```

## 常见问题

### Q1: 为什么水头在y方向不变？

**A**: 因为上下边界是无流边界（Neumann条件），且左右边界条件不随y变化。这使得问题退化为准一维问题。

### Q2: 如何处理Neumann边界条件？

**A**: 有两种方法：
1. 虚拟节点法：在边界外设置虚拟节点
2. 单侧差分：使用边界内侧的节点

本案例使用虚拟节点法。

### Q3: 网格需要多细？

**A**: 通过网格独立性验证确定。当进一步加密网格时结果变化<1%，即可认为网格足够细。

### Q4: 抽水井为什么设置在网格节点上？

**A**: 简化处理。实际中抽水井可能在节点之间，需要插值处理。

### Q5: 如何加快计算速度？

**A**: 
1. 使用稀疏矩阵（已使用）
2. 使用更高效的求解器（如GMRES、CG）
3. 使用多重网格法
4. 并行计算

## 数学推导补充

### 从达西定律到渗流方程

达西定律：
```
v = -K∇h
```

连续性方程（质量守恒）：
```
∇·v = Q
```

代入达西定律：
```
∇·(-K∇h) = Q
-∇·(K∇h) = Q
```

对于均质介质（K为常数）：
```
-K∇²h = Q
∇²h = -Q/K
```

稳态无源汇：
```
∇²h = 0
```

## 下一步

完成本案例后，继续学习：
- **案例3**：非均质含水层模拟
- **案例4**：瞬态地下水流动
- **案例5**：有限元方法基础
