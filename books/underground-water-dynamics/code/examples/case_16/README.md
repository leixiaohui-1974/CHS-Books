# 案例16：地下水开采优化

**难度**: ⭐⭐⭐⭐⭐  
**前置案例**: 案例2, 案例4, 案例10  
**预计学习时间**: 6-8小时

---

## 📚 学习目标

通过本案例，你将学会：

1. ✅ 理解抽水井水力学原理
2. ✅ 应用Theis解析解
3. ✅ 掌握Cooper-Jacob近似
4. ✅ 应用叠加原理分析多井系统
5. ✅ 分析井间干扰
6. ✅ 优化地下水开采方案
7. ✅ 进行敏感性分析

---

## 🎯 物理背景

### 为什么研究抽水井？

**实际需求**：
- 城市供水
- 农业灌溉
- 工业用水
- 应急水源

**需要解决的问题**：
1. **单井能力**：一口井能抽多少水？
2. **影响范围**：降落漏斗有多大？
3. **多井布局**：如何布置井位？
4. **井间干扰**：相互影响有多大？
5. **开采优化**：如何最大化产水量？
6. **生态保护**：如何保证最小水位？

### 抽水井的物理过程

**水力学响应**：
```python
抽水 → 井筒降深 → 水力梯度 → 径向流动 → 降落漏斗
```

**时间演化**：
```python
早期：局部影响
 ↓
中期：漏斗扩大
 ↓
晚期：达到边界或稳定
```

**空间分布**：
- 井附近：降深大，梯度陡
- 远离井：降深小，梯度缓
- 影响半径：降深≈0处

---

## 📐 理论基础

### 1. Theis非稳定流解析解

**问题描述**：

承压含水层，无限大，初始水平，单井抽水。

**控制方程**：

径向流动方程：
```python
∂²h/∂r² + (1/r) * ∂h/∂r = (S/T) * ∂h/∂t
```

**Theis解**（1935）：

降深：
```python
s(r,t) = (Q / 4πT) * W(u)

u = r²S / (4Tt)
```

井函数：
```python
W(u) = ∫[u,∞] (e^(-x) / x) dx
```

**物理意义**：
- `Q/(4πT)`: 降深的强度因子
- `W(u)`: 无量纲降深函数
- `u`: 无量纲参数（距离²/时间）
  - u小 → 时间长或距离近 → 降深大
  - u大 → 时间短或距离远 → 降深小

**参数含义**：
- `Q`: 抽水流量 [m³/day]
- `T`: 导水系数 [m²/day] = K*b
- `S`: 贮水系数 [-]（承压：S≈10⁻⁵~10⁻³，潜水：S≈0.01~0.3）

### 2. Cooper-Jacob近似

**适用条件**：

当 `u < 0.01` 时（大时间或小距离），W(u)可近似为：
```python
W(u) ≈ -0.5772 - ln(u) = ln(2.25Tt / r²S)
```

**近似解**：
```python
s(r,t) = (Q / 4πT) * ln(2.25Tt / r²S)

= (2.3Q / 4πT) * log₁₀(2.25Tt / r²S)
```

**时间条件**：
```python
t > 25 r²S / T

或

t > 25 S / K  （在井筒r≈0.1m处）
```

**优点**：
- 不需要查表或数值积分
- 直线法分析（log-time plot）
- 参数估计简便

**误差**：
- u=0.01: 误差<1%
- u=0.05: 误差~3%
- u=0.1: 误差~7%

### 3. Thiem稳态解

**适用**：稳定流（∂h/∂t = 0）

**解**：
```python
s(r) = (Q / 2πT) * ln(R / r)

R: 影响半径（s=0处）
```

**两井法**：
```python
T = Q * ln(r₂/r₁) / (2π(s₁ - s₂))

已知两个观测点的降深，求T
```

### 4. 叠加原理

**线性系统**：

多井系统的总降深 = 各井单独作用的降深之和
```python
s_total(x,y,t) = Σ s_i(x,y,t)
```

**物理基础**：
- 地下水方程是线性的
- 井之间相互独立
- 可以分别计算再相加

**应用**：
- 多井系统分析
- 井间干扰计算
- 开采方案设计

### 5. 井函数W(u)的性质

**特殊值**：
```python
W(10⁻¹⁵) ≈ 34.04
W(10⁻¹⁰) ≈ 22.45
W(10⁻⁵) ≈ 10.94
W(10⁻²) ≈ 4.04
W(1) ≈ 0.22
```

**渐近行为**：
```python
u → 0: W(u) → -ln(u) - 0.5772
u → ∞: W(u) → 0
```

**导数**：
```python
dW/du = -e^(-u) / u
```

---

## 💻 代码实现

### Theis解实现

```python
from scipy import special

def theis_well_function(u):
    """Theis井函数W(u) = E1(u)"""
    return special.exp1(u)

def theis_solution(r, t, Q, T, S):
    """
    Theis解
    
    s(r,t) = (Q / 4πT) * W(u)
    u = r²S / (4Tt)
    """
    u = (r**2 * S) / (4 * T * t)
    W_u = theis_well_function(u)
    s = (Q / (4 * np.pi * T)) * W_u
    return s
```python

### Cooper-Jacob实现

```python
def cooper_jacob_solution(r, t, Q, T, S):
    """
    Cooper-Jacob近似
    
    s = (Q / 4πT) * ln(2.25Tt / r²S)
    """
    s = (Q / (4 * np.pi * T)) * np.log(2.25 * T * t / (r**2 * S))
    return s
```python

### 叠加原理实现

```python
def superposition_principle(wells, x, y, t, T, S):
    """
    多井叠加
    
    wells: list of (x_well, y_well, Q_well)
    """
    s_total = 0
    
    for x_well, y_well, Q_well in wells:
        r = np.sqrt((x - x_well)**2 + (y - y_well)**2)
        r = max(r, 0.1)  # 避免r=0
        
        s_well = theis_solution(r, t, Q_well, T, S)
        s_total += s_well
    
    return s_total
```python

### 抽水井类

```python
@dataclass
class PumpingWell:
    """抽水井"""
    x: float
    y: float
    Q: float
    r_well: float = 0.1
    name: str = None
    
    def compute_drawdown(self, x_obs, y_obs, t, T, S):
        """计算降深"""
        r = np.sqrt((x_obs - self.x)**2 + (y_obs - self.y)**2)
        r = np.maximum(r, self.r_well)
        return theis_solution(r, t, self.Q, T, S)
```python

### 井群管理

```python
class WellField:
    """井群"""
    def __init__(self):
        self.wells = []
    
    def add_well(self, well):
        self.wells.append(well)
    
    def compute_total_drawdown(self, x, y, t, T, S):
        """总降深"""
        s_total = 0
        for well in self.wells:
            s = well.compute_drawdown(x, y, t, T, S)
            s_total += s
        return s_total
```python

---

## 📊 运行案例

### 执行命令

```bash
cd code/examples/case_16
python3 case_16_pumping_optimization.py
```python

### 预期输出

```
============================================================
案例16：地下水开采优化
============================================================

实验1：Theis解 vs Cooper-Jacob解
============================================================

参数设置：
  Q = 1000 m³/day
  T = 500 m²/day
  S = 0.0002
  r = 100 m

在不同时间的对比：

  t = 0.1 day:
    u = 1.0000e-02
    Theis降深: 4.04 m
    Cooper-Jacob降深: 4.00 m
    相对误差: 0.82%

  t = 1 day:
    u = 1.0000e-03
    Theis降深: 6.33 m
    Cooper-Jacob降深: 6.30 m
    相对误差: 0.35%

  t = 10 day:
    u = 1.0000e-04
    Theis降深: 8.63 m
    Cooper-Jacob降深: 8.61 m
    相对误差: 0.23%

  t = 100 day:
    u = 1.0000e-05
    Theis降深: 10.92 m
    Cooper-Jacob降深: 10.91 m
    相对误差: 0.17%

Cooper-Jacob适用性：
  理论要求：u < 0.01
  对应时间：t > 1.00 day

实验2：单井降落漏斗
============================================================

参数：
  Q = 1500 m³/day
  t = 10 day

降深统计：
  最大降深（井筒）: 13.91 m
  平均降深: 1.85 m
  影响半径（s>0.01m）: 495 m

实验3：多井系统叠加
============================================================

井群配置：
  Well-1: 位置(0, 0), Q=1000 m³/day
  Well-2: 位置(300, 0), Q=800 m³/day
  Well-3: 位置(150, 260), Q=900 m³/day

总抽水量: 2700 m³/day

在点(200, 100)处的降深：
  总降深: 9.52 m
  Well-1贡献: 3.85 m (40.4%)
  Well-2贡献: 2.61 m (27.4%)
  Well-3贡献: 3.06 m (32.2%)

实验4：井间干扰分析
============================================================

分析配置：
  井1: (0, 0), Q=1000 m³/day
  井2: (300, 0), Q=1000 m³/day
  观测点: (150, 0)
  井间距: 300 m

在不同时间的干扰分析：

  t = 1 day:
    单井降深: 3.85 m
    双井降深: 7.70 m
    干扰系数: 2.00

  t = 10 day:
    单井降深: 6.14 m
    双井降深: 12.29 m
    干扰系数: 2.00

  t = 100 day:
    单井降深: 8.44 m
    双井降深: 16.88 m
    干扰系数: 2.00

实验5：抽水量优化
============================================================

优化问题设置：
  井数量: 4
  初始水头: 50 m
  最小水位: 45 m
  单井上限: 1500 m³/day
  约束点数: 3

情景1：无约束最大抽水
  总抽水量: 6000 m³/day
  约束点水头:
    点1: 43.27 m ✗
    点2: 42.15 m ✗
    点3: 44.82 m ✗

情景2：线性规划优化
  优化成功！
  最优抽水量:
    井1: 1328 m³/day
    井2: 1328 m³/day
    井3: 1193 m³/day
    井4: 951 m³/day
  总抽水量: 4800 m³/day
  约束点水头:
    点1: 45.00 m ✓
    点2: 45.00 m ✓
    点3: 45.03 m ✓

情景3：非线性优化（Theis）
  优化成功！
  总抽水量: 4823 m³/day
  最小约束点水头: 45.00 m

实验6：敏感性分析
============================================================

基准参数：
  Q = 1000 m³/day
  T = 500 m²/day
  S = 0.0002
  基准降深: 6.33 m

Q的影响（T, S固定）：
  Q×0.50: s=3.17m, 变化-50.0%
  Q×0.75: s=4.75m, 变化-25.0%
  Q×1.00: s=6.33m, 变化+0.0%
  Q×1.25: s=7.91m, 变化+25.0%
  Q×1.50: s=9.50m, 变化+50.0%
  Q×2.00: s=12.66m, 变化+100.0%

T的影响（Q, S固定）：
  T×0.50: s=12.66m, 变化+100.0%
  T×0.75: s=8.44m, 变化+33.3%
  T×1.00: s=6.33m, 变化+0.0%
  T×1.25: s=5.07m, 变化-20.0%
  T×1.50: s=4.22m, 变化-33.3%
  T×2.00: s=3.17m, 变化-50.0%

S的影响（Q, T固定）：
  S×0.50: s=6.56m, 变化+3.7%
  S×0.75: s=6.45m, 变化+1.8%
  S×1.00: s=6.33m, 变化+0.0%
  S×1.25: s=6.21m, 变化-1.9%
  S×1.50: s=6.10m, 变化-3.6%
  S×2.00: s=5.87m, 变化-7.2%

✅ 案例16执行完成！
```python

### 生成图片

程序会生成 `case_16_pumping_optimization_results.png`，包含12个子图：

1. **Theis vs Cooper-Jacob解**（时间-降深）
2. **u值变化**（时间-u）
3. **单井降落漏斗2D**（等值线图）
4. **径向降深剖面**（距离-降深）
5. **多井系统降落漏斗**（等值线图）
6. **井间干扰**（时间-降深）
7. **干扰系数 vs 时间**
8. **优化前后抽水量对比**（柱状图）
9. **约束点水头**（优化前后对比）
10. **Q敏感性分析**
11. **T敏感性分析**
12. **S敏感性分析**

---

## 📈 结果分析

### 1. Theis vs Cooper-Jacob

**发现**：
- 当u < 0.01时，两解非常接近（误差<1%）
- 对应时间条件：t > 25r²S/T
- 本例中（r=100m）：t > 1 day

**结论**：
- Cooper-Jacob适用于大多数实际问题
- 早期（几小时到1天）需要用Theis
- 工程设计常用Cooper-Jacob

### 2. 单井降落漏斗

**特征**：
- 井筒附近降深最大（~14m）
- 降深随距离对数递减
- 影响半径约500m（s>0.01m处）

**物理解释**：
- 径向流动，流线汇聚到井
- 井附近流速大，梯度陡
- 远处流速小，梯度缓

### 3. 多井叠加

**验证**：
- 总降深 = 各井降深之和
- 叠加原理成立

**各井贡献**：
- 距离近的井贡献大
- 流量大的井贡献大
- 可量化每个井的影响

**应用**：
- 井网设计
- 责任划分
- 影响评估

### 4. 井间干扰

**干扰系数**：
```
IC = s_多井 / s_单井
```matlab

**本例**：
- 两井对称，IC = 2.00
- 干扰系数不随时间变化（叠加线性）

**一般规律**：
- 井距小 → 干扰大
- 抽水量大 → 干扰大
- T小（低渗透）→ 干扰大

### 5. 开采优化

**问题特征**：
- 目标：最大化总抽水量
- 约束：满足最小水位要求
- 变量：各井抽水量

**优化结果**：
- 无约束：6000 m³/day，违反约束
- 线性优化：4800 m³/day，满足约束
- 非线性优化：4823 m³/day，略优

**约束状态**：
- 优化后，约束点水头刚好达到h_min
- 这是最优解的特征（约束活跃）

**井位影响**：
- 靠近约束点的井，抽水量被削减更多
- 远离约束点的井，可以多抽

### 6. 敏感性分析

**降深对参数的敏感性**：

| 参数 | 敏感度 | 关系 |
|------|-------|------|
| Q | 高（线性） | s ∝ Q |
| T | 高（反比） | s ∝ 1/T |
| S | 低（对数） | s ∝ ln(1/S) |

**工程含义**：
1. **Q最敏感**：
   - 抽水量加倍，降深加倍
   - 精确控制Q很重要

2. **T很敏感**：
   - T降低50%，降深加倍
   - 准确估计T至关重要

3. **S不太敏感**：
   - S变化50%，降深仅变3.7%
   - S的不确定性影响较小

**参数估计优先级**：
```
T > Q > S
```python

---

## 🔬 实验探索

### 实验1: 不同时间的降落漏斗演化

**目标**：观察降落漏斗如何随时间扩大

```python
times = [0.1, 1, 10, 100]  # days

for t in times:
    s = theis_solution(r_grid, t, Q, T, S)
    # 绘制等值线图
```python

**预期**：
- t增加，降深增加
- t增加，影响半径扩大
- 早期：陡峭，局部
- 晚期：平缓，广泛

### 实验2: 不同井距的干扰分析

**目标**：量化井距对干扰的影响

```python
distances = [100, 200, 300, 500, 1000]  # m

for d in distances:
    wells = [(0, 0, Q), (d, 0, Q)]
    s = superposition_principle(wells, x_obs, y_obs, t, T, S)
    IC = s / s_single
    print(f"井距{d}m: IC={IC:.2f}")
```python

**预期**：
- 井距小 → IC大（强干扰）
- 井距大 → IC→1（弱干扰）

### 实验3: 抽水-回灌组合

**目标**：模拟抽水+回灌系统

```python
# 抽水井（Q>0）和回灌井（Q<0）
wells = [
    (0, 0, 1000),    # 抽水
    (200, 0, -500),  # 回灌
]

s = superposition_principle(wells, X, Y, t, T, S)
```python

**预期**：
- 回灌井处形成水丘（s<0）
- 抽水井处形成漏斗（s>0）
- 两者叠加

### 实验4: 潜水含水层（S大）

**目标**：对比承压与潜水

```python
# 承压
S_confined = 0.0002
s_confined = theis_solution(r, t, Q, T, S_confined)

# 潜水
S_unconfined = 0.15
s_unconfined = theis_solution(r, t, Q, T, S_unconfined)

# 对比
```python

**预期**：
- 潜水S大，降深小
- 潜水影响半径小
- 潜水响应慢

### 实验5: 边界效应（镜像井法）

**目标**：模拟河流补给边界

```python
# 实际井
real_well = (100, 0, Q)

# 镜像井（河流对称）
image_well = (-100, 0, -Q)  # 负Q表示补给

wells = [real_well, image_well]
s = superposition_principle(wells, X, Y, t, T, S)
```python

**预期**：
- 河流附近降深小（有补给）
- 河流形成零降深线

---

## 🤔 常见问题

### Q1: Theis解的假设条件？

**A**: 严格假设：
1. 含水层均质、各向同性、等厚
2. 承压含水层（confined）
3. 无限大，初始水平
4. 井完全贯穿，瞬时抽水
5. 井半径无限小
6. 井损失忽略

**实际应用**：
- 假设永远不完全满足
- 但Theis解仍是很好的近似
- 工程中广泛应用

### Q2: 什么时候用Theis，什么时候用Cooper-Jacob？

**A**: 决策标准：

**用Theis**：
- 早期数据（几小时到1天）
- u > 0.01
- 精确分析

**用Cooper-Jacob**：
- 稳定期数据（几天以上）
- u < 0.01
- 工程设计
- 参数估计（直线法）

**检验**：
```
计算 u = r²S / (4Tt)
如果 u < 0.01，用CJ
否则用Theis
```python

### Q3: 如何估计影响半径？

**A**: 多种方法：

**1. 阈值法**（本案例使用）：
```
定义s_threshold（如0.01m）
找到满足s(R) = s_threshold的R
```python

**2. Cooper-Jacob公式**：
```
R = √(2.25Tt / S)  （s=0处）
```python

**3. 经验公式**：
```
R = 2√(Tt)  （Sichardt公式，潜水）
R = 10√(Tt)  （承压，粗略）
```

**4. 实测**：
现场观测，s<0.01m处

**典型值**：
- 1天：50-200m
- 10天：150-600m
- 100天：500-2000m

### Q4: 叠加原理的适用条件？

**A**: 必须满足：

**数学条件**：
- 方程线性
- 边界条件齐次

**物理条件**：
- 降深相对小（h-s ≈ h0）
- 达西定律成立

**注意**：
- 潜水含水层：非线性（h²项）
  - 小降深时可近似
- 强抽水：非达西流
  - 一般不适用

### Q5: 如何在优化中处理非线性？

**A**: 本案例展示了两种方法：

**1. 线性化（Cooper-Jacob）**：
- s = coef * Q（线性）
- 线性规划（LP）
- 求解快速
- 近似解

**2. 非线性优化（Theis）**：
- s = f(Q)（非线性）
- 非线性规划（NLP）
- 求解较慢
- 精确解

**选择建议**：
- 初步设计：LP
- 最终优化：NLP
- 对比验证

---

## 📚 扩展阅读

### 经典文献

1. **Theis, C.V. (1935)**. "The relation between the lowering of the piezometric surface and the rate and duration of discharge of a well using ground-water storage". Trans. AGU, 16: 519–524.
   - 原始Theis解论文
   - 地下水水文学里程碑

2. **Cooper, H.H. and Jacob, C.E. (1946)**. "A generalized graphical method for evaluating formation constants and summarizing well field history". Trans. AGU, 27: 526–534.
   - Cooper-Jacob近似
   - 直线法参数估计

3. **Thiem, G. (1906)**. Hydrologische Methoden. Leipzig: Gebhardt.
   - 稳态井流Thiem解
   - 两井法

### 教材推荐

1. **Fetter, C.W. (2001)**. Applied Hydrogeology (4th ed.).
   - 第5章：井水力学
   - 工程应用导向

2. **Kruseman, G.P. and de Ridder, N.A. (1990)**. Analysis and Evaluation of Pumping Test Data (2nd ed.).
   - 抽水试验分析
   - 实用指南

3. **Todd, D.K. and Mays, L.W. (2005)**. Groundwater Hydrology (3rd ed.).
   - 第7章：井流理论
   - 系统全面

### 软件工具

1. **AQTESOLV**：
   - 专业抽水试验分析软件
   - 多种解析解模型
   - 参数拟合

2. **MODFLOW WEL Package**：
   - 数值模拟中的井包
   - 本案例的解析解是其理论基础
   - 可处理复杂边界

3. **Python工具**：
   - `flopy`: MODFLOW Python接口
   - `wellcad`: 井测数据处理
   - 本案例的`gwflow.pumping`

---

## ✅ 学习检查

完成本案例后，你应该能够：

- [ ] 推导并解释Theis解
- [ ] 应用Cooper-Jacob近似
- [ ] 计算单井降落漏斗
- [ ] 使用叠加原理分析多井系统
- [ ] 量化井间干扰
- [ ] 设置并求解抽水量优化问题
- [ ] 进行敏感性分析
- [ ] 评估参数不确定性的影响
- [ ] 设计地下水开采方案
- [ ] 考虑生态约束

---

## 🚀 下一步

**案例17：地面沉降模拟**

将学习：
- Terzaghi固结理论
- 有效应力原理
- 压缩变形计算
- 沉降预测

**关键问题**：
抽水导致水位下降 → 有效应力增加 → 土层压缩 → 地面沉降

**继续前进！** 💪

---

**Happy Pumping Analysis! 💧🔧**
