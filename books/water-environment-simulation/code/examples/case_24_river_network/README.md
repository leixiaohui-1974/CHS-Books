# 案例24：河湖水系连通与水质改善

## 案例简介

本案例演示河湖水系连通工程的水质改善效果评估方法，通过模拟闸门调度对河网水流和水质的影响，分析不同开度下的水流量、换水周期及水质响应特征。案例采用河网水文模型（RiverNetworkModel）模拟节点-闸门系统的水动力过程，基于水力学原理计算闸门出流，并通过换水周期评估水体更新能力，为优化闸门调度方案、改善河湖水质、恢复水生态系统提供技术支撑。

## 理论背景

河湖水系连通是改善城市水环境的重要工程措施。通过闸门、泵站等水利设施的联合调度，可以增强河网水体流动性，缩短换水周期，促进污染物稀释和扩散，从而改善水质。闸门调度优化需要综合考虑多个目标：水质改善要求增大流量加快换水，而防洪安全要求保持合理水位，生态需求要求维持最小生态流量。换水周期（Water Exchange Time）是评估水体自净能力的关键指标，定义为水体完全更新所需的时间，换水周期越短，水体自净能力越强。通过建立河网水动力-水质耦合模型，可以定量评估不同调度方案的水质改善效果，为河湖水系连通工程设计和运行管理提供科学依据。

## 代码说明

### 主要类和函数

1. **RiverNetworkModel类**
   - `__init__(n_nodes, n_gates)`: 初始化河网模型，设置节点和闸门数量
   - `simulate_gate_operation(opening, inflow)`: 模拟闸门运行，计算出流量
   - `calculate_water_exchange_time(volume, flow_rate)`: 计算水体换水周期

2. **optimize_gate_schedule函数**
   - 优化闸门调度方案，使水质达标
   - 参数：target_quality（目标水质）、current_quality（现状水质）

3. **主程序流程**
   - 创建河网模型（10个节点，5个闸门）
   - 模拟不同闸门开度（20%-100%）
   - 计算对应的出流量
   - 计算换水周期
   - 优化调度方案
   - 生成可视化结果

### 核心算法

```python
# 闸门流量计算（堰流公式）
outflow = opening * Cd * width * sqrt(2 * g * head)

# 换水周期计算
exchange_time = volume / flow_rate
```

## 运行方法

```bash
# 进入案例目录
cd /home/user/CHS-Books/books/water-environment-simulation/code/examples/case_24_river_network

# 运行模拟
python main.py
```

## 参数说明

| 参数 | 说明 | 默认值 | 单位 |
|------|------|--------|------|
| n_nodes | 河网节点数量 | 10 | - |
| n_gates | 闸门数量 | 5 | - |
| openings | 闸门开度序列 | [0.2, 0.4, 0.6, 0.8, 1.0] | - |
| inflow | 入流流量 | 10 | m³/s |
| volume | 水体体积 | 50000 | m³ |
| flow_rate | 流量 | 5 | m³/s |
| target_quality | 目标水质 | 20 | mg/L |
| current_quality | 现状水质 | 35 | mg/L |

## 预期结果说明

程序运行后将生成：

1. **控制台输出**
   - 案例运行状态信息
   - 换水周期计算结果
   - 优化调度方案

2. **图表文件**（river_network.png）
   - 闸门开度-出流量关系曲线
   - 显示闸门调控特性

3. **结果特征**
   - 出流量随开度增大而增加
   - 换水周期与流量成反比
   - 闸门调度影响水质改善效果

## 应用场景

1. **河湖水系连通工程**
   - 闸门调度方案优化
   - 水质改善效果评估
   - 换水周期分析

2. **城市水环境治理**
   - 黑臭水体治理
   - 活水循环系统设计
   - 生态补水方案

3. **水资源调配**
   - 跨流域调水
   - 区域水系联通
   - 水量分配优化

4. **生态流量保障**
   - 最小生态流量维持
   - 河流连通性恢复
   - 水生态系统修复

## 生态意义

河湖水系连通对水生态系统具有重要意义：

1. **水质改善**：增强水体流动，促进污染物稀释和输移
2. **生境连通**：打通鱼类洄游通道，恢复生物多样性
3. **自净能力**：缩短换水周期，提升水体自净能力
4. **生态流量**：保障河流基本生态需水，维持生态系统健康

## 参考文献

1. 逄勇, 等. (2010). 河网水动力水质数值模拟. 《环境科学学报》, 30(2), 289-296.

2. 李一平, 等. (2013). 平原河网水系连通对水环境改善作用研究. 《水科学进展》, 24(3), 407-413.

3. Monsen, N. E., et al. (2002). A comment on the use of flushing time, residence time, and age as transport time scales. *Limnology and Oceanography*, 47(5), 1545-1553.

4. 夏军, 等. (2016). 河湖水系连通理论体系框架. 《地理学报》, 71(1), 3-14.
