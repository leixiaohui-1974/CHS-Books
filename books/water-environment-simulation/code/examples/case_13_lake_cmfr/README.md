# 案例13：小型湖泊完全混合模型

## 案例背景

**工程场景**：城市景观湖水质管理  
**问题描述**：某城市景观湖（面积0.5 km²，平均水深3 m），接受城市排水，需要评估水质变化和改善措施。

**湖泊特征**：
- 面积：0.5 km²（500,000 m²）
- 平均水深：3 m
- 体积：1.5 × 10⁶ m³
- 风力作用强，垂向混合充分

**入流条件**：
- 入流流量：5,000 m³/d
- 入流污染物浓度：20 mg/L

**管理目标**：
- 水质标准：≤ 5 mg/L
- 评估当前水质状况
- 制定改善措施

---

## 学习目标

通过本案例的学习，你将：

1. **理解完全混合假设**
   - 完全混合条件
   - 0D箱式模型
   - 适用范围

2. **掌握箱式模型**
   - 质量平衡方程
   - 水力停留时间
   - 响应时间

3. **学会湖泊水质模拟**
   - 外源输入响应
   - 稳态浓度计算
   - 瞬态过程模拟

4. **评估改善措施**
   - 换水措施
   - 曝气措施
   - 源削减

---

## 核心理论

### 1. 完全混合假设

**适用条件**：
- 小型浅水湖泊
- 风力作用强
- 水力停留时间短
- 无明显分层

**基本假设**：
- 湖泊内浓度均匀分布
- 无空间变化
- 0维模型

### 2. 质量平衡方程

**控制方程**：
```
V * dC/dt = Q_in * C_in - Q_out * C - k*V*C + S
```

其中：
- `V`：湖泊体积（m³）
- `C`：湖泊浓度（mg/L）
- `Q_in`：入流流量（m³/d）
- `C_in`：入流浓度（mg/L）
- `Q_out`：出流流量（m³/d）
- `k`：一阶反应速率（1/d）
- `S`：内源产生/去除速率（mg/d）

**物理意义**：
```
累积 = 流入 - 流出 - 反应 + 内源
```

### 3. 水力停留时间（HRT）

**定义**：
```
HRT = V / Q_out
```

**物理意义**：
- 水在湖泊中的平均停留时间
- 决定污染物去除效率
- HRT越长，去除越充分

**典型值**：
- 景观湖：几天到几周
- 调蓄池：几小时到几天
- 天然湖泊：几个月到几年

### 4. 稳态浓度

**稳态条件**：`dC/dt = 0`

**稳态浓度**：
```
C_ss = (Q_in * C_in + S) / (Q_out + k*V)
```

**无量纲形式**：
```
C_ss / C_in = 1 / (1 + k*HRT)    （无内源时）
```

### 5. 响应时间

**响应时间常数**：
```
τ = V / (Q_out + k*V) = HRT / (1 + k*HRT)
```

**达到95%稳态**：
```
t_95 = 3*τ
```

**物理意义**：
- 从初始状态到稳态的过渡时间
- 决定改善措施见效时间

### 6. 去除效率

**总去除效率**：
```
E = (C_in - C_ss) / C_in = k*HRT / (1 + k*HRT)
```

**冲刷去除**：
```
E_flush = 1 / (1 + HRT/HRT_in)
```

**反应去除**：
```
E_reaction = k*HRT / (1 + k*HRT)
```

---

## 计算任务

### 任务1：建立0D箱式模型

**目标**：
- 初始化模型参数
- 计算水力停留时间
- 计算换水率

**参数**：
- 面积：0.5 km²
- 水深：3 m
- 入流：5,000 m³/d
- 反应速率：0.1 1/d

### 任务2：计算稳态浓度

**目标**：
- 计算无内源稳态浓度
- 考虑底泥释放（S = 1000 mg/d）
- 评估是否达标（标准5 mg/L）

### 任务3：模拟外源输入响应

**情景1**：突然停止输入
- 初始浓度：15 mg/L
- 入流浓度：0 mg/L
- 模拟时间：100天

**情景2**：突然增加输入
- 初始浓度：5 mg/L
- 入流浓度：30 mg/L
- 模拟时间：100天

### 任务4：分析换水周期影响

**对比不同换水率**：
- 低换水率：Q = 2,500 m³/d（HRT = 600 d）
- 中换水率：Q = 5,000 m³/d（HRT = 300 d）
- 高换水率：Q = 10,000 m³/d（HRT = 150 d）

### 任务5：评估水质改善措施

**方案1**：增加换水
- 从5,000 m³/d增加到10,000 m³/d

**方案2**：曝气处理
- 增加反应速率从0.1到0.3 1/d

**方案3**：源削减
- 入流浓度从20降低到10 mg/L

---

## 使用说明

### 1. 导入模型

```python
from models.lake_cmfr import LakeCMFR, calculate_critical_load
import numpy as np
import matplotlib.pyplot as plt
```

### 2. 初始化模型

```python
# 湖泊参数
A = 0.5e6  # 面积 0.5 km²
H = 3      # 水深 3 m
Q_in = 5000   # 入流 5000 m³/d
k = 0.1    # 反应速率
C_in = 20  # 入流浓度
C0 = 10    # 初始浓度

# 创建模型
lake = LakeCMFR(A, H, Q_in, Q_out=Q_in, k=k, C_in=C_in, C0=C0)
```

### 3. 计算水力参数

```python
# 水力停留时间
HRT = lake.calculate_hydraulic_residence_time()

# 换水率
r = lake.calculate_flushing_rate()

# 响应时间
tau, t_95 = lake.calculate_response_time()
```

### 4. 计算稳态浓度

```python
# 无内源
C_ss = lake.calculate_steady_state()

# 有内源（底泥释放）
lake.set_internal_source(S=1000)  # mg/d
C_ss_with_source = lake.calculate_steady_state()
```

### 5. 模拟瞬态响应

```python
# 时间数组
t = np.linspace(0, 100, 1000)

# 求解
t, C = lake.solve_transient(t)

# 绘图
plt.plot(t, C)
plt.xlabel('Time (d)')
plt.ylabel('Concentration (mg/L)')
```

### 6. 评估改善措施

```python
# 换水措施
C_old, C_new, improvement = lake.evaluate_water_exchange(Q_new=10000)

# 曝气措施
C_old, C_new, improvement = lake.evaluate_aeration(k_aeration=0.2)
```

### 7. 计算临界负荷

```python
# 临界负荷
L_crit = calculate_critical_load(V=lake.V, Q_out=lake.Q_out, 
                                   k=lake.k, C_standard=5)
```

---

## 预期结果

### 1. 水力参数

- 湖泊体积：1.5 × 10⁶ m³
- 水力停留时间：300天
- 换水率：0.0033 1/d
- 响应时间：272天

### 2. 稳态浓度

- 无内源：6.67 mg/L（超标）
- 有内源：7.33 mg/L（超标）
- 需要采取措施

### 3. 瞬态响应

**情景1（停止输入）**：
- 初始：15 mg/L
- 稳态：0 mg/L
- 时间：约900天达到稳态

**情景2（增加输入）**：
- 初始：5 mg/L
- 稳态：10 mg/L
- 时间：约900天达到稳态

### 4. 换水率影响

| 换水率 | HRT (d) | 稳态浓度 (mg/L) | 是否达标 |
|--------|---------|-----------------|----------|
| 低 | 600 | 8.33 | ✗ |
| 中 | 300 | 6.67 | ✗ |
| 高 | 150 | 5.00 | ✓ |

### 5. 改善措施效果

**方案1（增加换水）**：
- 改善：25%
- 新浓度：5.00 mg/L
- 达标

**方案2（曝气）**：
- 改善：33%
- 新浓度：4.44 mg/L
- 达标

**方案3（源削减）**：
- 改善：50%
- 新浓度：3.33 mg/L
- 达标

---

## 工程意义

### 1. 城市景观湖管理

**应用**：
- 水质评估
- 改善措施设计
- 运行管理优化

**关键参数**：
- 水力停留时间
- 换水率
- 污染负荷

### 2. 调蓄池设计

**应用**：
- 容积设计
- 换水周期确定
- 水质保持措施

### 3. 小型水体治理

**常见问题**：
- 水质恶化
- 换水不足
- 内源污染

**解决方案**：
- 增加换水
- 曝气增氧
- 控制外源
- 清除底泥

### 4. 应急管理

**污染事故**：
- 预测浓度变化
- 估算恢复时间
- 制定应急方案

---

## 模型局限性

### 1. 完全混合假设

**局限**：
- 忽略空间分布
- 不适用分层湖泊
- 不能模拟局部污染

**适用条件**：
- 浅水湖泊（H < 5m）
- 风力充足
- 短停留时间

### 2. 简化的反应过程

**局限**：
- 一阶反应假设
- 忽略复杂生化过程
- 不考虑温度影响

### 3. 稳定的外部条件

**局限**：
- 假设恒定入流
- 不考虑季节变化
- 忽略降雨径流

---

## 扩展阅读

### 1. 完全混合反应器理论

- Tchobanoglous, G., & Schroeder, E. D. (1985). *Water Quality*.
- Chapra, S. C. (1997). *Surface Water-Quality Modeling*.

### 2. 湖泊水质管理

- Jørgensen, S. E. (2010). *Lake and Reservoir Management*.
- Cooke, G. D., et al. (2005). *Restoration and Management of Lakes and Reservoirs*.

### 3. 工程案例

- 城市景观湖水质保持
- 调蓄池设计与运行
- 小型水体治理实践

---

## 文件说明

- `README.md`：本文档
- `main.py`：主程序，完成所有计算任务
- `../../models/lake_cmfr.py`：完全混合模型核心代码
- `../../tests/test_lake_cmfr.py`：模型测试代码

---

## 作者信息

**案例开发**：水环境模拟教材编写组  
**完成时间**：2025-11-02  
**版本**：v1.0
