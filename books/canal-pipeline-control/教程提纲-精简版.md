# 渠道、管道与管渠系统控制教程 - 精简提纲
## 融合《水系统控制论》和《明渠水力学》的控制课程

**版本**: v2.0-simplified
**日期**: 2025-10-30
**状态**: 📝 提纲设计阶段

---

## 📚 三本书的定位

### 第一本：《水系统控制论》（Water System Control）✅ 已完成
- **类型**: 集中参数系统控制
- **数学**: ODE（常微分方程）
- **案例**: 20个
- **对象**: 水箱、水塔、冷却塔
- **方法**: PID → 现代控制 → 智能控制
- **难度**: ⭐⭐⭐

### 第二本：《明渠水力学》（Open Channel Hydraulics）✅ 已完成
- **类型**: 分布参数系统水力学
- **数学**: PDE（偏微分方程）
- **案例**: 30个
- **对象**: 明渠、管道、管网
- **方法**: 均匀流 → 非恒定流 → 数值算法
- **难度**: ⭐⭐⭐⭐

### 第三本：《管渠系统控制》（Canal & Pipeline Control）⬜ 本课程
- **类型**: 分布参数系统控制
- **数学**: PDE + 控制理论
- **案例**: 20个
- **对象**: 渠道系统、管网系统、管渠联合
- **方法**: 分布式控制 → MPC → 智能调度
- **难度**: ⭐⭐⭐⭐⭐

---

## 🎯 教程定位与创新点

### 核心创新

1. **融合两本书的优势**
   - 物理模型：直接复用《明渠水力学》的代码（models/、solvers/）
   - 控制方法：扩展《水系统控制论》到分布参数系统

2. **关键挑战**
   - 从ODE控制 → PDE控制
   - 从单点测量 → 分布式传感
   - 从单执行器 → 多执行器协同

3. **技术路线**
   ```
   明渠水力学（物理层）
       ├─ channel.py          → 提供渠道模型
       ├─ pipe.py             → 提供管道模型
       ├─ unsteady_flow.py    → 提供非恒定流求解器
       └─ moc.py / fvm.py     → 提供数值算法

   +

   水系统控制论（控制层）
       ├─ PID控制器          → 扩展到分布式PID
       ├─ MPC控制器          → 处理PDE约束
       ├─ 自适应控制          → 在线参数辨识
       └─ 智能控制            → RL/NN应用

   =

   管渠系统控制（本课程）
       ├─ 分布式PID控制
       ├─ 串级池协同控制
       ├─ 管网优化调度
       └─ 智能化运营管理
   ```

---

## 📖 课程结构（20个案例）

### 第一章：分布式控制基础（案例1-4）

#### 案例1：单渠段PID水位控制
**继承自**:
- 《明渠水力学》案例13（非恒定流模拟）
- 《水系统控制论》案例1（PID控制）

**物理模型**:
- Saint-Venant方程（来自明渠水力学）
- 单闸门控制单渠段
- 下游水位控制目标

**控制方法**:
- PID控制器（来自水系统控制论）
- 测点：下游水位传感器
- 执行器：上游进水闸门

**实现**:
```python
from open_channel_hydraulics.models import Channel
from open_channel_hydraulics.solvers.unsteady import solve_saint_venant
from water_system_control.controllers import PIDController

# 物理模型（复用明渠水力学）
channel = Channel(length=1000, slope=0.001, roughness=0.025)

# 控制器（扩展水系统控制论）
pid = PIDController(Kp=2.0, Ki=0.5, Kd=1.0)

# 闭环仿真
for t in time_steps:
    # 求解水力学方程
    h, Q = solve_saint_venant(channel, boundary_conditions)

    # 读取下游水位
    h_downstream = h[-1]

    # PID控制计算
    u = pid.compute(target=2.0, measurement=h_downstream)

    # 更新闸门开度
    gate_opening = u
```

**关键点**:
- 时滞：水流传播时间
- 非线性：闸门-流量关系
- 扰动：侧向入流

**难度**: ⭐⭐
**代码量**: ~400行（main.py + experiments.py）

---

#### 案例2：多点反馈分布式PID控制
**基于案例1扩展**:
- 多个测点（沿程分布）
- 多个闸门（协调控制）
- 加权反馈策略

**控制策略**:
```
测点1(上游) ──┐
测点2(中游) ──┼→ 加权平均 → PID → 闸门控制
测点3(下游) ──┘
```

**实验内容**:
1. 单点反馈 vs 多点反馈
2. 不同权重分配方案
3. 测点位置优化
4. 时滞补偿策略

**难度**: ⭐⭐⭐
**代码量**: ~500行

---

#### 案例3：前馈-反馈复合控制
**继承自**:
- 《水系统控制论》案例8（前馈控制）
- 《明渠水力学》案例14（洪水演进）

**控制结构**:
```
上游流量测量 ──→ 前馈控制器 ──┐
                             ├→ 闸门控制
下游水位测量 ──→ 反馈控制器 ──┘
```

**前馈设计**:
- 基于Saint-Venant方程的动态补偿
- 扰动预估算法
- 传播时间预测

**难度**: ⭐⭐⭐
**代码量**: ~600行

---

#### 案例4：渠道参数在线辨识
**继承自**:
- 《水系统控制论》案例5（参数辨识）
- 《明渠水力学》案例9（糙率影响）

**辨识目标**:
- Manning糙率系数 n
- 渗漏系数 K
- 侧向入流 q_lat

**方法**:
- 递推最小二乘（RLS）
- 扩展卡尔曼滤波（EKF）
- 无迹卡尔曼滤波（UKF）

**应用**:
- 长期运行后糙率变化（淤积、杂草）
- 提高模型预测精度
- 支持自适应控制

**难度**: ⭐⭐⭐⭐
**代码量**: ~700行

---

### 第二章：串级池系统控制（案例5-8）

#### 案例5：两级串级池经典控制
**来自**: 《明渠水力学》案例16（渠系调度）

**系统结构**:
```
水源 → [闸门1] → [池1] → [闸门2] → [池2] → 用户
```

**控制目标**:
- 池1水位 = 2.0m
- 池2水位 = 2.5m
- 下游流量 = 需求流量

**控制算法**:
- 下游优先控制（Downstream Control）
- 上游优先控制（Upstream Control）
- 体积补偿控制（Volume Compensation）

**对比实验**:
1. PID控制 vs 经典算法（ASCE、BIVAL）
2. 需求阶跃响应
3. 扰动抑制能力
4. 溢流风险分析

**难度**: ⭐⭐⭐⭐
**代码量**: ~800行

---

#### 案例6：多级串级池解耦控制
**扩展案例5到N级（N=5）**

**耦合问题**:
- 上游调节影响下游
- 下游需求回传上游
- 多闸门相互影响

**解耦策略**:
1. **对角解耦**：每个池独立PID
2. **前馈解耦**：上游变化前馈到下游
3. **逆系统解耦**：设计伪线性系统
4. **动态解耦**：基于状态空间

**性能指标**:
- 解耦度（Decoupling Index）
- 各池水位波动
- 闸门动作频率

**难度**: ⭐⭐⭐⭐
**代码量**: ~900行

---

#### 案例7：串级池约束优化（QP求解）
**继承自**: 《水系统控制论》案例14（MPC）

**约束条件**:
```python
# 水位约束
h_min[i] <= h[i] <= h_max[i]

# 闸门约束
u_min <= u[i] <= u_max
du_min <= Δu[i] <= du_max  # 变化率约束

# 流量约束
Q[i] >= 0  # 不能倒流
```

**优化目标**:
```python
J = Σ[ w1*(h[i]-h_target[i])^2 +
      w2*Q[i]^2 +
      w3*Δu[i]^2 ]
```

**求解**:
- cvxpy二次规划
- 滚动时域优化
- 实时约束处理

**难度**: ⭐⭐⭐⭐⭐
**代码量**: ~1000行

---

#### 案例8：轮灌调度优化
**来自**: 《明渠水力学》案例12（涵洞）+ 《水系统控制论》优化

**问题描述**:
- 5个灌区，共用一条主渠
- 每个灌区有灌溉需求时间窗
- 主渠流量有限

**优化模型**:
```python
决策变量: x[i,t]  # 灌区i在时段t是否供水（0/1）
目标函数:
  min  Σ penalty_i * (demand_i - supply_i)
约束:
  Σ x[i,t] * Q[i] <= Q_canal_max  # 渠道容量
  supply[i] <= demand[i]           # 不超需求
  t_start[i] <= t <= t_end[i]      # 时间窗
```

**算法**:
- 整数规划（MILP）
- 遗传算法（GA）
- 粒子群算法（PSO）

**难度**: ⭐⭐⭐⭐⭐
**代码量**: ~1100行

---

### 第三章：管道系统控制（案例9-12）

#### 案例9：管道压力PID控制
**继承自**:
- 《明渠水力学》案例21（管道计算）
- 《水系统控制论》案例1（PID）

**物理模型**:
```python
from open_channel_hydraulics.models import Pipe

pipe = Pipe(length=5000, diameter=0.8, roughness=0.0001)
```

**控制目标**:
- 下游节点压力 = 30m

**执行器**:
- 泵变频调速（改变转速）
- 或调节阀（改变阻力）

**关键问题**:
- 水锤效应（压力波动）
- 泵特性非线性
- 流量-压力耦合

**难度**: ⭐⭐⭐
**代码量**: ~600行

---

#### 案例10：水锤防护控制
**继承自**: 《明渠水力学》案例25-26（水锤MOC）

**场景**:
- 阀门关闭引起水锤
- 泵突然停机

**控制策略**:
1. **缓闭控制**：优化关闭曲线
   ```python
   # 两阶段关闭
   T1 = 2*L/a  # 第一阶段：快速关闭到50%
   T2 = 10*T1  # 第二阶段：缓慢关闭到0
   ```

2. **调压井控制**：实时调节
   ```python
   Δp_measured = p_current - p_normal
   if Δp_measured > threshold:
       open_bypass_valve()
   ```

3. **空气阀控制**：防止负压

**仿真**:
- MOC求解水锤方程
- 对比不同控制策略
- 压力包络线分析

**难度**: ⭐⭐⭐⭐⭐
**代码量**: ~1200行

---

#### 案例11：管网多泵站协调控制
**继承自**: 《明渠水力学》案例22（管网平衡）

**系统**:
```
水源1 ──泵站1──┐
               ├──→ 管网 ──→ 用户节点1-10
水源2 ──泵站2──┘
```

**控制目标**:
- 所有节点压力在允许范围
- 总能耗最小
- 水质混合优化

**方法**:
1. **集中式MPC**
   ```python
   min  Σ P_pump[i] * electricity_price
   s.t. p_min[j] <= p_node[j] <= p_max[j]  # 所有节点
        Hardy-Cross管网方程
   ```

2. **分布式控制**
   - 每个泵站独立PID
   - 基于通信协调

3. **分层控制**
   - 上层：优化调度计划
   - 下层：泵站跟踪控制

**难度**: ⭐⭐⭐⭐⭐
**代码量**: ~1300行

---

#### 案例12：管网漏损检测与定位
**创新应用**

**问题**:
- 管网老化导致漏损
- 需要定位漏损点

**方法**:
1. **压力残差分析**
   ```python
   residual[j] = p_measured[j] - p_model[j]
   if |residual[j]| > threshold:
       suspect_leak_near_node[j]
   ```

2. **流量平衡**
   ```python
   leak_rate = inflow - outflow - demand
   ```

3. **卡尔曼滤波状态估计**
   ```python
   state = [h_nodes, leak_location, leak_size]
   EKF.update(measurements)
   ```

**定位算法**:
- 遗传算法搜索漏损点
- 最小二乘拟合
- 贝叶斯推断

**难度**: ⭐⭐⭐⭐⭐
**代码量**: ~1100行

---

### 第四章：先进控制方法（案例13-16）

#### 案例13：渠道MPC控制
**继承自**: 《水系统控制论》案例14（MPC）

**模型**:
- 降阶模型：Saint-Venant方程线性化
- ID模型：传递函数拟合
- 数据驱动：系统辨识

**MPC公式**:
```python
min  Σ_{k=0}^{N-1} [ ||y[k] - r[k]||_Q^2 + ||Δu[k]||_R^2 ]
s.t. x[k+1] = A*x[k] + B*u[k]           # 状态方程
     y[k] = C*x[k]                       # 输出方程
     h_min <= h[k] <= h_max              # 水位约束
     u_min <= u[k] <= u_max              # 闸门约束
     |Δu[k]| <= du_max                   # 变化率约束
```

**实现**:
- cvxpy求解
- 滚动时域 N=10
- 采样时间 Δt=60s

**对比**:
- MPC vs PID
- 不同预测时域
- 不同权重矩阵

**难度**: ⭐⭐⭐⭐⭐
**代码量**: ~1000行

---

#### 案例14：自适应控制 - MRAC在渠道中的应用
**继承自**: 《水系统控制论》案例13（自适应）

**问题**:
- 糙率随季节变化（植被生长）
- 渗漏随时间变化（衬砌老化）

**MRAC设计**:
```python
# 参考模型
y_m = reference_model(r)  # 理想响应

# 自适应律
θ̇ = γ * e * φ  # MIT规则
# 或 Lyapunov设计

# 控制律
u = θ^T * φ(x, r)
```

**参数**:
- θ = [Kp, Ki, Kd, n_manning, K_seepage]

**实验**:
1. 糙率从0.025→0.040（杂草生长）
2. 渗漏从0→0.5 m³/s/km（衬砌破损）
3. 参数收敛速度分析
4. 稳定性验证

**难度**: ⭐⭐⭐⭐⭐
**代码量**: ~1100行

---

#### 案例15：滑模控制 - 鲁棒性设计
**继承自**: 《水系统控制论》案例15（滑模）

**应用场景**:
- 参数不确定大
- 外部扰动强（暴雨、突发取水）

**滑模面设计**:
```python
s = c1*e + c2*∫e*dt + c3*de/dt

# 控制律
u = u_eq + u_sw
u_sw = -K * sign(s)  # 切换项

# 抖振抑制
u_sw = -K * sat(s/φ)  # 饱和函数
```

**实验**:
1. 参数摄动±30%
2. 扰动输入+50%
3. 滑模 vs PID鲁棒性对比
4. 抖振分析

**难度**: ⭐⭐⭐⭐
**代码量**: ~900行

---

#### 案例16：数字孪生 - 状态估计与预测
**继承自**: 《水系统控制论》案例19（数字孪生）

**架构**:
```
物理渠道系统（真实）
    ↓ 传感器
测量数据 [h1, h2, ..., Q1, Q2, ...]
    ↓
卡尔曼滤波 / 粒子滤波
    ↓
数字孪生模型（虚拟）
 ├─ 当前状态估计
 ├─ 未来状态预测
 └─ 控制决策优化
```

**状态估计**:
```python
# EKF for PDE system
state = [h(x,t), Q(x,t)]  # 分布式状态

# 预测步
x_pred = integrate(saint_venant_equations)

# 更新步（稀疏测量）
measurements = [h[sensor_locations]]
x_est = EKF_update(x_pred, measurements)
```

**应用**:
1. 传感器故障检测
2. 虚拟传感器（软测量）
3. 预测性维护
4. what-if分析

**难度**: ⭐⭐⭐⭐⭐
**代码量**: ~1200行

---

### 第五章：智能控制方法（案例17-19）

#### 案例17：神经网络建模与控制
**继承自**: 《水系统控制论》案例17（神经网络）

**问题**:
- Saint-Venant方程求解慢（实时控制困难）
- 需要快速预测模型

**方法**:
1. **LSTM替代模型**
   ```python
   input:  [h(t-k:t), Q(t-k:t), u(t-k:t)]
   output: [h(t+1:t+N), Q(t+1:t+N)]

   # 训练数据：从Saint-Venant求解器生成
   ```

2. **Physics-Informed NN**
   ```python
   loss = loss_data + λ * loss_physics

   loss_physics = ||∂h/∂t + ∂Q/∂x||^2  # 连续方程残差
                + ||∂Q/∂t + ...||^2     # 动量方程残差
   ```

3. **NN-MPC**
   ```python
   # 用NN替代MPC中的预测模型
   for k in range(N):
       x[k+1] = neural_network.predict(x[k], u[k])

   # 优化
   min J(x, u)  # 使用NN模型
   ```

**对比**:
- NN速度 vs 精度
- 与FDM/MOC对比
- 泛化能力测试

**难度**: ⭐⭐⭐⭐⭐
**代码量**: ~1200行

---

#### 案例18：强化学习 - 多闸门协同调度
**继承自**: 《水系统控制论》案例18（强化学习）

**MDP建模**:
```python
# 状态空间
state = [h1, h2, ..., hN,      # 各池水位
         Q1, Q2, ..., QM,      # 各段流量
         demand]                # 下游需求

# 动作空间
action = [u1, u2, ..., uK]     # 各闸门开度 ∈ [0,1]

# 奖励函数
reward = -w1*Σ|h[i]-h_target[i]|  # 水位偏差惩罚
         -w2*Σ|Δu[i]|             # 闸门动作惩罚
         -w3*overflow_penalty     # 溢流重罚
         +w4*supply_bonus         # 满足需求奖励
```

**算法**:
1. **DDPG** (连续动作)
2. **PPO** (稳定训练)
3. **SAC** (最大熵RL)

**环境**:
```python
class CanalEnv(gym.Env):
    def step(self, action):
        # 调用Saint-Venant求解器
        h, Q = solve_saint_venant(...)
        reward = compute_reward(h, Q)
        return state, reward, done, info
```

**实验**:
1. RL vs MPC vs PID
2. 训练曲线分析
3. 泛化测试（不同工况）
4. 安全性验证

**难度**: ⭐⭐⭐⭐⭐
**代码量**: ~1400行

---

#### 案例19：综合性能对比
**继承自**: 《水系统控制论》案例19（综合对比）

**对比方法**:
1. PID控制
2. 串级PID
3. 前馈-反馈
4. MPC
5. 自适应控制
6. 滑模控制
7. RL控制

**测试工况**:
1. **标称工况**：正常运行
2. **需求阶跃**：下游需求突变
3. **扰动工况**：侧向大量入流
4. **参数变化**：糙率+30%
5. **传感器故障**：某测点失效
6. **执行器故障**：某闸门卡死

**评价指标**:
```python
# 控制性能
IAE  = ∫|e|dt
ITAE = ∫t|e|dt
ISE  = ∫e²dt

# 经济性
energy_cost = Σ pump_power * electricity_price
gate_wear = Σ |Δu|

# 安全性
overflow_risk = count(h > h_safe)
pressure_violation = count(p < p_min or p > p_max)

# 鲁棒性
robustness_index = performance_worst / performance_nominal
```

**综合评分**:
```python
score = 0.3*control_performance +
        0.2*economic_index +
        0.3*safety_index +
        0.2*robustness_index
```

**雷达图可视化**

**难度**: ⭐⭐⭐⭐⭐
**代码量**: ~1500行

---

### 第六章：综合应用（案例20）

#### 案例20：南水北调中线工程总干渠智能调度系统
**终极综合案例**

**工程背景**:
- 长度：1432公里
- 渠段：64个
- 闸门：97座
- 流量：50-350 m³/s
- 控制目标：全线水位稳定、流量精准、能耗最优

**系统架构**:
```
┌─────────────────────────────────────────────┐
│         上层：调度决策中心                   │
│  ├─ 需求预测（LSTM）                        │
│  ├─ 全局优化（MILP）                        │
│  └─ 调度方案生成                            │
└─────────────────────┬───────────────────────┘
                      ↓ 调度指令
┌─────────────────────────────────────────────┐
│         中层：分段协调控制                   │
│  ├─ 段1：MPC控制（10个池）                  │
│  ├─ 段2：MPC控制（10个池）                  │
│  ├─ ...                                      │
│  └─ 段7：MPC控制（4个池）                   │
└─────────────────────┬───────────────────────┘
                      ↓ 闸门指令
┌─────────────────────────────────────────────┐
│         下层：现地闸门控制                   │
│  ├─ 闸门1-97：PID跟踪控制                  │
│  ├─ 传感器数据采集                          │
│  └─ 安全保护逻辑                            │
└─────────────────────────────────────────────┘
```

**模块1：水力学仿真**
```python
# 64个渠段的Saint-Venant方程联立求解
# 97个闸门的边界条件
# 考虑跌水、渡槽等建筑物

from open_channel_hydraulics.models import Channel
from open_channel_hydraulics.solvers.unsteady import MultiReachSolver

channels = [Channel(...) for i in range(64)]
gates = [Gate(...) for i in range(97)]

solver = MultiReachSolver(channels, gates)
h, Q = solver.solve(time_horizon=24*3600)
```

**模块2：需求预测**
```python
# 基于历史数据的LSTM预测
# 输入：日期、星期、节假日、气温、历史用水
# 输出：未来24小时逐时需水量

model = LSTM(input_dim=10, hidden_dim=64, output_dim=24)
demand_forecast = model.predict(features)
```

**模块3：全局优化调度**
```python
# MILP优化模型
决策变量:
  x[i,t]: 渠段i在t时刻的目标流量
  y[j,t]: 闸门j在t时刻的开度
  z[k,t]: 泵站k在t时刻的启停状态（0/1）

目标函数:
  min  Σ electricity_cost[t] * pump_power[k,t] * z[k,t]  # 电费
       + penalty * Σ|h[i,t] - h_target[i]|                # 水位偏差

约束:
  - 连续性方程（简化）
  - 水位上下限
  - 闸门开度限制
  - 流量传递关系
  - 泵站运行约束
  - 调节时间约束（不能频繁启停）

求解: Gurobi / CPLEX
```

**模块4：分段MPC控制**
```python
# 将64个渠段分为7个控制分段
# 每段10-15个池，独立MPC控制
# 段间通过边界流量协调

for segment in segments:
    mpc = MPCController(
        model=linearized_saint_venant_model,
        horizon=10,
        constraints={...}
    )

    u_optimal = mpc.solve(
        current_state=x_current,
        reference=x_ref_from_upper_layer
    )

    apply_control(u_optimal[0])  # 滚动时域
```

**模块5：数字孪生**
```python
# 实时状态估计
digital_twin = DigitalTwin(physical_system)

# 传感器数据融合
measurements = collect_sensor_data()  # 97个水位计 + 流量计

# 卡尔曼滤波估计全状态
x_estimated = digital_twin.estimate(measurements)

# 预测未来状态
x_predicted = digital_twin.predict(horizon=24h)

# 异常检测
anomalies = digital_twin.detect_anomaly(x_estimated, x_predicted)
```

**模块6：应急调度**
```python
# 场景1：突发污染
if pollution_detected():
    emergency_controller.stop_flow(segment)
    emergency_controller.isolate_contamination()
    emergency_controller.flush_system()

# 场景2：闸门故障
if gate_failure(gate_id):
    emergency_controller.bypass_control(gate_id)
    emergency_controller.redistribute_flow()

# 场景3：冰期运行
if temperature < 0:
    ice_controller.reduce_flow()
    ice_controller.prevent_ice_jam()
```

**实验场景**:
1. **正常调度（7天）**
   - 需求逐日变化
   - 电价峰谷变化
   - 优化结果分析

2. **极端工况**
   - 上游大流量（350 m³/s）
   - 下游需求激增
   - 全线水力响应

3. **冰期调度**
   - 低流量运行
   - 防冰冻控制
   - 安全验算

4. **事故处理**
   - 闸门卡死
   - 传感器失效
   - 通信中断

5. **长期运行（1年）**
   - 统计分析
   - 能耗评估
   - 维护决策

**可视化**:
1. 全线水位动态图（64段×24h）
2. 闸门开度时程图（97个）
3. 流量分布图
4. 能耗统计图
5. 控制性能雷达图
6. 3D时空演化图

**代码规模**:
- main.py: ~2000行
- experiments.py: ~1500行
- utils/: ~1000行
- **总计**: ~4500行

**难度**: ⭐⭐⭐⭐⭐⭐（超五星）

---

## 🛠️ 技术实现

### 代码复用策略

```python
# 从《明渠水力学》复用
from books.open_channel_hydraulics.code.models import Channel, Pipe, Gate
from books.open_channel_hydraulics.code.solvers.unsteady import solve_saint_venant
from books.open_channel_hydraulics.code.solvers.steady import hardy_cross

# 从《水系统控制论》复用
from books.water_system_control.code.examples.case_01_home_water_tower import PIDController
from books.water_system_control.code.examples.case_14_model_predictive_control import MPCController
from books.water_system_control.code.examples.case_13_adaptive_control import MRACController

# 本课程新增
from books.canal_pipeline_control.code.controllers import (
    DistributedPIDController,
    CascadePoolController,
    NetworkOptimizer
)
```

### 每个案例的文件结构

```
case_XX_name/
├── README.md           # 8000-10000字理论说明
│   ├─ 1. 问题描述
│   ├─ 2. 物理模型（引用明渠水力学）
│   ├─ 3. 控制策略（引用水系统控制论）
│   ├─ 4. 算法设计
│   ├─ 5. 参数整定
│   ├─ 6. 工程应用
│   └─ 7. 参考文献
│
├── main.py             # 800-1200行
│   ├─ Part 1: 模型定义
│   ├─ Part 2: 控制器设计
│   ├─ Part 3: 闭环仿真
│   ├─ Part 4: 结果可视化
│   └─ Part 5: 性能分析
│
├── experiments.py      # 600-800行
│   ├─ Experiment 1: 参数影响分析
│   ├─ Experiment 2: 鲁棒性测试
│   ├─ Experiment 3: 对比实验
│   └─ Experiment 4: 工程验证
│
└── utils.py           # 可选，专用工具函数
```

### 可视化标准

```python
# 时空分布图（PDE特有）
plt.figure(figsize=(12,6))
plt.contourf(X, T, H, levels=20)  # x-t-h 3D投影
plt.xlabel('Distance (m)')
plt.ylabel('Time (s)')
plt.colorbar(label='Water Depth (m)')

# 动画（非恒定流）
from matplotlib.animation import FuncAnimation
ani = FuncAnimation(fig, update, frames=Nt, interval=50)
ani.save('unsteady_flow.gif')

# 闸门控制序列
plt.step(time, gate_openings, where='post')

# 性能对比雷达图（案例19）
```

---

## 📊 与前两本书的技术对应

| 水系统控制论（ODE） | 本课程（PDE） | 关键变化 |
|-------------------|--------------|---------|
| 水箱液位 h(t) | 渠道水位 h(x,t) | 空间分布 |
| 流量 Q(t) | 流量 Q(x,t) | 空间分布 |
| 单点测量 | 多点测量 + 融合 | 传感器网络 |
| 单阀门 | 多闸门协同 | MIMO系统 |
| ODE求解（odeint） | PDE求解（FDM/MOC） | 数值方法 |
| 无时滞 | 传播时滞 | 预测补偿 |
| PID参数整定 | 分布式PID设计 | 空间权重 |
| MPC（QP） | MPC（降阶模型） | 维数诅咒 |

| 明渠水力学（水力计算） | 本课程（控制） | 关键变化 |
|---------------------|---------------|---------|
| 给定闸门→算水位 | 目标水位→算闸门 | 逆问题 |
| 开环计算 | 闭环控制 | 反馈 |
| 单次求解 | 实时滚动 | 在线优化 |
| 精确模型 | 模型误差 | 鲁棒性 |
| 无扰动 | 扰动抑制 | 前馈控制 |
| 设计计算 | 运行调度 | 动态优化 |

---

## 📅 开发计划（建议）

### 阶段1：基础准备（1周）
- ✅ 完成提纲设计
- ⬜ 搭建项目结构
- ⬜ 封装水力学接口
- ⬜ 封装控制器接口

### 阶段2：第一章（2周）
- ⬜ 案例1：单渠段PID
- ⬜ 案例2：多点反馈
- ⬜ 案例3：前馈-反馈
- ⬜ 案例4：参数辨识

### 阶段3：第二章（3周）
- ⬜ 案例5：两级串级池
- ⬜ 案例6：多级解耦
- ⬜ 案例7：约束优化
- ⬜ 案例8：轮灌调度

### 阶段4：第三章（2周）
- ⬜ 案例9：管道压力控制
- ⬜ 案例10：水锤防护
- ⬜ 案例11：多泵站协调
- ⬜ 案例12：漏损检测

### 阶段5：第四章（3周）
- ⬜ 案例13：MPC
- ⬜ 案例14：自适应
- ⬜ 案例15：滑模
- ⬜ 案例16：数字孪生

### 阶段6：第五章（3周）
- ⬜ 案例17：神经网络
- ⬜ 案例18：强化学习
- ⬜ 案例19：综合对比

### 阶段7：第六章（3周）
- ⬜ 案例20：南水北调综合案例

### 阶段8：收尾（1周）
- ⬜ 全部测试
- ⬜ 文档完善
- ⬜ 项目总结

**总计**: 约18周（4.5个月）

---

## 🎓 预期学习成果

### 理论层面
- ✅ 掌握分布参数系统控制理论
- ✅ 理解PDE系统的特殊性（时滞、空间耦合）
- ✅ 学会降阶建模方法
- ✅ 掌握分布式控制架构

### 方法层面
- ✅ PID控制的分布式扩展
- ✅ MPC在PDE系统中的应用
- ✅ 多智能体协同控制
- ✅ 数据驱动控制方法（NN、RL）

### 工程层面
- ✅ 灌溉渠道调度方案设计
- ✅ 城市管网优化运行
- ✅ 长距离输水智能调度
- ✅ 应急事故处理预案

### 编程能力
- ✅ PDE数值求解（FDM、MOC）
- ✅ 大规模优化算法（MILP、QP）
- ✅ 深度学习框架（PyTorch）
- ✅ 强化学习库（Gymnasium）

---

## 📖 参考文献体系

### 控制理论
1. *Distributed Parameter Systems Control* - Butkovskiy
2. *Control of Distributed Parameter Systems* - Banks
3. *Model Predictive Control of Distributed Parameter Systems* - Christofides

### 水力学
4. *Open-Channel Hydraulics* - Chow
5. *Unsteady Flow in Open Channels* - Mahmood & Yevjevich
6. *Pipeline Systems* - Boulos et al.

### 渠道控制（经典）
7. *Modeling and Control of Hydrosystems* - Litrico & Fromion ⭐⭐⭐
8. *Automatic Control of Open-Channel Flow* - Burt & Plusquellec
9. *Control of Water Levels in Open Channels* - Schuurmans (PhD thesis)

### 管网优化
10. *Water Distribution Systems Analysis* - Walski et al.
11. *Optimal Control of Water Supply Networks* - Rao & Salomons

### 智能控制
12. *Reinforcement Learning for Water Systems Control* - Castelletti et al.
13. *Neural Networks in Water Resources* - ASCE Task Committee

---

## ✅ 总结

本教程提纲设计完成了三本书的**融合创新**：

1. **继承《水系统控制论》**的控制方法体系
2. **复用《明渠水力学》**的物理模型和数值求解器
3. **创新发展**分布参数系统控制的工程应用

**核心价值**：
- 📚 填补分布参数系统控制教程的空白
- 🔧 提供可直接应用的工程代码
- 🎓 培养复合型人才（水力学+控制论）
- 🚀 推动智慧水利技术发展

**下一步**：等待用户审阅和反馈，确认后即可开始开发！

---

**提纲完成日期**: 2025-10-30
**作者**: Claude
**版本**: v2.0-simplified
**状态**: 📝 待审阅
