# 案例5：未知水箱系统参数辨识 - 最小二乘法

## 案例背景

某工厂有一套老旧的水箱供水系统，由于年代久远，设计资料已经丢失。为了实现自动化控制升级，需要建立该系统的数学模型。工程师决定通过实验数据，使用参数辨识技术来获取系统参数。

系统参数包括：
- 横截面积 A（m²）- 影响水位变化速率
- 阻力系数 R（min/m²）- 影响出水阻力
- 泵增益 K（m³/min）- 影响进水流量

## 学习目标

1. 理解系统辨识的基本概念和工程应用
2. 掌握最小二乘法参数估计原理
3. 学习实验设计和数据采集方法
4. 理解模型验证和残差分析技术
5. 了解参数辨识精度的评价指标

## 核心理论

### 1. 系统辨识问题

系统辨识是根据输入输出数据，建立系统数学模型的过程：

```
已知：输入 u(t)、输出 h(t)
未知：系统参数 θ = [A, R, K]
目标：找到最优参数 θ*，使模型预测最接近实际测量
```

### 2. 单水箱系统模型

微分方程形式：
```
A * dh/dt = K*u - h/R
```

离散化形式（欧拉法）：
```
h(k+1) = h(k) + (dt/A) * [K*u(k) - h(k)/R]
```

### 3. 最小二乘法

目标函数：
```
J(θ) = Σ [h_measured(k) - h_model(k, θ)]²
```

求解：
```
θ* = argmin J(θ)
```

使用优化算法（如scipy.optimize）求解最优参数。

### 4. 模型验证

- **训练误差**：辨识数据集上的预测误差
- **验证误差**：独立验证数据集上的预测误差
- **残差分析**：检查误差的统计特性
- **拟合优度**：R²系数，接近1表示拟合好

## 计算任务

### 任务1：实验数据采集

设计两组阶跃输入实验：
- 实验1：u = 0.5，初始水位 h0 = 1.0 m
- 实验2：u = 0.8，初始水位 h0 = 0.8 m

采集30分钟水位响应数据。

### 任务2：参数辨识

使用最小二乘法估计系统参数 [A, R, K]。

### 任务3：模型验证

使用第3组独立数据验证模型精度。

### 任务4：残差分析

分析预测误差的统计特性。

## 使用方法

```bash
# 运行主程序（参数辨识全流程）
cd books/water-system-control/code/examples/case_05_parameter_identification
python main.py

# 运行扩展实验（对比不同辨识方法）
python experiments.py
```

## 文件说明

- `main.py` - 主程序：数据采集、参数辨识、模型验证
- `experiments.py` - 扩展实验：噪声影响、初值敏感性、不同优化算法对比
- `README.md` - 本文件

## 预期结果

### 辨识精度

真实参数：
- A = 2.5 m²
- R = 1.8 min/m²
- K = 1.2 m³/min

辨识结果（无噪声）：
- 辨识误差 < 1%
- R²系数 > 0.999
- 残差均值 ≈ 0

## 工程意义

本案例展示了：

1. **实际应用价值**：
   - 老旧设备改造时，可通过实验建模
   - 无需拆解系统即可获得参数
   - 成本低、周期短

2. **系统辨识核心思想**：
   - 数据驱动建模
   - 优化求解
   - 模型验证

3. **工程实践技能**：
   - 实验设计（输入信号选择）
   - 数据预处理
   - 参数估计算法
   - 结果评估

## 扩展思考

1. **初值选择**：参数初值如何影响辨识结果？
2. **噪声影响**：测量噪声如何影响辨识精度？
3. **输入设计**：什么样的输入信号最适合参数辨识？
4. **模型结构**：如果模型结构选择错误会怎样？
5. **在线辨识**：能否实现参数的在线更新？

## 相关案例

- **案例4**：PID控制与参数整定（参数已知情况）
- **案例6**：阶跃响应法快速建模（图解法）
- **案例10**（规划中）：递推最小二乘法（在线辨识）

## 参考资料

1. Ljung, L. (1999). System Identification: Theory for the User
2. Nelles, O. (2001). Nonlinear System Identification
3. 方崇智，萧德云 (1988). 过程辨识
