# Day 9：水环境容量与水质评价

**学习时间**: 4小时  
**难度**: ⭐⭐⭐⭐  
**重要性**: ⭐⭐⭐⭐

---

## 一、水体自净与污染

### 1.1 水体自净作用

**主要过程**：
1. **稀释作用**：污染物浓度降低
2. **沉淀作用**：悬浮物下沉
3. **化学作用**：氧化还原反应
4. **生物作用**：微生物分解

### 1.2 BOD与DO

**BOD**（生化需氧量）：
- 微生物分解有机物所需溶解氧量
- BOD₅：5天生化需氧量（常用）
- **越高越污染**

**DO**（溶解氧）：
- 水中溶解氧含量
- **越低越缺氧**

**关系**：
$$\text{DO消耗} \approx \text{BOD}$$

---

## 二、河流水质模型

### 2.1 Streeter-Phelps方程

**氧垂曲线模型**：

$$\frac{dD}{dt} = k_1 L - k_2 D$$

其中：
- D：溶解氧亏损（mg/L）
- L：BOD（mg/L）
- k₁：脱氧系数（1/d）
- k₂：复氧系数（1/d）

**解析解**：
$$D(t) = \frac{k_1 L_0}{k_2 - k_1}(e^{-k_1 t} - e^{-k_2 t}) + D_0 e^{-k_2 t}$$

**临界点**（氧垂最低）：
$$t_c = \frac{1}{k_2 - k_1}\ln\left[\frac{k_2}{k_1}\left(1 - \frac{D_0(k_2-k_1)}{k_1 L_0}\right)\right]$$

### 2.2 水环境容量

**定义**：水体能容纳污染物的最大量

**计算**（完全混合模型）：
$$W = Q(C_s - C_0)$$

其中：
- W：环境容量（kg/d）
- Q：流量（m³/d）
- Cₛ：水质标准（mg/L）
- C₀：背景浓度（mg/L）

### Python实现

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy.integrate import odeint

class WaterQualityModel:
    """
    水质模型与评价
    """
    
    def __init__(self, k1=0.2, k2=0.4):
        """
        参数:
            k1: 脱氧系数 (1/d)
            k2: 复氧系数 (1/d)
        """
        self.k1 = k1
        self.k2 = k2
    
    def oxygen_deficit_analytical(self, t, L0, D0):
        """
        Streeter-Phelps方程解析解
        
        参数:
            t: 时间 (d)
            L0: 初始BOD (mg/L)
            D0: 初始DO亏损 (mg/L)
        
        返回:
            DO亏损
        """
        k1, k2 = self.k1, self.k2
        
        term1 = (k1 * L0) / (k2 - k1) * (np.exp(-k1 * t) - 
                                          np.exp(-k2 * t))
        term2 = D0 * np.exp(-k2 * t)
        
        D = term1 + term2
        
        return D
    
    def critical_point(self, L0, D0):
        """
        临界点（氧垂最低点）
        
        返回:
            tc (时间), Dc (最大亏损)
        """
        k1, k2 = self.k1, self.k2
        
        # 临界时间
        ratio = (k2 / k1) * (1 - (D0 * (k2 - k1)) / (k1 * L0))
        
        if ratio <= 0:
            tc = 0
        else:
            tc = (1 / (k2 - k1)) * np.log(ratio)
        
        # 临界亏损
        Dc = self.oxygen_deficit_analytical(tc, L0, D0)
        
        return tc, Dc
    
    def dissolved_oxygen(self, t, L0, D0, DO_sat=10):
        """
        溶解氧浓度
        
        DO = DO_sat - D
        
        参数:
            t: 时间 (d)
            L0: 初始BOD (mg/L)
            D0: 初始DO亏损 (mg/L)
            DO_sat: 饱和溶解氧 (mg/L)
        """
        D = self.oxygen_deficit_analytical(t, L0, D0)
        DO = DO_sat - D
        
        return DO
    
    def environmental_capacity(self, Q, Cs, C0):
        """
        水环境容量
        
        W = Q(Cs - C0)
        
        参数:
            Q: 流量 (m³/d)
            Cs: 水质标准 (mg/L)
            C0: 背景浓度 (mg/L)
        
        返回:
            环境容量 (kg/d)
        """
        W = Q * (Cs - C0) / 1000  # 转kg/d
        return W
    
    def plot_oxygen_sag_curve(self, L0, D0, DO_sat=10):
        """
        绘制氧垂曲线
        """
        t = np.linspace(0, 10, 200)  # 0-10天
        
        # 计算DO亏损和DO
        D = self.oxygen_deficit_analytical(t, L0, D0)
        DO = DO_sat - D
        
        # 临界点
        tc, Dc = self.critical_point(L0, D0)
        DO_c = DO_sat - Dc
        
        # BOD衰减
        BOD = L0 * np.exp(-self.k1 * t)
        
        # 绘图
        fig, axes = plt.subplots(2, 1, figsize=(10, 10))
        
        # 上图：DO和BOD
        axes[0].plot(t, DO, 'b-', linewidth=2, label='溶解氧 DO')
        axes[0].axhline(DO_sat, color='g', linestyle='--',
                       label=f'饱和DO={DO_sat}mg/L')
        axes[0].axhline(5, color='orange', linestyle=':',
                       label='水质标准（5mg/L）')
        axes[0].axhline(2, color='r', linestyle=':',
                       label='缺氧警戒（2mg/L）')
        
        # 标注临界点
        axes[0].plot(tc, DO_c, 'ro', markersize=10, label='临界点')
        axes[0].annotate(f'最低DO\nt={tc:.2f}d\nDO={DO_c:.2f}mg/L',
                        xy=(tc, DO_c), xytext=(tc+1, DO_c-1),
                        fontsize=10, color='red',
                        bbox=dict(boxstyle='round', facecolor='yellow', alpha=0.7),
                        arrowprops=dict(arrowstyle='->', color='red'))
        
        axes[0].set_xlabel('时间 (天)', fontsize=12)
        axes[0].set_ylabel('DO (mg/L)', fontsize=12)
        axes[0].set_title('氧垂曲线', fontsize=14)
        axes[0].legend()
        axes[0].grid(True, alpha=0.3)
        axes[0].set_ylim([0, DO_sat+1])
        
        # 下图：BOD衰减
        axes[1].plot(t, BOD, 'brown', linewidth=2, label='BOD')
        axes[1].fill_between(t, 0, BOD, alpha=0.3, color='brown')
        axes[1].set_xlabel('时间 (天)', fontsize=12)
        axes[1].set_ylabel('BOD (mg/L)', fontsize=12)
        axes[1].set_title('BOD衰减过程', fontsize=14)
        axes[1].legend()
        axes[1].grid(True, alpha=0.3)
        
        plt.tight_layout()
        plt.savefig('oxygen_sag_curve.png', dpi=300, bbox_inches='tight')
        plt.show()


# 使用示例
print("="*60)
print("氧垂曲线分析")
print("="*60)

# 模型参数
k1 = 0.2  # 脱氧系数 (1/d)
k2 = 0.4  # 复氧系数 (1/d)

model = WaterQualityModel(k1, k2)

# 初始条件
L0 = 30    # 初始BOD (mg/L)
D0 = 2     # 初始DO亏损 (mg/L)
DO_sat = 10  # 饱和DO (mg/L)

print(f"初始条件:")
print(f"  BOD₀ = {L0} mg/L")
print(f"  DO亏损₀ = {D0} mg/L")
print(f"  DO₀ = {DO_sat - D0} mg/L")
print(f"\n模型参数:")
print(f"  脱氧系数 k₁ = {k1} 1/d")
print(f"  复氧系数 k₂ = {k2} 1/d")

# 临界点
tc, Dc = model.critical_point(L0, D0)
DO_c = DO_sat - Dc

print(f"\n临界点:")
print(f"  时间: {tc:.2f} 天")
print(f"  最大DO亏损: {Dc:.2f} mg/L")
print(f"  最低DO: {DO_c:.2f} mg/L")

if DO_c < 2:
    print("  ⚠️ 警告：DO过低，水体严重缺氧！")
elif DO_c < 5:
    print("  ⚠️ 警告：DO低于水质标准")
else:
    print("  ✅ DO满足标准")

# 水环境容量
Q = 10000  # 流量 (m³/d)
Cs = 5     # 水质标准 (mg/L)
C0 = 2     # 背景浓度 (mg/L)

W = model.environmental_capacity(Q, Cs, C0)

print(f"\n水环境容量计算:")
print(f"  流量: {Q} m³/d")
print(f"  水质标准: {Cs} mg/L")
print(f"  背景浓度: {C0} mg/L")
print(f"  环境容量: {W:.1f} kg/d")

# 绘制氧垂曲线
model.plot_oxygen_sag_curve(L0, D0, DO_sat)
```

---

## 三、水质评价方法

### 3.1 单因子评价

$$P_i = \frac{C_i}{C_{i,标}}$$

- $P_i > 1$：超标
- $P_i \leq 1$：达标

### 3.2 综合污染指数

$$P = \frac{1}{n}\sum_{i=1}^{n}P_i$$

**分级**：
- P ≤ 0.2：清洁
- 0.2 < P ≤ 0.5：轻污染
- 0.5 < P ≤ 1.0：中度污染
- P > 1.0：重污染

### 3.3 水质指数法（WQI）

```python
class WaterQualityIndex:
    """
    水质指数评价
    """
    
    @staticmethod
    def single_factor_index(C_measured, C_standard):
        """
        单因子指数
        
        Pi = Ci / Ci,标
        """
        P = C_measured / C_standard
        return P
    
    @staticmethod
    def comprehensive_index(C_measured_list, C_standard_list):
        """
        综合污染指数
        
        P = (1/n) Σ Pi
        """
        P_list = [c_m / c_s for c_m, c_s 
                 in zip(C_measured_list, C_standard_list)]
        
        P_avg = np.mean(P_list)
        
        # 分级
        if P_avg <= 0.2:
            grade = "清洁"
        elif P_avg <= 0.5:
            grade = "轻污染"
        elif P_avg <= 1.0:
            grade = "中度污染"
        else:
            grade = "重污染"
        
        return P_avg, grade, P_list
    
    @staticmethod
    def plot_water_quality_radar(indicators, C_measured, C_standard):
        """
        绘制水质雷达图
        """
        # 计算单因子指数
        P_list = [c_m / c_s for c_m, c_s 
                 in zip(C_measured, C_standard)]
        
        # 雷达图
        N = len(indicators)
        angles = np.linspace(0, 2 * np.pi, N, endpoint=False).tolist()
        P_list += P_list[:1]
        angles += angles[:1]
        
        fig, ax = plt.subplots(figsize=(8, 8), subplot_kw=dict(projection='polar'))
        
        ax.plot(angles, P_list, 'o-', linewidth=2, label='实测/标准')
        ax.fill(angles, P_list, alpha=0.25)
        
        # 标准线（P=1）
        standard_line = [1.0] * (N + 1)
        ax.plot(angles, standard_line, 'r--', linewidth=2, label='标准线')
        
        ax.set_xticks(angles[:-1])
        ax.set_xticklabels(indicators)
        ax.set_ylim(0, max(P_list + [1.5]))
        ax.set_title('水质评价雷达图', fontsize=14)
        ax.legend(loc='upper right')
        ax.grid(True)
        
        plt.savefig('water_quality_radar.png', dpi=300, bbox_inches='tight')
        plt.show()


# 水质评价示例
print("\n" + "="*60)
print("水质综合评价")
print("="*60)

indicators = ['COD', 'BOD', 'NH3-N', 'TP', 'TN']
C_measured = [25, 6, 1.2, 0.25, 2.0]  # mg/L
C_standard = [20, 4, 1.0, 0.2, 1.5]   # III类标准

P_avg, grade, P_list = WaterQualityIndex.comprehensive_index(
    C_measured, C_standard
)

print("指标评价:")
for i, name in enumerate(indicators):
    print(f"  {name}: 实测={C_measured[i]:.2f}, "
          f"标准={C_standard[i]:.2f}, "
          f"P={P_list[i]:.2f} {'超标' if P_list[i]>1 else '达标'}")

print(f"\n综合污染指数: P = {P_avg:.3f}")
print(f"评价等级: {grade}")

# 雷达图
WaterQualityIndex.plot_water_quality_radar(
    indicators, C_measured, C_standard
)
```

---

## 四、典型考题

### 考题：氧垂曲线计算

**【题目】**（30分）

某河流，k₁=0.3/d，k₂=0.5/d，排污口下游：
- DO₀ = 6 mg/L
- BOD₀ = 40 mg/L
- DO饱和 = 10 mg/L

求：
1. 临界点时间
2. 最低DO
3. 是否满足III类水标准（DO≥5mg/L）

**【解答】**

1. **D₀计算**：
   $$D_0 = 10 - 6 = 4 \text{ mg/L}$$

2. **临界时间**：
   $$t_c = \frac{1}{0.5-0.3}\ln\left[\frac{0.5}{0.3}\left(1-\frac{4(0.5-0.3)}{0.3 \times 40}\right)\right]$$
   $$= 5\ln[1.667 \times 0.933] = 2.36 \text{ 天}$$

3. **最低DO**：
   $$D_c = \frac{0.3 \times 40}{0.5-0.3}(e^{-0.3\times 2.36} - e^{-0.5\times 2.36}) + 4e^{-0.5\times 2.36}$$
   $$\approx 5.8 \text{ mg/L}$$
   
   $$DO_c = 10 - 5.8 = 4.2 \text{ mg/L}$$

4. **结论**：**不满足**III类标准（DO<5mg/L）

---

## 五、高频考点

| 考点 | 公式/方法 | 难度 |
|------|---------|------|
| 氧垂曲线 | S-P方程 | ⭐⭐⭐⭐ |
| 环境容量 | W=Q(Cs-C0) | ⭐⭐⭐ |
| 水质评价 | 综合指数 | ⭐⭐⭐ |
| 临界点 | 对数公式 | ⭐⭐⭐⭐ |

---

**明日预告**: Day 10 - 地下水污染与防治

**本日重点**：
- Streeter-Phelps方程（必考）
- 氧垂曲线绘制
- 水环境容量计算
