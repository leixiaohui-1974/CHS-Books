# Day 6：洪水计算与频率分析

**学习时间**: 4小时  
**难度**: ⭐⭐⭐⭐⭐  
**重要性**: ⭐⭐⭐⭐⭐（必考）

---

## 一、设计洪水计算

### 1.1 推理公式法

$$Q_p = 0.278 \varphi S P$$

其中：
- $Q_p$：设计洪峰流量 (m³/s)
- $\varphi$：径流系数
- $S$：流域面积 (km²)
- $P$：设计雨强 (mm/h)

### 1.2 地区经验公式

不同地区有特定经验公式

### 1.3 Python实现

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy import stats
from scipy.optimize import fsolve

class FloodCalculation:
    """
    洪水计算工具
    """
    
    def __init__(self, basin_area):
        """
        参数:
            basin_area: 流域面积 (km²)
        """
        self.S = basin_area
    
    def rational_method(self, phi, P):
        """
        推理公式法
        
        参数:
            phi: 径流系数
            P: 设计雨强 (mm/h)
        
        返回:
            洪峰流量 (m³/s)
        """
        Qp = 0.278 * phi * self.S * P
        return Qp
    
    def empirical_formula(self, region='east'):
        """
        地区经验公式（示例）
        """
        if region == 'east':
            # 东部地区经验公式（示例）
            Qp = 0.5 * self.S ** 0.75
        elif region == 'west':
            Qp = 0.3 * self.S ** 0.8
        else:
            Qp = 0.4 * self.S ** 0.75
        
        return Qp
    
    def time_of_concentration(self, L, H, method='kirpich'):
        """
        汇流时间计算
        
        参数:
            L: 主河道长度 (km)
            H: 高差 (m)
            method: 计算方法
        
        返回:
            汇流时间 (h)
        """
        if method == 'kirpich':
            # Kirpich公式
            tc = 0.0195 * (L * 1000) ** 0.77 * (H ** -0.385) / 60
        else:
            # 简化公式
            tc = 0.278 * L / np.sqrt(H/L)
        
        return tc


class FrequencyAnalysis:
    """
    频率分析工具
    """
    
    def __init__(self):
        pass
    
    def pearson3_parameters(self, data):
        """
        皮尔逊III型参数估计
        
        参数:
            data: 洪水系列
        
        返回:
            均值、Cv、Cs
        """
        mean = np.mean(data)
        std = np.std(data, ddof=1)
        Cv = std / mean
        
        # 偏态系数（矩法估计）
        n = len(data)
        m3 = np.sum((data - mean)**3) / n
        Cs = m3 / (std**3)
        
        # 经验关系：Cs = 2Cv
        Cs_empirical = 2 * Cv
        
        return mean, Cv, Cs, Cs_empirical
    
    def design_value_pearson3(self, mean, Cv, Cs, p):
        """
        皮尔逊III型设计值
        
        参数:
            mean: 均值
            Cv: 变差系数
            Cs: 偏态系数
            p: 频率（超过概率）
        
        返回:
            设计值
        """
        # 标准正态分位数
        z_p = stats.norm.ppf(1 - p)
        
        # Φ值（皮尔逊III型）
        if abs(Cs) < 1e-6:
            # Cs≈0，退化为正态
            Phi_p = z_p
        else:
            # 近似公式
            Phi_p = z_p + (Cs / 6) * (z_p**2 - 1)
        
        # Kp值
        Kp = 1 + Cv * Phi_p
        
        # 设计值
        X_p = mean * Kp
        
        return X_p, Kp, Phi_p
    
    def empirical_frequency(self, data):
        """
        经验频率计算
        
        返回:
            排序数据和经验频率
        """
        n = len(data)
        data_sorted = np.sort(data)[::-1]  # 从大到小
        
        # 经验频率（m/(n+1)）
        m = np.arange(1, n+1)
        P = m / (n + 1)
        
        return data_sorted, P
    
    def plot_frequency_curve(self, data, mean, Cv, Cs):
        """
        绘制频率曲线
        """
        # 经验点
        data_sorted, P_empirical = self.empirical_frequency(data)
        
        # 理论曲线
        P_theory = np.array([0.01, 0.02, 0.05, 0.1, 0.2, 0.5, 0.8, 0.9])
        X_theory = [self.design_value_pearson3(mean, Cv, Cs, p)[0] 
                   for p in P_theory]
        
        fig, ax = plt.subplots(figsize=(10, 7))
        
        # 经验点
        ax.plot(P_empirical * 100, data_sorted, 'ro', 
               markersize=8, label='实测点')
        
        # 理论曲线
        ax.plot(P_theory * 100, X_theory, 'b-', 
               linewidth=2, label='皮尔逊III型理论曲线')
        
        # 常用重现期标注
        T_common = [2, 5, 10, 20, 50, 100]
        for T in T_common:
            p = 1 / T
            if p >= min(P_theory) and p <= max(P_theory):
                X = self.design_value_pearson3(mean, Cv, Cs, p)[0]
                ax.axvline(p*100, color='gray', linestyle='--', alpha=0.3)
                ax.text(p*100, ax.get_ylim()[1]*0.95, f'{T}年',
                       ha='center', fontsize=9)
        
        ax.set_xlabel('频率 P (%)', fontsize=12)
        ax.set_ylabel('洪峰流量 (m³/s)', fontsize=12)
        ax.set_title('洪水频率曲线', fontsize=14)
        ax.set_xscale('log')
        ax.grid(True, alpha=0.3, which='both')
        ax.legend()
        
        # 设置x轴刻度
        ax.set_xticks([1, 2, 5, 10, 20, 50, 80, 90])
        ax.set_xticklabels(['1', '2', '5', '10', '20', '50', '80', '90'])
        
        plt.tight_layout()
        plt.savefig('flood_frequency_curve.png', dpi=300, bbox_inches='tight')
        plt.show()


# 使用示例
print("="*60)
print("示例1：洪峰流量计算")
print("="*60)

flood_calc = FloodCalculation(basin_area=500)  # km²

# 推理公式法
phi = 0.6
P = 80  # mm/h
Qp = flood_calc.rational_method(phi, P)

print(f"流域面积: {flood_calc.S} km²")
print(f"径流系数: {phi}")
print(f"设计雨强: {P} mm/h")
print(f"设计洪峰: {Qp:.1f} m³/s")

# 汇流时间
L = 25  # km
H = 200  # m
tc = flood_calc.time_of_concentration(L, H)
print(f"\n汇流时间: {tc:.2f} h")

# 频率分析
print("\n" + "="*60)
print("示例2：洪水频率分析")
print("="*60)

# 洪水系列（实测年最大流量）
flood_series = np.array([
    850, 920, 1200, 780, 1050, 650, 900, 820, 1100, 880,
    720, 960, 830, 1150, 770, 1000, 840, 910, 860, 1080,
    800, 940, 750, 1020, 890, 970, 810, 1060, 850, 930
])

freq = FrequencyAnalysis()

# 参数估计
mean, Cv, Cs, Cs_emp = freq.pearson3_parameters(flood_series)

print(f"统计参数:")
print(f"  均值: {mean:.1f} m³/s")
print(f"  Cv: {Cv:.3f}")
print(f"  Cs: {Cs:.3f}")
print(f"  Cs (经验2Cv): {Cs_emp:.3f}")

# 采用经验关系
Cs_use = Cs_emp

# 设计值
print(f"\n设计洪水:")
T_list = [2, 5, 10, 20, 50, 100]
for T in T_list:
    p = 1 / T
    Qp, Kp, Phi = freq.design_value_pearson3(mean, Cv, Cs_use, p)
    print(f"  P={p*100:5.1f}% (T={T:3d}年): "
          f"Kp={Kp:.3f}, Qp={Qp:.0f} m³/s")

# 绘制频率曲线
freq.plot_frequency_curve(flood_series, mean, Cv, Cs_use)
```

---

## 二、典型考题

### 考题1：设计洪水计算

**【题目】**（30分，考频⭐⭐⭐⭐⭐）

某流域年最大洪峰流量系列（30年）：

统计参数：$\bar{Q}=950$ m³/s，$C_v=0.40$，$C_s=2C_v=0.80$

求：
1. 100年一遇设计洪峰（P=1%）
2. 50年一遇设计洪峰（P=2%）
3. 20年一遇设计洪峰（P=5%）
4. 10年一遇设计洪峰（P=10%）

**【解答】**

#### 1. P=1%（T=100年）

查皮尔逊III型频率表（$C_v=0.40$，$C_s=0.80$）：

$\Phi_{1\%} \approx 2.80$

$$K_{1\%} = 1 + C_v \Phi_{1\%} = 1 + 0.40 \times 2.80 = 2.12$$

$$Q_{1\%} = \bar{Q} \times K_{1\%} = 950 \times 2.12 = 2014 \text{ m}^3/\text{s}$$

#### 2. P=2%（T=50年）

$\Phi_{2\%} \approx 2.45$

$$K_{2\%} = 1 + 0.40 \times 2.45 = 1.98$$

$$Q_{2\%} = 950 \times 1.98 = 1881 \text{ m}^3/\text{s}$$

#### 3. P=5%（T=20年）

$\Phi_{5\%} \approx 1.96$

$$K_{5\%} = 1 + 0.40 \times 1.96 = 1.784$$

$$Q_{5\%} = 950 \times 1.784 = 1695 \text{ m}^3/\text{s}$$

#### 4. P=10%（T=10年）

$\Phi_{10\%} \approx 1.45$

$$K_{10\%} = 1 + 0.40 \times 1.45 = 1.58$$

$$Q_{10\%} = 950 \times 1.58 = 1501 \text{ m}^3/\text{s}$$

---

## 三、高频考点总结

| 考点 | 公式 | 关键参数 |
|------|------|---------|
| 推理公式 | $Q_p=0.278\varphi SP$ | φ、P |
| 均值 | $\bar{X}=\sum X_i/n$ | - |
| Cv | $C_v=\sigma/\bar{X}$ | 变差系数 |
| Cs | $C_s \approx 2C_v$ | 偏态系数 |
| Kp | $K_p=1+C_v\Phi_p$ | 模比系数 |
| 设计值 | $X_p=\bar{X} \cdot K_p$ | - |

---

## 四、本日练习

### 练习1（30分）
某流域统计参数：均值800 m³/s，Cv=0.35，Cs=0.70。
求P=1%、2%、5%、10%的设计洪峰。

### 练习2（35分）
已知洪水系列（20年），计算统计参数，绘制频率曲线，
求50年一遇设计值。

---

**明日预告**: Day 7 - 水文预报方法

**本日重点**：
- 皮尔逊III型（必考）
- 三个参数（均值、Cv、Cs）
- 设计值计算流程（高频）
- 频率曲线绘制
