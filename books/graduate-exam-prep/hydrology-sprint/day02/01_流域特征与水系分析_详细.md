# Day 2：流域特征与水系分析

**学习时间**: 4小时  
**难度**: ⭐⭐⭐  
**重要性**: ⭐⭐⭐⭐

---

## 一、流域特征参数

### 1.1 流域面积与形状

#### 1. 流域面积F

**定义**：分水线包围的区域面积

**计算方法**：
1. 求积仪法
2. 方格网法
3. GIS自动提取

#### 2. 流域形状系数

**圆度系数**：
$$\varphi = \frac{F}{F_0}$$

$F_0$：同周长圆的面积

**形状系数**：
$$f = \frac{F}{L^2}$$

$L$：流域长度

### 1.2 河网密度

**河网密度**：
$$D = \frac{\sum L_i}{F}$$

- $\sum L_i$：总河长（km）
- $F$：流域面积（km²）

**物理意义**：单位面积上的河流长度，反映地表径流排泄能力

### 1.3 Python实现

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy.spatial import ConvexHull

class BasinCharacteristics:
    """
    流域特征参数计算
    """
    
    def __init__(self, name):
        self.name = name
        self.area = None  # km²
        self.perimeter = None  # km
        self.length = None  # km
        self.river_lengths = []  # 各级河流长度列表
    
    def set_basic_params(self, area, perimeter, length):
        """
        设置基本参数
        """
        self.area = area
        self.perimeter = perimeter
        self.length = length
    
    def add_river(self, length, order=1):
        """
        添加河流
        
        参数:
            length: 河长 (km)
            order: 河流级别
        """
        self.river_lengths.append((order, length))
    
    def shape_coefficient(self):
        """
        形状系数
        """
        if self.area is None or self.length is None:
            raise ValueError("需先设置流域面积和长度")
        
        f = self.area / (self.length ** 2)
        
        # 判断形状
        if f < 0.2:
            shape = "狭长型"
        elif f < 0.5:
            shape = "椭圆型"
        else:
            shape = "扇形"
        
        return f, shape
    
    def compactness_coefficient(self):
        """
        紧凑系数（圆度系数）
        """
        if self.area is None or self.perimeter is None:
            raise ValueError("需先设置流域面积和周长")
        
        # 同周长圆的面积
        A_circle = (self.perimeter ** 2) / (4 * np.pi)
        
        # 紧凑系数
        K_c = self.area / A_circle
        
        return K_c
    
    def drainage_density(self):
        """
        河网密度
        """
        if self.area is None:
            raise ValueError("需先设置流域面积")
        
        if len(self.river_lengths) == 0:
            raise ValueError("需先添加河流")
        
        total_length = sum([length for _, length in self.river_lengths])
        D = total_length / self.area
        
        return D, total_length
    
    def river_frequency(self):
        """
        河网频率（河流条数/面积）
        """
        N = len(self.river_lengths)
        f_r = N / self.area
        return f_r, N
    
    def strahler_order_statistics(self):
        """
        Strahler河流分级统计
        """
        orders = {}
        for order, length in self.river_lengths:
            if order not in orders:
                orders[order] = {'count': 0, 'total_length': 0}
            orders[order]['count'] += 1
            orders[order]['total_length'] += length
        
        return orders
    
    def plot_river_network(self, river_coords):
        """
        绘制河网示意图
        
        参数:
            river_coords: 河流坐标列表 [(x1, y1, x2, y2, order), ...]
        """
        fig, ax = plt.subplots(figsize=(10, 8))
        
        # 颜色映射（按河流级别）
        colors = {1: 'lightblue', 2: 'blue', 3: 'darkblue', 4: 'navy'}
        widths = {1: 1, 2: 2, 3: 3, 4: 4}
        
        for x1, y1, x2, y2, order in river_coords:
            ax.plot([x1, x2], [y1, y2], 
                   color=colors.get(order, 'blue'),
                   linewidth=widths.get(order, 1),
                   label=f'{order}级河' if order not in [r[4] for r in river_coords[:river_coords.index((x1,y1,x2,y2,order))]] else "")
        
        ax.set_xlabel('X (km)')
        ax.set_ylabel('Y (km)')
        ax.set_title(f'{self.name} 河网示意图')
        ax.grid(True, alpha=0.3)
        ax.legend()
        ax.axis('equal')
        
        plt.tight_layout()
        plt.savefig(f'{self.name}_river_network.png', dpi=300, bbox_inches='tight')
        plt.show()
    
    def summary(self):
        """
        生成汇总报告
        """
        print("="*50)
        print(f"{self.name} 流域特征参数汇总")
        print("="*50)
        
        print(f"\n基本参数:")
        print(f"  流域面积: {self.area:.2f} km²")
        print(f"  流域周长: {self.perimeter:.2f} km")
        print(f"  流域长度: {self.length:.2f} km")
        
        try:
            f, shape = self.shape_coefficient()
            print(f"\n形状特征:")
            print(f"  形状系数: {f:.3f}")
            print(f"  流域形状: {shape}")
            
            K_c = self.compactness_coefficient()
            print(f"  紧凑系数: {K_c:.3f}")
        except:
            pass
        
        try:
            D, total_L = self.drainage_density()
            f_r, N = self.river_frequency()
            
            print(f"\n河网特征:")
            print(f"  河流总数: {N} 条")
            print(f"  河流总长: {total_L:.2f} km")
            print(f"  河网密度: {D:.3f} km/km²")
            print(f"  河网频率: {f_r:.3f} 条/km²")
            
            orders = self.strahler_order_statistics()
            print(f"\n  河流分级统计:")
            for order in sorted(orders.keys()):
                stat = orders[order]
                print(f"    {order}级河: {stat['count']}条, 总长{stat['total_length']:.2f}km")
        except:
            pass


# ============ 使用示例 ============

# 创建流域实例
basin = BasinCharacteristics("某山区流域")

# 设置基本参数
basin.set_basic_params(
    area=1500,      # km²
    perimeter=180,   # km
    length=60        # km
)

# 添加河流（Strahler分级）
# 1级河（支流）
for i in range(50):
    basin.add_river(length=np.random.uniform(2, 8), order=1)

# 2级河
for i in range(15):
    basin.add_river(length=np.random.uniform(10, 20), order=2)

# 3级河
for i in range(5):
    basin.add_river(length=np.random.uniform(25, 40), order=3)

# 4级河（干流）
basin.add_river(length=60, order=4)

# 生成汇总报告
basin.summary()

# 绘制河网（示例数据）
river_coords = [
    # (x1, y1, x2, y2, order)
    (10, 10, 30, 30, 1),
    (15, 15, 35, 35, 1),
    (5, 20, 30, 30, 2),
    (30, 30, 50, 50, 3),
    (50, 50, 80, 80, 4),
]

basin.plot_river_network(river_coords)
```

---

## 二、河流分级方法

### 2.1 Horton-Strahler分级

**规则**：
1. 源头河流为1级河
2. 两条相同级别河流汇合，级别+1
3. 不同级别汇合，保持高级别

### 2.2 Shreve分级

**规则**：
1. 源头河流为1级
2. 汇合时，级别相加

---

## 三、典型考题

### 考题1：流域特征计算

**【题目】**（25分）

某流域基本参数如下：
- 流域面积：F = 2500 km²
- 流域周长：P = 250 km
- 流域长度：L = 80 km
- 河流总数：N = 120 条
- 河流总长：ΣL = 2400 km

求：
1. 形状系数f
2. 紧凑系数K_c
3. 河网密度D
4. 河网频率f_r
5. 判断流域形状类型
6. 评价径流排泄能力

**【解答】**

#### 1. 形状系数

$$f = \frac{F}{L^2} = \frac{2500}{80^2} = \frac{2500}{6400} = 0.391$$

#### 2. 紧凑系数

同周长圆面积：
$$A_0 = \frac{P^2}{4\pi} = \frac{250^2}{4\pi} = 4974 \text{ km}^2$$

$$K_c = \frac{F}{A_0} = \frac{2500}{4974} = 0.503$$

#### 3. 河网密度

$$D = \frac{\sum L}{F} = \frac{2400}{2500} = 0.96 \text{ km/km}^2$$

#### 4. 河网频率

$$f_r = \frac{N}{F} = \frac{120}{2500} = 0.048 \text{ 条/km}^2$$

#### 5. 流域形状判断

$f = 0.391$（0.2~0.5之间）→ **椭圆型流域**

**特点**：
- 汇流时间适中
- 洪峰流量中等
- 洪水过程较缓

#### 6. 径流排泄能力评价

$D = 0.96$ km/km²

**标准**：
- D < 0.5：稀疏，排泄能力弱
- 0.5 < D < 1.5：中等
- D > 1.5：密集，排泄能力强

**结论**：本流域河网密度**中等**，径流排泄能力**一般**

#### Python验证

```python
# 计算
F = 2500  # km²
P = 250   # km
L = 80    # km
N = 120   # 条
sum_L = 2400  # km

# 形状系数
f = F / L**2
print(f"形状系数: f = {f:.3f}")

# 紧凑系数
A0 = P**2 / (4 * np.pi)
Kc = F / A0
print(f"紧凑系数: K_c = {Kc:.3f}")

# 河网密度
D = sum_L / F
print(f"河网密度: D = {D:.3f} km/km²")

# 河网频率
fr = N / F
print(f"河网频率: f_r = {fr:.4f} 条/km²")

# 判断
if f < 0.2:
    print("流域形状: 狭长型")
elif f < 0.5:
    print("流域形状: 椭圆型")
else:
    print("流域形状: 扇形")

if D < 0.5:
    print("河网密度: 稀疏")
elif D < 1.5:
    print("河网密度: 中等")
else:
    print("河网密度: 密集")
```

---

## 四、高频考点总结

| 参数 | 公式 | 典型值 |
|------|------|--------|
| 形状系数 | f = F/L² | 0.2~0.6 |
| 河网密度 | D = ΣL/F | 0.5~2.0 km/km² |
| 河网频率 | f_r = N/F | 0.02~0.1 条/km² |
| 紧凑系数 | K_c = F/A₀ | 0.3~0.8 |

---

## 五、本日练习

### 练习1（20分）
某流域面积1800km²，流域长度50km，河流总长1500km。求形状系数和河网密度，并评价。

### 练习2（25分）
已知流域河网包含：
- 1级河80条，平均长5km
- 2级河25条，平均长12km
- 3级河8条，平均长25km
- 4级河1条，长50km

流域面积2000km²。求河网密度和各级河长度比例。

---

**明日预告**: Day 3 - 降水分析与统计

**本日重点**：
- 流域特征参数计算
- 河网分级方法
- Python自动化分析
