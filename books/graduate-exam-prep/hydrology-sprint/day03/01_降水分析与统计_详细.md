# Day 3：降水分析与统计方法

**学习时间**: 4小时  
**难度**: ⭐⭐⭐  
**重要性**: ⭐⭐⭐⭐⭐（考试高频）

---

## 一、降水量统计参数

### 1.1 算术平均法

**适用**：测站分布均匀，地形起伏不大

$$\bar{P} = \frac{1}{n}\sum_{i=1}^{n}P_i$$

### 1.2 泰森多边形法

**适用**：测站分布不均

$$\bar{P} = \frac{\sum_{i=1}^{n}f_i P_i}{\sum_{i=1}^{n}f_i}$$

$f_i$：第i站控制面积

### 1.3 等雨量线法

**适用**：山区，地形复杂

### 1.4 Python实现

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy.spatial import Voronoi, voronoi_plot_2d
from shapely.geometry import Point, Polygon

class PrecipitationAnalysis:
    """
    降水分析工具类
    """
    
    def __init__(self, basin_name):
        self.basin_name = basin_name
        self.stations = []  # [(x, y, P, name), ...]
    
    def add_station(self, x, y, P, name=""):
        """
        添加测站
        
        参数:
            x, y: 坐标 (km)
            P: 降水量 (mm)
            name: 站名
        """
        self.stations.append((x, y, P, name))
    
    def arithmetic_mean(self):
        """
        算术平均法
        """
        if len(self.stations) == 0:
            raise ValueError("无测站数据")
        
        P_values = [P for _, _, P, _ in self.stations]
        P_mean = np.mean(P_values)
        
        return P_mean
    
    def thiessen_polygon(self, basin_boundary=None):
        """
        泰森多边形法
        
        参数:
            basin_boundary: 流域边界坐标 [(x1,y1), (x2,y2), ...]
        
        返回:
            平均降水量
        """
        if len(self.stations) < 3:
            raise ValueError("至少需要3个测站")
        
        # 提取坐标和降水
        points = np.array([(x, y) for x, y, _, _ in self.stations])
        P_values = np.array([P for _, _, P, _ in self.stations])
        
        # 构建Voronoi图
        vor = Voronoi(points)
        
        # 计算权重（简化：使用Voronoi单元面积）
        weights = []
        for i, region_index in enumerate(vor.point_region):
            region = vor.regions[region_index]
            if -1 not in region and len(region) > 0:
                # 计算多边形面积
                polygon_coords = [vor.vertices[j] for j in region]
                poly = Polygon(polygon_coords)
                weights.append(poly.area)
            else:
                weights.append(1.0)  # 边界单元，简化处理
        
        weights = np.array(weights)
        
        # 加权平均
        P_mean = np.sum(weights * P_values) / np.sum(weights)
        
        return P_mean, vor, weights
    
    def plot_thiessen(self):
        """
        绘制泰森多边形
        """
        P_mean, vor, weights = self.thiessen_polygon()
        
        fig, ax = plt.subplots(figsize=(10, 8))
        
        # 绘制Voronoi图
        voronoi_plot_2d(vor, ax=ax, show_vertices=False, line_colors='blue', 
                       line_width=1.5, line_alpha=0.6, point_size=0)
        
        # 绘制测站点
        for x, y, P, name in self.stations:
            ax.plot(x, y, 'ro', markersize=10)
            ax.text(x+0.5, y+0.5, f'{name}\n{P}mm', fontsize=10)
        
        ax.set_xlabel('X (km)', fontsize=12)
        ax.set_ylabel('Y (km)', fontsize=12)
        ax.set_title(f'{self.basin_name} 泰森多边形法\n平均降水: {P_mean:.2f} mm', 
                    fontsize=14)
        ax.grid(True, alpha=0.3)
        ax.axis('equal')
        
        plt.tight_layout()
        plt.savefig('thiessen_polygon.png', dpi=300, bbox_inches='tight')
        plt.show()
        
        return P_mean
    
    def frequency_analysis(self, P_series, return_periods=[2, 5, 10, 20, 50, 100]):
        """
        频率分析（皮尔逊III型）
        
        参数:
            P_series: 年降水序列 (mm)
            return_periods: 重现期列表
        
        返回:
            设计降水量字典
        """
        # 统计参数
        P_mean = np.mean(P_series)
        Cv = np.std(P_series, ddof=1) / P_mean  # 变差系数
        Cs = 2 * Cv  # 偏态系数（经验公式）
        
        # 设计值
        design_values = {}
        
        for T in return_periods:
            p = 1 / T  # 频率
            
            # 查频率表（简化，使用近似公式）
            # 标准正态分位数
            from scipy.stats import norm, pearson3
            
            # 皮尔逊III型分位数（简化）
            if Cs > 0:
                Kp = 1 + Cv * (norm.ppf(1-p) + (Cv/6) * (norm.ppf(1-p)**2 - 1))
            else:
                Kp = 1 + Cv * norm.ppf(1-p)
            
            P_design = P_mean * Kp
            design_values[T] = P_design
        
        return {
            'mean': P_mean,
            'Cv': Cv,
            'Cs': Cs,
            'design_values': design_values
        }
    
    def plot_frequency_curve(self, P_series):
        """
        绘制频率曲线
        """
        result = self.frequency_analysis(P_series)
        
        # 经验频率
        P_sorted = np.sort(P_series)[::-1]
        n = len(P_series)
        P_empirical = [(m / (n + 1)) for m in range(1, n+1)]
        
        fig, ax = plt.subplots(figsize=(10, 6))
        
        # 经验点
        ax.plot([1/p for p in P_empirical], P_sorted, 'ro', 
               markersize=6, label='实测点')
        
        # 理论曲线
        T_theory = [1, 2, 5, 10, 20, 50, 100]
        P_theory = [result['design_values'][T] for T in T_theory if T in result['design_values']]
        ax.plot(T_theory[:len(P_theory)], P_theory, 'b-', 
               linewidth=2, label='理论曲线')
        
        ax.set_xlabel('重现期 T (年)', fontsize=12)
        ax.set_ylabel('降水量 P (mm)', fontsize=12)
        ax.set_title(f'{self.basin_name} 降水频率曲线', fontsize=14)
        ax.set_xscale('log')
        ax.grid(True, which='both', alpha=0.3)
        ax.legend()
        
        plt.tight_layout()
        plt.savefig('precipitation_frequency_curve.png', dpi=300, bbox_inches='tight')
        plt.show()


# ============ 使用示例 ============

# 创建分析实例
precip = PrecipitationAnalysis("某流域")

# 添加测站
stations_data = [
    (10, 10, 120, "A站"),
    (20, 15, 135, "B站"),
    (15, 25, 115, "C站"),
    (30, 20, 140, "D站"),
    (25, 30, 125, "E站"),
]

for x, y, P, name in stations_data:
    precip.add_station(x, y, P, name)

# 算术平均
P_arithmetic = precip.arithmetic_mean()
print(f"算术平均法: {P_arithmetic:.2f} mm")

# 泰森多边形法
P_thiessen = precip.plot_thiessen()
print(f"泰森多边形法: {P_thiessen:.2f} mm")

# 频率分析
P_series = np.array([
    850, 920, 780, 1050, 650, 900, 820, 950, 880, 720,
    960, 830, 890, 770, 1000, 840, 910, 860, 800, 940
])

freq_result = precip.frequency_analysis(P_series)
print(f"\n频率分析结果:")
print(f"  多年平均: {freq_result['mean']:.2f} mm")
print(f"  变差系数 Cv: {freq_result['Cv']:.3f}")
print(f"  偏态系数 Cs: {freq_result['Cs']:.3f}")
print(f"\n设计降水量:")
for T, P in freq_result['design_values'].items():
    print(f"  P_{T}年 = {P:.2f} mm")

# 绘制频率曲线
precip.plot_frequency_curve(P_series)
```

---

## 二、典型考题

### 考题1：泰森多边形法计算

**【题目】**（25分）

某流域面积500km²，有5个雨量站，某次暴雨各站降水量及控制面积如下：

| 站名 | 降水量(mm) | 控制面积(km²) |
|------|-----------|--------------|
| A | 120 | 80 |
| B | 135 | 120 |
| C | 115 | 90 |
| D | 140 | 110 |
| E | 125 | 100 |

求：
1. 流域平均降水量（泰森多边形法）
2. 若用算术平均，结果如何
3. 两种方法误差分析
4. 总降水量（m³）

**【解答】**

#### 1. 泰森多边形法

$$\bar{P} = \frac{\sum f_i P_i}{\sum f_i}$$

$$= \frac{80 \times 120 + 120 \times 135 + 90 \times 115 + 110 \times 140 + 100 \times 125}{500}$$

$$= \frac{9600 + 16200 + 10350 + 15400 + 12500}{500}$$

$$= \frac{64050}{500} = 128.1 \text{ mm}$$

#### 2. 算术平均法

$$\bar{P}_{算} = \frac{120 + 135 + 115 + 140 + 125}{5}$$

$$= \frac{635}{5} = 127.0 \text{ mm}$$

#### 3. 误差分析

$$\text{误差} = 128.1 - 127.0 = 1.1 \text{ mm}$$

$$\text{相对误差} = \frac{1.1}{128.1} = 0.86\%$$

**结论**：误差很小（<1%），因测站分布较均匀

#### 4. 总降水量

$$W = \bar{P} \times A = 128.1 \times 10^{-3} \times 500 \times 10^6$$

$$= 6.405 \times 10^7 \text{ m}^3 = 6405 \text{ 万m}^3$$

---

### 考题2：降水频率计算

**【题目】**（30分）

某站20年年降水资料（mm）：
```
850, 920, 780, 1050, 650, 900, 820, 950, 880, 720,
960, 830, 890, 770, 1000, 840, 910, 860, 800, 940
```

求：
1. 多年平均降水量
2. 变差系数Cv
3. 偏态系数Cs（Cs=2Cv）
4. 设计降水量：P5%、P10%、P50%
5. 绘制频率曲线

**【解答】**

#### 1. 多年平均

$$\bar{P} = \frac{\sum P_i}{n} = \frac{17160}{20} = 858 \text{ mm}$$

#### 2. 变差系数

标准差：
$$\sigma = \sqrt{\frac{\sum(P_i - \bar{P})^2}{n-1}} = 85.3 \text{ mm}$$

变差系数：
$$C_v = \frac{\sigma}{\bar{P}} = \frac{85.3}{858} = 0.099$$

#### 3. 偏态系数

$$C_s = 2C_v = 2 \times 0.099 = 0.198 \approx 0.2$$

#### 4. 设计降水量

查皮尔逊III型频率表：

| P% | Φp | Kp=1+Cv·Φp | P=P̄·Kp |
|----|----|-----------|--------|
| 5% | 1.64 | 1.162 | 997 mm |
| 10% | 1.28 | 1.127 | 967 mm |
| 50% | 0.00 | 1.000 | 858 mm |

**答案**：
- P5% = 997 mm（20年一遇）
- P10% = 967 mm（10年一遇）
- P50% = 858 mm（2年一遇）

---

## 三、高频考点

### 3.1 频率计算步骤

1. **统计参数**
   - 均值P̄
   - 标准差σ
   - 变差系数Cv
   - 偏态系数Cs

2. **查频率表**
   - 根据Cv、Cs查Φp值
   - 计算Kp = 1 + Cv·Φp

3. **设计值**
   - P = P̄ · Kp

### 3.2 常用重现期

| 工程类型 | 重现期T(年) | 频率P |
|---------|------------|------|
| 一般农田排涝 | 5-10 | 20%-10% |
| 城市排水 | 2-5 | 50%-20% |
| 重要工程 | 20-50 | 5%-2% |
| 特别重要 | 50-100 | 2%-1% |

---

## 四、Python完整示例

```python
# 完整计算流程
P_series = np.array([
    850, 920, 780, 1050, 650, 900, 820, 950, 880, 720,
    960, 830, 890, 770, 1000, 840, 910, 860, 800, 940
])

# 统计参数
P_mean = np.mean(P_series)
P_std = np.std(P_series, ddof=1)
Cv = P_std / P_mean
Cs = 2 * Cv

print(f"统计参数:")
print(f"  多年平均: {P_mean:.2f} mm")
print(f"  标准差: {P_std:.2f} mm")
print(f"  Cv: {Cv:.3f}")
print(f"  Cs: {Cs:.3f}")

# 设计值
from scipy.stats import pearson3

design_freqs = [0.01, 0.02, 0.05, 0.10, 0.20, 0.50]
design_Ts = [1/(1-p) for p in design_freqs]

print(f"\n设计降水量:")
for p, T in zip(design_freqs, design_Ts):
    # 皮尔逊III型分位数（简化）
    from scipy.stats import norm
    Phi_p = norm.ppf(1-p)
    Kp = 1 + Cv * (Phi_p + (Cv/6) * (Phi_p**2 - 1))
    P_design = P_mean * Kp
    
    print(f"  P_{int((1-p)*100)}% (T={T:.1f}年) = {P_design:.0f} mm")
```

---

## 五、本日练习

### 练习1（20分）
某流域4个雨量站，某次降水：A站150mm(面积100km²)，B站135mm(120km²)，C站160mm(80km²)，D站145mm(100km²)。
求：泰森多边形法平均降水，总降水量。

### 练习2（30分）
已知年降水序列（10年）：
```
650, 720, 580, 800, 550, 680, 630, 750, 700, 600
```
求：多年平均、Cv、Cs、P5%设计值。

---

**明日预告**: Day 4 - 蒸发与下渗计算

**本日重点**：
- 泰森多边形法（必考）
- 降水频率分析（高频）
- Python自动化计算
