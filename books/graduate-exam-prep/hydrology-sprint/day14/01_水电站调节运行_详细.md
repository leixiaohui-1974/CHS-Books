# Day 14：水电站调节运行

**学习时间**: 4小时  
**难度**: ⭐⭐⭐⭐⭐  
**重要性**: ⭐⭐⭐⭐⭐

---

## 一、水电站基本概念

### 1.1 水电站组成

```
水库 → 引水系统 → 水轮机 → 发电机 → 电网
     ← 尾水系统 ←
```

### 1.2 基本参数

**水头**：
- 毛水头：$H_g = Z_{上} - Z_{下}$
- 净水头：$H_n = H_g - h_l$

**流量**：通过水轮机的流量$Q$

**出力**（功率）：
$$N = 9.81 \eta Q H_n \quad (kW)$$

其中$\eta$为水电站效率（0.75-0.85）

**电能**：
$$E = N \cdot T \quad (kWh)$$

---

## 二、调节方式

### 2.1 按调节周期

| 类型 | 调节周期 | 兴利库容 |
|------|---------|---------|
| 无调节 | 无 | - |
| 日调节 | 24小时 | 很小 |
| 周调节 | 1周 | 较小 |
| 季调节 | 1年内 | 较大 |
| 年调节 | 跨年 | 大 |
| 多年调节 | 多年 | 很大 |

### 2.2 保证出力与装机容量

**保证出力** $N_{保}$：设计保证率下的最小出力

**装机容量** $N_{装}$：水轮发电机组额定出力之和

$$N_{装} = k \cdot N_{保}$$

$k$：富余系数（1.5-3.0）

### Python实现

```python
import numpy as np
import matplotlib.pyplot as plt
import pandas as pd

class HydropowerStation:
    """
    水电站调节运行
    """
    
    def __init__(self, efficiency=0.80):
        """
        参数:
            efficiency: 综合效率
        """
        self.eta = efficiency
        self.g = 9.81  # m/s²
    
    def output_power(self, Q, H):
        """
        出力计算
        
        N = 9.81 · η · Q · H (kW)
        
        参数:
            Q: 流量 (m³/s)
            H: 净水头 (m)
        
        返回:
            出力 (kW)
        """
        N = self.g * self.eta * Q * H
        return N
    
    def energy_generation(self, N, T_hours):
        """
        发电量计算
        
        E = N · T (kWh)
        
        参数:
            N: 出力 (kW)
            T_hours: 运行时间 (h)
        
        返回:
            发电量 (kWh)
        """
        E = N * T_hours
        return E
    
    def daily_regulation(self, Q_daily, load_curve, H_avg):
        """
        日调节计算
        
        参数:
            Q_daily: 日平均流量 (m³/s)
            load_curve: 24小时负荷曲线（相对值）
            H_avg: 平均水头 (m)
        
        返回:
            逐时出力, 平均出力
        """
        # 归一化负荷曲线
        load_normalized = np.array(load_curve) / np.mean(load_curve)
        
        # 平均出力
        N_avg = self.output_power(Q_daily, H_avg)
        
        # 逐时出力（跟随负荷）
        N_hourly = N_avg * load_normalized
        
        return N_hourly, N_avg
    
    def firm_output(self, Q_series, H_avg, guarantee_rate=0.95):
        """
        保证出力计算
        
        参数:
            Q_series: 多年径流序列 (m³/s)
            H_avg: 平均水头 (m)
            guarantee_rate: 保证率
        
        返回:
            保证出力 (kW)
        """
        # 计算各时段出力
        N_series = [self.output_power(Q, H_avg) for Q in Q_series]
        
        # 排序
        N_sorted = np.sort(N_series)
        
        # 保证出力（对应保证率的出力）
        index = int(len(N_sorted) * (1 - guarantee_rate))
        N_firm = N_sorted[index]
        
        return N_firm
    
    def annual_energy(self, Q_monthly, H_monthly):
        """
        年发电量计算
        
        参数:
            Q_monthly: 12个月的平均流量 (m³/s)
            H_monthly: 12个月的平均水头 (m)
        
        返回:
            月发电量, 年总发电量 (万kWh)
        """
        days_per_month = [31, 28, 31, 30, 31, 30, 
                         31, 31, 30, 31, 30, 31]
        
        E_monthly = []
        
        for Q, H, days in zip(Q_monthly, H_monthly, days_per_month):
            N = self.output_power(Q, H)
            T = days * 24  # 小时
            E = self.energy_generation(N, T) / 10000  # 万kWh
            E_monthly.append(E)
        
        E_annual = sum(E_monthly)
        
        return E_monthly, E_annual
    
    def plot_daily_regulation(self, hours, N_hourly, N_avg, load_curve):
        """
        绘制日调节图
        """
        fig, axes = plt.subplots(2, 1, figsize=(12, 8))
        
        # 出力过程
        axes[0].plot(hours, N_hourly, 'b-o', linewidth=2, 
                    markersize=4, label='出力')
        axes[0].axhline(N_avg, color='r', linestyle='--',
                       linewidth=2, label=f'平均出力={N_avg:.0f}kW')
        axes[0].set_xlabel('时刻 (h)', fontsize=12)
        axes[0].set_ylabel('出力 (kW)', fontsize=12)
        axes[0].set_title('日调节出力过程', fontsize=14)
        axes[0].legend()
        axes[0].grid(True, alpha=0.3)
        axes[0].set_xticks(range(0, 25, 3))
        
        # 负荷曲线
        axes[1].plot(hours, load_curve, 'g-s', linewidth=2,
                    markersize=4, label='负荷')
        axes[1].axhline(np.mean(load_curve), color='orange',
                       linestyle='--', linewidth=2,
                       label='平均负荷')
        axes[1].set_xlabel('时刻 (h)', fontsize=12)
        axes[1].set_ylabel('负荷 (%)', fontsize=12)
        axes[1].set_title('系统负荷曲线', fontsize=14)
        axes[1].legend()
        axes[1].grid(True, alpha=0.3)
        axes[1].set_xticks(range(0, 25, 3))
        
        plt.tight_layout()
        plt.savefig('daily_regulation.png', dpi=300, bbox_inches='tight')
        plt.show()
    
    def plot_annual_energy(self, months, E_monthly, E_annual):
        """
        绘制年发电量分布
        """
        fig, ax = plt.subplots(figsize=(12, 6))
        
        bars = ax.bar(months, E_monthly, color='steelblue', alpha=0.7)
        
        # 标注数值
        for bar in bars:
            height = bar.get_height()
            ax.text(bar.get_x() + bar.get_width()/2., height,
                   f'{height:.1f}',
                   ha='center', va='bottom', fontsize=9)
        
        ax.set_xlabel('月份', fontsize=12)
        ax.set_ylabel('发电量 (万kWh)', fontsize=12)
        ax.set_title(f'月发电量分布（年总量={E_annual:.1f}万kWh）',
                    fontsize=14)
        ax.grid(True, alpha=0.3, axis='y')
        
        plt.tight_layout()
        plt.savefig('annual_energy.png', dpi=300, bbox_inches='tight')
        plt.show()


# 使用示例
print("="*60)
print("水电站调节运行计算")
print("="*60)

# 创建水电站
station = HydropowerStation(efficiency=0.80)

# 基本计算
Q = 100  # m³/s
H = 50   # m

N = station.output_power(Q, H)

print(f"基本参数:")
print(f"  流量: {Q} m³/s")
print(f"  水头: {H} m")
print(f"  效率: {station.eta*100}%")
print(f"\n出力: {N:.0f} kW = {N/1000:.1f} MW")

# 日发电量
T_day = 24  # 小时
E_day = station.energy_generation(N, T_day)

print(f"\n日发电量:")
print(f"  {E_day:.0f} kWh = {E_day/10000:.2f} 万kWh")

# 示例1：日调节
print("\n" + "="*60)
print("示例1：日调节")
print("="*60)

Q_daily = 80  # m³/s
H_daily = 48  # m

# 负荷曲线（典型日负荷，相对值）
load_curve = [
    60, 55, 50, 50, 55, 65,  # 0-6时（夜间低谷）
    80, 95, 100, 95, 90, 85,  # 6-12时（上午高峰）
    80, 75, 80, 90, 100, 105, # 12-18时（下午高峰）
    100, 90, 80, 75, 70, 65   # 18-24时（晚间）
]

hours = np.arange(24)

N_hourly, N_avg = station.daily_regulation(Q_daily, load_curve, H_daily)

print(f"日平均流量: {Q_daily} m³/s")
print(f"平均水头: {H_daily} m")
print(f"平均出力: {N_avg:.0f} kW")
print(f"\n出力范围:")
print(f"  最小: {N_hourly.min():.0f} kW")
print(f"  最大: {N_hourly.max():.0f} kW")

# 可视化
station.plot_daily_regulation(hours, N_hourly, N_avg, load_curve)

# 示例2：保证出力
print("\n" + "="*60)
print("示例2：保证出力计算")
print("="*60)

# 多年月平均流量（模拟10年数据）
np.random.seed(42)
n_years = 10

Q_series = []
for _ in range(n_years):
    for month in range(12):
        # 季节性流量
        if month in [5, 6, 7, 8]:  # 汛期
            Q = np.random.uniform(150, 250)
        elif month in [11, 0, 1]:  # 枯水期
            Q = np.random.uniform(30, 60)
        else:
            Q = np.random.uniform(70, 120)
        Q_series.append(Q)

Q_series = np.array(Q_series)
H_avg = 50  # m

# 不同保证率
for P in [0.90, 0.95, 0.975]:
    N_firm = station.firm_output(Q_series, H_avg, guarantee_rate=P)
    print(f"保证率{P*100:.0f}%: 保证出力 = {N_firm:.0f} kW = {N_firm/1000:.1f} MW")

# 装机容量
N_firm_95 = station.firm_output(Q_series, H_avg, guarantee_rate=0.95)
k = 2.0  # 富余系数

N_installed = k * N_firm_95

print(f"\n装机容量设计:")
print(f"  保证出力（95%）: {N_firm_95/1000:.1f} MW")
print(f"  富余系数: {k}")
print(f"  建议装机容量: {N_installed/1000:.1f} MW")

# 示例3：年发电量
print("\n" + "="*60)
print("示例3：年发电量计算")
print("="*60)

# 典型年月平均流量和水头
Q_monthly = [50, 45, 60, 80, 150, 200,
            220, 180, 120, 90, 70, 55]

H_monthly = [52, 53, 52, 51, 48, 45,
            44, 46, 48, 50, 51, 52]

E_monthly, E_annual = station.annual_energy(Q_monthly, H_monthly)

print(f"月发电量:")
months = ['1月', '2月', '3月', '4月', '5月', '6月',
         '7月', '8月', '9月', '10月', '11月', '12月']

for month, E in zip(months, E_monthly):
    print(f"  {month}: {E:6.1f} 万kWh")

print(f"\n年总发电量: {E_annual:.1f} 万kWh = {E_annual/10000:.2f} 亿kWh")

# 可视化
station.plot_annual_energy(months, E_monthly, E_annual)

# 年利用小时数
N_avg_year = np.mean([station.output_power(Q, H) 
                     for Q, H in zip(Q_monthly, H_monthly)])
T_util = (E_annual * 10000) / N_avg_year

print(f"\n年利用小时数: {T_util:.0f} h")
print(f"平均负荷率: {T_util/8760*100:.1f}%")
```

---

## 三、经济调度

### 3.1 目标

**最大化发电效益**：
$$\max \sum_{i=1}^{T} \lambda_i \cdot E_i$$

其中$\lambda_i$为电价

**约束条件**：
- 水量约束
- 出力约束
- 库容约束

### 3.2 峰谷电价

| 时段 | 电价（元/kWh） |
|------|--------------|
| 峰段（10-12h, 18-21h） | 1.2 |
| 平段（7-10h, 12-18h, 21-23h） | 0.8 |
| 谷段（23-7h） | 0.4 |

**策略**：峰时多发，谷时少发

---

## 四、典型考题

### 考题：水电站设计

**【题目】**（35分）

某水电站，多年平均流量50m³/s，水头40m，效率80%。

求：
1. 装机容量（保证率95%，富余系数2.0）
2. 年发电量
3. 年利用小时数

**【解答】**

1. **平均出力**：
   $$N_{平} = 9.81 \times 0.80 \times 50 \times 40 = 15,696 \text{ kW}$$

   保证出力取70%：
   $$N_{保} = 15,696 \times 0.70 = 10,987 \text{ kW}$$

   装机容量：
   $$N_{装} = 2.0 \times 10,987 = 21,974 \text{ kW} \approx 22 \text{ MW}$$

2. **年发电量**：
   $$E = 15,696 \times 8760 = 137,496,960 \text{ kWh} = 1.37 \text{ 亿kWh}$$

3. **年利用小时数**：
   $$T = \frac{137,496,960}{21,974} = 6,257 \text{ h}$$

---

## 五、高频考点

| 考点 | 公式 | 难度 |
|------|------|------|
| 出力计算 | N=9.81ηQH | ⭐⭐⭐ |
| 发电量 | E=N·T | ⭐⭐ |
| 保证出力 | 统计分析 | ⭐⭐⭐⭐ |
| 装机容量 | N装=k·N保 | ⭐⭐⭐ |
| 利用小时数 | T=E/N | ⭐⭐⭐ |

---

**明日预告**: Day 15 - 水文模型与参数率定

**本日重点**：
- 出力公式（必考）
- 保证出力计算
- 日调节原理
- 经济调度策略
