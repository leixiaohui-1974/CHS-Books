# Day 4：蒸发与下渗计算

**学习时间**: 4小时  
**难度**: ⭐⭐⭐  
**重要性**: ⭐⭐⭐⭐

---

## 一、蒸发计算方法

### 1.1 水面蒸发

#### 彭曼公式（Penman）

$$E = \frac{\Delta}{\Delta + \gamma}R_n + \frac{\gamma}{\Delta + \gamma}E_a$$

其中：
- $\Delta$：饱和水汽压曲线斜率
- $\gamma$：干湿表常数
- $R_n$：净辐射
- $E_a$：空气动力项

#### 简化经验公式

**布德科公式**：
$$E = k \cdot E_0$$

$E_0$：水面蒸发能力，$k$：折算系数（0.6-0.8）

### 1.2 陆面蒸散发

#### 蒸散发三要素
1. **水分供应**
2. **能量供应**
3. **水汽扩散**

### 1.3 Python实现

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy.interpolate import interp1d

class EvaporationCalculator:
    """
    蒸发计算工具
    """
    
    def __init__(self):
        self.gamma = 0.067  # 干湿表常数 (kPa/°C)
    
    def saturated_vapor_pressure(self, T):
        """
        饱和水汽压 (Magnus公式)
        
        参数:
            T: 温度 (°C)
        
        返回:
            饱和水汽压 (kPa)
        """
        es = 0.6108 * np.exp(17.27 * T / (T + 237.3))
        return es
    
    def vapor_pressure_slope(self, T):
        """
        饱和水汽压曲线斜率
        """
        Delta = (4098 * self.saturated_vapor_pressure(T)) / ((T + 237.3)**2)
        return Delta
    
    def penman_evaporation(self, T, RH, u2, Rn):
        """
        彭曼公式计算蒸发
        
        参数:
            T: 温度 (°C)
            RH: 相对湿度 (%)
            u2: 2m高度风速 (m/s)
            Rn: 净辐射 (MJ/m²/day)
        
        返回:
            蒸发量 (mm/day)
        """
        # 饱和水汽压
        es = self.saturated_vapor_pressure(T)
        
        # 实际水汽压
        ea = es * (RH / 100)
        
        # 水汽压差
        VPD = es - ea
        
        # 斜率
        Delta = self.vapor_pressure_slope(T)
        
        # 辐射项 (mm/day)
        E_rad = (0.408 * Delta * Rn) / (Delta + self.gamma)
        
        # 空气动力项 (mm/day)
        E_aero = (self.gamma / (Delta + self.gamma)) * \
                 (900 / (T + 273)) * u2 * VPD
        
        # 总蒸发
        E = E_rad + E_aero
        
        return E
    
    def pan_evaporation_correction(self, E_pan, land_type='water'):
        """
        蒸发皿折算系数
        
        参数:
            E_pan: 蒸发皿蒸发量 (mm)
            land_type: 下垫面类型
        """
        # 折算系数
        k_factors = {
            'water': 0.75,      # 水面
            'paddy': 0.85,      # 水田
            'grass': 0.70,      # 草地
            'forest': 0.60,     # 森林
            'bare': 0.80        # 裸地
        }
        
        k = k_factors.get(land_type, 0.75)
        E_actual = k * E_pan
        
        return E_actual, k
    
    def annual_evaporation_distribution(self, E_annual, lat=30):
        """
        年蒸发量季节分配（经验模型）
        
        参数:
            E_annual: 年蒸发量 (mm)
            lat: 纬度 (°)
        """
        # 月蒸发占比（经验）
        months = np.arange(1, 13)
        
        # 简化正弦模型
        phase = np.pi * (lat / 180)  # 纬度影响
        monthly_ratio = 0.5 + 0.5 * np.sin(2*np.pi*(months-3)/12 + phase)
        monthly_ratio = monthly_ratio / np.sum(monthly_ratio)
        
        E_monthly = E_annual * monthly_ratio
        
        return E_monthly, monthly_ratio
    
    def plot_evaporation_curve(self, months, E_monthly):
        """
        绘制蒸发过程线
        """
        fig, ax = plt.subplots(figsize=(10, 6))
        
        ax.bar(months, E_monthly, color='orange', alpha=0.7, label='月蒸发量')
        ax.plot(months, E_monthly, 'ro-', linewidth=2, markersize=6, label='趋势线')
        
        ax.set_xlabel('月份', fontsize=12)
        ax.set_ylabel('蒸发量 (mm)', fontsize=12)
        ax.set_title('年内蒸发分配', fontsize=14)
        ax.set_xticks(months)
        ax.grid(True, alpha=0.3)
        ax.legend()
        
        # 标注最大最小值
        max_idx = np.argmax(E_monthly)
        min_idx = np.argmin(E_monthly)
        ax.annotate(f'最大\n{E_monthly[max_idx]:.1f}mm', 
                   xy=(months[max_idx], E_monthly[max_idx]),
                   xytext=(months[max_idx]+0.5, E_monthly[max_idx]+50),
                   arrowprops=dict(arrowstyle='->', color='red'),
                   fontsize=10)
        
        plt.tight_layout()
        plt.savefig('evaporation_distribution.png', dpi=300, bbox_inches='tight')
        plt.show()


# 使用示例
evap = EvaporationCalculator()

# 彭曼公式计算
T = 25      # 温度 25°C
RH = 60     # 相对湿度 60%
u2 = 2.5    # 风速 2.5 m/s
Rn = 15     # 净辐射 15 MJ/m²/day

E_penman = evap.penman_evaporation(T, RH, u2, Rn)
print(f"彭曼公式蒸发量: {E_penman:.2f} mm/day")

# 蒸发皿折算
E_pan = 150  # mm/月
E_water, k = evap.pan_evaporation_correction(E_pan, 'water')
print(f"\n蒸发皿折算:")
print(f"  蒸发皿: {E_pan} mm")
print(f"  折算系数: {k}")
print(f"  实际水面蒸发: {E_water:.2f} mm")

# 年蒸发分配
E_annual = 1200  # mm
E_monthly, ratios = evap.annual_evaporation_distribution(E_annual, lat=30)

print(f"\n年蒸发分配（年总量{E_annual}mm）:")
for month, E in enumerate(E_monthly, 1):
    print(f"  {month}月: {E:.1f} mm ({ratios[month-1]*100:.1f}%)")

# 绘图
evap.plot_evaporation_curve(np.arange(1, 13), E_monthly)
```

---

## 二、下渗计算

### 2.1 霍顿下渗公式

$$f_t = f_c + (f_0 - f_c)e^{-kt}$$

其中：
- $f_t$：t时刻下渗率 (mm/h)
- $f_0$：初始下渗率 (mm/h)
- $f_c$：稳定下渗率 (mm/h)
- $k$：衰减系数 (h⁻¹)

### 2.2 菲利普入渗公式

$$F = St^{1/2} + At$$

其中：
- $F$：累积入渗量 (mm)
- $S$：吸渗率 (mm/h^{1/2})
- $A$：稳定入渗率 (mm/h)

### 2.3 Python实现

```python
class InfiltrationCalculator:
    """
    下渗计算工具
    """
    
    def __init__(self):
        pass
    
    def horton_infiltration_rate(self, t, f0, fc, k):
        """
        霍顿下渗公式
        
        参数:
            t: 时间 (h)
            f0: 初始下渗率 (mm/h)
            fc: 稳定下渗率 (mm/h)
            k: 衰减系数 (h⁻¹)
        
        返回:
            下渗率 (mm/h)
        """
        if isinstance(t, (int, float)):
            t = np.array([t])
        
        ft = fc + (f0 - fc) * np.exp(-k * t)
        return ft
    
    def horton_cumulative_infiltration(self, t, f0, fc, k):
        """
        累积下渗量
        
        F = ∫f(t)dt = fc*t + (f0-fc)/k * (1 - e^(-kt))
        """
        if isinstance(t, (int, float)):
            t = np.array([t])
        
        F = fc * t + (f0 - fc) / k * (1 - np.exp(-k * t))
        return F
    
    def philip_infiltration(self, t, S, A):
        """
        菲利普入渗公式
        
        参数:
            t: 时间 (h)
            S: 吸渗率 (mm/h^0.5)
            A: 稳定入渗率 (mm/h)
        """
        F = S * np.sqrt(t) + A * t
        return F
    
    def excess_rainfall(self, rainfall_intensity, infiltration_rate):
        """
        超渗产流
        
        参数:
            rainfall_intensity: 降雨强度 (mm/h)
            infiltration_rate: 下渗率 (mm/h)
        
        返回:
            超渗雨强 (mm/h)
        """
        excess = np.maximum(rainfall_intensity - infiltration_rate, 0)
        return excess
    
    def plot_infiltration_process(self, duration=6, f0=50, fc=5, k=0.5):
        """
        绘制下渗过程
        """
        t = np.linspace(0, duration, 100)
        
        # 下渗率
        ft = self.horton_infiltration_rate(t, f0, fc, k)
        
        # 累积下渗
        F = self.horton_cumulative_infiltration(t, f0, fc, k)
        
        fig, axes = plt.subplots(1, 2, figsize=(14, 5))
        
        # 下渗率曲线
        axes[0].plot(t, ft, 'b-', linewidth=2, label='下渗率 f(t)')
        axes[0].axhline(f0, color='r', linestyle='--', label=f'初始 f₀={f0}mm/h')
        axes[0].axhline(fc, color='g', linestyle='--', label=f'稳定 fc={fc}mm/h')
        axes[0].set_xlabel('时间 (h)', fontsize=12)
        axes[0].set_ylabel('下渗率 (mm/h)', fontsize=12)
        axes[0].set_title('霍顿下渗率曲线', fontsize=14)
        axes[0].grid(True, alpha=0.3)
        axes[0].legend()
        
        # 累积下渗曲线
        axes[1].plot(t, F, 'g-', linewidth=2, label='累积下渗 F(t)')
        axes[1].set_xlabel('时间 (h)', fontsize=12)
        axes[1].set_ylabel('累积下渗 (mm)', fontsize=12)
        axes[1].set_title('累积下渗量曲线', fontsize=14)
        axes[1].grid(True, alpha=0.3)
        axes[1].legend()
        
        plt.tight_layout()
        plt.savefig('infiltration_process.png', dpi=300, bbox_inches='tight')
        plt.show()


# 使用示例
infil = InfiltrationCalculator()

# 霍顿公式参数
f0 = 50    # 初始下渗率 50 mm/h
fc = 5     # 稳定下渗率 5 mm/h
k = 0.8    # 衰减系数

# 计算不同时刻下渗率
times = [0, 0.5, 1, 2, 3, 5]
print("霍顿下渗率计算:")
for t in times:
    ft = infil.horton_infiltration_rate(t, f0, fc, k)
    F = infil.horton_cumulative_infiltration(t, f0, fc, k)
    print(f"  t={t}h: f(t)={ft[0]:.2f} mm/h, F(t)={F[0]:.2f} mm")

# 绘制下渗过程
infil.plot_infiltration_process(duration=6, f0=f0, fc=fc, k=k)

# 超渗产流计算
print("\n超渗产流计算:")
rainfall = np.array([10, 20, 40, 60, 30])  # 降雨强度 mm/h
t_rainfall = np.array([0, 0.5, 1, 1.5, 2])  # 时间 h

for t, i in zip(t_rainfall, rainfall):
    ft = infil.horton_infiltration_rate(t, f0, fc, k)
    excess = infil.excess_rainfall(i, ft)
    print(f"  t={t}h: i={i}mm/h, f={ft[0]:.1f}mm/h, 超渗={excess[0]:.1f}mm/h")
```

---

## 三、典型考题

### 考题1：蒸发计算

**【题目】**（20分）

某水库，水面面积5km²，某月蒸发皿蒸发量150mm，折算系数0.75。求：
1. 实际水面蒸发量
2. 水库蒸发损失（m³）
3. 若年蒸发量1200mm，该月占比

**【解答】**

#### 1. 实际水面蒸发量

$$E = k \cdot E_{pan} = 0.75 \times 150 = 112.5 \text{ mm}$$

#### 2. 蒸发损失

$$V = E \times A = 112.5 \times 10^{-3} \times 5 \times 10^6$$
$$= 562,500 \text{ m}^3 = 56.25 \text{ 万m}^3$$

#### 3. 月占比

$$\frac{E_{月}}{E_{年}} = \frac{112.5}{1200} = 0.094 = 9.4\%$$

---

### 考题2：下渗计算

**【题目】**（25分）

某地区霍顿下渗参数：$f_0=60$ mm/h，$f_c=6$ mm/h，$k=1.0$ h⁻¹。

降雨过程：
- 0-1h：i=30 mm/h
- 1-2h：i=50 mm/h
- 2-3h：i=20 mm/h

求：
1. 各时段末下渗率
2. 各时段下渗量
3. 各时段超渗雨量
4. 总径流量

**【解答】**

#### 1. 各时段末下渗率

**t=1h**：
$$f_1 = 6 + (60-6)e^{-1.0 \times 1} = 6 + 54 \times 0.368 = 25.9 \text{ mm/h}$$

**t=2h**：
$$f_2 = 6 + 54e^{-2.0} = 6 + 7.3 = 13.3 \text{ mm/h}$$

**t=3h**：
$$f_3 = 6 + 54e^{-3.0} = 6 + 2.7 = 8.7 \text{ mm/h}$$

#### 2. 各时段下渗量

**0-1h**：
$$F_1 = \int_0^1 f(t)dt = 6 \times 1 + \frac{54}{1.0}(1-e^{-1.0})$$
$$= 6 + 54 \times 0.632 = 40.1 \text{ mm}$$

**1-2h**：
$$F_2 = F(2) - F(1) = [6 \times 2 + 54(1-e^{-2.0})] - 40.1$$
$$= 54.7 - 40.1 = 14.6 \text{ mm}$$

**2-3h**：
$$F_3 = F(3) - F(2) = 62.2 - 54.7 = 7.5 \text{ mm}$$

#### 3. 超渗雨量

**0-1h**：i=30 < f_平均≈40 → 超渗=0

**1-2h**：
- 平均下渗率 ≈ 14.6 mm/h < i=50 mm/h
- 超渗 = 50 - 14.6 = 35.4 mm ✓

**2-3h**：i=20 > f_平均≈7.5 → 超渗 = 20-7.5 = 12.5 mm

#### 4. 总径流量

$$R = 0 + 35.4 + 12.5 = 47.9 \text{ mm}$$

---

## 四、高频考点总结

| 考点 | 公式/参数 | 典型值 |
|------|----------|--------|
| 蒸发皿折算 | E = k·E_pan | k=0.6~0.8 |
| 霍顿公式 | $f_t = f_c + (f_0-f_c)e^{-kt}$ | f₀=30-80 mm/h |
| 稳定下渗率 | fc | 5-15 mm/h |
| 衰减系数 | k | 0.5-2.0 h⁻¹ |
| 超渗产流 | i > f → 产流 | - |

---

## 五、本日练习

### 练习1（20分）
某水库月蒸发皿蒸发180mm，水面折算系数0.7，面积8km²。求月蒸发损失（万m³）。

### 练习2（30分）
霍顿参数：f₀=70 mm/h，fc=8 mm/h，k=1.2 h⁻¹。
降雨：0-1h，i=40mm/h；1-2h，i=60mm/h。
求各时段下渗量和超渗量。

---

**明日预告**: Day 5 - 径流形成与计算

**本日重点**：
- 彭曼公式（理解）
- 霍顿下渗公式（必背）
- 超渗产流判断（高频）
