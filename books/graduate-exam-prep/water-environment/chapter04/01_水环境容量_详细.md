# 第4章：水环境容量

**定义**: 水体自净能力的量化指标  
**应用**: 排污总量控制

---

## 一、基本概念

### 1.1 定义

**水环境容量（Water Environmental Capacity）**：在满足水体使用功能和水质目标的前提下，水体所能容纳污染物的最大量。

**核心要素**：
1. 水质目标：$C_s$（地表水标准）
2. 水体自净能力：$k$（降解系数）
3. 水文条件：$Q$（流量）
4. 排放方式：点源、面源

### 1.2 与排污总量关系

**排污总量**：
$$W = \sum W_i \leq W_{容}$$

**超载率**：
$$\lambda = \frac{W_{实际}}{W_{容}} - 1$$

- $\lambda > 0$：超载
- $\lambda \leq 0$：未超载

---

## 二、河流水环境容量

### 2.1 一维模型

**完全混合模型**（河段）：
$$C = C_0 e^{-kx/u}$$

**容量计算**：
$$W = 86.4 Q(C_s - C_0 e^{-kL/u})$$

### 2.2 Streeter-Phelps模型

**DO平衡方程**：
$$\frac{dD}{dt} = k_1 L - k_2 D$$

- $D$：溶解氧亏损（$D = DO_s - DO$）
- $L$：BOD
- $k_1$：BOD降解系数
- $k_2$：复氧系数

**临界点**：
$$x_c = \frac{u}{k_2 - k_1} \ln\left[\frac{k_2}{k_1}\left(1 - \frac{D_0(k_2 - k_1)}{k_1 L_0}\right)\right]$$

**最大亏损**：
$$D_c = \frac{k_1 L_0}{k_2} e^{-k_1 x_c/u}$$

**容量约束**：$DO_{min} \geq DO_{标准}$，即$D_c \leq D_{允}$

### Python实现

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy.optimize import fsolve

class WaterEnvironmentalCapacity:
    """水环境容量计算"""
    
    def __init__(self):
        pass
    
    def river_capacity_1d(self, Q, u, k, L, C0, Cs):
        """
        河流一维水环境容量
        
        C = C₀·e^(-kx/u)
        
        容量: W = 86.4·Q·(C_s - C₀·e^(-kL/u))
        
        参数:
            Q: 流量 (m³/s)
            u: 流速 (m/s)
            k: 降解系数 (1/d)
            L: 河段长度 (m)
            C0: 初始浓度 (mg/L)
            Cs: 标准浓度 (mg/L)
        
        返回:
            W: 容量 (kg/d)
        """
        # 末端浓度
        C_L = C0 * np.exp(-k * L / (u * 86400))
        
        # 容量
        W = 86.4 * Q * (Cs - C_L)
        
        return W
    
    def streeter_phelps_model(self, x, u, k1, k2, L0, D0):
        """
        Streeter-Phelps氧垂曲线
        
        D(x) = (k₁L₀/(k₂-k₁))·(e^(-k₁t) - e^(-k₂t)) + D₀·e^(-k₂t)
        
        t = x/u
        
        参数:
            x: 距离 (m)
            u: 流速 (m/s)
            k1: BOD降解系数 (1/d)
            k2: 复氧系数 (1/d)
            L0: 初始BOD (mg/L)
            D0: 初始氧亏 (mg/L)
        
        返回:
            D: 氧亏 (mg/L)
        """
        # 时间（天）
        t = x / (u * 86400)
        
        if k1 == k2:
            # 特殊情况
            D = (k1*L0*t + D0) * np.exp(-k1*t)
        else:
            # 一般情况
            D = (k1*L0 / (k2 - k1)) * (np.exp(-k1*t) - np.exp(-k2*t)) + \
                D0 * np.exp(-k2*t)
        
        return D
    
    def critical_point(self, u, k1, k2, L0, D0):
        """
        临界点位置
        
        x_c = (u/(k₂-k₁))·ln[(k₂/k₁)·(1 - D₀(k₂-k₁)/(k₁L₀))]
        """
        if k1 == k2:
            x_c = u * 86400 * D0 / (k1 * L0)
        else:
            arg = (k2/k1) * (1 - D0*(k2-k1)/(k1*L0))
            
            if arg <= 0:
                # 无临界点（初始亏损过大）
                x_c = 0
            else:
                x_c = (u * 86400) / (k2 - k1) * np.log(arg)
        
        # 临界点氧亏
        D_c = self.streeter_phelps_model(x_c, u, k1, k2, L0, D0)
        
        return x_c, D_c
    
    def bod_capacity(self, Q, u, k1, k2, L, DO_std, DO_s, BOD_bg):
        """
        BOD容量计算（基于DO约束）
        
        参数:
            Q: 流量 (m³/s)
            u: 流速 (m/s)
            k1: BOD降解系数 (1/d)
            k2: 复氧系数 (1/d)
            L: 河段长度 (m)
            DO_std: DO标准 (mg/L)
            DO_s: 饱和DO (mg/L)
            BOD_bg: 背景BOD (mg/L)
        
        返回:
            BOD_capacity: BOD容量 (kg/d)
        """
        # 允许最大氧亏
        D_allow = DO_s - DO_std
        
        # 求解BOD容量（数值方法）
        # 约束：D_c ≤ D_allow
        
        def equation(L0_add):
            """目标方程：D_c = D_allow"""
            L0_total = BOD_bg + L0_add
            D0 = 0  # 假设初始无氧亏
            
            x_c, D_c = self.critical_point(u, k1, k2, L0_total, D0)
            
            return D_c - D_allow
        
        # 求解
        try:
            L0_add = fsolve(equation, 10)[0]
            
            if L0_add < 0:
                L0_add = 0
            
            # BOD容量
            W_BOD = 86.4 * Q * L0_add
        except:
            W_BOD = 0
        
        return W_BOD
    
    def lake_capacity(self, V, Q_in, k, Cs):
        """
        湖泊水环境容量（完全混合）
        
        质量平衡: V·dC/dt = Q_in·C_in - Q_out·C - kVC
        
        稳态: C = Q_in·C_in / (Q_out + kV)
        
        容量: W = (Q_out + kV)·C_s
        
        参数:
            V: 湖泊容积 (m³)
            Q_in: 入湖流量 (m³/s)
            k: 降解系数 (1/d)
            Cs: 标准浓度 (mg/L)
        
        返回:
            W: 容量 (kg/d)
        """
        Q_out = Q_in  # 假设稳态
        
        W = (86.4 * Q_out + k * V / 1000) * Cs
        
        return W
    
    def plot_oxygen_sag_capacity(self, u, k1, k2, L0_values, D0, x_max=50000):
        """绘制不同BOD负荷的氧垂曲线"""
        x = np.linspace(0, x_max, 500)
        
        DO_s = 10  # 饱和DO (mg/L)
        DO_std_III = 5  # III类标准 (mg/L)
        DO_std_IV = 3  # IV类标准 (mg/L)
        
        fig, axes = plt.subplots(1, 2, figsize=(16, 6))
        
        # (a) 氧亏曲线
        for L0 in L0_values:
            D = [self.streeter_phelps_model(xi, u, k1, k2, L0, D0) 
                 for xi in x]
            
            axes[0].plot(x/1000, D, linewidth=2, label=f'L₀={L0}mg/L')
        
        # 标准线
        D_std_III = DO_s - DO_std_III
        D_std_IV = DO_s - DO_std_IV
        
        axes[0].axhline(D_std_III, color='orange', linestyle='--',
                       linewidth=2, label=f'III类标准（DO={DO_std_III}mg/L）')
        axes[0].axhline(D_std_IV, color='r', linestyle='--',
                       linewidth=2, label=f'IV类标准（DO={DO_std_IV}mg/L）')
        
        axes[0].set_xlabel('距离 (km)', fontsize=12)
        axes[0].set_ylabel('溶解氧亏损 D (mg/L)', fontsize=12)
        axes[0].set_title('氧垂曲线与水质标准', fontsize=14)
        axes[0].legend(loc='best')
        axes[0].grid(True, alpha=0.3)
        axes[0].set_ylim([0, max(D_std_IV, max(D))+2])
        
        # (b) DO曲线
        for L0 in L0_values:
            D = [self.streeter_phelps_model(xi, u, k1, k2, L0, D0) 
                 for xi in x]
            DO = DO_s - np.array(D)
            
            axes[1].plot(x/1000, DO, linewidth=2, label=f'L₀={L0}mg/L')
        
        axes[1].axhline(DO_std_III, color='orange', linestyle='--',
                       linewidth=2, label='III类标准')
        axes[1].axhline(DO_std_IV, color='r', linestyle='--',
                       linewidth=2, label='IV类标准')
        
        axes[1].set_xlabel('距离 (km)', fontsize=12)
        axes[1].set_ylabel('溶解氧 DO (mg/L)', fontsize=12)
        axes[1].set_title('DO变化曲线', fontsize=14)
        axes[1].legend(loc='best')
        axes[1].grid(True, alpha=0.3)
        
        plt.tight_layout()
        plt.savefig('oxygen_sag_capacity.png', dpi=300)
        plt.show()

# 示例1：河流水环境容量
print("="*60)
print("示例1：河流COD水环境容量计算")
print("="*60)

wec = WaterEnvironmentalCapacity()

# 河流参数
Q = 50  # 流量 (m³/s)
u = 0.5  # 流速 (m/s)
k = 0.2  # COD降解系数 (1/d)
L = 10000  # 河段长度 (m)
C0 = 5  # 背景浓度 (mg/L)
Cs = 20  # III类标准 (mg/L)

print(f"河流参数:")
print(f"  流量 Q = {Q} m³/s")
print(f"  流速 u = {u} m/s")
print(f"  降解系数 k = {k} 1/d")
print(f"  河段长度 L = {L/1000} km")
print(f"  背景浓度 C₀ = {C0} mg/L")
print(f"  水质标准 C_s = {Cs} mg/L（III类）")

# 容量计算
W = wec.river_capacity_1d(Q, u, k, L, C0, Cs)

print(f"\nCOD水环境容量:")
print(f"  W = {W:.1f} kg/d = {W/1000:.2f} t/d")

# 示例2：Streeter-Phelps模型
print("\n" + "="*60)
print("示例2：Streeter-Phelps氧垂曲线")
print("="*60)

# 参数
u_sp = 0.3  # m/s
k1 = 0.3  # BOD降解系数 (1/d)
k2 = 0.5  # 复氧系数 (1/d)
L0 = 15  # 初始BOD (mg/L)
D0 = 2   # 初始氧亏 (mg/L)

print(f"模型参数:")
print(f"  流速 u = {u_sp} m/s")
print(f"  BOD降解系数 k₁ = {k1} 1/d")
print(f"  复氧系数 k₂ = {k2} 1/d")
print(f"  初始BOD L₀ = {L0} mg/L")
print(f"  初始氧亏 D₀ = {D0} mg/L")

# 临界点
x_c, D_c = wec.critical_point(u_sp, k1, k2, L0, D0)

print(f"\n临界点:")
print(f"  位置 x_c = {x_c:.0f} m = {x_c/1000:.2f} km")
print(f"  最大氧亏 D_c = {D_c:.2f} mg/L")

DO_s = 10  # 饱和DO
DO_c = DO_s - D_c

print(f"  最小DO = {DO_c:.2f} mg/L")

# 水质标准判断
DO_std_III = 5  # III类
DO_std_IV = 3   # IV类

if DO_c >= DO_std_III:
    status = "满足III类标准"
elif DO_c >= DO_std_IV:
    status = "满足IV类标准"
else:
    status = "低于IV类标准"

print(f"  水质评价: {status}")

# 示例3：BOD容量计算
print("\n" + "="*60)
print("示例3：基于DO约束的BOD容量")
print("="*60)

Q_bod = 20  # m³/s
DO_std = 5  # III类标准
DO_s_bod = 10  # 饱和DO
BOD_bg = 3  # 背景BOD

print(f"约束条件:")
print(f"  流量 Q = {Q_bod} m³/s")
print(f"  DO标准 = {DO_std} mg/L（III类）")
print(f"  饱和DO = {DO_s_bod} mg/L")
print(f"  背景BOD = {BOD_bg} mg/L")

W_BOD = wec.bod_capacity(Q_bod, u_sp, k1, k2, L, DO_std, DO_s_bod, BOD_bg)

print(f"\nBOD水环境容量:")
print(f"  W_BOD = {W_BOD:.1f} kg/d = {W_BOD/1000:.2f} t/d")

# 示例4：湖泊容量
print("\n" + "="*60)
print("示例4：湖泊水环境容量")
print("="*60)

V_lake = 50e6  # m³（0.05 km³）
Q_in_lake = 10  # m³/s
k_lake = 0.1  # 1/d
Cs_lake = 0.05  # mg/L（TP标准，III类）

print(f"湖泊参数:")
print(f"  容积 V = {V_lake/1e6:.2f}×10⁶ m³")
print(f"  入湖流量 Q = {Q_in_lake} m³/s")
print(f"  降解系数 k = {k_lake} 1/d")
print(f"  TP标准 = {Cs_lake} mg/L")

W_lake = wec.lake_capacity(V_lake, Q_in_lake, k_lake, Cs_lake)

print(f"\nTP水环境容量:")
print(f"  W = {W_lake:.1f} kg/d = {W_lake/1000:.3f} t/d = {W_lake*365/1000:.1f} t/a")

# 绘制氧垂曲线
print("\n绘制不同BOD负荷的氧垂曲线...")
L0_values = [10, 15, 20, 25]
wec.plot_oxygen_sag_capacity(u_sp, k1, k2, L0_values, D0)
```

---

## 三、排污总量分配

### 3.1 公平性原则

**等比例削减**：
$$W_i = W_i^0 \times (1 - \lambda)$$

### 3.2 效率原则

**边际治理成本相等**：
$$\frac{\partial C_i}{\partial W_i} = \lambda \quad (\forall i)$$

### 3.3 多目标优化

$$\min \sum C_i(W_i)$$

约束：$\sum W_i \leq W_{容}$

---

## 四、典型考题

### 【例题】水环境容量计算

**题目**（20分）

河流Q=30m³/s，u=0.4m/s，k=0.25 1/d，L=8km，C₀=10mg/L，C_s=20mg/L。求COD容量。

**【解答】**（见Python示例）

---

**本章重点**：
- 水环境容量定义
- 河流容量计算（一维模型）
- Streeter-Phelps氧垂曲线
- 排污总量控制

**下一章**：地下水污染修复
