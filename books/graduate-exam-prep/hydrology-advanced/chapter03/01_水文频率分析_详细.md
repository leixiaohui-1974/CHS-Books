# 第3章：水文频率分析

**难度**: ⭐⭐⭐⭐  
**考试重点**: 设计洪水/暴雨计算

---

## 一、基本概念

### 1.1 水文频率

**定义**：某水文变量$X$的值在长期观测中被超过（或不超过）的可能性

**超过频率**：$P(X \geq x)$  
**不超过频率（累积频率）**：$F(x) = P(X < x)$

### 1.2 重现期

$$T = \frac{1}{P}$$

**含义**：某值平均$T$年出现一次

**例**：百年一遇洪水（T=100年，P=1%）

### 1.3 经验频率

**数学期望公式**：
$$P = \frac{m}{n+1}$$

- $m$：样本按从大到小排序的序号
- $n$：样本总数

---

## 二、Pearson-III型分布

### 2.1 概率密度函数

$$f(x) = \frac{\beta^\alpha}{\Gamma(\alpha)} (x - a_0)^{\alpha - 1} e^{-\beta(x-a_0)}$$

**三参数**：
- $\alpha$：形状参数
- $\beta$：尺度参数
- $a_0$：位置参数

### 2.2 统计参数

**均值**：$\bar{x} = \frac{1}{n}\sum x_i$

**变差系数**：$C_v = \frac{\sigma}{\bar{x}}$

**偏态系数**：$C_s = \frac{E[(X-\bar{x})^3]}{\sigma^3}$

**关系**：$C_s = 2C_v$（理论，实际可调整）

### 2.3 频率曲线

$$\frac{x_p}{\bar{x}} = 1 + \Phi_p \cdot C_v$$

$\Phi_p$：模比系数，查表得（根据$C_v$、$C_s$、$P$）

### Python实现

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy import stats
from scipy.special import gamma

class HydrologicFrequencyAnalysis:
    """水文频率分析"""
    
    @staticmethod
    def empirical_frequency(data, method='weibull'):
        """
        经验频率计算
        
        参数:
            data: 样本数据
            method: 'weibull'（数学期望）, 'hazen'（中位数）
        
        返回:
            sorted_data: 排序后数据（降序）
            P: 超过频率
        """
        n = len(data)
        sorted_data = np.sort(data)[::-1]  # 降序
        
        m = np.arange(1, n+1)
        
        if method == 'weibull':
            P = m / (n + 1)
        elif method == 'hazen':
            P = (m - 0.5) / n
        else:
            P = m / (n + 1)
        
        return sorted_data, P
    
    @staticmethod
    def calculate_statistics(data):
        """
        计算统计参数
        
        返回:
            mean: 均值
            Cv: 变差系数
            Cs: 偏态系数
        """
        mean = np.mean(data)
        std = np.std(data, ddof=1)
        
        Cv = std / mean
        
        # 偏态系数
        n = len(data)
        m3 = np.sum((data - mean)**3) / n
        Cs = m3 / std**3
        
        return mean, Cv, Cs
    
    @staticmethod
    def pearson3_phi(Cv, Cs, P):
        """
        Pearson-III型模比系数Φ_p
        
        简化计算（近似公式）
        """
        # 正态分位数
        u_p = stats.norm.ppf(1 - P)
        
        # Pearson-III近似
        phi = 1 + Cv * (u_p + (u_p**2 - 1)*Cs/6 - 
                        (u_p**3 - 6*u_p)*Cs**2/36)
        
        return phi
    
    @staticmethod
    def design_value(mean, Cv, Cs, P):
        """
        设计值计算
        
        x_p = mean * (1 + Φ_p * Cv)
        """
        phi_p = HydrologicFrequencyAnalysis.pearson3_phi(Cv, Cs, P)
        x_p = mean * phi_p
        
        return x_p
    
    @staticmethod
    def plot_frequency_curve(data, Cv, Cs, title="水文频率曲线"):
        """绘制频率曲线"""
        # 经验频率
        sorted_data, P_emp = HydrologicFrequencyAnalysis.empirical_frequency(data)
        
        mean = np.mean(data)
        
        # 理论频率曲线
        P_theory = np.logspace(-3, -0.01, 100)  # 0.1% ~ 97.7%
        x_theory = []
        
        for p in P_theory:
            x_p = HydrologicFrequencyAnalysis.design_value(mean, Cv, Cs, p)
            x_theory.append(x_p)
        
        x_theory = np.array(x_theory)
        
        # 绘图
        fig, ax = plt.subplots(figsize=(12, 7))
        
        # 经验点
        ax.plot(P_emp * 100, sorted_data, 'ro', markersize=8,
               label='实测点')
        
        # 理论曲线
        ax.plot(P_theory * 100, x_theory, 'b-', linewidth=2,
               label=f'P-III曲线 (Cv={Cv:.2f}, Cs={Cs:.2f})')
        
        # 设计值标注
        for P_design, label in [(0.01, '百年一遇'), (0.02, '50年一遇'),
                                (0.05, '20年一遇'), (0.1, '10年一遇')]:
            x_design = HydrologicFrequencyAnalysis.design_value(mean, Cv, Cs, P_design)
            ax.plot(P_design * 100, x_design, 'g*', markersize=15)
            ax.text(P_design * 100, x_design, f'  {label}\n  P={P_design*100}%',
                   fontsize=10, va='center')
        
        ax.set_xlabel('超过频率 P (%)', fontsize=12)
        ax.set_ylabel('流量/雨量', fontsize=12)
        ax.set_title(title, fontsize=14)
        ax.set_xscale('log')
        ax.grid(True, which='both', alpha=0.3)
        ax.legend(loc='best')
        
        # 设置X轴刻度
        ax.set_xticks([0.1, 0.5, 1, 2, 5, 10, 20, 50])
        ax.set_xticklabels(['0.1', '0.5', '1', '2', '5', '10', '20', '50'])
        
        plt.tight_layout()
        plt.savefig('hydrologic_frequency_curve.png', dpi=300)
        plt.show()
    
    @staticmethod
    def confidence_interval(mean, Cv, Cs, P, n, alpha=0.05):
        """
        设计值置信区间
        
        参数:
            n: 样本量
            alpha: 显著性水平（0.05→95%置信区间）
        """
        x_p = HydrologicFrequencyAnalysis.design_value(mean, Cv, Cs, P)
        
        # 标准误差（简化）
        se = x_p * Cv / np.sqrt(n)
        
        # 置信区间
        z = stats.norm.ppf(1 - alpha/2)
        
        lower = x_p - z * se
        upper = x_p + z * se
        
        return lower, x_p, upper

# 示例1：年最大流量频率分析
print("="*60)
print("示例1：年最大洪峰流量频率分析")
print("="*60)

# 某站30年实测洪峰流量（m³/s）
Q_annual_max = np.array([
    3450, 2890, 4120, 3780, 2560,
    3210, 4560, 3890, 2980, 3340,
    4200, 3650, 2780, 3920, 4380,
    3560, 2890, 4010, 3460, 2950,
    3780, 4150, 3320, 3680, 4420,
    3190, 3850, 2870, 3540, 4090
])

print(f"样本量: {len(Q_annual_max)}年")
print(f"样本数据: {Q_annual_max[:5]}...（共{len(Q_annual_max)}个）")

# 统计参数
mean_Q, Cv_Q, Cs_Q = HydrologicFrequencyAnalysis.calculate_statistics(Q_annual_max)

print(f"\n统计参数:")
print(f"  均值 Q̄ = {mean_Q:.1f} m³/s")
print(f"  变差系数 Cv = {Cv_Q:.3f}")
print(f"  偏态系数 Cs = {Cs_Q:.3f}")

# 调整偏态系数（经验：Cs = 2Cv 或 3.5Cv）
Cs_adjusted = 2 * Cv_Q

print(f"  调整后 Cs = {Cs_adjusted:.3f} (取Cs=2Cv)")

# 设计洪水
design_cases = [
    (0.01, '百年一遇'),
    (0.02, '50年一遇'),
    (0.05, '20年一遇'),
    (0.1, '10年一遇'),
    (0.2, '5年一遇')
]

print(f"\n设计洪峰流量:")
for P, desc in design_cases:
    Q_p = HydrologicFrequencyAnalysis.design_value(mean_Q, Cv_Q, Cs_adjusted, P)
    
    # 置信区间
    lower, _, upper = HydrologicFrequencyAnalysis.confidence_interval(
        mean_Q, Cv_Q, Cs_adjusted, P, len(Q_annual_max))
    
    print(f"  {desc} (P={P*100:5.2f}%): Q_p = {Q_p:.0f} m³/s  "
          f"[{lower:.0f}, {upper:.0f}]")

# 绘制频率曲线
HydrologicFrequencyAnalysis.plot_frequency_curve(
    Q_annual_max, Cv_Q, Cs_adjusted, 
    title="某站年最大洪峰流量频率曲线")

# 示例2：暴雨频率分析
print("\n" + "="*60)
print("示例2：24小时最大暴雨频率分析")
print("="*60)

# 某站25年24h最大降雨（mm）
rainfall_24h = np.array([
    156, 132, 189, 165, 143,
    178, 201, 172, 148, 183,
    195, 159, 138, 187, 206,
    164, 151, 192, 169, 145,
    181, 198, 157, 175, 203
])

mean_R, Cv_R, Cs_R = HydrologicFrequencyAnalysis.calculate_statistics(rainfall_24h)

print(f"统计参数:")
print(f"  均值 R̄ = {mean_R:.1f} mm")
print(f"  Cv = {Cv_R:.3f}")
print(f"  Cs = {Cs_R:.3f}")

Cs_R_adj = 3.5 * Cv_R  # 暴雨常用

print(f"  调整后 Cs = {Cs_R_adj:.3f}")

print(f"\n设计暴雨:")
for P, desc in [(0.01, '百年一遇'), (0.02, '50年一遇'), 
                (0.05, '20年一遇')]:
    R_p = HydrologicFrequencyAnalysis.design_value(mean_R, Cv_R, Cs_R_adj, P)
    print(f"  {desc}: R_p = {R_p:.1f} mm")

# 示例3：频率分析方法对比
print("\n" + "="*60)
print("示例3：不同参数对频率曲线的影响")
print("="*60)

mean_test = 100
P_range = np.logspace(-3, -0.3, 50)

fig, axes = plt.subplots(1, 2, figsize=(16, 6))

# (a) 不同Cv
Cv_values = [0.2, 0.4, 0.6]
Cs_fixed = 0.5

for Cv in Cv_values:
    x_values = [HydrologicFrequencyAnalysis.design_value(
        mean_test, Cv, Cs_fixed, p) for p in P_range]
    
    axes[0].plot(P_range * 100, x_values, linewidth=2,
                label=f'Cv={Cv}')

axes[0].set_xlabel('超过频率 P (%)', fontsize=12)
axes[0].set_ylabel('设计值 x_p', fontsize=12)
axes[0].set_title(f'变差系数Cv的影响 (Cs={Cs_fixed})', fontsize=13)
axes[0].set_xscale('log')
axes[0].grid(True, alpha=0.3)
axes[0].legend()

# (b) 不同Cs
Cv_fixed = 0.4
Cs_values = [0.5, 1.0, 1.5]

for Cs in Cs_values:
    x_values = [HydrologicFrequencyAnalysis.design_value(
        mean_test, Cv_fixed, Cs, p) for p in P_range]
    
    axes[1].plot(P_range * 100, x_values, linewidth=2,
                label=f'Cs={Cs}')

axes[1].set_xlabel('超过频率 P (%)', fontsize=12)
axes[1].set_ylabel('设计值 x_p', fontsize=12)
axes[1].set_title(f'偏态系数Cs的影响 (Cv={Cv_fixed})', fontsize=13)
axes[1].set_xscale('log')
axes[1].grid(True, alpha=0.3)
axes[1].legend()

plt.tight_layout()
plt.savefig('frequency_parameter_comparison.png', dpi=300)
plt.show()

print(f"可视化完成！")
```

---

## 三、适线法步骤

### 3.1 步骤

1. **收集资料**：多年观测数据（≥30年）
2. **计算统计参数**：$\bar{x}$、$C_v$、$C_s$
3. **确定线型**：Pearson-III等
4. **配线**：调整$C_v$、$C_s$，使理论曲线拟合实测点
5. **计算设计值**：查表或公式

---

## 四、典型考题

### 【例题】设计洪水计算

**题目**（25分）

某站30年洪峰流量，$\bar{Q}=1200$ m³/s，$C_v=0.35$，$C_s=2C_v$。求百年一遇设计洪峰流量。

**【解答】**

**(1) 参数**（5分）

$$C_s = 2C_v = 0.70$$

**(2) 模比系数**（10分）

查Pearson-III表（或近似公式）：

$P=1\%$，$C_v=0.35$，$C_s=0.70$ → $\Phi_{1\%} \approx 2.20$

**(3) 设计流量**（10分）

$$Q_{1\%} = \bar{Q} \times \Phi_{1\%} = 1200 \times 2.20 = 2640 \text{ m}^3\text{/s}$$

---

**本章重点**：
- 频率与重现期
- Pearson-III分布
- 统计参数计算
- 设计值推算

**下一章**：产汇流计算
