# 第1章：流域水文模型

**难度**: ⭐⭐⭐⭐⭐  
**重要性**: ⭐⭐⭐⭐⭐

---

## 一、水文模型分类

### 1.1 按结构

| 类型 | 特点 | 代表 |
|------|------|------|
| 集总式 | 参数不变 | 新安江模型 |
| 分布式 | 空间分布 | TOPMODEL |
| 半分布式 | 子流域划分 | SWAT |

### 1.2 按物理基础

- **概念性模型**：水箱模型
- **物理模型**：基于物理方程
- **经验模型**：统计关系

---

## 二、新安江模型

### 2.1 结构

```
降雨
  ↓
蒸散发 → 土壤含水层（WM）
         ↓
    产流分配（b）
    ↓        ↓
  地表径流  壤中流  地下径流
    ↓        ↓      ↓
      汇流计算
         ↓
      流域出口
```

### 2.2 核心公式

**蓄水容量曲线**：
$$f = 1 - \left(1 - \frac{W}{WM}\right)^{b/(1+b)}$$

- $f$：产流面积比
- $W$：土壤含水量
- $WM$：蓄水容量
- $b$：指数参数

**产流量**：
$$R = P - E - \Delta W$$

### Python实现

```python
import numpy as np
import matplotlib.pyplot as plt

class XinanjiangModel:
    """新安江模型"""
    
    def __init__(self, WM=150, b=0.3, K=0.7):
        """
        参数:
            WM: 蓄水容量 (mm)
            b: 蓄水容量曲线指数
            K: 汇流参数
        """
        self.WM = WM
        self.b = b
        self.K = K
    
    def runoff_generation(self, P, E, W0):
        """
        产流计算
        
        参数:
            P: 降雨 (mm)
            E: 蒸发 (mm)
            W0: 初始含水量 (mm)
        
        返回:
            R: 径流 (mm)
            W1: 最终含水量 (mm)
        """
        # 净雨量
        PE = P - E
        
        if PE <= 0:
            return 0, max(0, W0 + PE)
        
        # 产流面积比
        if W0 >= self.WM:
            f = 1.0
        else:
            f = 1 - (1 - W0/self.WM)**(self.b/(1+self.b))
        
        # 产流量
        A = self.WM * (1 - (1 - f)**(1 + 1/self.b))
        
        if PE + A <= self.WM:
            R = PE * f
            W1 = W0 + PE - R
        else:
            R = PE - (self.WM - W0)
            W1 = self.WM
        
        return max(0, R), W1
    
    def simulate(self, rainfall, evap, W0=50):
        """
        模拟时段径流
        
        参数:
            rainfall: 降雨序列 (mm)
            evap: 蒸发序列 (mm)
            W0: 初始含水量 (mm)
        
        返回:
            径流序列, 含水量序列
        """
        n = len(rainfall)
        runoff = np.zeros(n)
        soil_moisture = np.zeros(n)
        
        W = W0
        
        for i in range(n):
            R, W = self.runoff_generation(rainfall[i], evap[i], W)
            runoff[i] = R
            soil_moisture[i] = W
        
        return runoff, soil_moisture
    
    def plot_simulation(self, rainfall, runoff, soil_moisture):
        """绘制模拟结果"""
        days = np.arange(len(rainfall))
        
        fig, axes = plt.subplots(3, 1, figsize=(12, 10))
        
        # 降雨
        axes[0].bar(days, rainfall, color='blue', alpha=0.6)
        axes[0].set_ylabel('降雨 (mm)')
        axes[0].set_title('降雨过程')
        axes[0].grid(True, alpha=0.3)
        
        # 径流
        axes[1].plot(days, runoff, 'r-o', linewidth=2, markersize=4)
        axes[1].fill_between(days, 0, runoff, alpha=0.3, color='red')
        axes[1].set_ylabel('径流 (mm)')
        axes[1].set_title('径流过程')
        axes[1].grid(True, alpha=0.3)
        
        # 土壤含水量
        axes[2].plot(days, soil_moisture, 'g-s', linewidth=2, markersize=4)
        axes[2].axhline(self.WM, color='orange', linestyle='--',
                       label=f'蓄水容量={self.WM}mm')
        axes[2].set_xlabel('时间 (天)')
        axes[2].set_ylabel('含水量 (mm)')
        axes[2].set_title('土壤含水量变化')
        axes[2].legend()
        axes[2].grid(True, alpha=0.3)
        
        plt.tight_layout()
        plt.savefig('xinanjiang_simulation.png', dpi=300)
        plt.show()

# 示例
print("="*60)
print("新安江模型模拟")
print("="*60)

# 创建模型
model = XinanjiangModel(WM=150, b=0.4, K=0.7)

# 模拟降雨（30天）
np.random.seed(42)
rainfall = np.random.gamma(2, 5, 30)  # 降雨
rainfall[rainfall < 5] = 0  # 小于5mm视为无雨

evap = np.ones(30) * 3  # 蒸发

# 模拟
runoff, soil_moisture = model.simulate(rainfall, evap, W0=80)

# 统计
print(f"模型参数:")
print(f"  WM = {model.WM} mm")
print(f"  b = {model.b}")
print(f"\n模拟结果:")
print(f"  总降雨: {rainfall.sum():.1f} mm")
print(f"  总蒸发: {evap.sum():.1f} mm")
print(f"  总径流: {runoff.sum():.1f} mm")
print(f"  径流系数: {runoff.sum()/rainfall.sum():.3f}")

# 可视化
model.plot_simulation(rainfall, runoff, soil_moisture)
```

---

## 三、TOPMODEL

### 3.1 原理

基于**地形指数**：
$$\lambda = \ln\left(\frac{a}{\tan\beta}\right)$$

- $a$：单宽汇流面积
- $\beta$：坡度

### 3.2 饱和缺水量

$$D = \bar{D} - m(\lambda - \bar{\lambda})$$

---

## 四、模型参数率定

### 4.1 目标函数

**Nash-Sutcliffe效率系数**：
$$NSE = 1 - \frac{\sum(Q_{obs} - Q_{sim})^2}{\sum(Q_{obs} - \bar{Q}_{obs})^2}$$

NSE > 0.75：很好  
NSE > 0.65：好  
NSE > 0.50：满意

### 4.2 优化方法

- 试错法
- SCE-UA算法
- 遗传算法

---

## 五、典型考题

### 【例题】模型选择

**题目**：小流域（50km²），资料充足，选择何种模型？

**解答**：
- **新安江模型**：成熟可靠，参数物理意义明确
- **TOPMODEL**：考虑地形，适合山区小流域
- 建议：**新安江模型**（更适合中国流域）

---

**本章重点**：
- 新安江模型结构与原理
- 产流计算
- 模型率定
