# 第5章：气候变化对水文过程的影响

**学习时间**: 4小时  
**考试频率**: ⭐⭐⭐⭐⭐  
**难度**: ⭐⭐⭐⭐⭐

---

## 一、气候变化基本概念

### 1.1 全球气候变化现状

**观测事实**：
- 全球平均气温上升：过去100年上升约0.85°C
- 极端天气事件频率增加
- 降水时空分布变化
- 冰川融化，海平面上升

**IPCC情景预估**（RCP情景）：
- **RCP2.6**：低排放情景，21世纪末升温<2°C
- **RCP4.5**：中等稳定情景，升温2.0-3.0°C
- **RCP6.0**：中高排放情景，升温3.0-4.0°C
- **RCP8.5**：高排放情景，升温4.0-5.5°C

### 1.2 对水文循环的影响

**直接影响**：
- 降水量变化
- 蒸发强度变化
- 融雪过程改变
- 土壤湿度变化

**间接影响**：
- 植被类型改变
- 地表径流变化
- 地下水补给变化
- 极端洪旱事件

---

## 二、降水变化分析

### 2.1 Mann-Kendall趋势检验

**统计量**：
$$S = \sum_{i=1}^{n-1}\sum_{j=i+1}^{n}\text{sgn}(x_j - x_i)$$

**符号函数**：
$$\text{sgn}(\theta) = \begin{cases}
+1, & \theta > 0 \\
0, & \theta = 0 \\
-1, & \theta < 0
\end{cases}$$

**标准化检验统计量**：
$$Z = \begin{cases}
\frac{S-1}{\sqrt{\text{Var}(S)}}, & S > 0 \\
0, & S = 0 \\
\frac{S+1}{\sqrt{\text{Var}(S)}}, & S < 0
\end{cases}$$

**方差**：
$$\text{Var}(S) = \frac{n(n-1)(2n+5)}{18}$$

**显著性判断**：
- $|Z| > 1.96$：95%置信水平显著
- $|Z| > 2.58$：99%置信水平显著

### 2.2 滑动平均与突变检验

**滑动平均**：
$$\bar{x}_i = \frac{1}{m}\sum_{j=i-m/2}^{i+m/2} x_j$$

**滑动t检验**（突变点检测）：
$$t = \frac{\bar{x}_1 - \bar{x}_2}{\sqrt{s_1^2/n_1 + s_2^2/n_2}}$$

---

## 三、潜在蒸散发变化

### 3.1 Penman-Monteith公式

**FAO-56标准公式**：
$$ET_0 = \frac{0.408\Delta(R_n - G) + \gamma \frac{900}{T+273}u_2(e_s - e_a)}{\Delta + \gamma(1 + 0.34u_2)}$$

**参数说明**：
- $ET_0$：参考蒸散发（mm/day）
- $\Delta$：饱和水汽压曲线斜率（kPa/°C）
- $R_n$：净辐射（MJ/m²/day）
- $G$：土壤热通量（MJ/m²/day）
- $\gamma$：干湿表常数（kPa/°C）
- $T$：平均气温（°C）
- $u_2$：2m高度风速（m/s）
- $e_s$：饱和水汽压（kPa）
- $e_a$：实际水汽压（kPa）

### 3.2 温度敏感性分析

**温度变化对ET的影响**：
$$\frac{\partial ET_0}{\partial T} = \frac{\partial ET_0}{\partial \Delta}\frac{d\Delta}{dT} + \frac{\partial ET_0}{\partial e_s}\frac{de_s}{dT}$$

**经验公式**（温度每升高1°C）：
$$\Delta ET_0 \approx 3\% \sim 5\% \times ET_0$$

---

## 四、径流响应分析

### 4.1 弹性系数法

**径流对降水的弹性系数**：
$$\epsilon_{Q,P} = \frac{\partial Q / Q}{\partial P / P}$$

**经验公式**：
$$\epsilon_{Q,P} = 1 + \frac{E_0}{P}$$

**物理意义**：降水变化1%，径流变化$\epsilon_{Q,P}$%

### 4.2 水文模型模拟

**情景设置**：
1. 基准期（1961-1990）
2. 未来期（2021-2050, 2051-2080）
3. 气候情景（RCP4.5, RCP8.5）

**变化率计算**：
$$\Delta Q = \frac{Q_{future} - Q_{baseline}}{Q_{baseline}} \times 100\%$$

---

## 五、极端事件变化

### 5.1 极值理论

**广义极值分布（GEV）**：
$$F(x) = \exp\left\{-\left[1 + \xi\left(\frac{x-\mu}{\sigma}\right)\right]^{-1/\xi}\right\}$$

**参数说明**：
- $\mu$：位置参数
- $\sigma$：尺度参数
- $\xi$：形状参数（$\xi > 0$为Fréchet型，$\xi < 0$为Weibull型，$\xi = 0$为Gumbel型）

### 5.2 极端降水指数

**R10**：年降水≥10mm天数
**R20**：年降水≥20mm天数
**R95p**：年降水量中>95分位数的降水总量
**CDD**：最长连续干旱日数（Consecutive Dry Days）
**CWD**：最长连续湿润日数（Consecutive Wet Days）

---

## 六、Python实现

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy import stats
from scipy.optimize import curve_fit
import pandas as pd

class ClimateChangeImpact:
    """气候变化对水文的影响分析"""
    
    @staticmethod
    def mann_kendall_test(data):
        """
        Mann-Kendall趋势检验
        
        参数:
            data: 时间序列数据
        
        返回:
            Z: 标准化统计量
            trend: 'increasing', 'decreasing', 'no trend'
            p_value: 显著性水平
        """
        n = len(data)
        
        # 计算S统计量
        S = 0
        for i in range(n - 1):
            for j in range(i + 1, n):
                S += np.sign(data[j] - data[i])
        
        # 计算方差
        var_S = n * (n - 1) * (2 * n + 5) / 18
        
        # 标准化
        if S > 0:
            Z = (S - 1) / np.sqrt(var_S)
        elif S < 0:
            Z = (S + 1) / np.sqrt(var_S)
        else:
            Z = 0
        
        # 显著性检验
        p_value = 2 * (1 - stats.norm.cdf(abs(Z)))
        
        # 判断趋势
        if abs(Z) < 1.96:
            trend = 'no trend'
        elif Z > 0:
            trend = 'increasing'
        else:
            trend = 'decreasing'
        
        return Z, trend, p_value
    
    @staticmethod
    def penman_monteith_et0(T, RH, u2, Rs, lat, J):
        """
        Penman-Monteith参考蒸散发（FAO-56）
        
        参数:
            T: 平均气温 (°C)
            RH: 相对湿度 (%)
            u2: 2m高风速 (m/s)
            Rs: 太阳辐射 (MJ/m²/day)
            lat: 纬度 (度)
            J: 儒略日（1-365）
        
        返回:
            ET0: 参考蒸散发 (mm/day)
        """
        # 饱和水汽压
        es = 0.6108 * np.exp(17.27 * T / (T + 237.3))
        
        # 实际水汽压
        ea = es * RH / 100
        
        # 饱和水汽压曲线斜率
        Delta = 4098 * es / (T + 237.3)**2
        
        # 干湿表常数
        P = 101.3  # 海平面气压 (kPa)
        gamma = 0.665e-3 * P
        
        # 净辐射（简化）
        # 外推辐射
        dr = 1 + 0.033 * np.cos(2 * np.pi * J / 365)
        delta = 0.409 * np.sin(2 * np.pi * J / 365 - 1.39)
        phi = lat * np.pi / 180
        
        ws = np.arccos(-np.tan(phi) * np.tan(delta))
        Ra = 24 * 60 / np.pi * 0.0820 * dr * \
             (ws * np.sin(phi) * np.sin(delta) + 
              np.cos(phi) * np.cos(delta) * np.sin(ws))
        
        # 净短波辐射（假设反照率0.23）
        Rns = 0.77 * Rs
        
        # 净长波辐射（简化）
        Rnl = 4.903e-9 * ((T + 273.16)**4) * (0.34 - 0.14 * np.sqrt(ea)) * \
              (1.35 * Rs / (0.75 * Ra) - 0.35)
        
        Rn = Rns - Rnl
        
        # 土壤热通量（日尺度可忽略）
        G = 0
        
        # ET0计算
        numerator = 0.408 * Delta * (Rn - G) + gamma * (900 / (T + 273)) * u2 * (es - ea)
        denominator = Delta + gamma * (1 + 0.34 * u2)
        
        ET0 = numerator / denominator
        
        return ET0
    
    @staticmethod
    def runoff_elasticity(P, E0):
        """
        径流对降水的弹性系数
        
        参数:
            P: 降水量 (mm)
            E0: 潜在蒸散发 (mm)
        
        返回:
            epsilon: 弹性系数
        """
        epsilon = 1 + E0 / P
        return epsilon
    
    @staticmethod
    def gev_fit(data):
        """
        广义极值分布拟合
        
        参数:
            data: 极值序列（如年最大降水）
        
        返回:
            params: (location, scale, shape)
            return_levels: 重现期水平
        """
        # 拟合GEV分布
        params = stats.genextreme.fit(data)
        
        # 计算不同重现期的设计值
        return_periods = [2, 5, 10, 20, 50, 100]
        return_levels = {}
        
        for T in return_periods:
            p = 1 - 1 / T
            x = stats.genextreme.ppf(p, *params)
            return_levels[T] = x
        
        return params, return_levels
    
    @staticmethod
    def extreme_indices(precip_daily):
        """
        计算极端降水指数
        
        参数:
            precip_daily: 日降水序列 (mm)
        
        返回:
            indices: 字典，包含各种指数
        """
        # R10: 年降水≥10mm天数
        R10 = np.sum(precip_daily >= 10)
        
        # R20: 年降水≥20mm天数
        R20 = np.sum(precip_daily >= 20)
        
        # R95p: 95分位数以上降水总量
        p95 = np.percentile(precip_daily[precip_daily > 1], 95)
        R95p = np.sum(precip_daily[precip_daily > p95])
        
        # CDD: 最长连续干旱日
        dry_days = (precip_daily < 1).astype(int)
        CDD = 0
        current_streak = 0
        
        for day in dry_days:
            if day == 1:
                current_streak += 1
                CDD = max(CDD, current_streak)
            else:
                current_streak = 0
        
        # CWD: 最长连续湿润日
        wet_days = (precip_daily >= 1).astype(int)
        CWD = 0
        current_streak = 0
        
        for day in wet_days:
            if day == 1:
                current_streak += 1
                CWD = max(CWD, current_streak)
            else:
                current_streak = 0
        
        indices = {
            'R10': R10,
            'R20': R20,
            'R95p': R95p,
            'CDD': CDD,
            'CWD': CWD
        }
        
        return indices
    
    @staticmethod
    def plot_climate_change_analysis(years, precip, temp):
        """绘制气候变化分析图"""
        fig, axes = plt.subplots(2, 2, figsize=(16, 12))
        
        # 1. 降水趋势分析
        ax1 = axes[0, 0]
        
        Z_p, trend_p, p_p = ClimateChangeImpact.mann_kendall_test(precip)
        
        ax1.plot(years, precip, 'bo-', linewidth=1, markersize=4, alpha=0.6, label='年降水量')
        
        # 线性趋势
        z = np.polyfit(years, precip, 1)
        p_fit = np.poly1d(z)
        ax1.plot(years, p_fit(years), 'r--', linewidth=2.5, label=f'趋势线 (斜率={z[0]:.2f} mm/年)')
        
        # 5年滑动平均
        precip_ma5 = np.convolve(precip, np.ones(5)/5, mode='valid')
        years_ma5 = years[2:-2]
        ax1.plot(years_ma5, precip_ma5, 'g-', linewidth=2, label='5年滑动平均')
        
        ax1.set_xlabel('年份', fontsize=11)
        ax1.set_ylabel('年降水量 (mm)', fontsize=11)
        ax1.set_title(f'降水趋势分析\nMK检验: Z={Z_p:.2f}, 趋势={trend_p}, p={p_p:.3f}',
                     fontsize=13, fontweight='bold')
        ax1.legend()
        ax1.grid(True, alpha=0.3)
        
        # 2. 气温趋势分析
        ax2 = axes[0, 1]
        
        Z_t, trend_t, p_t = ClimateChangeImpact.mann_kendall_test(temp)
        
        ax2.plot(years, temp, 'ro-', linewidth=1, markersize=4, alpha=0.6, label='年平均气温')
        
        z_t = np.polyfit(years, temp, 1)
        t_fit = np.poly1d(z_t)
        ax2.plot(years, t_fit(years), 'b--', linewidth=2.5, 
                label=f'趋势线 (斜率={z_t[0]:.3f} °C/年)')
        
        temp_ma5 = np.convolve(temp, np.ones(5)/5, mode='valid')
        ax2.plot(years_ma5, temp_ma5, 'orange', linewidth=2, label='5年滑动平均')
        
        ax2.set_xlabel('年份', fontsize=11)
        ax2.set_ylabel('年平均气温 (°C)', fontsize=11)
        ax2.set_title(f'气温趋势分析\nMK检验: Z={Z_t:.2f}, 趋势={trend_t}, p={p_t:.3f}',
                     fontsize=13, fontweight='bold')
        ax2.legend()
        ax2.grid(True, alpha=0.3)
        
        # 3. 温度vs蒸散发
        ax3 = axes[1, 0]
        
        # 模拟ET0变化
        T_range = np.linspace(10, 30, 100)
        ET0_values = []
        
        for T in T_range:
            ET0 = ClimateChangeImpact.penman_monteith_et0(
                T, RH=60, u2=2, Rs=20, lat=30, J=180)
            ET0_values.append(ET0)
        
        ET0_values = np.array(ET0_values)
        
        ax3.plot(T_range, ET0_values, 'b-', linewidth=2.5)
        
        # 标注当前气温
        current_T = np.mean(temp)
        current_ET0 = ClimateChangeImpact.penman_monteith_et0(
            current_T, RH=60, u2=2, Rs=20, lat=30, J=180)
        ax3.scatter([current_T], [current_ET0], color='r', s=150, zorder=5, marker='*',
                   label=f'当前：T={current_T:.1f}°C, ET₀={current_ET0:.2f}mm/d')
        
        # 未来情景
        future_T = current_T + 2  # 升温2°C
        future_ET0 = ClimateChangeImpact.penman_monteith_et0(
            future_T, RH=60, u2=2, Rs=20, lat=30, J=180)
        ax3.scatter([future_T], [future_ET0], color='orange', s=150, zorder=5, marker='^',
                   label=f'未来(+2°C): ET₀={future_ET0:.2f}mm/d')
        
        ax3.set_xlabel('气温 (°C)', fontsize=11)
        ax3.set_ylabel('参考蒸散发 ET₀ (mm/day)', fontsize=11)
        ax3.set_title('气温对蒸散发的影响', fontsize=13, fontweight='bold')
        ax3.legend()
        ax3.grid(True, alpha=0.3)
        
        # 4. 极端降水GEV分布
        ax4 = axes[1, 1]
        
        # 提取年最大降水（模拟）
        annual_max = np.random.gamma(30, 3, len(years))
        
        params, return_levels = ClimateChangeImpact.gev_fit(annual_max)
        
        # 绘制经验频率
        sorted_data = np.sort(annual_max)[::-1]
        n = len(sorted_data)
        empirical_p = np.arange(1, n+1) / (n + 1)
        empirical_T = 1 / (1 - empirical_p)
        
        ax4.scatter(empirical_T, sorted_data, color='blue', s=40, alpha=0.6, label='观测值')
        
        # 绘制拟合曲线
        T_plot = np.logspace(0, 2.5, 100)
        p_plot = 1 - 1 / T_plot
        fitted_values = stats.genextreme.ppf(p_plot, *params)
        
        ax4.plot(T_plot, fitted_values, 'r-', linewidth=2.5, label='GEV拟合')
        
        # 标注重现期水平
        for T, x in return_levels.items():
            if T in [10, 50, 100]:
                ax4.scatter([T], [x], s=100, zorder=5, marker='s')
                ax4.text(T*1.1, x, f'{T}年\n{x:.1f}mm', fontsize=9, va='center')
        
        ax4.set_xscale('log')
        ax4.set_xlabel('重现期 (年)', fontsize=11)
        ax4.set_ylabel('年最大日降水 (mm)', fontsize=11)
        ax4.set_title('极端降水频率分析（GEV分布）', fontsize=13, fontweight='bold')
        ax4.legend()
        ax4.grid(True, alpha=0.3, which='both')
        
        plt.tight_layout()
        plt.savefig('climate_change_impact.png', dpi=300)
        plt.show()

# 示例1：Mann-Kendall趋势检验
print("="*60)
print("示例1：Mann-Kendall趋势检验")
print("="*60)

# 模拟50年降水数据（有上升趋势）
np.random.seed(42)
years = np.arange(1970, 2020)
precip = 600 + 2 * (years - 1970) + np.random.normal(0, 50, len(years))

Z, trend, p_value = ClimateChangeImpact.mann_kendall_test(precip)

print(f"时间序列: {years[0]}-{years[-1]} ({len(years)}年)")
print(f"平均降水量: {np.mean(precip):.1f} mm")

print(f"\nMann-Kendall检验结果:")
print(f"  标准化统计量 Z = {Z:.3f}")
print(f"  趋势: {trend}")
print(f"  p值: {p_value:.4f}")

if abs(Z) > 2.58:
    print(f"  显著性: 99%置信水平显著")
elif abs(Z) > 1.96:
    print(f"  显著性: 95%置信水平显著")
else:
    print(f"  显著性: 无显著趋势")

# 示例2：Penman-Monteith ET0计算
print("\n" + "="*60)
print("示例2：参考蒸散发计算与气候变化影响")
print("="*60)

# 基准气候条件
T_baseline = 20  # °C
RH = 65         # %
u2 = 2.5        # m/s
Rs = 22         # MJ/m²/day
lat = 30        # °N
J = 180         # 6月底

ET0_baseline = ClimateChangeImpact.penman_monteith_et0(T_baseline, RH, u2, Rs, lat, J)

print(f"基准气候条件:")
print(f"  气温 T = {T_baseline}°C")
print(f"  相对湿度 RH = {RH}%")
print(f"  风速 u2 = {u2} m/s")
print(f"  太阳辐射 Rs = {Rs} MJ/m²/day")

print(f"\n基准ET0 = {ET0_baseline:.2f} mm/day")

# 气候变化情景
scenarios = {
    'RCP2.6': 1.5,
    'RCP4.5': 2.5,
    'RCP8.5': 4.5
}

print(f"\n气候变化情景分析:")
print(f"{'情景':<10s} {'升温(°C)':<12s} {'ET0(mm/d)':<15s} {'变化率':<10s}")
print("-" * 52)

for scenario, delta_T in scenarios.items():
    T_future = T_baseline + delta_T
    ET0_future = ClimateChangeImpact.penman_monteith_et0(T_future, RH, u2, Rs, lat, J)
    change_rate = (ET0_future - ET0_baseline) / ET0_baseline * 100
    
    print(f"{scenario:<10s} {delta_T:<12.1f} {ET0_future:<15.2f} {change_rate:+.1f}%")

# 示例3：径流弹性系数
print("\n" + "="*60)
print("示例3：径流对降水的弹性系数")
print("="*60)

P_values = [500, 700, 900, 1100, 1300]
E0 = 800  # mm

print(f"潜在蒸散发 E0 = {E0} mm")
print(f"\n{'降水P(mm)':<15s} {'弹性系数ε':<15s} {'含义':<40s}")
print("-" * 70)

for P in P_values:
    epsilon = ClimateChangeImpact.runoff_elasticity(P, E0)
    
    # 如果降水增加10%，径流增加多少？
    delta_Q_percent = epsilon * 10
    
    print(f"{P:<15d} {epsilon:<15.2f} P增加10% → Q增加{delta_Q_percent:.1f}%")

# 示例4：极端降水指数
print("\n" + "="*60)
print("示例4：极端降水指数计算")
print("="*60)

# 模拟一年365天日降水
np.random.seed(123)
n_wet_days = 100
precip_wet = np.random.gamma(2, 5, n_wet_days)
precip_daily = np.zeros(365)
wet_indices = np.random.choice(365, n_wet_days, replace=False)
precip_daily[wet_indices] = precip_wet

indices = ClimateChangeImpact.extreme_indices(precip_daily)

print(f"年降水量: {np.sum(precip_daily):.1f} mm")
print(f"\n极端降水指数:")
print(f"  R10 (≥10mm天数): {indices['R10']} 天")
print(f"  R20 (≥20mm天数): {indices['R20']} 天")
print(f"  R95p (95分位以上总量): {indices['R95p']:.1f} mm")
print(f"  CDD (最长连续干旱日): {indices['CDD']} 天")
print(f"  CWD (最长连续湿润日): {indices['CWD']} 天")

# 示例5：GEV分布拟合
print("\n" + "="*60)
print("示例5：极端降水频率分析")
print("="*60)

# 模拟50年年最大日降水
annual_max_precip = np.random.gamma(25, 3.5, 50)

params, return_levels = ClimateChangeImpact.gev_fit(annual_max_precip)

print(f"GEV分布参数:")
print(f"  形状参数 ξ = {params[0]:.3f}")
print(f"  位置参数 μ = {params[1]:.2f}")
print(f"  尺度参数 σ = {params[2]:.2f}")

print(f"\n不同重现期设计值:")
print(f"{'重现期(年)':<15s} {'设计降水(mm)':<18s}")
print("-" * 35)

for T, x in return_levels.items():
    print(f"{T:<15d} {x:<18.2f}")

# 绘制综合分析图
print("\n绘制气候变化影响综合分析图...")

# 模拟气温数据
temp = 15 + 0.03 * (years - 1970) + np.random.normal(0, 0.8, len(years))

ClimateChangeImpact.plot_climate_change_analysis(years, precip, temp)
```

---

## 七、典型考题

### 【例题1】Mann-Kendall检验（12分）

**题目**：某站30年降水序列，$S=180$，$n=30$，判断趋势显著性。

**【解答】**

$$\text{Var}(S) = \frac{30 \times 29 \times 65}{18} = 2808.33$$

$$Z = \frac{180 - 1}{\sqrt{2808.33}} = 3.38$$

$|Z| = 3.38 > 2.58$，在99%置信水平下，存在显著上升趋势。

---

### 【例题2】径流弹性系数（15分）

**题目**：$P=800$mm，$E_0=600$mm，降水增加15%，求径流变化率。

**【解答】**

$$\epsilon_{Q,P} = 1 + \frac{E_0}{P} = 1 + \frac{600}{800} = 1.75$$

$$\Delta Q\% = \epsilon_{Q,P} \times \Delta P\% = 1.75 \times 15\% = 26.25\%$$

径流增加26.25%。

---

**本章重点**：
- Mann-Kendall趋势检验
- Penman-Monteith公式
- 径流弹性系数
- 极端事件GEV分布

**下一章**：流域水文模型率定与验证
