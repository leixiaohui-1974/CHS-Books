# 第2章：水文统计理论

**难度**: ⭐⭐⭐⭐⭐  
**应用**: 设计洪水、水资源评价

---

## 一、水文随机变量

### 1.1 特性

1. **随机性**：径流不确定
2. **周期性**：季节变化
3. **趋势性**：长期变化
4. **持续性**：自相关

### 1.2 统计参数

**均值**：
$$\bar{x} = \frac{1}{n}\sum_{i=1}^n x_i$$

**标准差**：
$$\sigma = \sqrt{\frac{1}{n}\sum_{i=1}^n (x_i - \bar{x})^2}$$

**变差系数**：
$$C_v = \frac{\sigma}{\bar{x}}$$

**偏态系数**：
$$C_s = \frac{n}{(n-1)(n-2)\sigma^3}\sum_{i=1}^n (x_i - \bar{x})^3$$

---

## 二、概率分布

### 2.1 皮尔逊III型（P-III）

**概率密度**：
$$f(x) = \frac{\beta^\alpha}{\Gamma(\alpha)}(x-a_0)^{\alpha-1}e^{-\beta(x-a_0)}$$

**参数关系**（中国水文）：
- $\bar{x}$：均值
- $C_v$：变差系数
- $C_s = 2C_v$（经验关系）

**标准化变量**：
$$\Phi = \frac{x - \bar{x}}{\sigma C_v}$$

### 2.2 对数正态分布

**适用**：$C_v < 0.5$的序列

取对数后服从正态分布

### Python实现

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy import stats
from scipy.special import gamma

class HydrologicalStatistics:
    """水文统计分析"""
    
    @staticmethod
    def statistical_parameters(data):
        """
        计算统计参数
        
        参数:
            data: 水文序列
        
        返回:
            mean, std, Cv, Cs
        """
        n = len(data)
        
        # 均值
        mean = np.mean(data)
        
        # 标准差
        std = np.std(data, ddof=1)  # 无偏估计
        
        # 变差系数
        Cv = std / mean
        
        # 偏态系数
        Cs = stats.skew(data, bias=False)
        
        return mean, std, Cv, Cs
    
    @staticmethod
    def pearson3_fit(data, Cs_ratio=2):
        """
        皮尔逊III型拟合
        
        参数:
            data: 样本数据
            Cs_ratio: Cs/Cv比值（默认2）
        
        返回:
            拟合参数
        """
        mean, std, Cv, Cs_sample = HydrologicalStatistics.statistical_parameters(data)
        
        # 调整Cs（可选：使用Cs=2Cv经验关系）
        Cs = Cs_ratio * Cv
        
        # 皮尔逊III型参数
        # α = 4/Cs²
        # β = 2/(σ·Cs)
        # a0 = x̄ - 2σ/Cs
        
        alpha = 4 / Cs**2
        beta = 2 / (std * Cs)
        a0 = mean - 2 * std / Cs
        
        return {
            'mean': mean,
            'std': std,
            'Cv': Cv,
            'Cs': Cs,
            'alpha': alpha,
            'beta': beta,
            'a0': a0
        }
    
    @staticmethod
    def pearson3_quantile(params, P):
        """
        皮尔逊III型分位数（设计值）
        
        参数:
            params: 拟合参数字典
            P: 频率（如0.01表示1%）
        
        返回:
            设计值
        """
        # 使用Φ值表（查表或近似）
        mean = params['mean']
        Cv = params['Cv']
        Cs = params['Cs']
        
        # Φ值近似（基于Cs和P）
        # 这里使用scipy的gamma分布
        alpha = params['alpha']
        scale = 1 / params['beta']
        loc = params['a0']
        
        x_P = stats.gamma.ppf(1 - P, alpha, loc=loc, scale=scale)
        
        return x_P
    
    @staticmethod
    def frequency_analysis(data, probabilities=[0.01, 0.02, 0.05, 0.1, 0.2]):
        """
        频率分析
        
        参数:
            data: 水文序列
            probabilities: 需要计算的频率点
        
        返回:
            设计值字典
        """
        # 拟合P-III
        params = HydrologicalStatistics.pearson3_fit(data)
        
        # 计算设计值
        design_values = {}
        for P in probabilities:
            x_P = HydrologicalStatistics.pearson3_quantile(params, P)
            design_values[P] = x_P
        
        return design_values, params
    
    @staticmethod
    def plot_frequency_curve(data, probabilities=None):
        """绘制频率曲线"""
        if probabilities is None:
            probabilities = [0.01, 0.02, 0.05, 0.1, 0.2, 0.5]
        
        # 经验频率
        data_sorted = np.sort(data)[::-1]  # 降序
        n = len(data)
        empirical_P = np.arange(1, n+1) / (n + 1)
        
        # 拟合曲线
        design_values, params = HydrologicalStatistics.frequency_analysis(
            data, probabilities
        )
        
        # 理论曲线
        P_theory = np.linspace(0.001, 0.99, 200)
        x_theory = [HydrologicalStatistics.pearson3_quantile(params, p)
                   for p in P_theory]
        
        fig, axes = plt.subplots(1, 2, figsize=(14, 6))
        
        # 频率曲线（算术坐标）
        axes[0].plot(empirical_P * 100, data_sorted, 'bo',
                    markersize=6, label='经验点')
        axes[0].plot(P_theory * 100, x_theory, 'r-',
                    linewidth=2, label='P-III拟合')
        
        # 标注设计值
        for P, x in design_values.items():
            axes[0].plot(P * 100, x, 'gs', markersize=10)
            axes[0].text(P * 100, x, f'{P*100:.0f}%\n{x:.0f}',
                        fontsize=8, ha='left')
        
        axes[0].set_xlabel('频率 P (%)', fontsize=12)
        axes[0].set_ylabel('流量 (m³/s)', fontsize=12)
        axes[0].set_title('水文频率曲线', fontsize=14)
        axes[0].legend()
        axes[0].grid(True, alpha=0.3)
        
        # 频率曲线（半对数）
        axes[1].semilogx(empirical_P * 100, data_sorted, 'bo',
                        markersize=6, label='经验点')
        axes[1].semilogx(P_theory * 100, x_theory, 'r-',
                        linewidth=2, label='P-III拟合')
        
        for P, x in design_values.items():
            axes[1].plot(P * 100, x, 'gs', markersize=10)
        
        axes[1].set_xlabel('频率 P (%) [对数坐标]', fontsize=12)
        axes[1].set_ylabel('流量 (m³/s)', fontsize=12)
        axes[1].set_title('水文频率曲线（半对数）', fontsize=14)
        axes[1].legend()
        axes[1].grid(True, alpha=0.3)
        
        plt.tight_layout()
        plt.savefig('frequency_curve.png', dpi=300)
        plt.show()
        
        # 打印参数
        print(f"\n统计参数:")
        print(f"  均值 x̄ = {params['mean']:.2f}")
        print(f"  标准差 σ = {params['std']:.2f}")
        print(f"  变差系数 Cv = {params['Cv']:.3f}")
        print(f"  偏态系数 Cs = {params['Cs']:.3f}")
        
        print(f"\n设计值:")
        for P, x in design_values.items():
            T = 1 / P
            print(f"  P={P*100:5.1f}% (T={T:5.0f}年): {x:.1f}")

# 示例
print("="*60)
print("水文频率分析")
print("="*60)

# 模拟年最大流量序列（30年）
np.random.seed(42)
# 生成具有偏态的数据
base = 1000
flow_data = base + np.random.gamma(2, 300, 30)

print(f"年最大流量序列（m³/s）:")
for i, q in enumerate(flow_data, 1):
    print(f"  第{i:2d}年: {q:6.1f}", end='')
    if i % 5 == 0:
        print()

# 统计参数
mean, std, Cv, Cs = HydrologicalStatistics.statistical_parameters(flow_data)

print(f"\n\n基本统计:")
print(f"  样本容量 n = {len(flow_data)}")
print(f"  均值 x̄ = {mean:.2f} m³/s")
print(f"  标准差 σ = {std:.2f} m³/s")
print(f"  变差系数 Cv = {Cv:.3f}")
print(f"  偏态系数 Cs = {Cs:.3f}")

# 频率分析
print("\n" + "="*60)
print("频率分析")
print("="*60)

HydrologicalStatistics.plot_frequency_curve(flow_data)

# 参数敏感性分析
print("\n" + "="*60)
print("参数敏感性分析")
print("="*60)

Cv_values = [0.2, 0.3, 0.4, 0.5]
P_test = 0.01  # 1%频率

print(f"\n不同Cv下的1%设计洪水（Cs=2Cv）:")
print(f"{'Cv':>8s} {'Cs':>8s} {'Q1%(m³/s)':>15s} {'Q1%/x̄':>10s}")
print("-" * 45)

for Cv_val in Cv_values:
    # 构造参数
    Cs_val = 2 * Cv_val
    std_val = Cv_val * mean
    
    params_test = {
        'mean': mean,
        'std': std_val,
        'Cv': Cv_val,
        'Cs': Cs_val,
        'alpha': 4 / Cs_val**2,
        'beta': 2 / (std_val * Cs_val),
        'a0': mean - 2 * std_val / Cs_val
    }
    
    Q_1 = HydrologicalStatistics.pearson3_quantile(params_test, P_test)
    
    print(f"{Cv_val:8.2f} {Cs_val:8.2f} {Q_1:15.1f} {Q_1/mean:10.2f}")
```

---

## 三、适线方法

### 3.1 矩法

用样本矩估计总体参数

### 3.2 最大似然法

$$L = \prod_{i=1}^n f(x_i; \theta)$$

最大化似然函数

### 3.3 权函数法

加权最小二乘

---

## 四、一致性与代表性

### 4.1 一致性检验

**Mann-Kendall检验**：检验趋势

**游程检验**：检验跳跃

### 4.2 代表性

**取样误差**：
$$\varepsilon = \frac{C_v}{\sqrt{n}}$$

样本越大，误差越小

---

## 五、典型考题

### 【例题】设计洪水计算

**题目**：30年洪峰资料，均值1200m³/s，Cv=0.4，Cs=2Cv。求100年一遇设计洪水。

**解**：

P = 1/100 = 0.01

Cs = 2×0.4 = 0.8

查P-III表或计算：Φ(Cs=0.8, P=1%) ≈ 3.0

$$Q_{1\%} = \bar{Q}(1 + C_v \Phi) = 1200 \times (1 + 0.4 \times 3.0) = 2640 \text{ m}^3/\text{s}$$

---

**本章重点**：
- 统计参数计算
- 皮尔逊III型分布
- 频率曲线绘制
- 设计值推求
