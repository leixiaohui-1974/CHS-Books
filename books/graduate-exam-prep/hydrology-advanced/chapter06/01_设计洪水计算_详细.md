# 第6章：设计洪水计算

**学习时间**: 4小时  
**考试频率**: ⭐⭐⭐⭐⭐  
**难度**: ⭐⭐⭐⭐⭐

---

## 一、设计洪水概述

### 1.1 基本概念

**设计洪水**：工程设计采用的具有一定标准（重现期）的洪水过程

**设计标准**：
- 防洪标准：100年、50年、20年
- 校核标准：1000年、500年、300年

**设计成果**：
- 设计洪峰流量$Q_p$
- 设计洪量$W$
- 设计洪水过程线$Q(t)$

### 1.2 设计方法

**(1) 由流量资料推求**：
- 频率分析法（主要方法）
- 地区综合法

**(2) 由暴雨资料推求**：
- 推理公式法
- 单位线法

---

## 二、设计洪峰流量推求

### 2.1 频率分析法

**理论基础**：P-III型分布

$$f(x) = \frac{\beta^\alpha}{\Gamma(\alpha)}(x-a_0)^{\alpha-1}e^{-\beta(x-a_0)}$$

**实用公式**：

$$Q_p = \bar{Q}(1 + C_v \Phi_p)$$

**参数**：
- $\bar{Q}$：多年平均洪峰流量
- $C_v$：变差系数
- $\Phi_p$：频率模比系数

**频率模比系数查算**：

$$\Phi_p = f(C_v, C_s/C_v, p)$$

其中$C_s$为偏态系数，常取$C_s = 2C_v$

### 2.2 经验频率计算

**数学期望公式**：

$$P_m = \frac{m}{n+1}$$

其中$m$为项次（从大到小），$n$为样本容量

**威布尔公式**：

$$P_m = \frac{m}{n+1}$$

**海森公式**：

$$P_m = \frac{m-0.44}{n+0.12}$$

### 2.3 参数估计

**(1) 矩法**：

$$\bar{x} = \frac{1}{n}\sum x_i$$

$$C_v = \frac{\sqrt{\frac{1}{n}\sum(x_i-\bar{x})^2}}{\bar{x}}$$

**(2) 适线法**：

通过点据配线调整$C_v$和$C_s$

---

## 三、设计洪量推求

### 3.1 同频率放大

**原理**：洪峰与洪量具有相关性

$$W_T = \bar{W}(1 + C_{vW} \Phi_T)$$

**关系**：
- $C_{vW}$通常小于$C_{vQ}$
- $C_{vW} \approx 0.6 \sim 0.8 C_{vQ}$

### 3.2 洪量计算

**时段洪量**：

$$W_t = \int_0^t Q(\tau)d\tau$$

**最大$t$日洪量**：

$$W_{max,t} = \max\{W_{t,i}\}$$

---

## 四、设计洪水过程线

### 4.1 同频率放大法

**步骤**：
1. 选择典型洪水过程
2. 计算放大倍数$k_Q = Q_{p,T} / Q_{p,实测}$
3. 逐点放大$Q_T(t) = k_Q \cdot Q_{实测}(t)$

**修正**：
- 放大后洪量检验
- 洪峰出现时间调整

### 4.2 综合单位线法

**公式**：

$$Q(t) = \sum_{i=1}^n P_i \cdot U(t-i\Delta t)$$

**参数**：
- $P_i$：各时段雨量
- $U(t)$：单位线

---

## 五、地区综合法

### 5.1 经验公式

**小流域**：

$$Q_p = 0.278 \psi S P F$$

**参数**：
- $\psi$：径流系数
- $S$：流域面积（km²）
- $P$：设计暴雨（mm）
- $F$：地形系数

### 5.2 瞬时单位线

**Nash模型**：

$$u(t) = \frac{1}{K\Gamma(n)}(\frac{t}{K})^{n-1}e^{-t/K}$$

**参数**：
- $K$：滞时参数
- $n$：河槽储蓄参数

---

## 六、Python实现

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy import stats, special
from scipy.optimize import minimize
from scipy.interpolate import interp1d

class DesignFlood:
    """设计洪水计算"""
    
    def __init__(self):
        pass
    
    def empirical_frequency(self, data, method='weibull'):
        """
        经验频率计算
        
        参数:
            data: 洪峰流量序列
            method: 'weibull', 'hazen'
        """
        data_sorted = np.sort(data)[::-1]  # 从大到小
        n = len(data)
        m = np.arange(1, n + 1)
        
        if method == 'weibull':
            P = m / (n + 1)
        elif method == 'hazen':
            P = (m - 0.44) / (n + 0.12)
        else:
            P = m / (n + 1)
        
        return data_sorted, P * 100  # 转换为百分数
    
    def statistics_parameters(self, data):
        """
        统计参数计算（矩法）
        
        返回: mean, Cv, Cs
        """
        n = len(data)
        mean = np.mean(data)
        
        # 变差系数
        std = np.std(data, ddof=1)
        Cv = std / mean
        
        # 偏态系数（矩法）
        m3 = np.mean((data - mean)**3)
        Cs = m3 / std**3
        
        return mean, Cv, Cs
    
    def pearson3_quantile(self, mean, Cv, Cs, p):
        """
        P-III型频率模比系数
        
        参数:
            mean: 均值
            Cv: 变差系数
            Cs: 偏态系数
            p: 频率（小数形式，如0.01表示1%）
        
        返回: Qp设计值
        """
        # 简化：使用查表法的近似公式
        # 标准正态分位数
        u_p = stats.norm.ppf(1 - p)
        
        # Cs对频率模比系数的修正
        # 近似公式（工程常用）
        Phi_p = u_p + (u_p**2 - 1) * Cs / 6 + (u_p**3 - 3*u_p) * Cs**2 / 72
        
        # 设计值
        Qp = mean * (1 + Cv * Phi_p)
        
        return Qp
    
    def design_peak_flow(self, data, T, Cs_Cv_ratio=2):
        """
        设计洪峰流量计算
        
        参数:
            data: 历史洪峰流量序列
            T: 重现期（年）
            Cs_Cv_ratio: Cs/Cv比值（默认2）
        """
        # 统计参数
        mean, Cv, Cs = self.statistics_parameters(data)
        
        # 调整Cs（可选）
        Cs = Cs_Cv_ratio * Cv
        
        # 频率
        p = 1 / T
        
        # 设计洪峰
        Qp = self.pearson3_quantile(mean, Cv, Cs, p)
        
        return {
            'Qp': Qp,
            'mean': mean,
            'Cv': Cv,
            'Cs': Cs,
            'T': T,
            'p': p * 100
        }
    
    def amplify_flood_hydrograph(self, t, Q_observed, Qp_design):
        """
        同频率放大法
        
        参数:
            t: 时间序列
            Q_observed: 实测洪水过程
            Qp_design: 设计洪峰流量
        """
        Qp_observed = np.max(Q_observed)
        k = Qp_design / Qp_observed
        
        Q_design = k * Q_observed
        
        return Q_design, k
    
    def flood_volume(self, t, Q):
        """
        计算洪量
        
        参数:
            t: 时间（小时）
            Q: 流量（m³/s）
        
        返回: 洪量（万m³）
        """
        # 梯形积分
        W = np.trapz(Q, t) * 3600 / 1e4  # 转换为万m³
        return W
    
    def nash_iuh(self, t, K, n):
        """
        Nash瞬时单位线
        
        u(t) = [1/(K·Γ(n))] · (t/K)^(n-1) · exp(-t/K)
        
        参数:
            t: 时间数组
            K: 滞时参数
            n: 河槽储蓄参数
        """
        u = (1 / (K * special.gamma(n))) * (t / K)**(n-1) * np.exp(-t / K)
        return u
    
    def rational_formula(self, psi, S, P):
        """
        推理公式（小流域）
        
        Qp = 0.278·ψ·S·P
        
        参数:
            psi: 径流系数
            S: 流域面积（km²）
            P: 设计暴雨强度（mm/h）
        """
        Qp = 0.278 * psi * S * P
        return Qp
    
    def plot_design_flood_analysis(self, data, T_values=[10, 20, 50, 100]):
        """绘制设计洪水分析图"""
        fig, axes = plt.subplots(2, 2, figsize=(16, 12))
        
        # 1. 经验频率点据与理论曲线
        ax1 = axes[0, 0]
        
        # 经验频率
        Q_sorted, P_emp = self.empirical_frequency(data)
        
        ax1.scatter(P_emp, Q_sorted, s=100, alpha=0.7, color='blue',
                   edgecolors='black', linewidth=1.5, label='经验点据',
                   zorder=3)
        
        # 理论曲线（P-III）
        mean, Cv, Cs = self.statistics_parameters(data)
        Cs = 2 * Cv  # 调整
        
        P_theory = np.logspace(-2, 2, 200)  # 0.01%~100%
        Q_theory = []
        
        for p in P_theory:
            Qp = self.pearson3_quantile(mean, Cv, Cs, p / 100)
            Q_theory.append(Qp)
        
        ax1.plot(P_theory, Q_theory, 'r-', linewidth=2.5,
                label=f'P-III理论线\nCv={Cv:.2f}, Cs={Cs:.2f}')
        
        # 标注设计值
        for T in T_values:
            result = self.design_peak_flow(data, T, Cs_Cv_ratio=2)
            ax1.plot(result['p'], result['Qp'], 'go', markersize=12,
                    zorder=4)
            ax1.text(result['p'], result['Qp'] * 1.05,
                    f"{T}年一遇\n{result['Qp']:.0f}m³/s",
                    ha='center', fontsize=9,
                    bbox=dict(boxstyle='round', facecolor='yellow', alpha=0.7))
        
        ax1.set_xscale('log')
        ax1.set_xlabel('频率 P (%)', fontsize=11)
        ax1.set_ylabel('洪峰流量 Q (m³/s)', fontsize=11)
        ax1.set_title('频率曲线与设计洪峰', fontsize=13, fontweight='bold')
        ax1.legend()
        ax1.grid(True, alpha=0.3, which='both')
        ax1.invert_xaxis()
        
        # 2. 设计洪水过程线（同频率放大）
        ax2 = axes[0, 1]
        
        # 模拟典型洪水过程
        t_obs = np.arange(0, 72, 1)
        Qp_obs = 5000
        t_peak = 24
        
        # 简化三角形洪水过程
        Q_obs = np.zeros_like(t_obs, dtype=float)
        rising = t_obs <= t_peak
        Q_obs[rising] = Qp_obs * (t_obs[rising] / t_peak)
        Q_obs[~rising] = Qp_obs * (1 - (t_obs[~rising] - t_peak) / (72 - t_peak))
        
        ax2.plot(t_obs, Q_obs, 'b-', linewidth=2, label='典型洪水过程', alpha=0.7)
        
        # 放大到不同标准
        colors_T = ['orange', 'red', 'purple']
        T_design = [20, 50, 100]
        
        for T, color in zip(T_design, colors_T):
            result = self.design_peak_flow(data, T, Cs_Cv_ratio=2)
            Q_design, k = self.amplify_flood_hydrograph(t_obs, Q_obs, result['Qp'])
            
            W_design = self.flood_volume(t_obs, Q_design)
            
            ax2.plot(t_obs, Q_design, color=color, linewidth=2.5,
                    label=f"{T}年一遇\nQp={result['Qp']:.0f}m³/s, W={W_design:.0f}万m³")
        
        ax2.set_xlabel('时间 t (h)', fontsize=11)
        ax2.set_ylabel('流量 Q (m³/s)', fontsize=11)
        ax2.set_title('设计洪水过程线（同频率放大法）', fontsize=13, fontweight='bold')
        ax2.legend()
        ax2.grid(True, alpha=0.3)
        
        # 3. Nash瞬时单位线
        ax3 = axes[1, 0]
        
        t_iuh = np.linspace(0, 50, 500)
        
        params_nash = [(5, 2), (5, 3), (8, 3)]
        colors_nash = ['blue', 'green', 'red']
        
        for (K, n), color in zip(params_nash, colors_nash):
            u = self.nash_iuh(t_iuh, K, n)
            ax3.plot(t_iuh, u, color=color, linewidth=2.5,
                    label=f'K={K}, n={n}')
        
        ax3.set_xlabel('时间 t (h)', fontsize=11)
        ax3.set_ylabel('瞬时单位线 u(t)', fontsize=11)
        ax3.set_title('Nash瞬时单位线', fontsize=13, fontweight='bold')
        ax3.legend()
        ax3.grid(True, alpha=0.3)
        
        # 4. 统计参数敏感性分析
        ax4 = axes[1, 1]
        
        # 固定Cv，变化Cs
        Cv_fixed = 0.3
        Cs_range = np.linspace(0.3, 0.9, 5)
        p_test = 1  # 1%频率
        
        colors_Cs = plt.cm.viridis(np.linspace(0, 1, len(Cs_range)))
        
        for Cs_val, color in zip(Cs_range, colors_Cs):
            P_sens = np.logspace(-2, 2, 100)
            Q_sens = []
            
            for p in P_sens:
                Qp = self.pearson3_quantile(mean, Cv_fixed, Cs_val, p / 100)
                Q_sens.append(Qp)
            
            ax4.plot(P_sens, Q_sens, color=color, linewidth=2,
                    label=f'Cs={Cs_val:.1f}')
        
        ax4.set_xscale('log')
        ax4.set_xlabel('频率 P (%)', fontsize=11)
        ax4.set_ylabel('设计洪峰 Qp (m³/s)', fontsize=11)
        ax4.set_title(f'偏态系数Cs敏感性分析\n(Cv={Cv_fixed}固定)',
                     fontsize=13, fontweight='bold')
        ax4.legend()
        ax4.grid(True, alpha=0.3, which='both')
        ax4.invert_xaxis()
        
        plt.tight_layout()
        plt.savefig('design_flood_analysis.png', dpi=300)
        plt.show()

# 示例计算
print("="*60)
print("设计洪水计算")
print("="*60)

df = DesignFlood()

# 1. 历史洪峰流量序列（m³/s）
print("1. 历史洪峰流量统计:")
Q_data = np.array([
    3500, 4200, 2800, 5100, 3800, 4500, 3200, 6000, 4800, 3600,
    5500, 4000, 3400, 5800, 4300, 3900, 5200, 3700, 4600, 4100
])

print(f"  样本容量 n = {len(Q_data)}")

mean, Cv, Cs = df.statistics_parameters(Q_data)

print(f"  均值 Q̄ = {mean:.1f} m³/s")
print(f"  变差系数 Cv = {Cv:.3f}")
print(f"  偏态系数 Cs = {Cs:.3f}")
print(f"  Cs/Cv = {Cs/Cv:.2f}")

# 2. 设计洪峰流量
print("\n" + "="*60)
print("2. 设计洪峰流量:")

T_standards = [10, 20, 50, 100, 1000]

for T in T_standards:
    result = df.design_peak_flow(Q_data, T, Cs_Cv_ratio=2)
    
    print(f"\n  {T}年一遇（p={result['p']:.2f}%）:")
    print(f"    设计洪峰 Qp = {result['Qp']:.0f} m³/s")
    print(f"    放大倍数 = {result['Qp']/mean:.2f}")

# 3. 设计洪水过程
print("\n" + "="*60)
print("3. 设计洪水过程线（50年一遇）:")

# 典型洪水过程（简化）
t_typical = np.array([0, 6, 12, 18, 24, 30, 36, 42, 48, 54, 60, 66, 72])
Q_typical = np.array([500, 1500, 3000, 4500, 5000, 4200, 3000, 2000, 1200, 800, 500, 300, 200])

result_50 = df.design_peak_flow(Q_data, 50, Cs_Cv_ratio=2)
Q_design_50, k_50 = df.amplify_flood_hydrograph(t_typical, Q_typical, result_50['Qp'])

W_typical = df.flood_volume(t_typical, Q_typical)
W_design_50 = df.flood_volume(t_typical, Q_design_50)

print(f"  典型洪水:")
print(f"    洪峰 = {np.max(Q_typical):.0f} m³/s")
print(f"    洪量 = {W_typical:.0f} 万m³")
print(f"\n  设计洪水（50年）:")
print(f"    设计洪峰 = {result_50['Qp']:.0f} m³/s")
print(f"    放大倍数 k = {k_50:.2f}")
print(f"    设计洪量 = {W_design_50:.0f} 万m³")

# 4. 推理公式（小流域）
print("\n" + "="*60)
print("4. 推理公式（小流域设计洪峰）:")

psi = 0.6  # 径流系数
S = 15     # 流域面积（km²）
P = 80     # 设计暴雨强度（mm/h）

Qp_rational = df.rational_formula(psi, S, P)

print(f"  径流系数 ψ = {psi}")
print(f"  流域面积 S = {S} km²")
print(f"  暴雨强度 P = {P} mm/h")
print(f"  设计洪峰 Qp = {Qp_rational:.1f} m³/s")

# 绘图
print("\n绘制设计洪水分析图...")
df.plot_design_flood_analysis(Q_data, T_values=[10, 20, 50, 100])
```

---

## 七、典型考题

### 【例题1】设计洪峰计算（15分）

**题目**：某站20年洪峰资料，$\bar{Q}=3500$m³/s，$C_v=0.35$，$C_s=2C_v$。求50年一遇设计洪峰。

**【解答】**

$p = 1/50 = 0.02$，$C_s = 0.70$

查P-III型频率表，$\Phi_{2\%} \approx 2.05$（$C_v=0.35$，$C_s/C_v=2$）

$$Q_p = \bar{Q}(1 + C_v \Phi_p) = 3500 \times (1 + 0.35 \times 2.05)$$

$$= 3500 \times 1.718 = 6013 \text{ m}^3\text{/s}$$

---

**本章重点**：
- P-III型频率分析
- 经验频率计算
- 同频率放大法
- Nash瞬时单位线

**下一章**：水文预报方法
