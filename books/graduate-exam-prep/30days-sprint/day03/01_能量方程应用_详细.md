# Day 3：能量方程与伯努利方程应用

**学习时间**: 4小时  
**必考指数**: ⭐⭐⭐⭐⭐

---

## 一、能量方程基本形式

### 1.1 理想流体（伯努利方程）

$$\frac{p}{\gamma} + \frac{v^2}{2g} + z = C$$

**三项含义**：
- **压强水头**：$\frac{p}{\gamma}$（单位重量流体的压强能）
- **流速水头**：$\frac{v^2}{2g}$（单位重量流体的动能）
- **位置水头**：$z$（单位重量流体的位能）

### 1.2 实际流体（能量方程）

**两断面间**：
$$\frac{p_1}{\gamma} + \frac{\alpha_1 v_1^2}{2g} + z_1 = \frac{p_2}{\gamma} + \frac{\alpha_2 v_2^2}{2g} + z_2 + h_w$$

- $\alpha$：动能修正系数（层流α=2.0，湍流α≈1.05）
- $h_w$：水头损失

### 1.3 能量线与水力坡度线

**总能量线（总水头线）**：
$$H = \frac{p}{\gamma} + \frac{v^2}{2g} + z$$

**测压管水头线（水力坡度线）**：
$$H_p = \frac{p}{\gamma} + z$$

**关系**：
$$H = H_p + \frac{v^2}{2g}$$

### Python实现

```python
import numpy as np
import matplotlib.pyplot as plt

class EnergyEquation:
    """能量方程计算"""
    
    def __init__(self, gamma=9810, g=9.81):
        self.gamma = gamma
        self.g = g
    
    def bernoulli_no_loss(self, p1, v1, z1, p2=None, v2=None, z2=None):
        """
        伯努利方程（无损失）
        
        已知一断面的3个量和另一断面的2个量，求第3个量
        
        参数:
            p1, v1, z1: 断面1的压强(Pa)、流速(m/s)、高程(m)
            p2, v2, z2: 断面2的对应量
        
        返回:
            未知量
        """
        # 断面1总水头
        H1 = p1/self.gamma + v1**2/(2*self.g) + z1
        
        # 根据已知量求未知量
        if p2 is None:
            # 求p2
            p2 = self.gamma * (H1 - v2**2/(2*self.g) - z2)
            return p2
        elif v2 is None:
            # 求v2
            v2 = np.sqrt(2*self.g*(H1 - p2/self.gamma - z2))
            return v2
        elif z2 is None:
            # 求z2
            z2 = H1 - p2/self.gamma - v2**2/(2*self.g)
            return z2
    
    def energy_equation_with_loss(self, p1, v1, z1, p2, v2, z2, 
                                   alpha1=1.0, alpha2=1.0):
        """
        实际流体能量方程
        
        计算水头损失
        
        返回:
            h_w: 水头损失 (m)
        """
        H1 = p1/self.gamma + alpha1*v1**2/(2*self.g) + z1
        H2 = p2/self.gamma + alpha2*v2**2/(2*self.g) + z2
        
        h_w = H1 - H2
        
        return h_w
    
    def orifice_flow(self, H, A, phi=0.62):
        """
        孔口出流
        
        Q = φ·A·√(2gH)
        
        参数:
            H: 作用水头 (m)
            A: 孔口面积 (m²)
            phi: 流量系数
        
        返回:
            Q: 流量 (m³/s)
        """
        v_theory = np.sqrt(2*self.g*H)
        Q = phi * A * v_theory
        
        return Q
    
    def weir_flow(self, H, b, m=0.4, weir_type='rectangular'):
        """
        堰流
        
        参数:
            H: 堰上水头 (m)
            b: 堰宽 (m)
            m: 流量系数
            weir_type: 'rectangular'矩形堰, 'triangular'三角堰
        
        返回:
            Q: 流量 (m³/s)
        """
        if weir_type == 'rectangular':
            # 矩形堰: Q = m·b·√(2g)·H^(3/2)
            Q = m * b * np.sqrt(2*self.g) * H**(3/2)
        
        elif weir_type == 'triangular':
            # 三角堰（90°）: Q = (8/15)·m·√(2g)·H^(5/2)
            Q = (8/15) * m * np.sqrt(2*self.g) * H**(5/2)
        
        return Q
    
    def venturi_meter(self, d1, d2, delta_h, Cd=0.98):
        """
        文丘里流量计
        
        参数:
            d1: 上游直径 (m)
            d2: 喉部直径 (m)
            delta_h: 水银压差计读数 (m)
            Cd: 流量系数
        
        返回:
            Q: 流量 (m³/s)
        """
        A1 = np.pi * d1**2 / 4
        A2 = np.pi * d2**2 / 4
        
        # 水银容重
        gamma_Hg = 133400  # N/m³
        
        # 压差
        delta_p = (gamma_Hg - self.gamma) * delta_h
        
        # 流量
        Q = Cd * A2 * np.sqrt(2*self.g*delta_p/self.gamma / (1 - (A2/A1)**2))
        
        return Q
    
    def plot_energy_line(self, stations, z, p_head, v_head):
        """
        绘制能量线与水力坡度线
        
        参数:
            stations: 各断面位置 (m)
            z: 各断面高程 (m)
            p_head: 各断面压强水头 (m)
            v_head: 各断面流速水头 (m)
        """
        # 测压管水头线
        H_p = z + p_head
        
        # 总水头线
        H_total = H_p + v_head
        
        fig, ax = plt.subplots(figsize=(14, 7))
        
        # 管道轴线
        ax.plot(stations, z, 'k-', linewidth=3, label='管道轴线')
        ax.fill_between(stations, z, min(z)-2, alpha=0.2, color='gray')
        
        # 测压管水头线
        ax.plot(stations, H_p, 'b--', linewidth=2, marker='o',
               markersize=6, label='测压管水头线')
        
        # 总水头线
        ax.plot(stations, H_total, 'r-', linewidth=2, marker='s',
               markersize=6, label='总能量线')
        
        # 标注
        for i, (x, h_total, h_p, z_val) in enumerate(zip(stations, H_total, H_p, z)):
            # 流速水头
            ax.plot([x, x], [h_p, h_total], 'g-', linewidth=1.5, alpha=0.5)
            
            # 压强水头
            ax.plot([x, x], [z_val, h_p], 'b-', linewidth=1.5, alpha=0.5)
        
        ax.set_xlabel('距离 (m)', fontsize=12)
        ax.set_ylabel('高程/水头 (m)', fontsize=12)
        ax.set_title('能量线与水力坡度线', fontsize=14)
        ax.legend(loc='best')
        ax.grid(True, alpha=0.3)
        
        plt.tight_layout()
        plt.savefig('energy_hydraulic_grade_line.png', dpi=300)
        plt.show()

# 示例1：伯努利方程应用
print("="*60)
print("示例1：管道流动能量转换")
print("="*60)

ee = EnergyEquation()

# 水平管道突然收缩
d1 = 0.3  # m
d2 = 0.15  # m
v1 = 2.0  # m/s
p1 = 200000  # Pa
z1 = 0  # m（水平）
z2 = 0

# 连续性方程
A1 = np.pi * d1**2 / 4
A2 = np.pi * d2**2 / 4
v2 = v1 * A1 / A2

print(f"断面1:")
print(f"  直径 d₁ = {d1} m")
print(f"  流速 v₁ = {v1} m/s")
print(f"  压强 p₁ = {p1/1000} kPa")

print(f"\n断面2:")
print(f"  直径 d₂ = {d2} m")
print(f"  流速 v₂ = {v2:.2f} m/s (由连续性方程)")

# 伯努利方程求p2
p2 = ee.bernoulli_no_loss(p1, v1, z1, v2=v2, z2=z2)

print(f"  压强 p₂ = {p2/1000:.1f} kPa")

# 能量分析
H1 = p1/ee.gamma + v1**2/(2*ee.g)
H2 = p2/ee.gamma + v2**2/(2*ee.g)

print(f"\n能量分析:")
print(f"  断面1总水头: {H1:.2f} m")
print(f"  断面2总水头: {H2:.2f} m")
print(f"  能量守恒: {abs(H1-H2) < 0.01}")

# 示例2：孔口出流
print("\n" + "="*60)
print("示例2：孔口出流")
print("="*60)

H_orifice = 3.0  # m
d_orifice = 0.08  # m
A_orifice = np.pi * d_orifice**2 / 4

Q_orifice = ee.orifice_flow(H_orifice, A_orifice)

print(f"水箱侧壁孔口:")
print(f"  作用水头 H = {H_orifice} m")
print(f"  孔口直径 d = {d_orifice} m")
print(f"  流量系数 φ = 0.62")
print(f"\n流量 Q = {Q_orifice:.5f} m³/s = {Q_orifice*1000:.2f} L/s")

# 理论流速
v_theory = np.sqrt(2*ee.g*H_orifice)
v_actual = Q_orifice / A_orifice

print(f"\n流速分析:")
print(f"  理论流速: {v_theory:.2f} m/s")
print(f"  实际流速: {v_actual:.2f} m/s")

# 示例3：堰流
print("\n" + "="*60)
print("示例3：堰流测流")
print("="*60)

b_weir = 1.2  # m
H_weir = 0.25  # m

Q_rect = ee.weir_flow(H_weir, b_weir, weir_type='rectangular')
Q_tri = ee.weir_flow(H_weir, b_weir, weir_type='triangular')

print(f"堰流参数:")
print(f"  堰宽 b = {b_weir} m")
print(f"  堰上水头 H = {H_weir} m")

print(f"\n矩形堰流量: Q = {Q_rect:.4f} m³/s = {Q_rect*1000:.1f} L/s")
print(f"三角堰流量: Q = {Q_tri:.4f} m³/s = {Q_tri*1000:.1f} L/s")

# 示例4：能量线绘制
print("\n" + "="*60)
print("示例4：管路系统能量线")
print("="*60)

# 模拟一个简单管路系统
stations = np.array([0, 50, 100, 150, 200])
z = np.array([0, 0, 0, 0, 0])  # 水平管道

# 逐渐损失能量
p_head = np.array([20, 18, 15, 11, 8])  # 压强水头逐渐减小
v_head = np.array([2, 2.5, 3, 2.8, 2.3])  # 流速水头有变化

ee.plot_energy_line(stations, z, p_head, v_head)

print(f"管路系统:")
print(f"  总长度: {stations[-1]} m")
print(f"  初始总水头: {p_head[0] + v_head[0]:.1f} m")
print(f"  末端总水头: {p_head[-1] + v_head[-1]:.1f} m")
print(f"  总水头损失: {(p_head[0]+v_head[0]) - (p_head[-1]+v_head[-1]):.1f} m")

# 示例5：文丘里流量计
print("\n" + "="*60)
print("示例5：文丘里流量计")
print("="*60)

d1_ven = 0.2  # m
d2_ven = 0.1  # m
delta_h_ven = 0.15  # m（水银压差计读数）

Q_ven = ee.venturi_meter(d1_ven, d2_ven, delta_h_ven)

print(f"文丘里流量计:")
print(f"  上游直径 d₁ = {d1_ven} m")
print(f"  喉部直径 d₂ = {d2_ven} m")
print(f"  压差计读数 Δh = {delta_h_ven} m (水银)")
print(f"\n测得流量: Q = {Q_ven:.4f} m³/s = {Q_ven*1000:.1f} L/s")
```

---

## 二、典型应用

### 2.1 毕托管测速

**原理**：A点（滞止点）速度为0

$$v = \sqrt{2g\frac{\Delta p}{\gamma}}$$

### 2.2 虹吸管

**条件**：
1. 管顶压强不低于水的汽化压强
2. $p_{min} > -10$ m水柱（绝对压强>0）

### 2.3 水力发电

$$N = \eta \gamma Q H = 9.81 \eta Q H \text{ (kW)}$$

---

## 三、典型考题

### 【例题1】能量方程计算（15分）

**题目**：水平管道，断面1：d₁=0.2m，v₁=3m/s，p₁=150kPa；断面2：d₂=0.1m。不计损失，求p₂。

**【解答】**

**(1) 连续性方程**（4分）

$$v_2 = v_1 \frac{d_1^2}{d_2^2} = 3 \times \frac{0.2^2}{0.1^2} = 12 \text{ m/s}$$

**(2) 伯努利方程**（8分）

$$\frac{p_1}{\gamma} + \frac{v_1^2}{2g} = \frac{p_2}{\gamma} + \frac{v_2^2}{2g}$$

$$\frac{150000}{9810} + \frac{3^2}{19.62} = \frac{p_2}{9810} + \frac{12^2}{19.62}$$

$$15.29 + 0.46 = \frac{p_2}{9810} + 7.34$$

$$p_2 = 82400 \text{ Pa} = 82.4 \text{ kPa}$$

**(3) 结论**（3分）

流速增大，压强减小，符合伯努利方程。

---

### 【例题2】孔口出流（12分）

**题目**：容器底部孔口，d=0.06m，水深H=2m，φ=0.62，求流量。

**【解答】**

$$A = \frac{\pi \times 0.06^2}{4} = 0.00283 \text{ m}^2$$

$$v = \varphi\sqrt{2gH} = 0.62 \times \sqrt{2 \times 9.81 \times 2} = 3.88 \text{ m/s}$$

$$Q = Av = 0.00283 \times 3.88 = 0.011 \text{ m}^3\text{/s} = 11 \text{ L/s}$$

---

## 四、速记口诀

> 三项水头要记牢  
> 压强位置加动能  
> 实际流动有损失  
> 能量方程修正用

---

**明日预告**: Day 4 - 动量方程与水流冲击

**作业**：
1. 推导文丘里流量计公式
2. 计算虹吸管最高点压强
3. 绘制管路能量线
