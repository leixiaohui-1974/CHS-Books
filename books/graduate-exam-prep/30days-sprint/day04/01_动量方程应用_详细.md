# Day 4：动量方程与水流冲击力

**学习时间**: 4小时  
**必考指数**: ⭐⭐⭐⭐⭐

---

## 一、动量方程基本形式

### 1.1 动量定理

**牛顿第二定律**：
$$\sum F = \frac{d(mv)}{dt}$$

**对于流体**（恒定流）：
$$\sum F = \rho Q(v_2 - v_1)$$

### 1.2 动量方程

**x方向**：
$$\sum F_x = \rho Q(v_{2x} - v_{1x}) = \frac{\gamma Q}{g}(v_{2x} - v_{1x})$$

**y方向**：
$$\sum F_y = \rho Q(v_{2y} - v_{1y}) = \frac{\gamma Q}{g}(v_{2y} - v_{1y})$$

### 1.3 作用力

**外力包括**：
1. 压力：$P = p \cdot A$
2. 重力分量：$G_x = \gamma V \sin\theta$
3. 边界反力：$R$（待求）
4. 摩擦力：$F_f$（可忽略）

### Python实现

```python
import numpy as np
import matplotlib.pyplot as plt

class MomentumEquation:
    """动量方程计算"""
    
    def __init__(self, gamma=9810, g=9.81):
        self.gamma = gamma
        self.g = g
    
    def pipe_bend_force(self, d, Q, p1, theta, vertical_component=False):
        """
        管道弯头作用力
        
        参数:
            d: 管径 (m)
            Q: 流量 (m³/s)
            p1: 上游压强 (Pa)
            theta: 转角 (度)
            vertical_component: 是否考虑竖向分量
        
        返回:
            R_x, R_y: 反力分量 (N)
        """
        # 流速
        A = np.pi * d**2 / 4
        v = Q / A
        
        # 动量变化
        theta_rad = np.radians(theta)
        
        # x方向
        delta_vx = v * np.cos(theta_rad) - v  # v2x - v1x
        
        # y方向
        delta_vy = v * np.sin(theta_rad) - 0  # v2y - v1y
        
        # 动量方程
        # ΣFx = ρQ(v2x - v1x)
        momentum_x = self.gamma * Q * delta_vx / self.g
        
        momentum_y = self.gamma * Q * delta_vy / self.g
        
        # 压力
        P1 = p1 * A
        P2 = p1 * A  # 假设无损失
        
        # x方向: P1 - P2cosθ - Rx = ρQ(v2x - v1x)
        R_x = P1 - P2 * np.cos(theta_rad) - momentum_x
        
        # y方向: -P2sinθ - Ry - W = ρQ(v2y - v1y)
        # 若忽略重力
        R_y = -P2 * np.sin(theta_rad) - momentum_y
        
        return R_x, R_y
    
    def jet_impact_flat_plate(self, d, v_jet, theta=90):
        """
        射流冲击平板
        
        F = ρQ·v·sinθ
        
        参数:
            d: 射流直径 (m)
            v_jet: 射流速度 (m/s)
            theta: 冲击角度 (度)
        
        返回:
            F: 冲击力 (N)
        """
        A = np.pi * d**2 / 4
        Q = A * v_jet
        
        theta_rad = np.radians(theta)
        
        # 垂直于板面的速度分量
        v_n = v_jet * np.sin(theta_rad)
        
        # 冲击力
        F = self.gamma * Q * v_n / self.g
        
        return F
    
    def jet_impact_vane(self, d, v_jet, u_vane, theta):
        """
        射流冲击叶片（运动）
        
        参数:
            d: 射流直径 (m)
            v_jet: 射流绝对速度 (m/s)
            u_vane: 叶片速度 (m/s)
            theta: 叶片转角 (度)
        
        返回:
            F: 作用力 (N)
            N: 单位时间冲量 (kg/s)
            P: 功率 (W)
        """
        A = np.pi * d**2 / 4
        Q = A * v_jet
        
        # 相对速度
        v_rel = v_jet - u_vane
        
        # 相对流量
        Q_rel = A * v_rel
        
        # 动量变化
        theta_rad = np.radians(theta)
        delta_v = v_rel * (1 - np.cos(theta_rad))
        
        # 作用力
        F = self.gamma * Q_rel * delta_v / self.g
        
        # 单位时间冲量（质量流量×速度变化）
        rho = self.gamma / self.g
        N = rho * Q_rel * delta_v
        
        # 功率
        P = F * u_vane
        
        return F, N, P
    
    def water_jump_force(self, b, h1, h2, Q):
        """
        水跃中的力（验证动量方程）
        
        P1 - P2 = ρQ(v2 - v1)
        
        参数:
            b: 宽度 (m)
            h1, h2: 跃前、跃后水深 (m)
            Q: 流量 (m³/s)
        """
        # 流速
        v1 = Q / (b * h1)
        v2 = Q / (b * h2)
        
        # 压力
        P1 = 0.5 * self.gamma * b * h1**2
        P2 = 0.5 * self.gamma * b * h2**2
        
        # 动量变化
        momentum_change = self.gamma * Q * (v2 - v1) / self.g
        
        # 验证
        left = P1 - P2
        right = momentum_change
        
        return {
            'P1': P1,
            'P2': P2,
            'momentum_change': momentum_change,
            'difference': abs(left - right),
            'valid': abs((left - right) / left) < 0.01
        }
    
    def plot_pipe_bend_forces(self):
        """绘制弯头作用力随角度变化"""
        theta_range = np.linspace(0, 180, 100)
        
        # 固定参数
        d = 0.3
        Q = 0.15
        p1 = 200000
        
        R_x_list = []
        R_y_list = []
        R_total_list = []
        
        for theta in theta_range:
            R_x, R_y = self.pipe_bend_force(d, Q, p1, theta)
            R_total = np.sqrt(R_x**2 + R_y**2)
            
            R_x_list.append(R_x)
            R_y_list.append(R_y)
            R_total_list.append(R_total)
        
        fig, axes = plt.subplots(1, 2, figsize=(16, 6))
        
        # (a) 分力
        axes[0].plot(theta_range, np.array(R_x_list)/1000, 'b-',
                    linewidth=2, label='水平分力 R_x')
        axes[0].plot(theta_range, np.array(R_y_list)/1000, 'r-',
                    linewidth=2, label='竖向分力 R_y')
        axes[0].axhline(0, color='k', linewidth=0.5)
        axes[0].set_xlabel('转角 θ (°)', fontsize=12)
        axes[0].set_ylabel('反力 (kN)', fontsize=12)
        axes[0].set_title('管道弯头反力分量', fontsize=14)
        axes[0].legend()
        axes[0].grid(True, alpha=0.3)
        
        # (b) 合力
        axes[1].plot(theta_range, np.array(R_total_list)/1000, 'g-',
                    linewidth=2.5, label='合力 R')
        axes[1].set_xlabel('转角 θ (°)', fontsize=12)
        axes[1].set_ylabel('合力 (kN)', fontsize=12)
        axes[1].set_title('管道弯头反力合力', fontsize=14)
        axes[1].legend()
        axes[1].grid(True, alpha=0.3)
        
        # 标注关键点
        idx_90 = np.argmin(np.abs(theta_range - 90))
        R_90 = R_total_list[idx_90]
        axes[1].plot(90, R_90/1000, 'ro', markersize=10)
        axes[1].text(90, R_90/1000+5, f'90°: {R_90/1000:.1f}kN',
                    ha='center', fontsize=10)
        
        plt.tight_layout()
        plt.savefig('pipe_bend_forces.png', dpi=300)
        plt.show()

# 示例1：管道弯头作用力
print("="*60)
print("示例1：90°弯头作用力计算")
print("="*60)

me = MomentumEquation()

# 参数
d = 0.2  # m
Q = 0.08  # m³/s
p1 = 150000  # Pa
theta = 90  # 度

print(f"管道参数:")
print(f"  管径 d = {d} m")
print(f"  流量 Q = {Q} m³/s")
print(f"  上游压强 p₁ = {p1/1000} kPa")
print(f"  转角 θ = {theta}°")

# 计算
A = np.pi * d**2 / 4
v = Q / A

print(f"\n流速:")
print(f"  v = Q/A = {v:.2f} m/s")

# 弯头反力
R_x, R_y = me.pipe_bend_force(d, Q, p1, theta)
R_total = np.sqrt(R_x**2 + R_y**2)

print(f"\n弯头受力:")
print(f"  水平反力 R_x = {R_x/1000:.2f} kN")
print(f("  竖向反力 R_y = {R_y/1000:.2f} kN")
print(f"  合力 R = {R_total/1000:.2f} kN")

# 方向角
alpha = np.degrees(np.arctan2(abs(R_y), abs(R_x)))
print(f"  方向角 α = {alpha:.1f}°")

# 示例2：射流冲击平板
print("\n" + "="*60)
print("示例2：射流冲击平板")
print("="*60)

d_jet = 0.05  # m
v_jet = 20  # m/s

print(f"射流参数:")
print(f"  直径 d = {d_jet} m")
print(f"  速度 v = {v_jet} m/s")

# 垂直冲击（90°）
F_90 = me.jet_impact_flat_plate(d_jet, v_jet, theta=90)

print(f"\n垂直冲击:")
print(f"  冲击力 F = {F_90:.1f} N")

# 不同角度
for theta_impact in [30, 45, 60, 90]:
    F = me.jet_impact_flat_plate(d_jet, v_jet, theta=theta_impact)
    print(f"  θ={theta_impact}°: F={F:.1f}N")

# 示例3：射流冲击运动叶片
print("\n" + "="*60)
print("示例3：射流冲击运动叶片（水轮机模型）")
print("="*60)

d_vane = 0.08  # m
v_jet_vane = 30  # m/s
theta_vane = 165  # 叶片转角（接近180°，水轮机）

print(f"叶片参数:")
print(f"  射流速度 v_jet = {v_jet_vane} m/s")
print(f"  叶片转角 θ = {theta_vane}°")

# 不同叶片速度
u_vane_values = np.linspace(0, 25, 50)
F_list = []
P_list = []

for u_vane in u_vane_values:
    F, N, P = me.jet_impact_vane(d_vane, v_jet_vane, u_vane, theta_vane)
    F_list.append(F)
    P_list.append(P)

# 找最大功率
idx_max = np.argmax(P_list)
u_opt = u_vane_values[idx_max]
P_max = P_list[idx_max]

print(f"\n优化结果:")
print(f"  最佳叶片速度 u = {u_opt:.2f} m/s")
print(f"  最大功率 P_max = {P_max/1000:.2f} kW")
print(f"  速比 u/v_jet = {u_opt/v_jet_vane:.2f}")

# 绘图
fig, axes = plt.subplots(1, 2, figsize=(16, 6))

# (a) 作用力
axes[0].plot(u_vane_values, np.array(F_list)/1000, 'b-', linewidth=2)
axes[0].set_xlabel('叶片速度 u (m/s)', fontsize=12)
axes[0].set_ylabel('作用力 F (kN)', fontsize=12)
axes[0].set_title('射流对叶片作用力', fontsize=14)
axes[0].grid(True, alpha=0.3)

# (b) 功率
axes[1].plot(u_vane_values, np.array(P_list)/1000, 'r-', linewidth=2)
axes[1].plot(u_opt, P_max/1000, 'go', markersize=12,
            label=f'最大功率: {P_max/1000:.2f}kW @ u={u_opt:.1f}m/s')
axes[1].set_xlabel('叶片速度 u (m/s)', fontsize=12)
axes[1].set_ylabel('功率 P (kW)', fontsize=12)
axes[1].set_title('输出功率曲线', fontsize=14)
axes[1].legend()
axes[1].grid(True, alpha=0.3)

plt.tight_layout()
plt.savefig('jet_impact_vane_performance.png', dpi=300)
plt.show()

# 示例4：水跃动量验证
print("\n" + "="*60)
print("示例4：水跃动量方程验证")
print("="*60)

b_jump = 5  # m
h1_jump = 0.8  # m
h2_jump = 2.5  # m
Q_jump = 20  # m³/s

print(f"水跃参数:")
print(f"  宽度 b = {b_jump} m")
print(f"  跃前水深 h₁ = {h1_jump} m")
print(f"  跃后水深 h₂ = {h2_jump} m")
print(f"  流量 Q = {Q_jump} m³/s")

results_jump = me.water_jump_force(b_jump, h1_jump, h2_jump, Q_jump)

print(f"\n动量方程验证:")
print(f"  上游压力 P₁ = {results_jump['P1']/1000:.1f} kN")
print(f"  下游压力 P₂ = {results_jump['P2']/1000:.1f} kN")
print(f"  动量变化 ρQ(v₂-v₁) = {results_jump['momentum_change']/1000:.1f} kN")
print(f"  差值: {results_jump['difference']/1000:.1f} kN")
print(f"  验证: {'通过' if results_jump['valid'] else '不通过'}")

# 绘制弯头作用力曲线
print("\n绘制管道弯头作用力随角度变化...")
me.plot_pipe_bend_forces()
```

---

## 二、典型应用

### 2.1 管道弯头

**90°弯头**：
$$R_x = P_1 - P_2\cos90° - \frac{\gamma Q}{g}(v_2\cos90° - v_1)$$
$$R_y = -P_2\sin90° - \frac{\gamma Q}{g}(v_2\sin90° - 0)$$

### 2.2 射流冲击

**垂直冲击固定平板**：
$$F = \rho Q v = \frac{\gamma Q v}{g}$$

**冲击运动叶片**：
$$F = \frac{\gamma Q}{g}(v - u)(1 - \cos\theta)$$

最大功率：$u = \frac{v}{2}$（$\theta=180°$时）

---

## 三、典型考题

### 【例题1】管道弯头（15分）

**题目**：水平90°弯头，d=0.15m，Q=0.06m³/s，p₁=200kPa，忽略损失。求弯头受力。

**【解答】**（见Python示例）

---

### 【例题2】射流冲击（12分）

**题目**：射流d=0.04m，v=25m/s，垂直冲击固定平板。求冲击力。

**【解答】**

$$Q = \frac{\pi d^2}{4} \cdot v = \frac{\pi \times 0.04^2}{4} \times 25 = 0.0314 \text{ m}^3\text{/s}$$

$$F = \frac{\gamma Q v}{g} = \frac{9810 \times 0.0314 \times 25}{9.81} = 770 \text{ N}$$

---

## 四、速记口诀

> 动量方程找外力  
> 压力重力加反力  
> 入流出流速度差  
> 乘以密度乘流量

---

**明日预告**: Day 5 - 层流与湍流

**作业**：
1. 推导180°弯头公式
2. 计算射流冲击效率
3. 分析水轮机叶片最优速比
