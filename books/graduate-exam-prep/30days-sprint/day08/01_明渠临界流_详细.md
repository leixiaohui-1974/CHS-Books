# Day 8：明渠临界流

**学习时间**: 5小时  
**考试频率**: ⭐⭐⭐⭐⭐  
**难度**: ⭐⭐⭐⭐⭐

---

## 一、临界流基本概念

### 1.1 定义

**临界流**：弗劳德数$Fr = 1$的流动状态

$$Fr = \frac{v}{\sqrt{gh}} = 1$$

**临界水深$h_c$**：发生临界流时的水深

### 1.2 流态判别

| $Fr$ | 流态 | 特征 |
|------|------|------|
| $Fr < 1$ | 缓流 | $h > h_c$，波速 > 水流速度 |
| $Fr = 1$ | 临界流 | $h = h_c$，波速 = 水流速度 |
| $Fr > 1$ | 急流 | $h < h_c$，波速 < 水流速度 |

---

## 二、临界水深计算

### 2.1 矩形断面

**基本方程**：

$$Fr = \frac{Q/A}{\sqrt{gh}} = 1$$

对于矩形断面（$A = bh$）：

$$\frac{Q}{bh_c} = \sqrt{gh_c}$$

$$\frac{Q^2}{b^2h_c^2} = gh_c$$

**临界水深公式**：

$$h_c = \sqrt[3]{\frac{Q^2}{gb^2}}$$

或：

$$h_c = \sqrt[3]{\frac{q^2}{g}}$$

其中单宽流量：$q = Q/b$

### 2.2 宽矩形简化

**单宽流量形式**：

$$q = \frac{Q}{b}$$

$$h_c = \sqrt[3]{\frac{q^2}{g}}$$

$$v_c = \sqrt{gh_c}$$

$$E_c = h_c + \frac{v_c^2}{2g} = h_c + \frac{h_c}{2} = \frac{3}{2}h_c$$

---

## 三、比能曲线

### 3.1 比能定义

**比能（Specific Energy）**：单位重量水体相对于渠底的能量

$$E = h + \frac{v^2}{2g} = h + \frac{Q^2}{2gA^2}$$

**矩形断面**：

$$E = h + \frac{Q^2}{2gb^2h^2}$$

### 3.2 比能曲线特征

**dE/dh = 0**时，$E$最小，对应$h = h_c$

**最小比能**：

$$E_{min} = E_c = \frac{3}{2}h_c$$

**比能曲线形状**：
- 左支：$h > h_c$（缓流区）
- 右支：$h < h_c$（急流区）
- 最低点：$h = h_c$（临界流）

### 3.3 共轭水深

**定义**：在同一比能$E$下，对应的两个不同水深

- **缓流共轭深**：$h_1 > h_c$
- **急流共轭深**：$h_2 < h_c$

**性质**：
$$E_1 = E_2$$
$$h_1 > h_c > h_2$$

---

## 四、临界流发生条件

### 4.1 自然形成

1. **宽顶堰**：堰顶发生临界流
2. **陡坡过渡**：从缓坡进入陡坡的过渡段
3. **渠道断面突然收缩**
4. **跌水或瀑布上游**

### 4.2 临界水深断面（控制断面）

**定义**：唯一确定水深的断面

**作用**：
- 计算起点
- 分界点（缓流/急流）

---

## 五、宽顶堰流量计算

### 5.1 基本公式

**堰顶发生临界流**：$h = h_c$

$$Q = m b \sqrt{2g} H^{3/2}$$

**参数说明**：
- $m$：流量系数（0.32~0.48）
- $b$：堰宽（m）
- $H$：堰上水头（m）

### 5.2 堰上水头与临界水深关系

$$H = E_0 = h_c + \frac{v_c^2}{2g} = \frac{3}{2}h_c$$

$$h_c = \frac{2}{3}H$$

---

## 六、Python实现

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy.optimize import fsolve

class CriticalOpenChannelFlow:
    """明渠临界流计算"""
    
    def __init__(self, g=9.81):
        self.g = g
    
    def critical_depth_rectangular(self, Q, b):
        """
        矩形断面临界水深
        
        h_c = (Q²/(gb²))^(1/3)
        
        参数:
            Q: 流量 (m³/s)
            b: 渠宽 (m)
        """
        h_c = (Q**2 / (self.g * b**2))**(1/3)
        return h_c
    
    def critical_depth_unit_discharge(self, q):
        """
        单宽流量形式
        
        h_c = (q²/g)^(1/3)
        
        参数:
            q: 单宽流量 (m²/s)
        """
        h_c = (q**2 / self.g)**(1/3)
        return h_c
    
    def froude_number(self, v, h):
        """弗劳德数"""
        Fr = v / np.sqrt(self.g * h)
        return Fr
    
    def specific_energy(self, Q, b, h):
        """
        比能
        
        E = h + Q²/(2gb²h²)
        
        参数:
            Q: 流量 (m³/s)
            b: 渠宽 (m)
            h: 水深 (m)
        """
        A = b * h
        v = Q / A
        E = h + v**2 / (2 * self.g)
        return E
    
    def minimum_specific_energy(self, Q, b):
        """
        最小比能（临界比能）
        
        E_min = (3/2) * h_c
        """
        h_c = self.critical_depth_rectangular(Q, b)
        E_min = 1.5 * h_c
        return E_min
    
    def alternate_depths(self, Q, b, E):
        """
        共轭水深（给定比能E，求两个可能的水深）
        
        参数:
            Q: 流量 (m³/s)
            b: 渠宽 (m)
            E: 比能 (m)
        
        返回:
            h1: 缓流水深 (h1 > h_c)
            h2: 急流水深 (h2 < h_c)
        """
        h_c = self.critical_depth_rectangular(Q, b)
        E_min = self.minimum_specific_energy(Q, b)
        
        if E < E_min:
            return None, None  # 无解
        
        def equation(h):
            return self.specific_energy(Q, b, h) - E
        
        # 缓流水深
        h1 = fsolve(equation, 1.5 * h_c)[0]
        
        # 急流水深
        h2 = fsolve(equation, 0.5 * h_c)[0]
        
        return h1, h2
    
    def broad_crested_weir_discharge(self, m, b, H):
        """
        宽顶堰流量
        
        Q = m·b·√(2g)·H^(3/2)
        
        参数:
            m: 流量系数
            b: 堰宽 (m)
            H: 堰上水头 (m)
        """
        Q = m * b * np.sqrt(2 * self.g) * H**1.5
        return Q
    
    def broad_crested_weir_head(self, Q, m, b):
        """
        宽顶堰水头（已知流量求水头）
        
        H = (Q / (m·b·√(2g)))^(2/3)
        """
        H = (Q / (m * b * np.sqrt(2 * self.g)))**(2/3)
        return H
    
    def plot_critical_flow_analysis(self):
        """绘制临界流分析图"""
        fig, axes = plt.subplots(2, 2, figsize=(16, 12))
        
        Q = 10  # m³/s
        b = 5   # m
        
        h_c = self.critical_depth_rectangular(Q, b)
        E_min = self.minimum_specific_energy(Q, b)
        
        # 1. 比能曲线
        ax1 = axes[0, 0]
        
        h_range = np.linspace(0.1, 3 * h_c, 300)
        E_values = [self.specific_energy(Q, b, h) for h in h_range]
        
        ax1.plot(E_values, h_range, 'b-', linewidth=2.5, label='E-h曲线')
        
        # 临界点
        ax1.scatter([E_min], [h_c], s=200, color='red', zorder=5, marker='*',
                   label=f'临界点\nh_c={h_c:.2f}m\nE_min={E_min:.2f}m')
        
        # 分区标注
        ax1.axhline(h_c, color='g', linestyle='--', linewidth=1.5, alpha=0.5)
        ax1.text(E_min * 1.5, h_c * 1.8, '缓流区\n(Fr<1)', fontsize=11,
                bbox=dict(boxstyle='round', facecolor='lightblue', alpha=0.7))
        ax1.text(E_min * 1.5, h_c * 0.4, '急流区\n(Fr>1)', fontsize=11,
                bbox=dict(boxstyle='round', facecolor='lightcoral', alpha=0.7))
        
        # 共轭水深示例
        E_test = E_min * 1.5
        h1_test, h2_test = self.alternate_depths(Q, b, E_test)
        ax1.plot([E_test, E_test], [h2_test, h1_test], 'r--', linewidth=2)
        ax1.scatter([E_test, E_test], [h1_test, h2_test], s=100, color='orange', zorder=5)
        ax1.text(E_test + 0.1, (h1_test + h2_test)/2, '共轭水深', fontsize=9,
                bbox=dict(boxstyle='round', facecolor='yellow', alpha=0.7))
        
        ax1.set_xlabel('比能 E (m)', fontsize=11)
        ax1.set_ylabel('水深 h (m)', fontsize=11)
        ax1.set_title(f'比能曲线\nQ={Q}m³/s, b={b}m', fontsize=13, fontweight='bold')
        ax1.legend(loc='upper right')
        ax1.grid(True, alpha=0.3)
        ax1.set_xlim([E_min * 0.9, E_min * 3])
        
        # 2. 弗劳德数曲线
        ax2 = axes[0, 1]
        
        Fr_values = []
        v_values = []
        for h in h_range:
            A = b * h
            v = Q / A
            Fr = self.froude_number(v, h)
            Fr_values.append(Fr)
            v_values.append(v)
        
        ax2_twin = ax2.twinx()
        
        line1 = ax2.plot(h_range, Fr_values, 'b-', linewidth=2.5, label='弗劳德数Fr')
        line2 = ax2_twin.plot(h_range, v_values, 'r-', linewidth=2.5, label='流速v')
        
        # Fr=1临界线
        ax2.axhline(1, color='g', linestyle='--', linewidth=2, label='Fr=1（临界）')
        ax2.axvline(h_c, color='orange', linestyle=':', linewidth=1.5, alpha=0.5)
        
        # 填充区域
        ax2.fill_between(h_range, 0, Fr_values, where=(np.array(Fr_values) < 1),
                        alpha=0.2, color='blue', label='缓流区')
        ax2.fill_between(h_range, 0, Fr_values, where=(np.array(Fr_values) > 1),
                        alpha=0.2, color='red', label='急流区')
        
        ax2.set_xlabel('水深 h (m)', fontsize=11)
        ax2.set_ylabel('弗劳德数 Fr', fontsize=11, color='b')
        ax2_twin.set_ylabel('流速 v (m/s)', fontsize=11, color='r')
        ax2.set_title('弗劳德数与流速随水深变化', fontsize=13, fontweight='bold')
        
        lines = line1 + line2
        labels = [l.get_label() for l in lines]
        ax2.legend(lines, labels, loc='upper right', fontsize=9)
        ax2.grid(True, alpha=0.3)
        ax2.set_ylim([0, 3])
        
        # 3. 宽顶堰流量
        ax3 = axes[1, 0]
        
        m = 0.40  # 流量系数
        b_weir = 3  # m
        
        H_range = np.linspace(0.1, 2, 100)
        Q_weir_values = [self.broad_crested_weir_discharge(m, b_weir, H) for H in H_range]
        
        ax3.plot(H_range, Q_weir_values, 'b-', linewidth=2.5)
        
        # 标注典型点
        H_typical = [0.5, 1.0, 1.5]
        for H_t in H_typical:
            Q_t = self.broad_crested_weir_discharge(m, b_weir, H_t)
            h_c_t = (2/3) * H_t
            ax3.scatter([H_t], [Q_t], s=100, color='red', zorder=5)
            ax3.text(H_t, Q_t + 0.5, f'H={H_t}m\nQ={Q_t:.2f}\nh_c={h_c_t:.2f}m',
                    ha='center', fontsize=9, bbox=dict(boxstyle='round', 
                    facecolor='wheat', alpha=0.7))
        
        ax3.set_xlabel('堰上水头 H (m)', fontsize=11)
        ax3.set_ylabel('流量 Q (m³/s)', fontsize=11)
        ax3.set_title(f'宽顶堰流量曲线\nm={m}, b={b_weir}m', fontsize=13, fontweight='bold')
        ax3.grid(True, alpha=0.3)
        
        # 4. 临界水深与流量关系
        ax4 = axes[1, 1]
        
        Q_range = np.linspace(1, 30, 100)
        
        b_values = [3, 5, 8]
        colors = ['blue', 'green', 'red']
        
        for b_val, color in zip(b_values, colors):
            h_c_values = [self.critical_depth_rectangular(Q_val, b_val) for Q_val in Q_range]
            ax4.plot(Q_range, h_c_values, color=color, linewidth=2.5, label=f'b={b_val}m')
        
        ax4.set_xlabel('流量 Q (m³/s)', fontsize=11)
        ax4.set_ylabel('临界水深 h_c (m)', fontsize=11)
        ax4.set_title('临界水深-流量关系', fontsize=13, fontweight='bold')
        ax4.legend()
        ax4.grid(True, alpha=0.3)
        
        plt.tight_layout()
        plt.savefig('critical_open_channel_flow.png', dpi=300)
        plt.show()

# 示例1：临界水深计算
print("="*60)
print("示例1：矩形渠道临界水深")
print("="*60)

ccf = CriticalOpenChannelFlow()

Q = 10.0  # m³/s
b = 5.0   # m

h_c = ccf.critical_depth_rectangular(Q, b)

A_c = b * h_c
v_c = Q / A_c
Fr_c = ccf.froude_number(v_c, h_c)
E_c = ccf.specific_energy(Q, b, h_c)

print(f"已知参数:")
print(f"  流量 Q = {Q} m³/s")
print(f"  渠宽 b = {b} m")

print(f"\n临界流参数:")
print(f"  临界水深 h_c = {h_c:.3f} m")
print(f"  临界流速 v_c = {v_c:.3f} m/s")
print(f"  弗劳德数 Fr = {Fr_c:.3f}（应为1.0）")
print(f"  临界比能 E_c = {E_c:.3f} m")

# 验证 h_c = (2/3)E_c
print(f"\n验证：h_c / E_c = {h_c / E_c:.3f}（应为0.667）")

# 单宽流量法
q = Q / b
h_c_q = ccf.critical_depth_unit_discharge(q)

print(f"\n单宽流量法:")
print(f"  q = Q/b = {q:.3f} m²/s")
print(f"  h_c = {h_c_q:.3f} m（相同）")

# 示例2：共轭水深
print("\n" + "="*60)
print("示例2：共轭水深计算")
print("="*60)

E_given = 3.0  # m

h1, h2 = ccf.alternate_depths(Q, b, E_given)

if h1 and h2:
    A1 = b * h1
    v1 = Q / A1
    Fr1 = ccf.froude_number(v1, h1)
    
    A2 = b * h2
    v2 = Q / A2
    Fr2 = ccf.froude_number(v2, h2)
    
    print(f"给定比能 E = {E_given} m")
    print(f"临界比能 E_c = {E_c:.3f} m")
    
    if E_given > E_c:
        print(f"E > E_c，存在两个共轭水深")
    
    print(f"\n缓流共轭深:")
    print(f"  h1 = {h1:.3f} m")
    print(f"  v1 = {v1:.3f} m/s")
    print(f"  Fr1 = {Fr1:.3f} < 1（缓流）")
    
    print(f"\n急流共轭深:")
    print(f"  h2 = {h2:.3f} m")
    print(f"  v2 = {v2:.3f} m/s")
    print(f"  Fr2 = {Fr2:.3f} > 1（急流）")
    
    # 验证比能相等
    E1 = ccf.specific_energy(Q, b, h1)
    E2 = ccf.specific_energy(Q, b, h2)
    
    print(f"\n验证比能:")
    print(f"  E1 = {E1:.3f} m")
    print(f"  E2 = {E2:.3f} m")
    print(f"  |E1 - E2| = {abs(E1 - E2):.2e} ≈ 0 ✓")

# 示例3：宽顶堰流量
print("\n" + "="*60)
print("示例3：宽顶堰流量计算")
print("="*60)

m = 0.40  # 流量系数
b_weir = 3.0  # m
H = 1.2  # m（堰上水头）

Q_weir = ccf.broad_crested_weir_discharge(m, b_weir, H)

# 堰顶临界水深
h_c_weir = (2/3) * H

print(f"宽顶堰参数:")
print(f"  流量系数 m = {m}")
print(f"  堰宽 b = {b_weir} m")
print(f"  堰上水头 H = {H} m")

print(f"\n计算结果:")
print(f"  流量 Q = {Q_weir:.3f} m³/s")
print(f"  堰顶临界水深 h_c = (2/3)H = {h_c_weir:.3f} m")

# 反算水头
H_check = ccf.broad_crested_weir_head(Q_weir, m, b_weir)

print(f"\n验证：反算水头 H = {H_check:.3f} m（应为{H}）")

# 示例4：流态判别
print("\n" + "="*60)
print("示例4：流态判别")
print("="*60)

test_cases = [
    (10, 5, 1.0),   # 缓流
    (10, 5, h_c),   # 临界流
    (10, 5, 0.5)    # 急流
]

print(f"流量 Q = {Q} m³/s，渠宽 b = {b} m")
print(f"临界水深 h_c = {h_c:.3f} m\n")

print(f"{'水深h(m)':<12s} {'流速v(m/s)':<15s} {'Fr':<12s} {'流态':<10s}")
print("-" * 52)

for Q_test, b_test, h_test in test_cases:
    A_test = b_test * h_test
    v_test = Q_test / A_test
    Fr_test = ccf.froude_number(v_test, h_test)
    
    if Fr_test < 0.98:
        regime = "缓流"
    elif Fr_test > 1.02:
        regime = "急流"
    else:
        regime = "临界流"
    
    print(f"{h_test:<12.3f} {v_test:<15.3f} {Fr_test:<12.3f} {regime:<10s}")

# 示例5：临界流的工程应用
print("\n" + "="*60)
print("示例5：临界流工程应用-渠道突然收缩")
print("="*60)

# 上游：宽渠道
Q_contract = 15  # m³/s
b1_contract = 8  # m
h1_contract = 1.5  # m（上游水深）

A1_contract = b1_contract * h1_contract
v1_contract = Q_contract / A1_contract
Fr1_contract = ccf.froude_number(v1_contract, h1_contract)

# 下游：窄渠道
b2_contract = 4  # m

# 下游临界水深
h_c_contract = ccf.critical_depth_rectangular(Q_contract, b2_contract)

print(f"渠道突然收缩:")
print(f"  流量 Q = {Q_contract} m³/s")

print(f"\n上游宽渠道:")
print(f"  宽度 b1 = {b1_contract} m")
print(f"  水深 h1 = {h1_contract} m")
print(f"  流速 v1 = {v1_contract:.3f} m/s")
print(f"  Fr1 = {Fr1_contract:.3f}（缓流）")

print(f"\n下游窄渠道:")
print(f"  宽度 b2 = {b2_contract} m")
print(f"  临界水深 h_c = {h_c_contract:.3f} m")

# 判断是否形成临界流
if Fr1_contract < 1:
    print(f"\n由于上游为缓流，收缩段可能形成临界流（控制断面）")

# 绘制临界流分析图
print("\n绘制明渠临界流分析图...")
ccf.plot_critical_flow_analysis()
```

---

## 七、典型考题

### 【例题1】临界水深（10分）

**题目**：矩形渠道，$b=4$m，$Q=8$m³/s。求临界水深$h_c$及临界流速$v_c$。

**【解答】**

$$h_c = \sqrt[3]{\frac{Q^2}{gb^2}} = \sqrt[3]{\frac{64}{9.81 \times 16}} = \sqrt[3]{0.408} = 0.742 \text{ m}$$

$$v_c = \sqrt{gh_c} = \sqrt{9.81 \times 0.742} = 2.70 \text{ m/s}$$

---

### 【例题2】共轭水深（15分）

**题目**：矩形渠道，$Q=10$m³/s，$b=5$m，比能$E=3$m。求两个可能的水深。

**【解答】**（数值求解，步骤略）

---

**本章重点**：
- 临界水深计算
- 比能曲线
- 共轭水深
- 宽顶堰流量

**下一章**：水跃
