# Day 7：明渠均匀流

**学习时间**: 5小时  
**考试频率**: ⭐⭐⭐⭐⭐  
**难度**: ⭐⭐⭐⭐

---

## 一、明渠均匀流基本概念

### 1.1 定义与特征

**均匀流**：水深、流速、断面积沿程不变的流动

**特征**：
1. 水深$h = h_0$（正常水深）恒定
2. 流速$v = v_0$恒定
3. 水面线与渠底平行：$i = i_0$
4. 能量坡度$J = i_0$（底坡）

### 1.2 形成条件

1. 棱柱形渠道（断面、底坡恒定）
2. 恒定流（流量不随时间变化）
3. 长直渠道（充分发展）

---

## 二、谢才公式（Chézy公式）

### 2.1 基本公式

$$v = C\sqrt{Ri}$$

$$Q = AC\sqrt{Ri}$$

**参数说明**：
- $C$：谢才系数（m^{1/2}/s）
- $R$：水力半径（m），$R = A/\chi$
- $A$：过水断面积（m²）
- $\chi$：湿周（m）
- $i$：底坡

### 2.2 矩形断面

**几何参数**：
- 断面积：$A = bh$
- 湿周：$\chi = b + 2h$
- 水力半径：$R = \frac{bh}{b + 2h}$

**最优断面**（湿周最小）：
$$b = 2h$$

---

## 三、曼宁公式（Manning公式）

### 3.1 基本公式

$$v = \frac{1}{n}R^{2/3}i^{1/2}$$

$$Q = \frac{1}{n}AR^{2/3}i^{1/2}$$

**参数说明**：
- $n$：糙率（Manning系数）

### 3.2 常用糙率值

| 渠道类型 | 糙率$n$ |
|---------|--------|
| 光滑混凝土 | 0.012 ~ 0.014 |
| 粗糙混凝土 | 0.014 ~ 0.017 |
| 浆砌石 | 0.017 ~ 0.025 |
| 干砌石 | 0.025 ~ 0.035 |
| 土渠（平整） | 0.020 ~ 0.025 |
| 土渠（粗糙） | 0.025 ~ 0.035 |
| 天然河道 | 0.030 ~ 0.060 |

---

## 四、正常水深计算

### 4.1 直接计算

**已知**：$Q, b, i, n$，求$h_0$

**矩形断面**：

$$Q = \frac{1}{n} \cdot bh_0 \cdot \left(\frac{bh_0}{b+2h_0}\right)^{2/3} \cdot i^{1/2}$$

**数值求解**（试算法或Newton法）

### 4.2 宽矩形简化

**条件**：$b \gg h$

**简化**：$R \approx h$

$$Q = \frac{1}{n}bh^{5/3}i^{1/2}$$

$$h_0 = \left(\frac{nQ}{bi^{1/2}}\right)^{3/5}$$

---

## 五、水力最优断面

### 5.1 定义

**在给定断面积$A$、底坡$i$、糙率$n$时，使流量$Q$最大的断面形状**

**等价条件**：湿周$\chi$最小

### 5.2 矩形最优断面

**结论**：$b = 2h$（宽深比为2）

**推导**：

$$A = bh = \text{常数}$$

$$\chi = b + 2h = \frac{A}{h} + 2h$$

$$\frac{d\chi}{dh} = -\frac{A}{h^2} + 2 = 0 \Rightarrow h = \sqrt{\frac{A}{2}}$$

$$b = \frac{A}{h} = 2h$$

### 5.3 梯形最优断面

**断面形状**：底宽$b$，水深$h$，边坡系数$m$

**最优条件**：
1. 半断面为半正方形
2. 水力半径$R = h/2$
3. 边坡角$\theta = 60°$（$m = \frac{1}{\sqrt{3}}$）

---

## 六、允许流速

### 6.1 不冲流速

**定义**：渠道不发生冲刷的最大流速

**土渠允许流速**（经验值）：

| 土质 | 允许流速（m/s） |
|------|---------------|
| 轻壤土 | 0.5 ~ 0.7 |
| 中壤土 | 0.7 ~ 0.9 |
| 重壤土 | 0.9 ~ 1.2 |
| 砂壤土 | 1.2 ~ 1.5 |
| 砾石 | 1.5 ~ 2.5 |

### 6.2 不淤流速

**定义**：渠道不发生淤积的最小流速

**经验值**：$v_{min} = 0.3 \sim 0.5$ m/s

---

## 七、Python实现

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy.optimize import fsolve

class UniformOpenChannelFlow:
    """明渠均匀流计算"""
    
    def __init__(self, g=9.81):
        self.g = g
    
    def manning_formula(self, n, A, R, i):
        """
        Manning公式
        
        Q = (1/n) · A · R^(2/3) · i^(1/2)
        """
        Q = (1 / n) * A * R**(2/3) * i**0.5
        return Q
    
    def rectangular_geometry(self, b, h):
        """
        矩形断面几何参数
        
        返回: A, chi, R
        """
        A = b * h
        chi = b + 2 * h
        R = A / chi
        return A, chi, R
    
    def normal_depth_rectangular(self, Q, b, i, n):
        """
        矩形断面正常水深
        
        参数:
            Q: 流量 (m³/s)
            b: 渠底宽度 (m)
            i: 底坡
            n: 糙率
        
        返回:
            h0: 正常水深 (m)
        """
        def equation(h):
            if h <= 0:
                return 1e10
            A, chi, R = self.rectangular_geometry(b, h)
            Q_calc = self.manning_formula(n, A, R, i)
            return Q_calc - Q
        
        # 初始猜测
        h_init = 1.0
        
        h0 = fsolve(equation, h_init)[0]
        
        return h0
    
    def normal_depth_wide_rectangular(self, Q, b, i, n):
        """
        宽矩形渠道正常水深（简化公式）
        
        条件: b >> h
        简化: R ≈ h
        
        h0 = (nQ / (b·i^0.5))^(3/5)
        """
        h0 = (n * Q / (b * i**0.5))**(3/5)
        return h0
    
    def optimal_rectangular_section(self, A):
        """
        矩形最优断面
        
        条件: 断面积A给定
        
        返回: b_opt, h_opt
        """
        h_opt = np.sqrt(A / 2)
        b_opt = 2 * h_opt
        
        return b_opt, h_opt
    
    def velocity_manning(self, R, i, n):
        """流速（Manning公式）"""
        v = (1 / n) * R**(2/3) * i**0.5
        return v
    
    def froude_number(self, v, h):
        """弗劳德数"""
        Fr = v / np.sqrt(self.g * h)
        return Fr
    
    def plot_uniform_flow_analysis(self):
        """绘制均匀流分析图"""
        fig, axes = plt.subplots(2, 2, figsize=(16, 12))
        
        # 1. 正常水深与流量关系
        ax1 = axes[0, 0]
        
        b = 5.0  # m
        i = 0.001
        n = 0.025
        
        Q_range = np.linspace(1, 30, 100)
        h0_values = [self.normal_depth_rectangular(Q, b, i, n) for Q in Q_range]
        
        ax1.plot(Q_range, h0_values, 'b-', linewidth=2.5)
        
        ax1.set_xlabel('流量 Q (m³/s)', fontsize=11)
        ax1.set_ylabel('正常水深 h₀ (m)', fontsize=11)
        ax1.set_title(f'正常水深-流量关系\nb={b}m, i={i}, n={n}',
                     fontsize=13, fontweight='bold')
        ax1.grid(True, alpha=0.3)
        
        # 2. 糙率影响
        ax2 = axes[0, 1]
        
        Q_test = 10  # m³/s
        n_values = np.linspace(0.012, 0.040, 50)
        
        h0_vs_n = [self.normal_depth_rectangular(Q_test, b, i, n_val) for n_val in n_values]
        
        ax2.plot(n_values, h0_vs_n, 'r-', linewidth=2.5)
        
        # 标注典型糙率
        n_typical = {'光滑混凝土': 0.013, '土渠': 0.025, '天然河道': 0.035}
        for label, n_val in n_typical.items():
            h0_val = self.normal_depth_rectangular(Q_test, b, i, n_val)
            ax2.scatter([n_val], [h0_val], s=100, zorder=5)
            ax2.text(n_val, h0_val + 0.05, label, ha='center', fontsize=9,
                    bbox=dict(boxstyle='round', facecolor='wheat', alpha=0.7))
        
        ax2.set_xlabel('糙率 n', fontsize=11)
        ax2.set_ylabel('正常水深 h₀ (m)', fontsize=11)
        ax2.set_title(f'糙率对水深的影响\nQ={Q_test}m³/s, b={b}m, i={i}',
                     fontsize=13, fontweight='bold')
        ax2.grid(True, alpha=0.3)
        
        # 3. 最优断面分析
        ax3 = axes[1, 0]
        
        A_given = 10  # m²
        
        # 宽深比变化
        h_range = np.linspace(0.5, 5, 100)
        b_range = A_given / h_range
        chi_range = b_range + 2 * h_range
        
        # 最优点
        b_opt, h_opt = self.optimal_rectangular_section(A_given)
        chi_opt = b_opt + 2 * h_opt
        
        ax3.plot(h_range, chi_range, 'b-', linewidth=2.5, label='湿周χ')
        ax3.scatter([h_opt], [chi_opt], s=200, color='red', zorder=5, marker='*',
                   label=f'最优点\nh={h_opt:.2f}m\nb={b_opt:.2f}m')
        
        # 标注b=2h线
        ax3.axvline(h_opt, color='r', linestyle='--', linewidth=1.5, alpha=0.5)
        ax3.text(h_opt + 0.1, chi_opt - 0.5, f'b/h=2', fontsize=10,
                bbox=dict(boxstyle='round', facecolor='yellow', alpha=0.7))
        
        ax3.set_xlabel('水深 h (m)', fontsize=11)
        ax3.set_ylabel('湿周 χ (m)', fontsize=11)
        ax3.set_title(f'矩形最优断面（A={A_given}m²）', fontsize=13, fontweight='bold')
        ax3.legend()
        ax3.grid(True, alpha=0.3)
        
        # 4. 流速与弗劳德数
        ax4 = axes[1, 1]
        
        Q_Fr = 15  # m³/s
        b_Fr = 5  # m
        
        i_range = np.logspace(-4, -2, 100)
        
        h0_Fr = []
        v_Fr = []
        Fr_Fr = []
        
        for i_val in i_range:
            h0_val = self.normal_depth_rectangular(Q_Fr, b_Fr, i_val, n)
            A_val, chi_val, R_val = self.rectangular_geometry(b_Fr, h0_val)
            v_val = Q_Fr / A_val
            Fr_val = self.froude_number(v_val, h0_val)
            
            h0_Fr.append(h0_val)
            v_Fr.append(v_val)
            Fr_Fr.append(Fr_val)
        
        ax4_twin = ax4.twinx()
        
        line1 = ax4.plot(i_range, v_Fr, 'b-', linewidth=2.5, label='流速v')
        line2 = ax4_twin.plot(i_range, Fr_Fr, 'r-', linewidth=2.5, label='弗劳德数Fr')
        
        # Fr=1临界线
        ax4_twin.axhline(1, color='g', linestyle='--', linewidth=2, label='Fr=1（临界）')
        
        ax4.set_xscale('log')
        ax4.set_xlabel('底坡 i', fontsize=11)
        ax4.set_ylabel('流速 v (m/s)', fontsize=11, color='b')
        ax4_twin.set_ylabel('弗劳德数 Fr', fontsize=11, color='r')
        ax4.set_title(f'流速与弗劳德数随底坡变化\nQ={Q_Fr}m³/s, b={b_Fr}m',
                     fontsize=13, fontweight='bold')
        
        lines = line1 + line2 + [ax4_twin.get_lines()[1]]
        labels = [l.get_label() for l in lines]
        ax4.legend(lines, labels, loc='upper left')
        ax4.grid(True, alpha=0.3, which='both')
        
        plt.tight_layout()
        plt.savefig('uniform_open_channel_flow.png', dpi=300)
        plt.show()

# 示例1：正常水深计算
print("="*60)
print("示例1：矩形渠道正常水深")
print("="*60)

uoc = UniformOpenChannelFlow()

Q = 10.0  # m³/s
b = 5.0   # m
i = 0.001
n = 0.025

h0 = uoc.normal_depth_rectangular(Q, b, i, n)

A, chi, R = uoc.rectangular_geometry(b, h0)
v = Q / A
Fr = uoc.froude_number(v, h0)

print(f"已知参数:")
print(f"  流量 Q = {Q} m³/s")
print(f"  渠底宽度 b = {b} m")
print(f"  底坡 i = {i}")
print(f"  糙率 n = {n}")

print(f"\n正常水深 h₀ = {h0:.3f} m")

print(f"\n几何参数:")
print(f"  断面积 A = {A:.3f} m²")
print(f"  湿周 χ = {chi:.3f} m")
print(f"  水力半径 R = {R:.3f} m")

print(f"\n水力特性:")
print(f"  流速 v = {v:.3f} m/s")
print(f"  弗劳德数 Fr = {Fr:.3f}")

if Fr < 1:
    flow_regime = "缓流"
elif Fr > 1:
    flow_regime = "急流"
else:
    flow_regime = "临界流"

print(f"  流态: {flow_regime}")

# 验证Manning公式
Q_check = uoc.manning_formula(n, A, R, i)
print(f"\n验证：Q_计算 = {Q_check:.3f} m³/s（应为{Q}）")

# 示例2：宽矩形简化
print("\n" + "="*60)
print("示例2：宽矩形渠道简化公式")
print("="*60)

b_wide = 50.0  # m（宽渠道）
h0_exact = uoc.normal_depth_rectangular(Q, b_wide, i, n)
h0_approx = uoc.normal_depth_wide_rectangular(Q, b_wide, i, n)

print(f"宽渠道参数:")
print(f"  Q = {Q} m³/s")
print(f"  b = {b_wide} m（b >> h）")
print(f"  i = {i}")
print(f"  n = {n}")

print(f"\n精确公式：h₀ = {h0_exact:.3f} m")
print(f"简化公式：h₀ = {h0_approx:.3f} m")
print(f"相对误差：{abs(h0_approx - h0_exact)/h0_exact*100:.2f}%")

# 示例3：最优断面
print("\n" + "="*60)
print("示例3：矩形最优断面")
print("="*60)

A_given = 10.0  # m²

b_opt, h_opt = uoc.optimal_rectangular_section(A_given)
_, chi_opt, R_opt = uoc.rectangular_geometry(b_opt, h_opt)

# 对比非最优断面
b_non = 10.0
h_non = A_given / b_non
_, chi_non, R_non = uoc.rectangular_geometry(b_non, h_non)

print(f"给定断面积 A = {A_given} m²")

print(f"\n最优断面:")
print(f"  宽度 b = {b_opt:.3f} m")
print(f"  水深 h = {h_opt:.3f} m")
print(f"  宽深比 b/h = {b_opt/h_opt:.1f}")
print(f"  湿周 χ = {chi_opt:.3f} m")
print(f"  水力半径 R = {R_opt:.3f} m")

print(f"\n非最优断面（b={b_non}m）:")
print(f"  水深 h = {h_non:.3f} m")
print(f"  宽深比 b/h = {b_non/h_non:.1f}")
print(f"  湿周 χ = {chi_non:.3f} m")
print(f"  水力半径 R = {R_non:.3f} m")

print(f"\n湿周减少：{(chi_non - chi_opt)/chi_non*100:.1f}%")
print(f"水力半径增加：{(R_opt - R_non)/R_non*100:.1f}%")

# 在相同条件下，最优断面流量更大
Q_opt = uoc.manning_formula(n, A_given, R_opt, i)
Q_non = uoc.manning_formula(n, A_given, R_non, i)

print(f"\n流量对比（i={i}, n={n}）:")
print(f"  最优断面：Q = {Q_opt:.3f} m³/s")
print(f"  非最优断面：Q = {Q_non:.3f} m³/s")
print(f"  流量增加：{(Q_opt - Q_non)/Q_non*100:.1f}%")

# 示例4：允许流速校核
print("\n" + "="*60)
print("示例4：允许流速校核")
print("="*60)

# 土渠设计
Q_soil = 5.0
b_soil = 3.0
i_soil = 0.0005
n_soil = 0.025

h0_soil = uoc.normal_depth_rectangular(Q_soil, b_soil, i_soil, n_soil)
A_soil, _, R_soil = uoc.rectangular_geometry(b_soil, h0_soil)
v_soil = Q_soil / A_soil

print(f"土渠参数:")
print(f"  Q = {Q_soil} m³/s")
print(f"  b = {b_soil} m")
print(f"  i = {i_soil}")
print(f"  n = {n_soil}（土渠）")

print(f"\n计算结果:")
print(f"  正常水深 h₀ = {h0_soil:.3f} m")
print(f"  流速 v = {v_soil:.3f} m/s")

# 允许流速
v_max_soil = 0.9  # 中壤土
v_min_soil = 0.4  # 不淤流速

print(f"\n允许流速范围:")
print(f"  不淤流速 v_min = {v_min_soil} m/s")
print(f"  不冲流速 v_max = {v_max_soil} m/s")

if v_soil < v_min_soil:
    print(f"  ⚠️ 流速过小（{v_soil:.3f} < {v_min_soil}），可能淤积！")
elif v_soil > v_max_soil:
    print(f"  ⚠️ 流速过大（{v_soil:.3f} > {v_max_soil}），可能冲刷！")
else:
    print(f"  ✓ 流速合适（{v_min_soil} < {v_soil:.3f} < {v_max_soil}）")

# 绘制均匀流分析图
print("\n绘制明渠均匀流分析图...")
uoc.plot_uniform_flow_analysis()
```

---

## 八、典型考题

### 【例题1】正常水深（12分）

**题目**：矩形渠道，$b=4$m，$i=0.001$，$n=0.020$，通过流量$Q=8$m³/s。求正常水深$h_0$和流速$v$。

**【解答】**

Manning公式：

$$Q = \frac{1}{n}AR^{2/3}i^{1/2}$$

$$A = 4h_0, \quad R = \frac{4h_0}{4+2h_0}$$

代入试算：

假设$h_0 = 1.5$m：
- $A = 6$m²，$R = 0.857$m
- $Q_{calc} = \frac{1}{0.02} \times 6 \times 0.857^{2/3} \times 0.001^{0.5} = 8.23$ m³/s

调整至$h_0 \approx 1.47$m

$$v = \frac{Q}{A} = \frac{8}{4 \times 1.47} = 1.36 \text{ m/s}$$

---

### 【例题2】最优断面（15分）

**题目**：设计矩形渠道，$Q=10$m³/s，$i=0.0008$，$n=0.022$。采用最优断面，求$b$和$h_0$。

**【解答】**

最优断面：$b = 2h_0$

$$Q = \frac{1}{n} \cdot 2h_0 \cdot h_0 \cdot \left(\frac{2h_0}{4h_0}\right)^{2/3} \cdot i^{1/2}$$

$$10 = \frac{1}{0.022} \times 2h_0^2 \times 0.5^{2/3} \times 0.0008^{0.5}$$

解得$h_0 \approx 1.82$m，$b = 3.64$m

---

**本章重点**：
- Manning公式
- 正常水深计算
- 水力最优断面
- 允许流速

**下一章**：明渠临界流
