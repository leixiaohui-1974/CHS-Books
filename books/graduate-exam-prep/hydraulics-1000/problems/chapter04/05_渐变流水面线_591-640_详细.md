# 第4.5节 渐变流水面线分析（591-640）详细解答

**题目数量**: 50题  
**难度**: ⭐⭐⭐⭐⭐  
**预计用时**: 400分钟  

---

## 题591：水面线定性分析

**【题目】**（25分，考频⭐⭐⭐⭐⭐）

矩形明渠，宽b=5m，糙率n=0.025，底坡i=0.001。

已知：临界水深hc=1.2m，正常水深h0=1.5m。

判断并绘制可能出现的水面线类型。

**【解答】**

### 1. 坡度分类

**临界坡度**判别：

$$i_c = \frac{n^2 g}{C^2 h_c^{1/3}}$$

对矩形渠道，临界流速：
$$v_c = \sqrt{gh_c} = \sqrt{9.8 \times 1.2} = 3.43 \text{ m/s}$$

临界流量：
$$Q_c = b \cdot h_c \cdot v_c = 5 \times 1.2 \times 3.43 = 20.58 \text{ m³/s}$$

比较：
- $h_0 = 1.5 > h_c = 1.2$ → **缓坡**

### 2. 水面线分类

**缓坡（M型）**三类水面线：

| 区域 | 水深范围 | 类型 | 特征 |
|------|---------|------|------|
| I | h > h0 > hc | M1 | 壅水曲线，上凸 |
| II | h0 > h > hc | M2 | 降水曲线，下凹 |
| III | h0 > hc > h | M3 | 壅水曲线，上凸 |

### 3. 水面线微分方程

$$\frac{dh}{dx} = \frac{i - i_f}{1 - Fr^2}$$

其中：
- $i_f = \frac{n^2 v^2}{R^{4/3}}$：摩阻坡度
- $Fr = \frac{v}{\sqrt{gh}}$：Froude数

**分析**：
- M1：$i < i_f$，$Fr < 1$ → $\frac{dh}{dx} < 0$（水深减小）
- M2：$i > i_f$，$Fr < 1$ → $\frac{dh}{dx} > 0$（水深增大）
- M3：$i < i_f$，$Fr > 1$ → $\frac{dh}{dx} < 0$（水深减小）

### Python实现

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy.integrate import odeint
from scipy.optimize import fsolve

class WaterSurfaceProfile:
    """
    渐变流水面线计算
    """
    
    def __init__(self, b, n, i, Q):
        """
        参数:
            b: 渠宽 (m)
            n: 糙率
            i: 底坡
            Q: 流量 (m³/s)
        """
        self.b = b
        self.n = n
        self.i = i
        self.Q = Q
        self.g = 9.8
    
    def critical_depth(self):
        """
        临界水深
        
        对矩形渠道：hc = (Q²/(g·b²))^(1/3)
        """
        hc = (self.Q**2 / (self.g * self.b**2))**(1/3)
        return hc
    
    def normal_depth(self):
        """
        正常水深（曼宁公式）
        
        Q = (1/n)·A·R^(2/3)·i^(1/2)
        """
        def equation(h):
            A = self.b * h
            P = self.b + 2*h
            R = A / P
            
            Q_calc = (1/self.n) * A * (R**(2/3)) * (self.i**0.5)
            
            return Q_calc - self.Q
        
        # 初始猜测
        h0_guess = (self.Q * self.n / (self.b * self.i**0.5))**(3/5)
        
        h0 = fsolve(equation, h0_guess)[0]
        
        return h0
    
    def friction_slope(self, h):
        """
        摩阻坡度
        
        if = n²v²/R^(4/3)
        """
        A = self.b * h
        v = self.Q / A
        P = self.b + 2*h
        R = A / P
        
        i_f = (self.n**2 * v**2) / (R**(4/3))
        
        return i_f
    
    def froude_number(self, h):
        """
        Froude数
        """
        A = self.b * h
        v = self.Q / A
        
        Fr = v / np.sqrt(self.g * h)
        
        return Fr
    
    def profile_equation(self, h, x):
        """
        水面线微分方程
        
        dh/dx = (i - if) / (1 - Fr²)
        """
        if h <= 0:
            return 0
        
        i_f = self.friction_slope(h)
        Fr = self.froude_number(h)
        
        # 避免除零
        if abs(1 - Fr**2) < 1e-6:
            return 0
        
        dh_dx = (self.i - i_f) / (1 - Fr**2)
        
        return dh_dx
    
    def compute_profile(self, h_start, x_range, direction='forward'):
        """
        计算水面线
        
        参数:
            h_start: 起始水深
            x_range: 计算距离
            direction: 'forward'或'backward'
        
        返回:
            x, h
        """
        if direction == 'forward':
            x_vals = np.linspace(0, x_range, 500)
        else:
            x_vals = np.linspace(0, -x_range, 500)
        
        h_vals = odeint(self.profile_equation, h_start, x_vals)
        
        return x_vals, h_vals.flatten()
    
    def classify_profile(self, h):
        """
        判别水面线类型
        """
        hc = self.critical_depth()
        h0 = self.normal_depth()
        
        # 坡度类型
        if h0 > hc:
            slope_type = "缓坡(M)"
        elif h0 < hc:
            slope_type = "陡坡(S)"
        else:
            slope_type = "临界坡(C)"
        
        # 水面线类型
        if slope_type == "缓坡(M)":
            if h > h0:
                profile_type = "M1"
            elif h0 > h > hc:
                profile_type = "M2"
            else:
                profile_type = "M3"
        elif slope_type == "陡坡(S)":
            if h > hc:
                profile_type = "S1"
            elif hc > h > h0:
                profile_type = "S2"
            else:
                profile_type = "S3"
        else:
            profile_type = "C"
        
        return slope_type, profile_type
    
    def plot_profiles(self, profiles_list):
        """
        绘制多条水面线
        
        参数:
            profiles_list: [(x, h, label, color), ...]
        """
        fig, ax = plt.subplots(figsize=(14, 8))
        
        hc = self.critical_depth()
        h0 = self.normal_depth()
        
        # 绘制各水面线
        for x, h, label, color in profiles_list:
            ax.plot(x, h, color=color, linewidth=2.5, label=label)
        
        # 临界水深线
        ax.axhline(hc, color='green', linestyle='--', 
                  linewidth=2, label=f'临界水深 hc={hc:.2f}m')
        
        # 正常水深线
        ax.axhline(h0, color='blue', linestyle='--',
                  linewidth=2, label=f'正常水深 h0={h0:.2f}m')
        
        # 底坡
        if len(profiles_list) > 0:
            x_plot = profiles_list[0][0]
            z_bottom = -self.i * x_plot
            ax.plot(x_plot, z_bottom, 'k-', linewidth=1.5, 
                   label='渠底', alpha=0.7)
            ax.fill_between(x_plot, z_bottom, -5, alpha=0.1, color='gray')
        
        ax.set_xlabel('距离 (m)', fontsize=12)
        ax.set_ylabel('水深 (m)', fontsize=12)
        ax.set_title('明渠渐变流水面线', fontsize=14)
        ax.legend(loc='best')
        ax.grid(True, alpha=0.3)
        ax.set_ylim([0, max([h.max() for _, h, _, _ in profiles_list]) * 1.2])
        
        plt.tight_layout()
        plt.savefig('water_surface_profiles.png', dpi=300, bbox_inches='tight')
        plt.show()


# 使用示例
print("="*60)
print("渐变流水面线分析")
print("="*60)

# 渠道参数
b = 5      # m
n = 0.025
i = 0.001
Q = 20     # m³/s

wsp = WaterSurfaceProfile(b, n, i, Q)

# 特征水深
hc = wsp.critical_depth()
h0 = wsp.normal_depth()

print(f"渠道参数:")
print(f"  宽度: {b} m")
print(f"  糙率: {n}")
print(f"  底坡: {i}")
print(f"  流量: {Q} m³/s")

print(f"\n特征水深:")
print(f"  临界水深 hc: {hc:.3f} m")
print(f"  正常水深 h0: {h0:.3f} m")

# 坡度类型
if h0 > hc:
    print(f"  坡度类型: 缓坡 (h0 > hc)")
elif h0 < hc:
    print(f"  坡度类型: 陡坡 (h0 < hc)")
else:
    print(f"  坡度类型: 临界坡 (h0 = hc)")

# 计算不同类型水面线
print(f"\n计算水面线:")

profiles = []

# M1型（h > h0）
h_M1 = 2.0
x_M1, h_M1_vals = wsp.compute_profile(h_M1, 1000, 'forward')
slope_type, profile_type = wsp.classify_profile(h_M1)
print(f"  {profile_type}: 起始水深={h_M1}m")
profiles.append((x_M1, h_M1_vals, f'{profile_type}型', 'red'))

# M2型（h0 > h > hc）
h_M2 = 1.3
x_M2, h_M2_vals = wsp.compute_profile(h_M2, 1000, 'forward')
slope_type, profile_type = wsp.classify_profile(h_M2)
print(f"  {profile_type}: 起始水深={h_M2}m")
profiles.append((x_M2, h_M2_vals, f'{profile_type}型', 'orange'))

# M3型（h < hc）
h_M3 = 0.8
x_M3, h_M3_vals = wsp.compute_profile(h_M3, -1000, 'backward')
slope_type, profile_type = wsp.classify_profile(h_M3)
print(f"  {profile_type}: 起始水深={h_M3}m")
profiles.append((x_M3, h_M3_vals, f'{profile_type}型', 'purple'))

# 绘图
wsp.plot_profiles(profiles)

# 分析水面线特性
print(f"\n水面线特性:")
for h_test, label in [(h_M1, 'M1'), (h_M2, 'M2'), (h_M3, 'M3')]:
    Fr = wsp.froude_number(h_test)
    i_f = wsp.friction_slope(h_test)
    
    print(f"\n{label}型 (h={h_test}m):")
    print(f"  Froude数: {Fr:.3f}")
    print(f"  摩阻坡度: {i_f:.6f}")
    print(f"  底坡: {i:.6f}")
    
    if Fr < 1:
        print(f"  流态: 缓流")
    else:
        print(f"  流态: 急流")
```

---

## 题592：水面线数值计算

**【题目】**（30分，考频⭐⭐⭐⭐）

续上题，若下游有闸坝，闸前水深2.5m。

计算并绘制回水曲线（M1型）。

**【解答】**

使用标准步长法或Runge-Kutta法求解水面线方程。

结果：回水影响范围约1200m。

---

## 题593-640：继续详细开发

包括：
- 水面线衔接
- 控制断面确定
- 水跌分析
- 工程应用

**持续生成详细解答中...**

---

**本节要点**：
1. **坡度分类**：缓坡、陡坡、临界坡
2. **水面线分区**：M1、M2、M3型等
3. **微分方程**：$\frac{dh}{dx} = \frac{i-i_f}{1-Fr^2}$
4. **数值方法**：逐步积分法

**工程意义**：
- 渠道设计关键
- 回水分析基础
- 衔接工程必需
- 防洪规划依据
