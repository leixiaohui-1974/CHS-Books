# 第3章：积分速算技巧

**学习时间**: 3小时  
**必考指数**: ⭐⭐⭐⭐⭐

---

## 一、不定积分速算技巧

### 技巧1：凑微分法

**核心**：$\int f[g(x)]g'(x)dx = \int f[g(x)]dg(x) = F[g(x)] + C$

**示例**：
$$\int \frac{1}{1+x^2}dx = \int \frac{1}{1+(\tan\theta)^2} d(\tan\theta) = \arctan x + C$$

### 技巧2：分部积分万能公式

$$\int u dv = uv - \int v du$$

**优先级口诀**："反对幂指三"
- **反**：反三角函数
- **对**：对数函数
- **幂**：幂函数
- **指**：指数函数
- **三**：三角函数

优先级高的选为$u$

### 技巧3：有理函数积分

**待定系数法**：

$$\frac{1}{(x-1)(x-2)} = \frac{A}{x-1} + \frac{B}{x-2}$$

求出$A$、$B$后分别积分

### 技巧4：三角函数积分

**万能替换**：$t = \tan\frac{x}{2}$

$$\sin x = \frac{2t}{1+t^2}, \quad \cos x = \frac{1-t^2}{1+t^2}, \quad dx = \frac{2dt}{1+t^2}$$

### 技巧5：根式积分

**三角替换**：
- $\sqrt{a^2 - x^2}$：令$x = a\sin\theta$
- $\sqrt{a^2 + x^2}$：令$x = a\tan\theta$
- $\sqrt{x^2 - a^2}$：令$x = a\sec\theta$

---

## 二、定积分速算技巧

### 技巧6：对称性

**偶函数**：
$$\int_{-a}^{a} f(x)dx = 2\int_{0}^{a} f(x)dx \quad (f(-x) = f(x))$$

**奇函数**：
$$\int_{-a}^{a} f(x)dx = 0 \quad (f(-x) = -f(x))$$

### 技巧7：周期性

**周期函数**（周期为$T$）：
$$\int_{a}^{a+T} f(x)dx = \int_{0}^{T} f(x)dx$$

### 技巧8：区间再现

$$\int_{a}^{b} f(x)dx = \int_{a}^{b} f(a+b-x)dx$$

**应用**：两式相加，简化被积函数

### 技巧9：华里士公式

$$\int_{0}^{\frac{\pi}{2}} \sin^n x dx = \int_{0}^{\frac{\pi}{2}} \cos^n x dx = \begin{cases}
\frac{n-1}{n} \cdot \frac{n-3}{n-2} \cdots \frac{1}{2} \cdot \frac{\pi}{2} & (n \text{偶})\\
\frac{n-1}{n} \cdot \frac{n-3}{n-2} \cdots \frac{2}{3} \cdot 1 & (n \text{奇})
\end{cases}$$

### 技巧10：点火公式

$$I_n = \int_{0}^{\frac{\pi}{2}} \sin^n x dx = \frac{n-1}{n} I_{n-2}$$

### Python实现

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy import integrate
import sympy as sp

class IntegralQuickCalc:
    """积分速算技巧"""
    
    @staticmethod
    def substitution_demo():
        """凑微分法示例"""
        x = sp.Symbol('x')
        
        problems = [
            (2*x / (1 + x**2), '2x/(1+x²)'),
            (sp.exp(x) / (1 + sp.exp(x)), 'e^x/(1+e^x)'),
            (sp.sin(x) * sp.cos(x), 'sin(x)cos(x)')
        ]
        
        print("="*60)
        print("凑微分法示例")
        print("="*60)
        
        for expr, desc in problems:
            result = sp.integrate(expr, x)
            print(f"\n∫ {desc} dx = {result} + C")
            
            # 验证
            derivative = sp.diff(result, x)
            print(f"  验证: d/dx({result}) = {sp.simplify(derivative)}")
    
    @staticmethod
    def integration_by_parts_demo():
        """分部积分示例"""
        x = sp.Symbol('x')
        
        problems = [
            (x * sp.exp(x), 'x·e^x', x, sp.exp(x)),
            (x * sp.sin(x), 'x·sin(x)', x, -sp.cos(x)),
            (sp.log(x), 'ln(x)', sp.log(x), x)
        ]
        
        print("\n" + "="*60)
        print("分部积分示例")
        print("="*60)
        
        for expr, desc, u, dv in problems:
            result = sp.integrate(expr, x)
            print(f"\n∫ {desc} dx = {result} + C")
    
    @staticmethod
    def symmetry_property():
        """对称性速算"""
        print("\n" + "="*60)
        print("对称性积分")
        print("="*60)
        
        # 偶函数
        def f_even(x):
            return x**2 * np.cos(x)
        
        a = 2
        
        # 方法1：直接积分
        I1, _ = integrate.quad(f_even, -a, a)
        
        # 方法2：利用对称性
        I2_half, _ = integrate.quad(f_even, 0, a)
        I2 = 2 * I2_half
        
        print(f"\n偶函数: f(x) = x²·cos(x)")
        print(f"  区间: [{-a}, {a}]")
        print(f"  直接积分: {I1:.6f}")
        print(f"  对称性 2∫₀^a: {I2:.6f}")
        print(f"  时间节省: 约50%")
        
        # 奇函数
        def f_odd(x):
            return x**3 * np.sin(x)
        
        I_odd, _ = integrate.quad(f_odd, -a, a)
        
        print(f"\n奇函数: f(x) = x³·sin(x)")
        print(f"  区间: [{-a}, {a}]")
        print(f"  结果: {I_odd:.6f} ≈ 0")
        print(f"  对称性直接得0，无需计算！")
    
    @staticmethod
    def interval_reappearance():
        """区间再现公式"""
        print("\n" + "="*60)
        print("区间再现技巧")
        print("="*60)
        
        # 示例: ∫₀^π [x·sin(x)/(1+cos²x)] dx
        
        def f(x):
            return x * np.sin(x) / (1 + np.cos(x)**2)
        
        # 直接积分（困难）
        I_direct, _ = integrate.quad(f, 0, np.pi)
        
        print(f"\n例: ∫₀^π [x·sin(x)/(1+cos²x)] dx")
        print(f"\n技巧: 令 I = ∫₀^π f(x)dx")
        print(f"      I = ∫₀^π f(π-x)dx  (区间再现)")
        print(f"\n      f(π-x) = (π-x)sin(x)/(1+cos²x)")
        print(f"      2I = ∫₀^π [π·sin(x)/(1+cos²x)] dx")
        print(f"      I = (π/2) ∫₀^π [sin(x)/(1+cos²x)] dx")
        print(f"\n利用区间再现，被积函数简化了！")
        print(f"结果: I = {I_direct:.6f}")
    
    @staticmethod
    def wallis_formula():
        """华里士公式"""
        print("\n" + "="*60)
        print("华里士（点火）公式")
        print("="*60)
        
        def I_n_theoretical(n):
            """理论值"""
            if n % 2 == 0:
                # 偶数
                result = 1
                for k in range(n, 1, -2):
                    result *= (k - 1) / k
                result *= np.pi / 2
            else:
                # 奇数
                result = 1
                for k in range(n, 2, -2):
                    result *= (k - 1) / k
            
            return result
        
        print(f"\nI_n = ∫₀^(π/2) sin^n(x) dx")
        print(f"\n{'n':>3s} {'理论值':>12s} {'数值积分':>12s}")
        print("-" * 35)
        
        for n in range(1, 11):
            I_theory = I_n_theoretical(n)
            
            # 数值验证
            I_numeric, _ = integrate.quad(lambda x: np.sin(x)**n,
                                         0, np.pi/2)
            
            print(f"{n:3d} {I_theory:12.8f} {I_numeric:12.8f}")
    
    @staticmethod
    def plot_integral_techniques():
        """可视化积分技巧"""
        fig, axes = plt.subplots(2, 2, figsize=(14, 10))
        
        # (a) 对称性
        x_sym = np.linspace(-2, 2, 200)
        y_even = x_sym**2
        y_odd = x_sym**3
        
        axes[0, 0].plot(x_sym, y_even, 'b-', linewidth=2, label='偶函数 x²')
        axes[0, 0].fill_between(x_sym, 0, y_even, alpha=0.3, color='blue')
        axes[0, 0].plot(x_sym, y_odd, 'r-', linewidth=2, label='奇函数 x³')
        axes[0, 0].axhline(0, color='k', linewidth=0.5)
        axes[0, 0].axvline(0, color='k', linewidth=0.5)
        axes[0, 0].set_xlabel('x', fontsize=12)
        axes[0, 0].set_ylabel('f(x)', fontsize=12)
        axes[0, 0].set_title('对称性: 偶函数×2, 奇函数=0', fontsize=13)
        axes[0, 0].legend()
        axes[0, 0].grid(True, alpha=0.3)
        
        # (b) 周期性
        x_period = np.linspace(0, 4*np.pi, 500)
        y_period = np.sin(x_period)
        
        axes[0, 1].plot(x_period, y_period, 'g-', linewidth=2)
        
        # 标注一个周期
        axes[0, 1].fill_between(x_period[x_period <= 2*np.pi], 
                               0, 
                               y_period[x_period <= 2*np.pi],
                               alpha=0.3, color='green', label='一个周期')
        
        axes[0, 1].axhline(0, color='k', linewidth=0.5)
        axes[0, 1].set_xlabel('x', fontsize=12)
        axes[0, 1].set_ylabel('sin(x)', fontsize=12)
        axes[0, 1].set_title('周期性: ∫ₐ^(a+T) = ∫₀^T', fontsize=13)
        axes[0, 1].legend()
        axes[0, 1].grid(True, alpha=0.3)
        
        # (c) 区间再现
        x_interval = np.linspace(0, np.pi, 200)
        y_fx = x_interval * np.sin(x_interval)
        y_fa_plus_b_minus_x = (np.pi - x_interval) * np.sin(np.pi - x_interval)
        
        axes[1, 0].plot(x_interval, y_fx, 'b-', linewidth=2, label='f(x) = x·sin(x)')
        axes[1, 0].plot(x_interval, y_fa_plus_b_minus_x, 'r--', linewidth=2,
                       label='f(π-x) = (π-x)·sin(π-x)')
        axes[1, 0].set_xlabel('x', fontsize=12)
        axes[1, 0].set_ylabel('f(x)', fontsize=12)
        axes[1, 0].set_title('区间再现: f(x) + f(a+b-x)', fontsize=13)
        axes[1, 0].legend()
        axes[1, 0].grid(True, alpha=0.3)
        
        # (d) 华里士公式
        n_values = np.arange(1, 11)
        I_values = []
        
        for n in n_values:
            if n % 2 == 0:
                result = 1
                for k in range(n, 1, -2):
                    result *= (k - 1) / k
                result *= np.pi / 2
            else:
                result = 1
                for k in range(n, 2, -2):
                    result *= (k - 1) / k
            
            I_values.append(result)
        
        axes[1, 1].plot(n_values, I_values, 'mo-', linewidth=2, markersize=8)
        axes[1, 1].set_xlabel('n', fontsize=12)
        axes[1, 1].set_ylabel('I_n', fontsize=12)
        axes[1, 1].set_title('华里士公式: I_n = ∫₀^(π/2) sin^n(x) dx', fontsize=13)
        axes[1, 1].grid(True, alpha=0.3)
        
        plt.tight_layout()
        plt.savefig('integral_techniques.png', dpi=300)
        plt.show()

# 执行示例
print("="*60)
print("积分速算技巧演示")
print("="*60)

calc = IntegralQuickCalc()

# 1. 凑微分法
calc.substitution_demo()

# 2. 分部积分
calc.integration_by_parts_demo()

# 3. 对称性
calc.symmetry_property()

# 4. 区间再现
calc.interval_reappearance()

# 5. 华里士公式
calc.wallis_formula()

# 6. 可视化
calc.plot_integral_techniques()
```

---

## 三、常见积分公式速查

### 基本积分

| 被积函数 | 原函数 |
|---------|--------|
| $x^n$ | $\frac{x^{n+1}}{n+1} + C$ |
| $\frac{1}{x}$ | $\ln|x| + C$ |
| $e^x$ | $e^x + C$ |
| $a^x$ | $\frac{a^x}{\ln a} + C$ |
| $\sin x$ | $-\cos x + C$ |
| $\cos x$ | $\sin x + C$ |
| $\frac{1}{1+x^2}$ | $\arctan x + C$ |
| $\frac{1}{\sqrt{1-x^2}}$ | $\arcsin x + C$ |

---

## 四、练习题

### 练习1-10（每题5分）

1. $\int \frac{x}{x^2+1}dx$ **（凑微分）**

**解**：令$u = x^2 + 1$，$du = 2xdx$

$$\int \frac{x}{x^2+1}dx = \frac{1}{2}\int \frac{1}{u}du = \frac{1}{2}\ln|u| + C = \frac{1}{2}\ln(x^2+1) + C$$

---

2. $\int x e^x dx$ **（分部积分）**

**解**：令$u=x$，$dv=e^x dx$

$$\int x e^x dx = xe^x - \int e^x dx = xe^x - e^x + C = e^x(x-1) + C$$

---

3. $\int_{-1}^{1} x^3 dx$ **（奇函数）**

**解**：$f(-x) = -f(x)$，奇函数

$$\int_{-1}^{1} x^3 dx = 0$$

---

4. $\int_{0}^{\pi} \frac{x\sin x}{1+\cos^2 x}dx$ **（区间再现）**

**解**：令$I = \int_{0}^{\pi} f(x)dx = \int_{0}^{\pi} f(\pi-x)dx$

$$2I = \int_{0}^{\pi} \frac{\pi\sin x}{1+\cos^2 x}dx = \pi \cdot \frac{\pi}{2} = \frac{\pi^2}{2}$$

$$I = \frac{\pi^2}{4}$$

---

5. $\int_{0}^{\frac{\pi}{2}} \sin^4 x dx$ **（华里士公式）**

**解**：$n=4$（偶数）

$$I_4 = \frac{3}{4} \cdot \frac{1}{2} \cdot \frac{\pi}{2} = \frac{3\pi}{16}$$

---

**本章重点**：
- 凑微分法（最常用）
- 分部积分（u选择口诀）
- 对称性（奇偶性速判）
- 区间再现（简化技巧）
- 华里士公式（必背）

**下一章**：级数速算技巧
