# 第9章：常微分方程进阶速算

**学习时间**: 4小时  
**考试频率**: ⭐⭐⭐⭐  
**难度**: ⭐⭐⭐⭐⭐

---

## 一、高阶线性微分方程

### 1.1 常系数线性方程

**一般形式**：
$$y^{(n)} + p_{1}y^{(n-1)} + \cdots + p_{n-1}y' + p_ny = f(x)$$

**齐次方程特征根法**：

**特征方程**：
$$\lambda^n + p_1\lambda^{n-1} + \cdots + p_{n-1}\lambda + p_n = 0$$

**通解构造**：
| 特征根类型 | 通解形式 |
|------------|----------|
| $k$重实根$\lambda$ | $(C_1 + C_2x + \cdots + C_kx^{k-1})e^{\lambda x}$ |
| 单实根$\lambda_1, \lambda_2, \ldots$ | $C_1e^{\lambda_1 x} + C_2e^{\lambda_2 x} + \cdots$ |
| $k$重复根$\alpha \pm \beta i$ | $e^{\alpha x}[(C_1+C_2x+\cdots)]\cos\beta x + (D_1+D_2x+\cdots)\sin\beta x$ |

**例题1**：求解$y''' - 6y'' + 11y' - 6y = 0$

**解**：
特征方程：$\lambda^3 - 6\lambda^2 + 11\lambda - 6 = 0$

分解因式：$(\lambda-1)(\lambda-2)(\lambda-3) = 0$

特征根：$\lambda_1=1, \lambda_2=2, \lambda_3=3$

通解：
$$y = C_1e^x + C_2e^{2x} + C_3e^{3x}$$

---

### 1.2 非齐次方程特解

**方法1：待定系数法**

**$f(x) = P_m(x)e^{\alpha x}$型**：

特解形式：$y^* = x^k Q_m(x)e^{\alpha x}$

其中：
- $Q_m(x)$为$m$次多项式
- $k$为$\alpha$是特征根的重数（0,1,2,...）

**例题2**：求$y'' - 3y' + 2y = 2e^x$的特解

**解**：
特征方程：$\lambda^2 - 3\lambda + 2 = 0$，$\lambda_1=1, \lambda_2=2$

$f(x) = 2e^x$，$\alpha=1$是单特征根，$k=1$

设特解：$y^* = Axe^x$

代入原方程：
$$y^* = Axe^x, \quad y'^* = Ae^x + Axe^x, \quad y''^* = 2Ae^x + Axe^x$$

$$(2A + Ax)e^x - 3(A + Ax)e^x + 2Axe^x = 2e^x$$
$$-Ae^x = 2e^x$$
$$A = -2$$

特解：$y^* = -2xe^x$

通解：$y = C_1e^x + C_2e^{2x} - 2xe^x$

---

**$f(x) = P_m(x)e^{\alpha x}\cos\beta x$或$P_m(x)e^{\alpha x}\sin\beta x$型**：

特解形式：$y^* = x^k e^{\alpha x}[Q_m^{(1)}(x)\cos\beta x + Q_m^{(2)}(x)\sin\beta x]$

---

**方法2：常数变易法**

设齐次方程通解为$y = C_1y_1 + C_2y_2 + \cdots + C_ny_n$

非齐次特解：$y^* = u_1(x)y_1 + u_2(x)y_2 + \cdots + u_n(x)y_n$

通过Cramer法则求$u_i'(x)$，再积分得$u_i(x)$

---

## 二、Euler方程

### 2.1 标准形式

$$x^ny^{(n)} + p_1x^{n-1}y^{(n-1)} + \cdots + p_{n-1}xy' + p_ny = f(x)$$

**变换**：令$x = e^t$（或$t = \ln x$）

$$x\frac{d}{dx} = \frac{d}{dt}$$
$$x^2\frac{d^2}{dx^2} = \frac{d^2}{dt^2} - \frac{d}{dt}$$

**例题3**：求解$x^2y'' - 2xy' + 2y = 0$

**解**：
令$x = e^t$，$t = \ln x$

$$x^2y'' = \frac{d^2y}{dt^2} - \frac{dy}{dt}$$
$$xy' = \frac{dy}{dt}$$

代入：
$$\frac{d^2y}{dt^2} - \frac{dy}{dt} - 2\frac{dy}{dt} + 2y = 0$$
$$\frac{d^2y}{dt^2} - 3\frac{dy}{dt} + 2y = 0$$

特征方程：$\lambda^2 - 3\lambda + 2 = 0$，$\lambda=1, 2$

$$y = C_1e^t + C_2e^{2t} = C_1x + C_2x^2$$

---

## 三、微分方程组

### 3.1 常系数线性方程组

**标准形式**：
$$\begin{cases}
\frac{dx}{dt} = a_{11}x + a_{12}y + f_1(t) \\
\frac{dy}{dt} = a_{21}x + a_{22}y + f_2(t)
\end{cases}$$

**矩阵形式**：
$$\frac{d\mathbf{X}}{dt} = A\mathbf{X} + \mathbf{F}(t)$$

**解法1：消元法**

对第一式求导，消去$y$，得到关于$x$的高阶方程

**解法2：特征值法**

齐次方程$\frac{d\mathbf{X}}{dt} = A\mathbf{X}$的解：
$$\mathbf{X} = e^{\lambda t}\mathbf{v}$$

其中$\lambda$为$A$的特征值，$\mathbf{v}$为对应特征向量

**例题4**：求解
$$\begin{cases}
\frac{dx}{dt} = x + 2y \\
\frac{dy}{dt} = 3x + 2y
\end{cases}$$

**解**（特征值法）：
$$A = \begin{bmatrix} 1 & 2 \\ 3 & 2 \end{bmatrix}$$

特征方程：$\det(A - \lambda I) = 0$
$$(\lambda-1)(\lambda-2) - 6 = 0$$
$$\lambda^2 - 3\lambda - 4 = 0$$
$$\lambda_1 = 4, \lambda_2 = -1$$

对$\lambda_1=4$：
$$(A - 4I)\mathbf{v_1} = 0 \Rightarrow \begin{bmatrix} -3 & 2 \\ 3 & -2 \end{bmatrix}\begin{bmatrix} v_1 \\ v_2 \end{bmatrix} = 0$$
$$\mathbf{v_1} = \begin{bmatrix} 2 \\ 3 \end{bmatrix}$$

对$\lambda_2=-1$：
$$\mathbf{v_2} = \begin{bmatrix} 1 \\ -1 \end{bmatrix}$$

通解：
$$\begin{bmatrix} x \\ y \end{bmatrix} = C_1e^{4t}\begin{bmatrix} 2 \\ 3 \end{bmatrix} + C_2e^{-t}\begin{bmatrix} 1 \\ -1 \end{bmatrix}$$

---

## 四、Python实现

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy.integrate import odeint
from scipy.linalg import eig
import sympy as sp

class AdvancedODE:
    """高级常微分方程工具"""
    
    @staticmethod
    def solve_high_order_ode_symbolic(n, coeffs, f_x):
        """
        符号求解高阶常系数ODE
        
        参数:
            n: 阶数
            coeffs: 系数列表[p1, p2, ..., pn]
            f_x: 右端函数（符号表达式）
        """
        x = sp.Symbol('x')
        y = sp.Function('y')
        
        # 构造微分方程
        # 例如：y'' + p1*y' + p2*y = f(x)
        ode = y(x).diff(x, n)
        for i, coef in enumerate(coeffs):
            ode += coef * y(x).diff(x, n-1-i)
        ode = sp.Eq(ode, f_x)
        
        # 求解
        solution = sp.dsolve(ode, y(x))
        
        return solution
    
    @staticmethod
    def solve_euler_equation(a, b, c, x_range):
        """
        求解Euler方程: ax²y'' + bxy' + cy = 0
        
        参数:
            a, b, c: 系数
            x_range: 求解区间
        
        返回:
            x: 自变量数组
            y: 通解数组
        """
        # 转化为常系数方程
        # 令x = e^t
        # 特征方程: aλ² + (b-a)λ + c = 0
        
        A = a
        B = b - a
        C = c
        
        discriminant = B**2 - 4*A*C
        
        if discriminant > 0:
            # 两个不等实根
            lambda1 = (-B + np.sqrt(discriminant)) / (2*A)
            lambda2 = (-B - np.sqrt(discriminant)) / (2*A)
            
            x = np.linspace(x_range[0], x_range[1], 200)
            y = x**lambda1 + x**lambda2  # C1=C2=1（示例）
            
            print(f"通解: y = C₁x^{lambda1:.2f} + C₂x^{lambda2:.2f}")
            
        elif discriminant == 0:
            # 重根
            lambda_root = -B / (2*A)
            
            x = np.linspace(x_range[0], x_range[1], 200)
            y = x**lambda_root * (1 + np.log(x))
            
            print(f"通解: y = (C₁ + C₂lnx)x^{lambda_root:.2f}")
            
        else:
            # 共轭复根
            alpha = -B / (2*A)
            beta = np.sqrt(-discriminant) / (2*A)
            
            x = np.linspace(x_range[0], x_range[1], 200)
            y = x**alpha * np.cos(beta * np.log(x))
            
            print(f"通解: y = x^{alpha:.2f}[C₁cos({beta:.2f}lnx) + C₂sin({beta:.2f}lnx)]")
        
        return x, y
    
    @staticmethod
    def solve_ode_system(A, x0, t_range):
        """
        求解常系数线性ODE组: dx/dt = Ax
        
        参数:
            A: 系数矩阵(n×n)
            x0: 初值向量
            t_range: 时间范围[t_min, t_max]
        
        返回:
            t: 时间数组
            X: 解矩阵(n×len(t))
        """
        n = A.shape[0]
        
        # 定义ODE组
        def system(X, t):
            return A @ X
        
        # 求解
        t = np.linspace(t_range[0], t_range[1], 500)
        X = odeint(system, x0, t).T
        
        return t, X
    
    @staticmethod
    def plot_phase_portrait(A, x_range=(-3, 3), y_range=(-3, 3)):
        """
        绘制二维ODE组的相图
        
        参数:
            A: 2×2系数矩阵
            x_range, y_range: 坐标范围
        """
        fig, axes = plt.subplots(1, 2, figsize=(14, 6))
        
        # 计算特征值
        eigenvalues, eigenvectors = eig(A)
        
        # 相图
        ax1 = axes[0]
        
        # 网格
        x = np.linspace(x_range[0], x_range[1], 20)
        y = np.linspace(y_range[0], y_range[1], 20)
        X, Y = np.meshgrid(x, y)
        
        # 向量场
        U = A[0,0]*X + A[0,1]*Y
        V = A[1,0]*X + A[1,1]*Y
        
        # 归一化
        M = np.sqrt(U**2 + V**2)
        M[M==0] = 1
        U_norm = U / M
        V_norm = V / M
        
        ax1.quiver(X, Y, U_norm, V_norm, M, cmap='viridis', alpha=0.8)
        
        # 绘制特征向量
        for i in range(2):
            v = eigenvectors[:, i].real
            if np.linalg.norm(v) > 1e-10:
                ax1.plot([0, 3*v[0]], [0, 3*v[1]], 'r-', linewidth=2.5,
                        label=f'特征向量{i+1}')
        
        ax1.set_xlabel('x', fontsize=11)
        ax1.set_ylabel('y', fontsize=11)
        ax1.set_title(f'相图 (特征值: {eigenvalues[0]:.2f}, {eigenvalues[1]:.2f})',
                     fontsize=12, fontweight='bold')
        ax1.grid(True, alpha=0.3)
        ax1.legend()
        ax1.axis('equal')
        
        # 解曲线
        ax2 = axes[1]
        
        # 多组初值
        initial_conditions = [
            [1, 0], [0, 1], [1, 1], [-1, 1],
            [2, 1], [1, 2], [-1, -1], [2, -1]
        ]
        
        for x0 in initial_conditions:
            t, X = AdvancedODE.solve_ode_system(A, x0, [0, 5])
            ax2.plot(t, X[0], '-', linewidth=1.5, alpha=0.7)
            ax2.plot(t, X[1], '--', linewidth=1.5, alpha=0.7)
        
        ax2.set_xlabel('t', fontsize=11)
        ax2.set_ylabel('x(t), y(t)', fontsize=11)
        ax2.set_title('解曲线', fontsize=12, fontweight='bold')
        ax2.grid(True, alpha=0.3)
        
        plt.tight_layout()
        plt.savefig('ode_system_analysis.png', dpi=300)
        plt.show()

# 示例使用
print("="*60)
print("高级ODE求解器")
print("="*60)

aode = AdvancedODE()

# 1. Euler方程
print("\n1. Euler方程: x²y'' - 2xy' + 2y = 0")

x, y = aode.solve_euler_equation(a=1, b=-2, c=2, x_range=(0.1, 5))

plt.figure(figsize=(10, 6))
plt.plot(x, y, 'b-', linewidth=2.5, label='解曲线')
plt.xlabel('x', fontsize=11)
plt.ylabel('y', fontsize=11)
plt.title('Euler方程解', fontsize=13, fontweight='bold')
plt.legend()
plt.grid(True, alpha=0.3)
plt.savefig('euler_equation.png', dpi=300)
plt.show()

# 2. ODE组
print("\n" + "="*60)
print("2. ODE组求解")

A = np.array([[1, 2],
              [3, 2]])

print(f"系数矩阵A:")
print(A)

# 计算特征值
eigenvalues, eigenvectors = np.linalg.eig(A)
print(f"\n特征值: {eigenvalues}")
print(f"特征向量:\n{eigenvectors}")

# 求解并绘图
x0 = [1, 0]
t, X = aode.solve_ode_system(A, x0, [0, 2])

plt.figure(figsize=(14, 5))

# 时间序列
plt.subplot(1, 2, 1)
plt.plot(t, X[0], 'b-', linewidth=2, label='x(t)')
plt.plot(t, X[1], 'r-', linewidth=2, label='y(t)')
plt.xlabel('t', fontsize=11)
plt.ylabel('x(t), y(t)', fontsize=11)
plt.title('时间序列', fontsize=12, fontweight='bold')
plt.legend()
plt.grid(True, alpha=0.3)

# 相平面
plt.subplot(1, 2, 2)
plt.plot(X[0], X[1], 'b-', linewidth=2)
plt.plot(X[0,0], X[1,0], 'go', markersize=12, label='初值')
plt.plot(X[0,-1], X[1,-1], 'rs', markersize=12, label='终值')
plt.xlabel('x', fontsize=11)
plt.ylabel('y', fontsize=11)
plt.title('相平面轨迹', fontsize=12, fontweight='bold')
plt.legend()
plt.grid(True, alpha=0.3)

plt.tight_layout()
plt.savefig('ode_system_solution.png', dpi=300)
plt.show()

# 3. 相图分析
print("\n绘制相图...")
aode.plot_phase_portrait(A)
```

---

## 五、边值问题

### 5.1 Sturm-Liouville问题

**标准形式**：
$$\frac{d}{dx}\left[p(x)\frac{dy}{dx}\right] + [\lambda r(x) - q(x)]y = 0$$

边界条件（两种）：
- 第一类：$y(a)=0, y(b)=0$
- 第二类：$y'(a)=0, y'(b)=0$
- 第三类（混合）

---

**本章重点**：
- 高阶线性ODE（特征根法、待定系数法）
- Euler方程变换
- 线性ODE组（消元法、特征值法）
- 相图分析
- 边值问题

**下一章**：数学建模与应用
