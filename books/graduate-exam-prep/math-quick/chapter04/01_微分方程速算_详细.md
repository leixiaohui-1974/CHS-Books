# 第4章：微分方程速算技巧

**学习时间**: 3小时  
**考试频率**: ⭐⭐⭐⭐⭐  
**难度**: ⭐⭐⭐⭐

---

## 一、一阶微分方程速算

### 技巧1：可分离变量型

**标准形式**：$\frac{dy}{dx} = f(x)g(y)$

**速算步骤**：
1. 分离变量：$\frac{dy}{g(y)} = f(x)dx$
2. 两边积分：$\int\frac{dy}{g(y)} = \int f(x)dx$
3. 代入初值

**例**：$\frac{dy}{dx} = xy$，$y(0)=1$

$$\frac{dy}{y} = xdx \Rightarrow \ln|y| = \frac{x^2}{2} + C$$

$y(0)=1 \Rightarrow C=0$，故$y = e^{x^2/2}$

---

### 技巧2：齐次方程（换元法）

**标准形式**：$\frac{dy}{dx} = f\left(\frac{y}{x}\right)$

**速算步骤**：
1. 令$u = \frac{y}{x}$，则$y = ux$，$\frac{dy}{dx} = u + x\frac{du}{dx}$
2. 代入原方程：$u + x\frac{du}{dx} = f(u)$
3. 分离变量：$\frac{du}{f(u) - u} = \frac{dx}{x}$

**例**：$\frac{dy}{dx} = \frac{y}{x} + \frac{x}{y}$

令$u = y/x$：
$$u + x\frac{du}{dx} = u + \frac{1}{u} \Rightarrow x\frac{du}{dx} = \frac{1}{u}$$

$$udu = \frac{dx}{x} \Rightarrow \frac{u^2}{2} = \ln|x| + C$$

---

### 技巧3：一阶线性方程（公式法）

**标准形式**：$\frac{dy}{dx} + P(x)y = Q(x)$

**通解公式（背下来！）**：
$$y = e^{-\int P(x)dx}\left[\int Q(x)e^{\int P(x)dx}dx + C\right]$$

**记忆口诀**：先乘积分因子，再积分右端

**例**：$\frac{dy}{dx} + \frac{y}{x} = x^2$

$P(x) = \frac{1}{x}$，$\int P(x)dx = \ln|x|$

积分因子：$e^{\ln x} = x$

$$y = \frac{1}{x}\left[\int x \cdot x^2 dx + C\right] = \frac{1}{x}\left[\frac{x^4}{4} + C\right] = \frac{x^3}{4} + \frac{C}{x}$$

---

### 技巧4：伯努利方程（降阶法）

**标准形式**：$\frac{dy}{dx} + P(x)y = Q(x)y^n$ ($n \neq 0, 1$)

**速算步骤**：
1. 两边除以$y^n$：$y^{-n}\frac{dy}{dx} + P(x)y^{1-n} = Q(x)$
2. 令$z = y^{1-n}$，$\frac{dz}{dx} = (1-n)y^{-n}\frac{dy}{dx}$
3. 转化为一阶线性方程：$\frac{dz}{dx} + (1-n)P(x)z = (1-n)Q(x)$

**例**：$\frac{dy}{dx} - y = e^x y^2$

除以$y^2$：$y^{-2}\frac{dy}{dx} - y^{-1} = e^x$

令$z = y^{-1}$：$-\frac{dz}{dx} - z = e^x \Rightarrow \frac{dz}{dx} + z = -e^x$

---

### 技巧5：全微分方程（积分因子）

**判定**：$P(x,y)dx + Q(x,y)dy = 0$，若$\frac{\partial P}{\partial y} = \frac{\partial Q}{\partial x}$

**速算**：
$$u(x,y) = \int P(x,y)dx + \int [Q(x,y) - \frac{\partial}{\partial y}\int P dx]dy = C$$

---

## 二、二阶常系数线性微分方程速算

### 技巧6：特征根法（齐次方程）

**标准形式**：$y'' + py' + qy = 0$

**特征方程**：$r^2 + pr + q = 0$

**通解速查表**：

| 判别式$\Delta = p^2 - 4q$ | 特征根 | 通解 |
|-------------------------|-------|------|
| $\Delta > 0$ | 两不等实根$r_1, r_2$ | $y = C_1e^{r_1 x} + C_2e^{r_2 x}$ |
| $\Delta = 0$ | 重根$r$ | $y = (C_1 + C_2 x)e^{rx}$ |
| $\Delta < 0$ | 共轭复根$\alpha \pm i\beta$ | $y = e^{\alpha x}(C_1\cos\beta x + C_2\sin\beta x)$ |

**例**：$y'' - 5y' + 6y = 0$

特征方程：$r^2 - 5r + 6 = 0 \Rightarrow (r-2)(r-3) = 0$

$r_1 = 2, r_2 = 3$，通解：$y = C_1 e^{2x} + C_2 e^{3x}$

---

### 技巧7：待定系数法（非齐次方程）

**标准形式**：$y'' + py' + qy = f(x)$

**通解 = 齐次通解 + 特解**

**特解形式速查表**：

| $f(x)$类型 | 特解形式$y^*$ |
|-----------|--------------|
| $P_n(x)$ | $x^k Q_n(x)$ |
| $e^{\lambda x}$ | $x^k Ae^{\lambda x}$ |
| $e^{\lambda x}P_n(x)$ | $x^k e^{\lambda x}Q_n(x)$ |
| $\cos\omega x$或$\sin\omega x$ | $x^k(A\cos\omega x + B\sin\omega x)$ |

**$k$的确定**：
- 若$\lambda$（或$i\omega$）不是特征根，$k=0$
- 若$\lambda$是单根，$k=1$
- 若$\lambda$是重根，$k=2$

**例**：$y'' - 3y' + 2y = e^{2x}$

齐次通解：$y_h = C_1 e^x + C_2 e^{2x}$

$\lambda = 2$是单根，设$y^* = Axe^{2x}$

代入原方程求得$A = 1$，特解$y^* = xe^{2x}$

通解：$y = C_1 e^x + C_2 e^{2x} + xe^{2x}$

---

### 技巧8：欧拉方程（换元降阶）

**标准形式**：$x^2y'' + pxy' + qy = 0$

**速算步骤**：令$x = e^t$（或$t = \ln x$）

$$\frac{dy}{dx} = \frac{1}{x}\frac{dy}{dt}, \quad \frac{d^2y}{dx^2} = \frac{1}{x^2}\left(\frac{d^2y}{dt^2} - \frac{dy}{dt}\right)$$

转化为常系数方程：
$$\frac{d^2y}{dt^2} + (p-1)\frac{dy}{dt} + qy = 0$$

---

## 三、高阶微分方程速算

### 技巧9：降阶法

**类型1**：$y^{(n)} = f(x)$

**速算**：连续积分$n$次

**例**：$y''' = 6x$

$$y'' = 3x^2 + C_1$$
$$y' = x^3 + C_1 x + C_2$$
$$y = \frac{x^4}{4} + \frac{C_1 x^2}{2} + C_2 x + C_3$$

---

**类型2**：不显含$y$：$y'' = f(x, y')$

**速算**：令$p = y'$，$y'' = \frac{dp}{dx}$

转化为一阶方程：$\frac{dp}{dx} = f(x, p)$

---

**类型3**：不显含$x$：$y'' = f(y, y')$

**速算**：令$p = y'$，$y'' = p\frac{dp}{dy}$

转化为：$p\frac{dp}{dy} = f(y, p)$

---

### 技巧10：幂级数法（特殊点）

**贝塞尔方程**：$x^2y'' + xy' + (x^2 - n^2)y = 0$

**通解**：$y = C_1 J_n(x) + C_2 Y_n(x)$

（$J_n$：第一类贝塞尔函数，$Y_n$：第二类贝塞尔函数）

---

## 四、Python实现

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy.integrate import odeint
import sympy as sp

class DifferentialEquationQuick:
    """微分方程速算"""
    
    @staticmethod
    def solve_separable(f, g, x0, y0, x_range):
        """
        可分离变量：dy/dx = f(x)*g(y)
        
        数值求解
        """
        def dydt(y, x):
            return f(x) * g(y)
        
        x_vals = np.linspace(x_range[0], x_range[1], 200)
        y_vals = odeint(dydt, y0, x_vals)
        
        return x_vals, y_vals.flatten()
    
    @staticmethod
    def solve_first_order_linear(P, Q, x0, y0, x_range):
        """
        一阶线性：dy/dx + P(x)y = Q(x)
        
        通解公式法
        """
        # 数值求解
        def dydt(y, x):
            return Q(x) - P(x) * y
        
        x_vals = np.linspace(x_range[0], x_range[1], 200)
        y_vals = odeint(dydt, y0, x_vals)
        
        return x_vals, y_vals.flatten()
    
    @staticmethod
    def solve_second_order_constant_coeff(p, q, f, x0, y0, yp0, x_range):
        """
        二阶常系数：y'' + py' + qy = f(x)
        
        参数:
            p, q: 常数
            f: 右端函数
            x0, y0, yp0: 初值
            x_range: x范围
        """
        def system(Y, x):
            y, yp = Y
            ypp = f(x) - q*y - p*yp
            return [yp, ypp]
        
        x_vals = np.linspace(x_range[0], x_range[1], 200)
        Y_vals = odeint(system, [y0, yp0], x_vals)
        
        return x_vals, Y_vals[:, 0]
    
    @staticmethod
    def characteristic_roots(p, q):
        """
        特征根计算
        
        r² + pr + q = 0
        """
        delta = p**2 - 4*q
        
        if delta > 0:
            r1 = (-p + np.sqrt(delta)) / 2
            r2 = (-p - np.sqrt(delta)) / 2
            root_type = '两不等实根'
            roots = (r1, r2)
        elif delta == 0:
            r = -p / 2
            root_type = '重根'
            roots = (r, r)
        else:
            alpha = -p / 2
            beta = np.sqrt(-delta) / 2
            root_type = '共轭复根'
            roots = (alpha, beta)
        
        return roots, root_type, delta
    
    @staticmethod
    def symbolic_solve_example():
        """符号求解示例"""
        x = sp.Symbol('x')
        y = sp.Function('y')
        
        # 示例：y' + y = x
        eq = sp.Eq(y(x).diff(x) + y(x), x)
        
        solution = sp.dsolve(eq, y(x))
        
        return solution
    
    @staticmethod
    def plot_solutions_comparison():
        """绘制不同类型微分方程解的对比"""
        fig, axes = plt.subplots(2, 2, figsize=(16, 12))
        
        # 1. 可分离变量：dy/dx = xy, y(0)=1
        ax1 = axes[0, 0]
        
        def f1(x):
            return x
        
        def g1(y):
            return y
        
        x1, y1 = DifferentialEquationQuick.solve_separable(f1, g1, 0, 1, (-2, 2))
        
        # 精确解
        y1_exact = np.exp(x1**2 / 2)
        
        ax1.plot(x1, y1, 'b-', linewidth=2.5, label='数值解')
        ax1.plot(x1, y1_exact, 'r--', linewidth=2, label='精确解 y=e^(x²/2)')
        ax1.set_xlabel('x', fontsize=11)
        ax1.set_ylabel('y', fontsize=11)
        ax1.set_title("可分离变量：dy/dx = xy, y(0)=1", fontsize=13, fontweight='bold')
        ax1.legend()
        ax1.grid(True, alpha=0.3)
        
        # 2. 一阶线性：dy/dx + y = e^x, y(0)=0
        ax2 = axes[0, 1]
        
        def P2(x):
            return 1
        
        def Q2(x):
            return np.exp(x)
        
        x2, y2 = DifferentialEquationQuick.solve_first_order_linear(P2, Q2, 0, 0, (0, 3))
        
        # 精确解
        y2_exact = 0.5 * x2 * np.exp(x2)
        
        ax2.plot(x2, y2, 'g-', linewidth=2.5, label='数值解')
        ax2.plot(x2, y2_exact, 'r--', linewidth=2, label='精确解 y=(x/2)e^x')
        ax2.set_xlabel('x', fontsize=11)
        ax2.set_ylabel('y', fontsize=11)
        ax2.set_title("一阶线性：dy/dx + y = e^x, y(0)=0", fontsize=13, fontweight='bold')
        ax2.legend()
        ax2.grid(True, alpha=0.3)
        
        # 3. 二阶齐次：y'' - y = 0, y(0)=1, y'(0)=0
        ax3 = axes[1, 0]
        
        def f3(x):
            return 0
        
        x3, y3 = DifferentialEquationQuick.solve_second_order_constant_coeff(0, -1, f3, 0, 1, 0, (0, 3))
        
        # 精确解：特征根 r=±1，通解 y = C1*e^x + C2*e^(-x)
        # y(0)=1, y'(0)=0 => C1=C2=0.5
        y3_exact = 0.5 * (np.exp(x3) + np.exp(-x3))  # = cosh(x)
        
        ax3.plot(x3, y3, 'orange', linewidth=2.5, label='数值解')
        ax3.plot(x3, y3_exact, 'r--', linewidth=2, label='精确解 y=cosh(x)')
        ax3.set_xlabel('x', fontsize=11)
        ax3.set_ylabel('y', fontsize=11)
        ax3.set_title("二阶齐次：y'' - y = 0, y(0)=1, y'(0)=0", fontsize=13, fontweight='bold')
        ax3.legend()
        ax3.grid(True, alpha=0.3)
        
        # 4. 二阶非齐次：y'' + 4y = sin(x), y(0)=0, y'(0)=0
        ax4 = axes[1, 1]
        
        def f4(x):
            return np.sin(x)
        
        x4, y4 = DifferentialEquationQuick.solve_second_order_constant_coeff(0, 4, f4, 0, 0, 0, (0, 4*np.pi))
        
        ax4.plot(x4, y4, 'purple', linewidth=2.5, label='数值解')
        ax4.set_xlabel('x', fontsize=11)
        ax4.set_ylabel('y', fontsize=11)
        ax4.set_title("二阶非齐次：y'' + 4y = sin(x), y(0)=0, y'(0)=0", fontsize=13, fontweight='bold')
        ax4.legend()
        ax4.grid(True, alpha=0.3)
        
        plt.tight_layout()
        plt.savefig('differential_equations_quick.png', dpi=300)
        plt.show()

# 示例1：特征根计算
print("="*60)
print("示例1：二阶常系数特征根速算")
print("="*60)

de_quick = DifferentialEquationQuick()

equations = [
    (-5, 6, "y'' - 5y' + 6y = 0"),
    (-4, 4, "y'' - 4y' + 4y = 0"),
    (0, 4, "y'' + 4y = 0"),
    (-2, 5, "y'' - 2y' + 5y = 0"),
]

for p, q, eq_str in equations:
    roots, root_type, delta = de_quick.characteristic_roots(p, q)
    
    print(f"\n方程：{eq_str}")
    print(f"特征方程：r² {p:+d}r {q:+d} = 0")
    print(f"判别式 Δ = {delta}")
    print(f"特征根类型：{root_type}")
    
    if root_type == '两不等实根':
        r1, r2 = roots
        print(f"r₁ = {r1:.3f}, r₂ = {r2:.3f}")
        print(f"通解：y = C₁e^({r1:.3f}x) + C₂e^({r2:.3f}x)")
    elif root_type == '重根':
        r, _ = roots
        print(f"r = {r:.3f}")
        print(f"通解：y = (C₁ + C₂x)e^({r:.3f}x)")
    else:
        alpha, beta = roots
        print(f"α = {alpha:.3f}, β = {beta:.3f}")
        print(f"通解：y = e^({alpha:.3f}x)(C₁cos({beta:.3f}x) + C₂sin({beta:.3f}x))")

# 示例2：一阶线性方程速算
print("\n" + "="*60)
print("示例2：一阶线性方程公式法")
print("="*60)

print("方程：dy/dx + y/x = x²")
print("\n步骤：")
print("1. 识别 P(x) = 1/x, Q(x) = x²")
print("2. ∫P(x)dx = ∫(1/x)dx = ln|x|")
print("3. 积分因子：e^(ln|x|) = x")
print("4. 通解公式：y = (1/x)[∫x·x²dx + C]")
print("5. 计算：y = (1/x)[x⁴/4 + C] = x³/4 + C/x")

# 示例3：特解形式速查
print("\n" + "="*60)
print("示例3：非齐次方程特解形式速查")
print("="*60)

cases = [
    ("y'' + y = x²", "P₂(x)=x²", "λ=0不是特征根", "y* = Ax² + Bx + C"),
    ("y'' - y = e^x", "e^x", "λ=1是特征根", "y* = Axe^x"),
    ("y'' + 4y = sin(2x)", "sin(2x)", "iω=2i是特征根", "y* = x(Acos2x + Bsin2x)"),
    ("y'' + 2y' + y = e^(-x)", "e^(-x)", "λ=-1是重根", "y* = Ax²e^(-x)"),
]

print(f"{'方程':<25s} {'f(x)类型':<12s} {'特征根判断':<20s} {'特解形式':<25s}")
print("-" * 85)

for eq, f_type, char_root, y_star in cases:
    print(f"{eq:<25s} {f_type:<12s} {char_root:<20s} {y_star:<25s}")

# 示例4：符号求解演示
print("\n" + "="*60)
print("示例4：符号求解演示（sympy）")
print("="*60)

solution = de_quick.symbolic_solve_example()
print(f"方程：y' + y = x")
print(f"通解：{solution}")

# 绘制对比图
print("\n绘制微分方程解的对比图...")
de_quick.plot_solutions_comparison()
```

---

## 五、速记口诀

**一阶方程**：
> 可分离，两边积  
> 齐次方，换元迭  
> 线性方，公式记  
> 伯努利，先降阶

**二阶方程**：
> 特征根，定通解  
> 实根异，指数和  
> 实根重，乘$x$破  
> 复根出，三角乐

**特解设**：
> 多项式，同次拟  
> 指数函，同形试  
> 三角式，正弦齐  
> 重根现，乘$x$移

---

**本章重点**：
- 一阶方程五大类型
- 特征根法（背通解公式）
- 待定系数法（背特解表）
- 降阶法

**下一章**：级数与积分变换速算
