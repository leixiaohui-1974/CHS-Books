# 第4章：数字特征

**学习时间**: 4小时  
**难度**: ⭐⭐⭐⭐  
**必考题型**: ⭐⭐⭐⭐⭐

---

## 一、数学期望

### 1.1 定义

**离散型**：
$$E(X) = \sum_{i=1}^{\infty} x_i p_i$$

**连续型**：
$$E(X) = \int_{-\infty}^{+\infty} x f(x)dx$$

**意义**：随机变量取值的"平均值"、"重心"

### 1.2 性质

1. $E(C) = C$（常数）
2. $E(CX) = CE(X)$
3. $E(X \pm Y) = E(X) \pm E(Y)$
4. **$X$、$Y$独立**：$E(XY) = E(X)E(Y)$

### 1.3 常见分布期望

| 分布 | E(X) |
|------|------|
| 0-1分布 | p |
| 二项分布B(n,p) | np |
| 泊松分布P(λ) | λ |
| 均匀分布U(a,b) | (a+b)/2 |
| 指数分布E(λ) | 1/λ |
| 正态分布N(μ,σ²) | μ |

---

## 二、方差

### 2.1 定义

$$D(X) = E[(X - E(X))^2] = E(X^2) - [E(X)]^2$$

**标准差**：$\sigma(X) = \sqrt{D(X)}$

**意义**：度量随机变量取值的"分散程度"

### 2.2 性质

1. $D(C) = 0$
2. $D(CX) = C^2 D(X)$
3. $D(X \pm Y) = D(X) + D(Y) \pm 2\text{Cov}(X,Y)$
4. **$X$、$Y$独立**：$D(X \pm Y) = D(X) + D(Y)$

### 2.3 常见分布方差

| 分布 | D(X) |
|------|------|
| 0-1分布 | p(1-p) |
| 二项分布B(n,p) | np(1-p) |
| 泊松分布P(λ) | λ |
| 均匀分布U(a,b) | (b-a)²/12 |
| 指数分布E(λ) | 1/λ² |
| 正态分布N(μ,σ²) | σ² |

### Python实现

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy import stats

class NumericalCharacteristics:
    """数字特征计算"""
    
    @staticmethod
    def expectation_discrete(values, probabilities):
        """
        离散型期望
        
        E(X) = Σ x_i·p_i
        """
        return np.sum(values * probabilities)
    
    @staticmethod
    def variance_discrete(values, probabilities):
        """
        离散型方差
        
        D(X) = E(X²) - [E(X)]²
        """
        EX = NumericalCharacteristics.expectation_discrete(values, probabilities)
        EX2 = np.sum(values**2 * probabilities)
        
        return EX2 - EX**2
    
    @staticmethod
    def expectation_continuous(f, a, b, n_points=1000):
        """
        连续型期望（数值积分）
        
        E(X) = ∫ x·f(x) dx
        """
        x = np.linspace(a, b, n_points)
        integrand = x * f(x)
        
        # 梯形法则数值积分
        EX = np.trapz(integrand, x)
        
        return EX
    
    @staticmethod
    def variance_continuous(f, a, b, n_points=1000):
        """连续型方差"""
        x = np.linspace(a, b, n_points)
        
        # E(X)
        EX = NumericalCharacteristics.expectation_continuous(f, a, b, n_points)
        
        # E(X²)
        integrand = x**2 * f(x)
        EX2 = np.trapz(integrand, x)
        
        return EX2 - EX**2
    
    @staticmethod
    def covariance(X, Y):
        """
        协方差
        
        Cov(X,Y) = E[(X-EX)(Y-EY)] = E(XY) - EX·EY
        """
        return np.mean((X - np.mean(X)) * (Y - np.mean(Y)))
    
    @staticmethod
    def correlation_coefficient(X, Y):
        """
        相关系数
        
        ρ(X,Y) = Cov(X,Y) / [σ(X)·σ(Y)]
        """
        cov_XY = NumericalCharacteristics.covariance(X, Y)
        std_X = np.std(X, ddof=1)
        std_Y = np.std(Y, ddof=1)
        
        return cov_XY / (std_X * std_Y)
    
    @staticmethod
    def plot_expectation_variance_demo():
        """期望与方差可视化对比"""
        fig, axes = plt.subplots(2, 2, figsize=(14, 10))
        
        # 1. 相同期望，不同方差
        x = np.linspace(-5, 15, 1000)
        
        mu = 5
        for sigma in [0.5, 1.0, 2.0]:
            y = stats.norm.pdf(x, mu, sigma)
            axes[0, 0].plot(x, y, linewidth=2,
                           label=f'N({mu},{sigma}²)')
        
        axes[0, 0].axvline(mu, color='r', linestyle='--',
                          linewidth=2, label=f'E(X)={mu}')
        axes[0, 0].set_xlabel('x', fontsize=12)
        axes[0, 0].set_ylabel('f(x)', fontsize=12)
        axes[0, 0].set_title('相同期望，不同方差', fontsize=14)
        axes[0, 0].legend()
        axes[0, 0].grid(True, alpha=0.3)
        
        # 2. 不同期望，相同方差
        sigma = 1.0
        for mu_val in [3, 5, 7]:
            y = stats.norm.pdf(x, mu_val, sigma)
            axes[0, 1].plot(x, y, linewidth=2,
                           label=f'N({mu_val},{sigma}²)')
            axes[0, 1].axvline(mu_val, linestyle='--', alpha=0.5)
        
        axes[0, 1].set_xlabel('x', fontsize=12)
        axes[0, 1].set_ylabel('f(x)', fontsize=12)
        axes[0, 1].set_title('不同期望，相同方差', fontsize=14)
        axes[0, 1].legend()
        axes[0, 1].grid(True, alpha=0.3)
        
        # 3. 二项分布期望与方差
        n_values = [10, 20, 50]
        p = 0.3
        
        for n in n_values:
            k = np.arange(0, n+1)
            pmf = stats.binom.pmf(k, n, p)
            
            EX = n * p
            DX = n * p * (1-p)
            
            axes[1, 0].plot(k, pmf, 'o-', linewidth=1.5,
                           markersize=4,
                           label=f'B({n},{p}): E={EX:.1f}, D={DX:.2f}')
        
        axes[1, 0].set_xlabel('k', fontsize=12)
        axes[1, 0].set_ylabel('P(X=k)', fontsize=12)
        axes[1, 0].set_title('二项分布的期望与方差', fontsize=14)
        axes[1, 0].legend()
        axes[1, 0].grid(True, alpha=0.3)
        
        # 4. 样本均值的分布（中心极限定理演示）
        sample_sizes = [1, 5, 30]
        n_samples = 10000
        
        for n_sample in sample_sizes:
            # 从指数分布抽样
            samples = np.random.exponential(scale=2, size=(n_samples, n_sample))
            sample_means = np.mean(samples, axis=1)
            
            axes[1, 1].hist(sample_means, bins=50, alpha=0.5,
                           density=True, label=f'n={n_sample}')
        
        axes[1, 1].set_xlabel('样本均值', fontsize=12)
        axes[1, 1].set_ylabel('密度', fontsize=12)
        axes[1, 1].set_title('样本均值分布（中心极限定理）', fontsize=14)
        axes[1, 1].legend()
        axes[1, 1].grid(True, alpha=0.3)
        
        plt.tight_layout()
        plt.savefig('expectation_variance_demo.png', dpi=300)
        plt.show()

# 示例1：离散型期望与方差
print("="*60)
print("示例1：离散型随机变量")
print("="*60)

# 骰子
values = np.array([1, 2, 3, 4, 5, 6])
probs = np.array([1/6] * 6)

EX = NumericalCharacteristics.expectation_discrete(values, probs)
DX = NumericalCharacteristics.variance_discrete(values, probs)

print(f"掷骰子:")
print(f"  可能值: {values}")
print(f"  概率: {probs}")
print(f"  期望 E(X) = {EX:.4f}")
print(f"  方差 D(X) = {DX:.4f}")
print(f"  标准差 σ(X) = {np.sqrt(DX):.4f}")

# 二项分布
print("\n二项分布 B(10, 0.3):")
n, p = 10, 0.3
EX_binom = n * p
DX_binom = n * p * (1-p)

print(f"  E(X) = np = {n}×{p} = {EX_binom}")
print(f"  D(X) = np(1-p) = {n}×{p}×{1-p} = {DX_binom:.2f}")

# 示例2：连续型期望与方差
print("\n" + "="*60)
print("示例2：连续型随机变量")
print("="*60)

# 均匀分布 U(0, 10)
a, b = 0, 10

def f_uniform(x):
    return np.where((x >= a) & (x <= b), 1/(b-a), 0)

EX_uniform = (a + b) / 2
DX_uniform = (b - a)**2 / 12

print(f"均匀分布 U({a}, {b}):")
print(f"  理论 E(X) = (a+b)/2 = {EX_uniform}")
print(f"  理论 D(X) = (b-a)²/12 = {DX_uniform:.4f}")

# 数值验证
EX_num = NumericalCharacteristics.expectation_continuous(f_uniform, a-1, b+1)
DX_num = NumericalCharacteristics.variance_continuous(f_uniform, a-1, b+1)

print(f"  数值 E(X) ≈ {EX_num:.4f}")
print(f"  数值 D(X) ≈ {DX_num:.4f}")

# 示例3：期望与方差的性质
print("\n" + "="*60)
print("示例3：期望与方差性质验证")
print("="*60)

# 生成两个独立的随机变量
np.random.seed(42)
n_samples = 10000

X = np.random.normal(5, 2, n_samples)
Y = np.random.normal(10, 3, n_samples)

print(f"X ~ N(5, 4), Y ~ N(10, 9)")
print(f"样本量: {n_samples}")

# 期望性质
print(f"\n期望性质:")
print(f"  E(X) ≈ {np.mean(X):.4f} (理论: 5)")
print(f"  E(Y) ≈ {np.mean(Y):.4f} (理论: 10)")
print(f"  E(X+Y) ≈ {np.mean(X+Y):.4f} (理论: 15)")
print(f"  E(2X) ≈ {np.mean(2*X):.4f} (理论: 10)")

# 方差性质
print(f"\n方差性质:")
print(f"  D(X) ≈ {np.var(X, ddof=1):.4f} (理论: 4)")
print(f"  D(Y) ≈ {np.var(Y, ddof=1):.4f} (理论: 9)")
print(f"  D(X+Y) ≈ {np.var(X+Y, ddof=1):.4f} (理论: 13, X⊥Y)")
print(f"  D(2X) ≈ {np.var(2*X, ddof=1):.4f} (理论: 16)")

# 可视化
NumericalCharacteristics.plot_expectation_variance_demo()
```

---

## 三、协方差与相关系数

### 3.1 协方差

$$\text{Cov}(X,Y) = E[(X - E(X))(Y - E(Y))] = E(XY) - E(X)E(Y)$$

**性质**：
- $\text{Cov}(X,X) = D(X)$
- $\text{Cov}(X,Y) = \text{Cov}(Y,X)$
- $\text{Cov}(aX, bY) = ab\text{Cov}(X,Y)$

### 3.2 相关系数

$$\rho_{XY} = \frac{\text{Cov}(X,Y)}{\sqrt{D(X)}\sqrt{D(Y)}}$$

**范围**：$-1 \leq \rho \leq 1$

**含义**：
- $\rho = 0$：不相关
- $\rho > 0$：正相关
- $\rho < 0$：负相关
- $|\rho| = 1$：线性关系

---

## 四、典型考题

### 【例题1】期望计算（10分）

**题目**：$X$的分布律为

| X | -1 | 0 | 1 | 2 |
|---|----|----|---|---|
| P | 0.1| 0.2|0.3|0.4|

求$E(X)$、$E(X^2)$、$E(2X+1)$

**【解答】**

$$E(X) = (-1) \times 0.1 + 0 \times 0.2 + 1 \times 0.3 + 2 \times 0.4 = 0.9$$

$$E(X^2) = 1 \times 0.1 + 0 + 1 \times 0.3 + 4 \times 0.4 = 2.0$$

$$E(2X+1) = 2E(X) + 1 = 2 \times 0.9 + 1 = 2.8$$

---

### 【例题2】方差计算（12分）

**题目**：$X \sim B(n, p)$，$E(X)=2.4$，$D(X)=1.44$，求$n$、$p$

**【解答】**

$$\begin{cases}
np = 2.4 \\
np(1-p) = 1.44
\end{cases}$$

$$\Rightarrow 2.4(1-p) = 1.44$$

$$p = 0.4, \quad n = 6$$

---

### 【例题3】独立性与不相关（15分）

**题目**：已知$\rho_{XY} = 0$，问$X$与$Y$是否独立？

**【解答】**

$\rho_{XY} = 0$ ⇒ $X$、$Y$**不相关**

但**不能推出独立**！

**反例**：$X \sim U(-1, 1)$，$Y = X^2$

则$E(XY) = E(X^3) = 0$，$E(X) = 0$，$E(Y) = 1/3$

$\text{Cov}(X,Y) = 0$，但$X$、$Y$明显相关（函数关系）

**注**：若$(X,Y)$服从**二维正态分布**，则不相关⇔独立

---

## 五、速记口诀

> 期望反映平均值  
> 方差衡量分散度  
> 协方差看线性关  
> 相关系数标准化

---

**本章重点**：
- 期望方差计算（必考）
- 性质应用
- 协方差与相关系数
- 独立与不相关区别

**下一章**：大数定律与中心极限定理
