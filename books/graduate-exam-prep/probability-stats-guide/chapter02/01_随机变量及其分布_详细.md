# 第2章：随机变量及其分布

**学习时间**: 5小时  
**难度**: ⭐⭐⭐⭐  
**考试权重**: 20%  
**必考题型**: ⭐⭐⭐⭐⭐

---

## 一、随机变量的概念

### 1.1 定义

**随机变量** $X$：样本空间到实数的映射

**分类**：
- **离散型**：可列个取值
- **连续型**：不可列无穷多个取值

### 1.2 分布函数

**定义**：
$$F(x) = P(X \leq x), \quad -\infty < x < +\infty$$

**性质**：
1. $0 \leq F(x) \leq 1$
2. 单调不减
3. 右连续
4. $\lim_{x \to -\infty}F(x) = 0$，$\lim_{x \to +\infty}F(x) = 1$

---

## 二、离散型随机变量

### 2.1 概率分布列

$$P(X = x_i) = p_i, \quad i = 1,2,...$$

**性质**：
1. $p_i \geq 0$
2. $\sum_i p_i = 1$

### 2.2 常见离散分布

#### (1) 0-1分布（伯努利分布）

$$P(X=k) = p^k(1-p)^{1-k}, \quad k=0,1$$

#### (2) 二项分布 $B(n,p)$

$$P(X=k) = C_n^k p^k (1-p)^{n-k}, \quad k=0,1,...,n$$

**意义**：n次独立重复试验中成功k次的概率

#### (3) 泊松分布 $P(\lambda)$

$$P(X=k) = \frac{\lambda^k e^{-\lambda}}{k!}, \quad k=0,1,2,...$$

**泊松定理**：当$n$很大，$p$很小，$np=\lambda$适中时，
$$B(n,p) \approx P(\lambda)$$

---

## 三、连续型随机变量

### 3.1 概率密度函数

$$F(x) = \int_{-\infty}^{x} f(t)dt$$

**性质**：
1. $f(x) \geq 0$
2. $\int_{-\infty}^{+\infty} f(x)dx = 1$
3. $P(a < X \leq b) = \int_a^b f(x)dx$

### 3.2 常见连续分布

#### (1) 均匀分布 $U(a,b)$

$$f(x) = \begin{cases}
\frac{1}{b-a}, & a \leq x \leq b \\
0, & \text{其他}
\end{cases}$$

#### (2) 指数分布 $E(\lambda)$

$$f(x) = \begin{cases}
\lambda e^{-\lambda x}, & x > 0 \\
0, & x \leq 0
\end{cases}$$

**无记忆性**：$P(X > s+t | X > s) = P(X > t)$

#### (3) 正态分布 $N(\mu, \sigma^2)$

$$f(x) = \frac{1}{\sqrt{2\pi}\sigma}e^{-\frac{(x-\mu)^2}{2\sigma^2}}, \quad -\infty < x < +\infty$$

**标准正态分布** $N(0,1)$：

$$\varphi(x) = \frac{1}{\sqrt{2\pi}}e^{-\frac{x^2}{2}}$$

$$\Phi(x) = \int_{-\infty}^{x}\varphi(t)dt$$

**标准化**：
$$Z = \frac{X-\mu}{\sigma} \sim N(0,1)$$

### Python实现

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy import stats
from scipy.special import comb

class RandomVariableDistribution:
    """
    随机变量及其分布
    """
    
    # ========== 离散分布 ==========
    
    @staticmethod
    def binomial_pmf(k, n, p):
        """
        二项分布概率质量函数
        
        P(X=k) = C_n^k · p^k · (1-p)^(n-k)
        """
        return comb(n, k, exact=True) * (p**k) * ((1-p)**(n-k))
    
    @staticmethod
    def poisson_pmf(k, lambda_param):
        """
        泊松分布概率质量函数
        
        P(X=k) = λ^k · e^(-λ) / k!
        """
        return (lambda_param**k) * np.exp(-lambda_param) / np.math.factorial(k)
    
    @staticmethod
    def poisson_approximation_check(n, p):
        """
        检查泊松近似条件
        
        条件: n大(>20), p小(<0.05), np适中(<10)
        """
        lambda_param = n * p
        
        conditions = {
            'n_large': n > 20,
            'p_small': p < 0.05,
            'lambda_moderate': lambda_param < 10
        }
        
        can_approximate = all(conditions.values())
        
        return can_approximate, lambda_param, conditions
    
    # ========== 连续分布 ==========
    
    @staticmethod
    def uniform_pdf(x, a, b):
        """
        均匀分布概率密度
        """
        if a <= x <= b:
            return 1 / (b - a)
        else:
            return 0
    
    @staticmethod
    def exponential_pdf(x, lambda_param):
        """
        指数分布概率密度
        """
        if x >= 0:
            return lambda_param * np.exp(-lambda_param * x)
        else:
            return 0
    
    @staticmethod
    def normal_pdf(x, mu, sigma):
        """
        正态分布概率密度
        """
        return (1 / (np.sqrt(2 * np.pi) * sigma)) * \
               np.exp(-((x - mu)**2) / (2 * sigma**2))
    
    @staticmethod
    def standard_normal_cdf(x):
        """
        标准正态分布函数 Φ(x)
        """
        return stats.norm.cdf(x)
    
    @staticmethod
    def standardize(x, mu, sigma):
        """
        标准化
        
        Z = (X - μ) / σ
        """
        return (x - mu) / sigma
    
    @staticmethod
    def plot_distributions():
        """
        绘制常见分布
        """
        fig, axes = plt.subplots(2, 3, figsize=(16, 10))
        
        # 1. 二项分布
        n, p = 20, 0.3
        k = np.arange(0, n+1)
        pmf_binom = [RandomVariableDistribution.binomial_pmf(ki, n, p) 
                    for ki in k]
        
        axes[0, 0].bar(k, pmf_binom, alpha=0.7, color='blue')
        axes[0, 0].set_xlabel('k', fontsize=11)
        axes[0, 0].set_ylabel('P(X=k)', fontsize=11)
        axes[0, 0].set_title(f'二项分布 B({n}, {p})', fontsize=13)
        axes[0, 0].grid(True, alpha=0.3, axis='y')
        
        # 2. 泊松分布
        lambda_p = 3
        k_p = np.arange(0, 15)
        pmf_poisson = [RandomVariableDistribution.poisson_pmf(ki, lambda_p)
                      for ki in k_p]
        
        axes[0, 1].bar(k_p, pmf_poisson, alpha=0.7, color='green')
        axes[0, 1].set_xlabel('k', fontsize=11)
        axes[0, 1].set_ylabel('P(X=k)', fontsize=11)
        axes[0, 1].set_title(f'泊松分布 P({lambda_p})', fontsize=13)
        axes[0, 1].grid(True, alpha=0.3, axis='y')
        
        # 3. 二项与泊松近似对比
        n_large, p_small = 100, 0.02
        lambda_approx = n_large * p_small
        k_compare = np.arange(0, 10)
        
        pmf_binom_large = [RandomVariableDistribution.binomial_pmf(ki, n_large, p_small)
                          for ki in k_compare]
        pmf_poisson_approx = [RandomVariableDistribution.poisson_pmf(ki, lambda_approx)
                             for ki in k_compare]
        
        width = 0.35
        axes[0, 2].bar(k_compare - width/2, pmf_binom_large, width,
                      alpha=0.7, label=f'B({n_large},{p_small})', color='blue')
        axes[0, 2].bar(k_compare + width/2, pmf_poisson_approx, width,
                      alpha=0.7, label=f'P({lambda_approx})', color='green')
        axes[0, 2].set_xlabel('k', fontsize=11)
        axes[0, 2].set_ylabel('概率', fontsize=11)
        axes[0, 2].set_title('泊松近似', fontsize=13)
        axes[0, 2].legend()
        axes[0, 2].grid(True, alpha=0.3, axis='y')
        
        # 4. 均匀分布
        a, b = 2, 5
        x_uniform = np.linspace(0, 7, 1000)
        pdf_uniform = [RandomVariableDistribution.uniform_pdf(xi, a, b) 
                      for xi in x_uniform]
        
        axes[1, 0].plot(x_uniform, pdf_uniform, 'b-', linewidth=2)
        axes[1, 0].fill_between(x_uniform, 0, pdf_uniform, alpha=0.3)
        axes[1, 0].set_xlabel('x', fontsize=11)
        axes[1, 0].set_ylabel('f(x)', fontsize=11)
        axes[1, 0].set_title(f'均匀分布 U({a}, {b})', fontsize=13)
        axes[1, 0].grid(True, alpha=0.3)
        
        # 5. 指数分布
        lambda_exp = 1.5
        x_exp = np.linspace(0, 5, 1000)
        pdf_exp = [RandomVariableDistribution.exponential_pdf(xi, lambda_exp)
                  for xi in x_exp]
        
        axes[1, 1].plot(x_exp, pdf_exp, 'g-', linewidth=2)
        axes[1, 1].fill_between(x_exp, 0, pdf_exp, alpha=0.3, color='green')
        axes[1, 1].set_xlabel('x', fontsize=11)
        axes[1, 1].set_ylabel('f(x)', fontsize=11)
        axes[1, 1].set_title(f'指数分布 E({lambda_exp})', fontsize=13)
        axes[1, 1].grid(True, alpha=0.3)
        
        # 6. 正态分布
        mu, sigma = 0, 1
        x_norm = np.linspace(-4, 4, 1000)
        pdf_norm = [RandomVariableDistribution.normal_pdf(xi, mu, sigma)
                   for xi in x_norm]
        
        axes[1, 2].plot(x_norm, pdf_norm, 'r-', linewidth=2,
                       label=f'N({mu}, {sigma}²)')
        axes[1, 2].fill_between(x_norm, 0, pdf_norm, alpha=0.3, color='red')
        
        # 标注关键点
        axes[1, 2].axvline(mu, color='k', linestyle='--', alpha=0.5, label='μ')
        axes[1, 2].axvline(mu + sigma, color='b', linestyle='--', alpha=0.5,
                          label='μ±σ')
        axes[1, 2].axvline(mu - sigma, color='b', linestyle='--', alpha=0.5)
        
        axes[1, 2].set_xlabel('x', fontsize=11)
        axes[1, 2].set_ylabel('φ(x)', fontsize=11)
        axes[1, 2].set_title('标准正态分布', fontsize=13)
        axes[1, 2].legend()
        axes[1, 2].grid(True, alpha=0.3)
        
        plt.tight_layout()
        plt.savefig('random_variable_distributions.png', dpi=300, bbox_inches='tight')
        plt.show()


# 示例使用
print("="*60)
print("随机变量分布计算")
print("="*60)

# 1. 二项分布
print("1. 二项分布 B(10, 0.3)")
n, p = 10, 0.3

for k in [0, 3, 5, 10]:
    P_k = RandomVariableDistribution.binomial_pmf(k, n, p)
    print(f"   P(X={k}) = {P_k:.6f}")

# 累积概率
P_at_most_3 = sum(RandomVariableDistribution.binomial_pmf(k, n, p) 
                  for k in range(4))
print(f"   P(X≤3) = {P_at_most_3:.6f}")

# 2. 泊松分布
print("\n2. 泊松分布 P(2)")
lambda_param = 2

for k in [0, 1, 2, 3, 5]:
    P_k = RandomVariableDistribution.poisson_pmf(k, lambda_param)
    print(f"   P(X={k}) = {P_k:.6f}")

# 3. 泊松近似
print("\n3. 泊松近似检查")
n_test, p_test = 100, 0.01

can_approx, lambda_approx, conditions = \
    RandomVariableDistribution.poisson_approximation_check(n_test, p_test)

print(f"   n={n_test}, p={p_test}")
print(f"   条件检查:")
for cond_name, cond_value in conditions.items():
    print(f"     {cond_name}: {cond_value}")
print(f"   可以近似: {can_approx}")
print(f"   λ = np = {lambda_approx}")

# 对比
k_test = 2
P_exact = RandomVariableDistribution.binomial_pmf(k_test, n_test, p_test)
P_approx = RandomVariableDistribution.poisson_pmf(k_test, lambda_approx)

print(f"\n   P(X={k_test}):")
print(f"     精确(二项): {P_exact:.8f}")
print(f"     近似(泊松): {P_approx:.8f}")
print(f"     相对误差: {abs(P_exact-P_approx)/P_exact*100:.4f}%")

# 4. 正态分布
print("\n4. 标准正态分布")

x_values = [-2, -1, 0, 1, 2]

for x in x_values:
    phi_x = RandomVariableDistribution.standard_normal_cdf(x)
    print(f"   Φ({x}) = {phi_x:.6f}")

# 标准化
print("\n5. 正态分布标准化")
mu, sigma = 100, 15
x_score = 115

z = RandomVariableDistribution.standardize(x_score, mu, sigma)
P_less = RandomVariableDistribution.standard_normal_cdf(z)

print(f"   X ~ N({mu}, {sigma}²)")
print(f"   x = {x_score}")
print(f"   Z = (x-μ)/σ = {z:.4f}")
print(f"   P(X≤{x_score}) = Φ({z:.4f}) = {P_less:.6f}")

# 绘制所有分布
RandomVariableDistribution.plot_distributions()
```

---

## 四、典型考题

### 考题1：二项分布

**【题目】**某射手命中率0.8，射击10次，求：
1. 恰好命中8次的概率
2. 至少命中8次的概率

**【解答】**

$X \sim B(10, 0.8)$

1. $P(X=8) = C_{10}^8 \cdot 0.8^8 \cdot 0.2^2 = 45 \times 0.16777 \times 0.04 = 0.3020$

2. $P(X \geq 8) = P(X=8) + P(X=9) + P(X=10)$
   $= 0.3020 + 0.2684 + 0.1074 = 0.6778$

---

### 考题2：泊松近似

**【题目】**某书平均每页有0.01个错字，一本400页的书，求：
1. 恰有3个错字的概率
2. 至多2个错字的概率

**【解答】**

$n=400$，$p=0.01$，$\lambda = np = 4$

用泊松分布 $P(4)$ 近似：

1. $P(X=3) = \frac{4^3 e^{-4}}{3!} = \frac{64 \times 0.0183}{6} = 0.1954$

2. $P(X \leq 2) = P(X=0) + P(X=1) + P(X=2)$
   $= e^{-4}(1 + 4 + 8) = 0.0183 \times 13 = 0.2381$

---

### 考题3：正态分布

**【题目】**$X \sim N(10, 4)$，求 $P(8 < X \leq 12)$

**【解答】**

标准化：
$$P(8 < X \leq 12) = P\left(\frac{8-10}{2} < Z \leq \frac{12-10}{2}\right)$$
$$= P(-1 < Z \leq 1) = \Phi(1) - \Phi(-1)$$
$$= \Phi(1) - [1-\Phi(1)] = 2\Phi(1) - 1$$
$$= 2 \times 0.8413 - 1 = 0.6826$$

---

## 五、速记口诀

> 二项伯努利重复试验  
> 泊松分布稀有事件  
> 指数无记忆寿命分析  
> 正态分布应用最广

---

**本章重点**：
- 二项分布计算（必考）
- 泊松近似条件
- 正态分布标准化
- 分布函数性质

**下一章**：多维随机变量
