# 第3章：多维随机变量及其分布

**学习时间**: 5小时  
**难度**: ⭐⭐⭐⭐⭐  
**考试权重**: 18%  
**必考题型**: ⭐⭐⭐⭐⭐

---

## 一、二维随机变量

### 1.1 联合分布

**离散型**：
$$P(X=x_i, Y=y_j) = p_{ij}$$

性质：
1. $p_{ij} \geq 0$
2. $\sum_i\sum_j p_{ij} = 1$

**连续型**：联合概率密度$f(x,y)$

$$P((X,Y) \in D) = \iint_D f(x,y)dxdy$$

性质：
1. $f(x,y) \geq 0$
2. $\int_{-\infty}^{+\infty}\int_{-\infty}^{+\infty}f(x,y)dxdy = 1$

### 1.2 边缘分布

**离散型**：
$$p_{i \cdot} = P(X=x_i) = \sum_j p_{ij}$$
$$p_{\cdot j} = P(Y=y_j) = \sum_i p_{ij}$$

**连续型**：
$$f_X(x) = \int_{-\infty}^{+\infty}f(x,y)dy$$
$$f_Y(y) = \int_{-\infty}^{+\infty}f(x,y)dx$$

### 1.3 条件分布

**离散型**：
$$P(X=x_i|Y=y_j) = \frac{p_{ij}}{p_{\cdot j}}$$

**连续型**：
$$f_{X|Y}(x|y) = \frac{f(x,y)}{f_Y(y)}$$

---

## 二、随机变量的独立性

### 2.1 定义

**独立** ⇔ $P(X \leq x, Y \leq y) = P(X \leq x)P(Y \leq y)$

**等价条件**：
- 离散：$p_{ij} = p_{i\cdot} \cdot p_{\cdot j}$
- 连续：$f(x,y) = f_X(x) \cdot f_Y(y)$

### 2.2 判别方法

1. **分离变量法**：若$f(x,y) = g(x)h(y)$且积分为1，则独立
2. **矩形法**：若$(X,Y)$的取值区域为矩形，且密度可分离，则独立

---

## 三、二维正态分布

### 3.1 定义

$$(X,Y) \sim N(\mu_1, \mu_2, \sigma_1^2, \sigma_2^2, \rho)$$

概率密度：
$$f(x,y) = \frac{1}{2\pi\sigma_1\sigma_2\sqrt{1-\rho^2}}\exp\left\{-\frac{1}{2(1-\rho^2)}\left[\frac{(x-\mu_1)^2}{\sigma_1^2} - \frac{2\rho(x-\mu_1)(y-\mu_2)}{\sigma_1\sigma_2} + \frac{(y-\mu_2)^2}{\sigma_2^2}\right]\right\}$$

### 3.2 性质

1. $X \sim N(\mu_1, \sigma_1^2)$，$Y \sim N(\mu_2, \sigma_2^2)$
2. $X$与$Y$独立 ⇔ $\rho = 0$
3. $aX + bY \sim N(a\mu_1 + b\mu_2, a^2\sigma_1^2 + b^2\sigma_2^2 + 2ab\rho\sigma_1\sigma_2)$

### Python实现

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy import stats
from mpl_toolkits.mplot3d import Axes3D

class MultiVariateDistribution:
    """
    多维随机变量分布
    """
    
    @staticmethod
    def discrete_joint_pmf(X_vals, Y_vals, pmf_matrix):
        """
        离散型联合分布
        
        参数:
            X_vals: X的取值
            Y_vals: Y的取值
            pmf_matrix: 联合概率矩阵 p_ij
        
        返回:
            边缘分布
        """
        pmf = np.array(pmf_matrix)
        
        # 边缘分布
        p_X = pmf.sum(axis=1)  # 对j求和
        p_Y = pmf.sum(axis=0)  # 对i求和
        
        return p_X, p_Y
    
    @staticmethod
    def check_independence_discrete(pmf_matrix):
        """
        检查离散型随机变量独立性
        
        独立 ⇔ p_ij = p_i· × p_·j
        """
        pmf = np.array(pmf_matrix)
        p_X, p_Y = MultiVariateDistribution.discrete_joint_pmf(
            None, None, pmf
        )
        
        # 计算外积
        p_product = np.outer(p_X, p_Y)
        
        # 比较
        is_independent = np.allclose(pmf, p_product)
        
        return is_independent, p_product
    
    @staticmethod
    def bivariate_normal_pdf(x, y, mu1, mu2, sigma1, sigma2, rho):
        """
        二维正态分布概率密度
        
        参数:
            x, y: 坐标
            mu1, mu2: 均值
            sigma1, sigma2: 标准差
            rho: 相关系数
        """
        coeff = 1 / (2 * np.pi * sigma1 * sigma2 * np.sqrt(1 - rho**2))
        
        z1 = ((x - mu1) / sigma1)**2
        z2 = -2 * rho * (x - mu1) * (y - mu2) / (sigma1 * sigma2)
        z3 = ((y - mu2) / sigma2)**2
        
        exponent = -1 / (2 * (1 - rho**2)) * (z1 + z2 + z3)
        
        return coeff * np.exp(exponent)
    
    @staticmethod
    def plot_bivariate_normal(mu1=0, mu2=0, sigma1=1, sigma2=1, rho=0.5):
        """
        绘制二维正态分布
        """
        # 网格
        x = np.linspace(mu1 - 3*sigma1, mu1 + 3*sigma1, 100)
        y = np.linspace(mu2 - 3*sigma2, mu2 + 3*sigma2, 100)
        X, Y = np.meshgrid(x, y)
        
        # 计算概率密度
        Z = np.zeros_like(X)
        for i in range(X.shape[0]):
            for j in range(X.shape[1]):
                Z[i, j] = MultiVariateDistribution.bivariate_normal_pdf(
                    X[i, j], Y[i, j], mu1, mu2, sigma1, sigma2, rho
                )
        
        fig = plt.figure(figsize=(16, 5))
        
        # 3D曲面
        ax1 = fig.add_subplot(131, projection='3d')
        surf = ax1.plot_surface(X, Y, Z, cmap='viridis', alpha=0.8)
        ax1.set_xlabel('X')
        ax1.set_ylabel('Y')
        ax1.set_zlabel('f(x,y)')
        ax1.set_title(f'二维正态分布 (ρ={rho})')
        plt.colorbar(surf, ax=ax1, shrink=0.5)
        
        # 等高线
        ax2 = fig.add_subplot(132)
        contour = ax2.contour(X, Y, Z, levels=15)
        ax2.clabel(contour, inline=True, fontsize=8)
        ax2.set_xlabel('X')
        ax2.set_ylabel('Y')
        ax2.set_title('等高线图')
        ax2.grid(True, alpha=0.3)
        ax2.axis('equal')
        
        # 随机样本
        ax3 = fig.add_subplot(133)
        
        # 使用scipy生成样本
        mean = [mu1, mu2]
        cov = [[sigma1**2, rho*sigma1*sigma2],
               [rho*sigma1*sigma2, sigma2**2]]
        
        samples = np.random.multivariate_normal(mean, cov, 1000)
        
        ax3.scatter(samples[:, 0], samples[:, 1], alpha=0.3, s=10)
        ax3.set_xlabel('X')
        ax3.set_ylabel('Y')
        ax3.set_title(f'随机样本 (n=1000)')
        ax3.grid(True, alpha=0.3)
        ax3.axis('equal')
        
        plt.tight_layout()
        plt.savefig('bivariate_normal.png', dpi=300, bbox_inches='tight')
        plt.show()


# 示例1：离散型联合分布
print("="*60)
print("示例1：离散型联合分布")
print("="*60)

# 联合分布表
X_vals = [0, 1, 2]
Y_vals = [0, 1]

pmf_matrix = [
    [0.1, 0.2],  # X=0
    [0.2, 0.3],  # X=1
    [0.1, 0.1]   # X=2
]

print("联合分布:")
print("      Y=0   Y=1")
for i, x in enumerate(X_vals):
    print(f"X={x}  {pmf_matrix[i]}")

# 边缘分布
p_X, p_Y = MultiVariateDistribution.discrete_joint_pmf(
    X_vals, Y_vals, pmf_matrix
)

print(f"\n边缘分布:")
print(f"  P(X): {p_X}")
print(f"  P(Y): {p_Y}")
print(f"  验证: ΣP(X) = {p_X.sum():.1f}, ΣP(Y) = {p_Y.sum():.1f}")

# 独立性检验
is_indep, p_prod = MultiVariateDistribution.check_independence_discrete(pmf_matrix)

print(f"\n独立性检验:")
print(f"  独立? {is_indep}")

if not is_indep:
    print(f"  若独立，应为:")
    print("        Y=0     Y=1")
    for i, x in enumerate(X_vals):
        print(f"  X={x}  {p_prod[i]}")

# 示例2：条件概率
print("\n" + "="*60)
print("示例2：条件概率")
print("="*60)

# P(X=1|Y=0)
p_11 = pmf_matrix[1][0]
p_Y0 = p_Y[0]

p_X1_given_Y0 = p_11 / p_Y0

print(f"P(X=1, Y=0) = {p_11}")
print(f"P(Y=0) = {p_Y0}")
print(f"P(X=1|Y=0) = {p_X1_given_Y0:.4f}")

# 示例3：二维正态分布
print("\n" + "="*60)
print("示例3：二维正态分布")
print("="*60)

# 参数
mu1, mu2 = 0, 0
sigma1, sigma2 = 1, 1.5
rho = 0.7

print(f"参数:")
print(f"  μ1={mu1}, μ2={mu2}")
print(f"  σ1={sigma1}, σ2={sigma2}")
print(f"  ρ={rho}")

# 计算某点概率密度
x0, y0 = 0, 0
f_xy = MultiVariateDistribution.bivariate_normal_pdf(
    x0, y0, mu1, mu2, sigma1, sigma2, rho
)

print(f"\n在点({x0}, {y0})的概率密度:")
print(f"  f({x0}, {y0}) = {f_xy:.6f}")

# 性质验证
print(f"\n性质:")
print(f"  X ~ N({mu1}, {sigma1}²)")
print(f"  Y ~ N({mu2}, {sigma2}²)")
print(f"  相关系数 ρ = {rho}")

if abs(rho) < 0.01:
    print(f"  X与Y独立")
else:
    print(f"  X与Y不独立")

# 线性组合
a, b = 2, -1
mu_Z = a * mu1 + b * mu2
var_Z = a**2 * sigma1**2 + b**2 * sigma2**2 + 2*a*b*rho*sigma1*sigma2

print(f"\n线性组合 Z = {a}X + {b}Y:")
print(f"  E(Z) = {mu_Z}")
print(f"  Var(Z) = {var_Z:.4f}")
print(f"  Z ~ N({mu_Z}, {var_Z:.4f})")

# 可视化
print("\n绘制二维正态分布...")
MultiVariateDistribution.plot_bivariate_normal(
    mu1, mu2, sigma1, sigma2, rho
)

# 不同相关系数对比
print("\n不同相关系数对比...")
fig, axes = plt.subplots(2, 3, figsize=(15, 10))

rho_values = [0, 0.3, 0.6, -0.3, -0.6, 0.9]

for idx, rho_val in enumerate(rho_values):
    ax = axes[idx // 3, idx % 3]
    
    # 生成样本
    mean = [0, 0]
    cov = [[1, rho_val], [rho_val, 1]]
    samples = np.random.multivariate_normal(mean, cov, 500)
    
    ax.scatter(samples[:, 0], samples[:, 1], alpha=0.3, s=10)
    ax.set_xlabel('X')
    ax.set_ylabel('Y')
    ax.set_title(f'ρ = {rho_val}')
    ax.grid(True, alpha=0.3)
    ax.set_xlim([-3, 3])
    ax.set_ylim([-3, 3])
    ax.axis('equal')

plt.tight_layout()
plt.savefig('correlation_comparison.png', dpi=300, bbox_inches='tight')
plt.show()
```

---

## 四、典型考题

### 考题1：求边缘分布

**【题目】**$(X,Y)$的联合概率密度为
$$f(x,y) = \begin{cases}
6x, & 0 < x < 1, 0 < y < x \\
0, & \text{其他}
\end{cases}$$

求边缘概率密度

**【解答】**

$$f_X(x) = \int_0^x 6x dy = 6x^2, \quad 0 < x < 1$$

$$f_Y(y) = \int_y^1 6x dx = 3(1-y^2), \quad 0 < y < 1$$

---

### 考题2：判断独立性

**【题目】**$f(x,y) = e^{-(x+y)}$，$x>0, y>0$，判断$X$与$Y$是否独立

**【解答】**

$$f(x,y) = e^{-x} \cdot e^{-y} = g(x)h(y)$$

且$X$、$Y$取值区域为矩形$\\{x>0, y>0\\}$

**X与Y独立**

---

### 考题3：二维正态分布

**【题目】**$(X,Y) \sim N(1, 2, 4, 9, 0.5)$，求$P(X+Y \leq 5)$

**【解答】**

$Z = X + Y \sim N(\mu_Z, \sigma_Z^2)$

$$\mu_Z = 1 + 2 = 3$$
$$\sigma_Z^2 = 4 + 9 + 2 \times 0.5 \times 2 \times 3 = 19$$

$$P(Z \leq 5) = \Phi\left(\frac{5-3}{\sqrt{19}}\right) = \Phi(0.459) \approx 0.677$$

---

## 五、速记口诀

> 联合分布知全局  
> 边缘分布各自求  
> 独立相当于相乘  
> 正态线性仍正态

---

**本章重点**：
- 边缘分布计算（必考）
- 独立性判别
- 二维正态分布性质
- 条件分布

**下一章**：数字特征
