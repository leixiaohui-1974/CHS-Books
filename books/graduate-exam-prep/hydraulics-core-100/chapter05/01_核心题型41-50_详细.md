# 第5章：管网水力计算核心题型（41-50题）

**学习时间**: 4小时  
**考试频率**: ⭐⭐⭐⭐  
**难度**: ⭐⭐⭐⭐⭐

---

## 一、串联管道

### 1.1 基本原理

**流量关系**：
$$Q = Q_1 = Q_2 = Q_3$$

**水头损失关系**：
$$h_w = h_{w1} + h_{w2} + h_{w3}$$

**等效管道**：
$$h_w = S_e Q^2 = (S_1 + S_2 + S_3) Q^2$$

**管道阻抗**：
$$S = \frac{8\lambda L}{\pi^2 g d^5}$$

### 1.2 不同管径串联

**等效长度法**：将不同管径管道换算成同一管径：

$$L_e = L_1 + L_2 \left(\frac{d_1}{d_2}\right)^5$$

---

## 二、并联管道

### 2.1 基本原理

**流量关系**：
$$Q = Q_1 + Q_2 + Q_3$$

**水头损失关系**：
$$h_w = h_{w1} = h_{w2} = h_{w3}$$

**等效管道**：
$$Q = \sqrt{\frac{h_w}{S_e}} = \sqrt{\frac{h_w}{S_1}} + \sqrt{\frac{h_w}{S_2}} + \sqrt{\frac{h_w}{S_3}}$$

$$\frac{1}{\sqrt{S_e}} = \frac{1}{\sqrt{S_1}} + \frac{1}{\sqrt{S_2}} + \frac{1}{\sqrt{S_3}}$$

### 2.2 两管并联分流

$$\frac{Q_1}{Q_2} = \sqrt{\frac{S_2}{S_1}} = \sqrt{\frac{d_1^5}{d_2^5}} = \left(\frac{d_1}{d_2}\right)^{2.5}$$

（假设$\lambda_1 = \lambda_2$，$L_1 = L_2$）

---

## 三、分支管道

### 3.1 三水库连通问题

**节点流量平衡**：
$$Q_1 = Q_2 + Q_3$$

**节点水头关系**：
$$z_1 - h_{w1} = z_2 + h_{w2} = z_3 + h_{w3}$$

**求解步骤**：
1. 假设节点水头$H_0$
2. 计算各管流量$Q_i = \sqrt{(z_i - H_0)/S_i}$
3. 检查流量平衡$\sum Q_i = 0$
4. 调整$H_0$直至平衡

---

## 四、管网水力计算

### 4.1 哈代-克罗斯法（Hardy-Cross法）

**基本思想**：假设各管流量→计算闭合差→修正流量→迭代收敛

**修正公式**：
$$\Delta Q = \frac{\sum h_w}{\sum (2h_w / Q)}$$

**迭代步骤**：
1. 假设各管流量（满足节点连续性）
2. 计算各环水头损失闭合差$\sum h_w$
3. 计算修正量$\Delta Q$
4. 修正流量$Q_{new} = Q_{old} + \Delta Q$
5. 重复2-4直至$|\sum h_w| < \varepsilon$

### Python实现

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy.optimize import fsolve
import networkx as nx

class PipeNetwork:
    """管网水力计算"""
    
    def __init__(self, g=9.81):
        self.g = g
    
    def pipe_resistance(self, lam, L, d):
        """
        管道阻抗
        
        S = 8λL/(π²gd⁵)
        """
        return 8 * lam * L / (np.pi**2 * self.g * d**5)
    
    def head_loss(self, S, Q):
        """
        水头损失
        
        hw = SQ²
        """
        return S * Q**2
    
    def series_pipes(self, pipes_data):
        """
        串联管道计算
        
        参数:
            pipes_data: [(lam1, L1, d1), (lam2, L2, d2), ...]
        
        返回:
            S_total: 总阻抗
        """
        S_total = 0
        
        for lam, L, d in pipes_data:
            S = self.pipe_resistance(lam, L, d)
            S_total += S
        
        return S_total
    
    def parallel_pipes(self, pipes_data):
        """
        并联管道计算
        
        参数:
            pipes_data: [(lam1, L1, d1), (lam2, L2, d2), ...]
        
        返回:
            S_equivalent: 等效阻抗
            flow_ratios: 分流比
        """
        # 计算各管阻抗
        resistances = []
        for lam, L, d in pipes_data:
            S = self.pipe_resistance(lam, L, d)
            resistances.append(S)
        
        # 等效阻抗
        sum_inv_sqrt = sum(1 / np.sqrt(S) for S in resistances)
        S_equivalent = 1 / sum_inv_sqrt**2
        
        # 分流比（相对于第一根管）
        flow_ratios = [np.sqrt(resistances[0] / S) for S in resistances]
        
        return S_equivalent, flow_ratios
    
    def three_reservoirs(self, z1, z2, z3, S1, S2, S3, tol=1e-4, max_iter=100):
        """
        三水库连通问题
        
        参数:
            z1, z2, z3: 三个水库水位 (m)
            S1, S2, S3: 三根管道阻抗
            
        返回:
            H0: 连接点水头 (m)
            Q1, Q2, Q3: 各管流量 (m³/s)，流入为正
        """
        # 初始假设节点水头为中间值
        H0 = (z1 + z2 + z3) / 3
        
        for i in range(max_iter):
            # 计算各管流量
            Q1 = np.sqrt(abs(z1 - H0) / S1) * np.sign(z1 - H0)
            Q2 = np.sqrt(abs(z2 - H0) / S2) * np.sign(z2 - H0)
            Q3 = np.sqrt(abs(z3 - H0) / S3) * np.sign(z3 - H0)
            
            # 流量平衡
            balance = Q1 + Q2 + Q3
            
            # 检查收敛
            if abs(balance) < tol:
                break
            
            # 修正节点水头
            # dQ/dH = -1/(2S*Q)
            dQ1_dH = -1 / (2 * S1 * Q1) if Q1 != 0 else 0
            dQ2_dH = -1 / (2 * S2 * Q2) if Q2 != 0 else 0
            dQ3_dH = -1 / (2 * S3 * Q3) if Q3 != 0 else 0
            
            dBalance_dH = dQ1_dH + dQ2_dH + dQ3_dH
            
            H0 = H0 - balance / dBalance_dH
        
        return {
            'H0': H0,
            'Q1': Q1,
            'Q2': Q2,
            'Q3': Q3,
            'iterations': i + 1
        }
    
    def hardy_cross_single_loop(self, pipes, Q_initial, tol=1e-5, max_iter=20):
        """
        哈代-克罗斯法（单环）
        
        参数:
            pipes: [(S1, direction1), (S2, direction2), ...]
                   direction: +1顺时针，-1逆时针
            Q_initial: 初始流量假设（数组）
            
        返回:
            Q: 各管流量 (m³/s)
            iterations: 迭代次数
        """
        Q = np.array(Q_initial, dtype=float)
        n_pipes = len(pipes)
        
        for iter_count in range(max_iter):
            # 计算水头损失闭合差
            sum_hw = 0
            sum_dhw_dQ = 0
            
            for i, (S, direction) in enumerate(pipes):
                hw = direction * S * Q[i] * abs(Q[i])
                sum_hw += hw
                sum_dhw_dQ += 2 * S * abs(Q[i])
            
            # 检查收敛
            if abs(sum_hw) < tol:
                break
            
            # 修正流量
            delta_Q = -sum_hw / sum_dhw_dQ
            
            for i, (S, direction) in enumerate(pipes):
                Q[i] += direction * delta_Q
        
        return {
            'Q': Q,
            'sum_hw': sum_hw,
            'iterations': iter_count + 1
        }
    
    def plot_series_vs_parallel(self):
        """绘制串并联对比"""
        fig, axes = plt.subplots(2, 2, figsize=(16, 12))
        
        # 两管串联
        ax1 = axes[0, 0]
        L1, L2 = 100, 150
        d1, d2 = 0.3, 0.2
        lam = 0.025
        
        S1 = self.pipe_resistance(lam, L1, d1)
        S2 = self.pipe_resistance(lam, L2, d2)
        S_series = S1 + S2
        
        Q_range = np.linspace(0, 0.3, 100)
        hw1 = S1 * Q_range**2
        hw2 = S2 * Q_range**2
        hw_total = S_series * Q_range**2
        
        ax1.plot(Q_range, hw1, 'b-', linewidth=2, label=f'管1 (d={d1}m, L={L1}m)')
        ax1.plot(Q_range, hw2, 'r-', linewidth=2, label=f'管2 (d={d2}m, L={L2}m)')
        ax1.plot(Q_range, hw_total, 'g--', linewidth=2.5, label='总水头损失')
        ax1.set_xlabel('流量 Q (m³/s)', fontsize=11)
        ax1.set_ylabel('水头损失 hw (m)', fontsize=11)
        ax1.set_title('串联管道：hw = hw1 + hw2', fontsize=13, fontweight='bold')
        ax1.legend(loc='upper left')
        ax1.grid(True, alpha=0.3)
        
        # 两管并联
        ax2 = axes[0, 1]
        S_parallel = 1 / (1/np.sqrt(S1) + 1/np.sqrt(S2))**2
        
        hw_range = np.linspace(0, 50, 100)
        Q1 = np.sqrt(hw_range / S1)
        Q2 = np.sqrt(hw_range / S2)
        Q_total = Q1 + Q2
        
        ax2.plot(Q1, hw_range, 'b-', linewidth=2, label=f'管1')
        ax2.plot(Q2, hw_range, 'r-', linewidth=2, label=f'管2')
        ax2.plot(Q_total, hw_range, 'g--', linewidth=2.5, label='总流量')
        ax2.set_xlabel('流量 Q (m³/s)', fontsize=11)
        ax2.set_ylabel('水头损失 hw (m)', fontsize=11)
        ax2.set_title('并联管道：Q = Q1 + Q2, hw = hw1 = hw2', fontsize=13, fontweight='bold')
        ax2.legend(loc='upper left')
        ax2.grid(True, alpha=0.3)
        
        # 三水库问题
        ax3 = axes[1, 0]
        z1, z2, z3 = 100, 80, 60
        result = self.three_reservoirs(z1, z2, z3, S1, S2, S1)
        
        H0 = result['H0']
        Q1, Q2, Q3 = result['Q1'], result['Q2'], result['Q3']
        
        # 绘制示意图
        ax3.barh(['水库1', '水库2', '水库3', '节点'], 
                [z1, z2, z3, H0], 
                color=['blue', 'green', 'orange', 'red'],
                alpha=0.7)
        
        ax3.set_xlabel('水位 (m)', fontsize=11)
        ax3.set_title(f'三水库连通\n节点水头H₀={H0:.2f}m', fontsize=13, fontweight='bold')
        ax3.grid(True, alpha=0.3, axis='x')
        
        # 添加流量标注
        ax3.text(z1+2, 0, f'Q₁={Q1:.3f}m³/s', fontsize=10, va='center')
        ax3.text(z2+2, 1, f'Q₂={Q2:.3f}m³/s', fontsize=10, va='center')
        ax3.text(z3+2, 2, f'Q₃={Q3:.3f}m³/s', fontsize=10, va='center')
        
        # Hardy-Cross迭代过程
        ax4 = axes[1, 1]
        
        # 简单单环示例
        pipes = [(S1, 1), (S2, 1), (S1, -1)]
        Q_init = [0.1, 0.1, 0.2]
        
        # 记录迭代过程
        Q_history = [Q_init.copy()]
        Q_current = Q_init.copy()
        
        for _ in range(10):
            result = self.hardy_cross_single_loop(pipes, Q_current, max_iter=1)
            Q_current = result['Q'].tolist()
            Q_history.append(Q_current.copy())
        
        Q_history = np.array(Q_history)
        
        for i in range(3):
            ax4.plot(range(len(Q_history)), Q_history[:, i], 
                    marker='o', linewidth=2, label=f'管{i+1}')
        
        ax4.set_xlabel('迭代次数', fontsize=11)
        ax4.set_ylabel('流量 Q (m³/s)', fontsize=11)
        ax4.set_title('Hardy-Cross法迭代收敛', fontsize=13, fontweight='bold')
        ax4.legend()
        ax4.grid(True, alpha=0.3)
        
        plt.tight_layout()
        plt.savefig('pipe_network_analysis.png', dpi=300)
        plt.show()

# 示例1：串联管道
print("="*60)
print("核心题型41：串联管道计算")
print("="*60)

network = PipeNetwork()

# 两根管道串联
pipes = [
    (0.025, 100, 0.3),  # (λ, L, d)
    (0.030, 150, 0.2)
]

S_total = network.series_pipes(pipes)

print("串联管道参数:")
for i, (lam, L, d) in enumerate(pipes, 1):
    S = network.pipe_resistance(lam, L, d)
    print(f"  管{i}: λ={lam}, L={L}m, d={d}m, S={S:.2e}")

print(f"\n总阻抗 S_total = {S_total:.2e}")

Q = 0.1  # m³/s
hw_total = network.head_loss(S_total, Q)

print(f"\n当流量 Q={Q} m³/s 时:")
print(f"  总水头损失 hw = {hw_total:.3f} m")

# 示例2：并联管道
print("\n" + "="*60)
print("核心题型42：并联管道分流计算")
print("="*60)

pipes_parallel = [
    (0.025, 100, 0.3),
    (0.025, 100, 0.2)
]

S_eq, flow_ratios = network.parallel_pipes(pipes_parallel)

print("并联管道参数:")
for i, (lam, L, d) in enumerate(pipes_parallel, 1):
    S = network.pipe_resistance(lam, L, d)
    print(f"  管{i}: λ={lam}, L={L}m, d={d}m, S={S:.2e}")

print(f"\n等效阻抗 S_eq = {S_eq:.2e}")

Q_total = 0.2  # m³/s
hw = network.head_loss(S_eq, Q_total)

print(f"\n当总流量 Q_total={Q_total} m³/s 时:")
print(f"  水头损失 hw = {hw:.3f} m")

Q1 = flow_ratios[0] / sum(flow_ratios) * Q_total
Q2 = flow_ratios[1] / sum(flow_ratios) * Q_total

print(f"  管1流量 Q1 = {Q1:.4f} m³/s ({Q1/Q_total*100:.1f}%)")
print(f"  管2流量 Q2 = {Q2:.4f} m³/s ({Q2/Q_total*100:.1f}%)")
print(f"  分流比 Q1:Q2 = {Q1/Q2:.2f}:1")

# 示例3：三水库连通
print("\n" + "="*60)
print("核心题型43：三水库连通问题")
print("="*60)

z1, z2, z3 = 100, 85, 70
S1 = network.pipe_resistance(0.025, 200, 0.3)
S2 = network.pipe_resistance(0.030, 150, 0.25)
S3 = network.pipe_resistance(0.028, 180, 0.28)

print(f"三个水库水位:")
print(f"  水库1: z1 = {z1} m")
print(f"  水库2: z2 = {z2} m")
print(f"  水库3: z3 = {z3} m")

result = network.three_reservoirs(z1, z2, z3, S1, S2, S3)

print(f"\n计算结果:")
print(f"  节点水头 H0 = {result['H0']:.3f} m")
print(f"  管1流量 Q1 = {result['Q1']:+.4f} m³/s ({'流入' if result['Q1']>0 else '流出'})")
print(f"  管2流量 Q2 = {result['Q2']:+.4f} m³/s ({'流入' if result['Q2']>0 else '流出'})")
print(f"  管3流量 Q3 = {result['Q3']:+.4f} m³/s ({'流入' if result['Q3']>0 else '流出'})")
print(f"  流量平衡检验: Q1+Q2+Q3 = {result['Q1']+result['Q2']+result['Q3']:.6f} m³/s")
print(f"  迭代次数 = {result['iterations']}")

# 示例4：Hardy-Cross法
print("\n" + "="*60)
print("核心题型44：Hardy-Cross法管网计算")
print("="*60)

# 简单单环管网
pipes_loop = [
    (S1, 1),   # 管1，顺时针
    (S2, 1),   # 管2，顺时针
    (S3, -1)   # 管3，逆时针
]

Q_initial = [0.05, 0.05, 0.10]

print("初始流量假设:")
for i, Q in enumerate(Q_initial, 1):
    print(f"  管{i}: Q = {Q:.3f} m³/s")

result = network.hardy_cross_single_loop(pipes_loop, Q_initial)

print(f"\n收敛后流量:")
for i, Q in enumerate(result['Q'], 1):
    print(f"  管{i}: Q = {Q:.4f} m³/s")

print(f"\n水头损失闭合差: {result['sum_hw']:.6f} m")
print(f"迭代次数: {result['iterations']}")

# 绘制对比图
print("\n绘制管网计算对比图...")
network.plot_series_vs_parallel()
```

---

## 五、核心题型精解

### 【题型41】串联管道等效长度（12分）

**题目**：两管串联，管1：$d_1=0.3$m，$L_1=100$m；管2：$d_2=0.2$m，$L_2=150$m。求换算成$d_1$的等效长度。

**【解答】**

$$L_e = L_1 + L_2 \left(\frac{d_1}{d_2}\right)^5 = 100 + 150 \times \left(\frac{0.3}{0.2}\right)^5$$

$$= 100 + 150 \times 7.59 = 1238.5 \text{ m}$$

---

### 【题型42】并联管道分流比（15分）

**题目**：两管并联，长度相同，$d_1=0.4$m，$d_2=0.3$m，$\lambda$相同。求流量分配比$Q_1/Q_2$。

**【解答】**

$$\frac{Q_1}{Q_2} = \left(\frac{d_1}{d_2}\right)^{2.5} = \left(\frac{0.4}{0.3}\right)^{2.5} = 1.76$$

---

**本章重点**：
- 串联：$h_w$相加，$Q$相同
- 并联：$Q$相加，$h_w$相同
- 三水库：节点流量平衡+水头关系
- Hardy-Cross法：迭代修正流量

**下一章**：水泵与管道系统
