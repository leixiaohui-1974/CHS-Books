# 第3章：概率统计核心定理与速算技巧

**学习时间**: 5小时  
**难度**: ⭐⭐⭐  
**考试权重**: 18%

---

## 一、概率基本公式

### 1.1 古典概型

$$P(A) = \frac{m}{n}$$

其中：m为有利事件数，n为总事件数

### 1.2 条件概率

$$P(A|B) = \frac{P(AB)}{P(B)}$$

### 1.3 乘法公式

$$P(AB) = P(A)P(B|A) = P(B)P(A|B)$$

### 1.4 全概率公式

$$P(A) = \sum_{i=1}^{n}P(B_i)P(A|B_i)$$

其中$B_i$构成样本空间的一个划分

### 1.5 贝叶斯公式

$$P(B_i|A) = \frac{P(B_i)P(A|B_i)}{\sum_{j=1}^{n}P(B_j)P(A|B_j)}$$

### 1.6 Python实现

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy import stats
from scipy.special import comb

class ProbabilityCalculator:
    """
    概率计算工具
    """
    
    @staticmethod
    def classical_probability(m, n):
        """
        古典概型
        
        参数:
            m: 有利事件数
            n: 总事件数
        """
        return m / n
    
    @staticmethod
    def conditional_probability(P_AB, P_B):
        """
        条件概率: P(A|B) = P(AB) / P(B)
        """
        if P_B == 0:
            raise ValueError("P(B) 不能为0")
        return P_AB / P_B
    
    @staticmethod
    def total_probability(P_B, P_A_given_B):
        """
        全概率公式
        
        参数:
            P_B: 各划分事件的概率列表
            P_A_given_B: 各条件概率列表 P(A|B_i)
        """
        return np.sum(np.array(P_B) * np.array(P_A_given_B))
    
    @staticmethod
    def bayes_theorem(P_B, P_A_given_B, i):
        """
        贝叶斯公式
        
        参数:
            P_B: 先验概率列表
            P_A_given_B: 条件概率列表
            i: 求P(B_i|A)的索引
        """
        numerator = P_B[i] * P_A_given_B[i]
        denominator = np.sum(np.array(P_B) * np.array(P_A_given_B))
        return numerator / denominator
    
    @staticmethod
    def combination(n, k):
        """
        组合数 C(n,k)
        """
        return comb(n, k, exact=True)
    
    @staticmethod
    def permutation(n, k):
        """
        排列数 A(n,k)
        """
        return comb(n, k, exact=True) * np.math.factorial(k)


# 示例
calc = ProbabilityCalculator()

# 古典概型：掷骰子
P_even = calc.classical_probability(3, 6)
print(f"掷骰子出现偶数的概率: {P_even:.3f}")

# 全概率公式
print(f"\n全概率公式示例:")
P_B = [0.3, 0.5, 0.2]  # 三个工厂的产品比例
P_A_given_B = [0.05, 0.03, 0.08]  # 各工厂的次品率

P_A = calc.total_probability(P_B, P_A_given_B)
print(f"  总次品率: {P_A:.4f}")

# 贝叶斯公式：已知产品是次品，求来自第1个工厂的概率
P_B1_given_A = calc.bayes_theorem(P_B, P_A_given_B, 0)
print(f"  次品来自工厂1的概率: {P_B1_given_A:.4f}")

# 组合排列
C_10_3 = calc.combination(10, 3)
A_10_3 = calc.permutation(10, 3)
print(f"\n组合排列:")
print(f"  C(10,3) = {C_10_3}")
print(f"  A(10,3) = {A_10_3}")
```

---

## 二、常见分布

### 2.1 离散型分布

#### 二项分布 B(n, p)

$$P(X=k) = C_n^k p^k (1-p)^{n-k}$$

**均值**：$E(X) = np$  
**方差**：$D(X) = np(1-p)$

#### 泊松分布 P(λ)

$$P(X=k) = \frac{\lambda^k}{k!}e^{-\lambda}$$

**均值**：$E(X) = \lambda$  
**方差**：$D(X) = \lambda$

### 2.2 连续型分布

#### 均匀分布 U(a, b)

$$f(x) = \begin{cases}
\frac{1}{b-a}, & a \leq x \leq b \\
0, & \text{其他}
\end{cases}$$

**均值**：$E(X) = \frac{a+b}{2}$  
**方差**：$D(X) = \frac{(b-a)^2}{12}$

#### 指数分布 Exp(λ)

$$f(x) = \begin{cases}
\lambda e^{-\lambda x}, & x \geq 0 \\
0, & x < 0
\end{cases}$$

**均值**：$E(X) = \frac{1}{\lambda}$  
**方差**：$D(X) = \frac{1}{\lambda^2}$

**无记忆性**：$P(X>s+t | X>s) = P(X>t)$

#### 正态分布 N(μ, σ²)

$$f(x) = \frac{1}{\sqrt{2\pi}\sigma}e^{-\frac{(x-\mu)^2}{2\sigma^2}}$$

**标准正态分布**：$N(0, 1)$

**3σ原则**：
- $P(|X-\mu| < \sigma) = 0.6827$
- $P(|X-\mu| < 2\sigma) = 0.9545$
- $P(|X-\mu| < 3\sigma) = 0.9973$

### 2.3 Python实现

```python
class DistributionAnalysis:
    """
    概率分布分析
    """
    
    @staticmethod
    def binomial_pmf(n, p, k):
        """
        二项分布概率质量函数
        """
        return stats.binom.pmf(k, n, p)
    
    @staticmethod
    def binomial_expectation(n, p):
        """
        二项分布均值和方差
        """
        E = n * p
        D = n * p * (1 - p)
        return E, D
    
    @staticmethod
    def poisson_pmf(lam, k):
        """
        泊松分布PMF
        """
        return stats.poisson.pmf(k, lam)
    
    @staticmethod
    def normal_pdf(x, mu, sigma):
        """
        正态分布PDF
        """
        return stats.norm.pdf(x, mu, sigma)
    
    @staticmethod
    def normal_cdf(x, mu, sigma):
        """
        正态分布CDF
        """
        return stats.norm.cdf(x, mu, sigma)
    
    @staticmethod
    def standard_normal_quantile(p):
        """
        标准正态分位数
        """
        return stats.norm.ppf(p)
    
    @staticmethod
    def plot_distributions():
        """
        绘制常见分布
        """
        fig, axes = plt.subplots(2, 2, figsize=(14, 10))
        
        # 二项分布
        n, p = 20, 0.3
        x_binom = np.arange(0, n+1)
        y_binom = [stats.binom.pmf(k, n, p) for k in x_binom]
        
        axes[0, 0].bar(x_binom, y_binom, color='steelblue', alpha=0.7)
        axes[0, 0].set_xlabel('k')
        axes[0, 0].set_ylabel('P(X=k)')
        axes[0, 0].set_title(f'二项分布 B({n}, {p})')
        axes[0, 0].grid(True, alpha=0.3)
        
        # 泊松分布
        lam = 5
        x_poisson = np.arange(0, 20)
        y_poisson = [stats.poisson.pmf(k, lam) for k in x_poisson]
        
        axes[0, 1].bar(x_poisson, y_poisson, color='coral', alpha=0.7)
        axes[0, 1].set_xlabel('k')
        axes[0, 1].set_ylabel('P(X=k)')
        axes[0, 1].set_title(f'泊松分布 P({lam})')
        axes[0, 1].grid(True, alpha=0.3)
        
        # 均匀分布
        a, b = 0, 10
        x_uniform = np.linspace(-2, 12, 1000)
        y_uniform = stats.uniform.pdf(x_uniform, a, b-a)
        
        axes[1, 0].plot(x_uniform, y_uniform, 'g-', linewidth=2)
        axes[1, 0].fill_between(x_uniform, y_uniform, alpha=0.3, color='green')
        axes[1, 0].set_xlabel('x')
        axes[1, 0].set_ylabel('f(x)')
        axes[1, 0].set_title(f'均匀分布 U({a}, {b})')
        axes[1, 0].grid(True, alpha=0.3)
        
        # 正态分布
        mu, sigma = 0, 1
        x_normal = np.linspace(-4, 4, 1000)
        y_normal = stats.norm.pdf(x_normal, mu, sigma)
        
        axes[1, 1].plot(x_normal, y_normal, 'b-', linewidth=2, label='PDF')
        axes[1, 1].fill_between(x_normal, y_normal, alpha=0.3)
        
        # 3σ区间
        for k in [1, 2, 3]:
            x_fill = x_normal[(x_normal >= -k*sigma) & (x_normal <= k*sigma)]
            y_fill = stats.norm.pdf(x_fill, mu, sigma)
            axes[1, 1].fill_between(x_fill, y_fill, alpha=0.2, 
                                   label=f'{k}σ: {stats.norm.cdf(k)-stats.norm.cdf(-k):.4f}')
        
        axes[1, 1].set_xlabel('x')
        axes[1, 1].set_ylabel('f(x)')
        axes[1, 1].set_title(f'正态分布 N({mu}, {sigma}²)')
        axes[1, 1].grid(True, alpha=0.3)
        axes[1, 1].legend(fontsize=8)
        
        plt.tight_layout()
        plt.savefig('probability_distributions.png', dpi=300, bbox_inches='tight')
        plt.show()


# 使用示例
dist = DistributionAnalysis()

# 二项分布
n, p, k = 10, 0.4, 6
P_binom = dist.binomial_pmf(n, p, k)
E, D = dist.binomial_expectation(n, p)
print(f"二项分布 B({n}, {p}):")
print(f"  P(X={k}) = {P_binom:.4f}")
print(f"  E(X) = {E:.2f}")
print(f"  D(X) = {D:.2f}")

# 泊松分布
lam, k = 3, 5
P_poisson = dist.poisson_pmf(lam, k)
print(f"\n泊松分布 P({lam}):")
print(f"  P(X={k}) = {P_poisson:.4f}")

# 正态分布
mu, sigma, x = 100, 15, 110
P_normal = dist.normal_cdf(x, mu, sigma)
print(f"\n正态分布 N({mu}, {sigma}²):")
print(f"  P(X ≤ {x}) = {P_normal:.4f}")

# 标准正态分位数
for p in [0.9, 0.95, 0.975, 0.99]:
    z = dist.standard_normal_quantile(p)
    print(f"  z_{p} = {z:.3f}")

# 绘图
dist.plot_distributions()
```

---

## 三、典型考题

### 考题1：全概率与贝叶斯

**【题目】**（20分）

某工厂有三条生产线A、B、C，产量分别占30%、50%、20%，次品率分别为5%、3%、8%。

1. 求产品是次品的概率
2. 若产品是次品，求来自A线的概率

**【解答】**

设$B_1, B_2, B_3$分别表示产品来自A、B、C线，$A$表示次品

#### 1. 全概率公式

$$P(A) = \sum_{i=1}^{3}P(B_i)P(A|B_i)$$

$$= 0.3 \times 0.05 + 0.5 \times 0.03 + 0.2 \times 0.08$$

$$= 0.015 + 0.015 + 0.016 = 0.046$$

**答**：次品率为**4.6%**

#### 2. 贝叶斯公式

$$P(B_1|A) = \frac{P(B_1)P(A|B_1)}{P(A)}$$

$$= \frac{0.3 \times 0.05}{0.046} = \frac{0.015}{0.046} = 0.326$$

**答**：来自A线的概率为**32.6%**

---

### 考题2：正态分布

**【题目】**（20分）

某零件长度$X \sim N(100, 4^2)$ mm。求：
1. $P(96 < X < 104)$
2. $P(X > 108)$
3. 若要求$P(X > a) = 0.05$，求$a$

**【解答】**

#### 1. $P(96 < X < 104)$

标准化：
$$P(96 < X < 104) = P\left(\frac{96-100}{4} < Z < \frac{104-100}{4}\right)$$

$$= P(-1 < Z < 1) = \Phi(1) - \Phi(-1)$$

$$= 0.8413 - 0.1587 = 0.6826$$

#### 2. $P(X > 108)$

$$P(X > 108) = P\left(Z > \frac{108-100}{4}\right) = P(Z > 2)$$

$$= 1 - \Phi(2) = 1 - 0.9772 = 0.0228$$

#### 3. 求$a$使得$P(X > a) = 0.05$

$$P(X > a) = P\left(Z > \frac{a-100}{4}\right) = 0.05$$

查表：$\frac{a-100}{4} = z_{0.95} = 1.645$

$$a = 100 + 4 \times 1.645 = 106.58 \text{ mm}$$

---

## 四、高频考点速查

### 4.1 常用分布速记

| 分布 | 参数 | E(X) | D(X) |
|------|------|------|------|
| 二项 | B(n,p) | np | np(1-p) |
| 泊松 | P(λ) | λ | λ |
| 均匀 | U(a,b) | (a+b)/2 | (b-a)²/12 |
| 指数 | Exp(λ) | 1/λ | 1/λ² |
| 正态 | N(μ,σ²) | μ | σ² |

### 4.2 标准正态分位数（背诵）

| p | z_p |
|---|-----|
| 0.90 | 1.282 |
| 0.95 | 1.645 |
| 0.975 | 1.960 |
| 0.99 | 2.326 |

---

**本章习题**: 见配套练习册  
**复习重点**: 贝叶斯公式、正态分布、3σ原则
