# 第4章：井流计算

**学习时间**: 4小时  
**考试频率**: ⭐⭐⭐⭐⭐  
**难度**: ⭐⭐⭐⭐

---

## 一、承压水井流

### 1.1 稳定井流（Thiem公式）

**基本假设**：
- 完整井，全部揭穿含水层
- 承压含水层厚度$M$恒定
- 稳定流，$\frac{\partial h}{\partial t} = 0$

**Thiem公式**：

$$Q = \frac{2\pi KM(s_1 - s_2)}{\ln(r_2/r_1)}$$

或：
$$Q = \frac{2\pi KM(h_2 - h_1)}{\ln(r_2/r_1)}$$

**参数说明**：
- $Q$：抽水流量（m³/d）
- $K$：渗透系数（m/d）
- $M$：含水层厚度（m）
- $s_1, s_2$：观测孔水位降深（m）
- $r_1, r_2$：观测孔距抽水井距离（m）
- $h_1, h_2$：观测孔水头（m）

**水位降深公式**：

$$s = \frac{Q}{2\pi KM}\ln\frac{R}{r}$$

**参数说明**：
- $s$：降深（m）
- $R$：影响半径（m）
- $r$：至井中心距离（m）

### 1.2 单井出水量

$$Q = \frac{2\pi KM(H - h_w)}{\ln(R/r_w)}$$

**参数说明**：
- $H$：初始水头（m）
- $h_w$：井内水位（m）
- $r_w$：井半径（m）

---

## 二、潜水井流

### 2.1 稳定井流（Dupuit公式）

**基本方程**（Dupuit假设：垂直流速忽略）：

$$Q = \frac{\pi K(h_2^2 - h_1^2)}{\ln(r_2/r_1)}$$

**单井出水量**：

$$Q = \frac{\pi K(H^2 - h_w^2)}{\ln(R/r_w)}$$

**参数说明**：
- $H$：初始潜水面高程（m）
- $h_w$：井内水位高程（m）
- $h_1, h_2$：观测孔水位高程（m）

**降深公式**：

$$s = H - h = H - \sqrt{H^2 - \frac{Q}{\pi K}\ln\frac{R}{r}}$$

### 2.2 抽水半径与影响半径

**影响半径**（经验公式，Sichardt公式）：

$$R = 10s\sqrt{K}$$

或（Kusasky公式）：

$$R = 3000s\sqrt{K} \quad (K \text{单位m/d})$$

---

## 三、非稳定井流

### 3.1 Theis井流理论

**基本方程**：

$$s(r, t) = \frac{Q}{4\pi T}W(u)$$

**参数说明**：
- $T = KM$：导水系数（m²/d）
- $W(u)$：井函数
- $u = \frac{r^2 S}{4Tt}$
- $S$：贮水系数（无量纲）

**井函数**：

$$W(u) = \int_u^{\infty}\frac{e^{-y}}{y}dy = -0.5772 - \ln u + u - \frac{u^2}{2 \cdot 2!} + \frac{u^3}{3 \cdot 3!} - \cdots$$

**小$u$近似**（$u < 0.01$）：

$$W(u) \approx -0.5772 - \ln u$$

### 3.2 Jacob近似

**适用条件**：$u < 0.01$（大时间、小距离）

**简化公式**：

$$s = \frac{2.3Q}{4\pi T}\lg\frac{2.25Tt}{r^2S}$$

或：

$$s = \frac{0.183Q}{T}\lg\frac{2.25Tt}{r^2S}$$

### 3.3 参数反求

**配线法**：
1. 绘制$s-t$曲线（实测）
2. 与标准曲线$W(u)-1/u$配线
3. 选取配点$(s_M, t_M, W(u_M), 1/u_M)$
4. 计算$T = \frac{Q}{4\pi s_M}W(u_M)$
5. 计算$S = \frac{4Tt_M}{r^2} \cdot \frac{1}{u_M}$

**Jacob直线法**：
1. 绘制$s$-$\lg t$曲线
2. 求直线斜率$i$
3. $T = \frac{0.183Q}{i}$
4. 延长直线交横轴于$t_0$
5. $S = \frac{2.25Tt_0}{r^2}$

---

## 四、井间干扰

### 4.1 叠加原理

**多井抽水**：

$$s = s_1 + s_2 + \cdots + s_n$$

**承压井群**：

$$s = \sum_{i=1}^{n}\frac{Q_i}{2\pi KM}\ln\frac{R_i}{r_i}$$

### 4.2 回灌井

**抽水井+回灌井**：

$$s = \frac{Q}{2\pi KM}\left(\ln\frac{R}{r_抽} - \ln\frac{R}{r_灌}\right) = \frac{Q}{2\pi KM}\ln\frac{r_灌}{r_抽}$$

---

## 五、Python实现

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy.special import expi
from scipy.optimize import curve_fit

class WellHydraulics:
    """井流计算"""
    
    def __init__(self):
        self.g = 9.81
    
    def thiem_confined(self, Q, K, M, r1, r2, s1, s2=None):
        """
        Thiem公式（承压井稳定流）
        
        已知Q, K, M, r1, r2, s1，求s2
        或已知Q, K, M, r1, r2, s1, s2，求参数
        
        Q = 2πKM(s1-s2) / ln(r2/r1)
        """
        if s2 is None:
            # 已知参数，求s2
            s2 = s1 - Q * np.log(r2 / r1) / (2 * np.pi * K * M)
            return s2
        else:
            # 反求K
            K_calc = Q * np.log(r2 / r1) / (2 * np.pi * M * (s1 - s2))
            return K_calc
    
    def thiem_unconfined(self, Q, K, r1, r2, h1, h2=None):
        """
        Dupuit公式（潜水井稳定流）
        
        Q = πK(h2²-h1²) / ln(r2/r1)
        """
        if h2 is None:
            # 已知参数，求h2
            h2_sq = h1**2 + Q * np.log(r2 / r1) / (np.pi * K)
            h2 = np.sqrt(h2_sq)
            return h2
        else:
            # 反求K
            K_calc = Q * np.log(r2 / r1) / (np.pi * (h2**2 - h1**2))
            return K_calc
    
    def well_function(self, u):
        """
        井函数 W(u)
        
        W(u) = ∫[u,∞] e^(-y)/y dy
        """
        # 使用scipy的指数积分函数
        # W(u) = -Ei(-u)
        W = -expi(-u)
        return W
    
    def theis_drawdown(self, Q, T, S, r, t):
        """
        Theis非稳定井流降深
        
        s = Q/(4πT) * W(u)
        u = r²S/(4Tt)
        
        参数:
            Q: 抽水流量 (m³/d)
            T: 导水系数 (m²/d)
            S: 贮水系数
            r: 距离 (m)
            t: 时间 (d)
        """
        u = r**2 * S / (4 * T * t)
        W_u = self.well_function(u)
        s = Q / (4 * np.pi * T) * W_u
        return s
    
    def jacob_approximation(self, Q, T, S, r, t):
        """
        Jacob近似（u<0.01时）
        
        s = 0.183Q/T * lg(2.25Tt/r²S)
        """
        u = r**2 * S / (4 * T * t)
        
        if u > 0.01:
            print(f"警告：u={u:.4f} > 0.01，Jacob近似可能不准确")
        
        s = 0.183 * Q / T * np.log10(2.25 * T * t / (r**2 * S))
        return s
    
    def jacob_method_fit(self, t_data, s_data, Q, r):
        """
        Jacob直线法反求参数
        
        参数:
            t_data: 时间序列 (d)
            s_data: 降深序列 (m)
            Q: 抽水流量 (m³/d)
            r: 观测孔距离 (m)
        
        返回:
            T, S
        """
        # 对时间取对数
        log_t = np.log10(t_data)
        
        # 线性拟合 s = a + b*log(t)
        coeffs = np.polyfit(log_t, s_data, 1)
        b = coeffs[0]  # 斜率
        a = coeffs[1]  # 截距
        
        # 计算T
        T = 0.183 * Q / b
        
        # 计算S：延长直线至s=0，求t0
        # a + b*log(t0) = 0
        log_t0 = -a / b
        t0 = 10**log_t0
        
        S = 2.25 * T * t0 / r**2
        
        return T, S, b, t0
    
    def influence_radius_sichardt(self, s, K):
        """
        影响半径（Sichardt公式）
        
        R = 10*s*√K
        
        参数:
            s: 降深 (m)
            K: 渗透系数 (m/d)
        """
        R = 10 * s * np.sqrt(K)
        return R
    
    def well_discharge_confined(self, K, M, H, hw, R, rw):
        """
        承压井出水量
        
        Q = 2πKM(H-hw) / ln(R/rw)
        """
        Q = 2 * np.pi * K * M * (H - hw) / np.log(R / rw)
        return Q
    
    def well_discharge_unconfined(self, K, H, hw, R, rw):
        """
        潜水井出水量
        
        Q = πK(H²-hw²) / ln(R/rw)
        """
        Q = np.pi * K * (H**2 - hw**2) / np.log(R / rw)
        return Q
    
    def plot_well_flow_analysis(self, Q, T, S, r_obs):
        """绘制井流分析图"""
        fig, axes = plt.subplots(2, 2, figsize=(16, 12))
        
        # 1. Theis曲线族（不同距离）
        ax1 = axes[0, 0]
        
        t_range = np.logspace(-3, 2, 200)  # 0.001 - 100天
        r_values = [10, 30, 50, 100]
        colors = plt.cm.viridis(np.linspace(0.2, 0.9, len(r_values)))
        
        for r, color in zip(r_values, colors):
            s_values = [self.theis_drawdown(Q, T, S, r, t) for t in t_range]
            ax1.plot(t_range, s_values, color=color, linewidth=2, label=f'r={r}m')
        
        ax1.set_xscale('log')
        ax1.set_xlabel('时间 t (天)', fontsize=11)
        ax1.set_ylabel('降深 s (m)', fontsize=11)
        ax1.set_title(f'Theis曲线族（不同距离）\nQ={Q}m³/d, T={T}m²/d, S={S}',
                     fontsize=13, fontweight='bold')
        ax1.legend()
        ax1.grid(True, alpha=0.3, which='both')
        
        # 2. Jacob直线法
        ax2 = axes[0, 1]
        
        t_jacob = np.logspace(0, 2, 50)  # 1-100天
        s_jacob = [self.jacob_approximation(Q, T, S, r_obs, t) for t in t_jacob]
        
        ax2.semilogx(t_jacob, s_jacob, 'b-', linewidth=2.5, label='Jacob近似')
        
        # Theis精确解对比
        s_theis = [self.theis_drawdown(Q, T, S, r_obs, t) for t in t_jacob]
        ax2.semilogx(t_jacob, s_theis, 'r--', linewidth=2, label='Theis精确解')
        
        ax2.set_xlabel('时间 t (天)', fontsize=11)
        ax2.set_ylabel('降深 s (m)', fontsize=11)
        ax2.set_title(f'Jacob直线法 vs Theis（r={r_obs}m）', fontsize=13, fontweight='bold')
        ax2.legend()
        ax2.grid(True, alpha=0.3, which='both')
        
        # 3. 井函数曲线
        ax3 = axes[1, 0]
        
        u_range = np.logspace(-4, 1, 200)
        W_u_values = [self.well_function(u) for u in u_range]
        
        ax3.loglog(1/u_range, W_u_values, 'g-', linewidth=2.5)
        ax3.set_xlabel('1/u', fontsize=11)
        ax3.set_ylabel('W(u)', fontsize=11)
        ax3.set_title('井函数标准曲线', fontsize=13, fontweight='bold')
        ax3.grid(True, alpha=0.3, which='both')
        
        # 标注u=0.01点
        u_01 = 0.01
        W_01 = self.well_function(u_01)
        ax3.scatter([1/u_01], [W_01], color='r', s=150, zorder=5, marker='*')
        ax3.text(1/u_01*1.5, W_01, f'u=0.01\n(Jacob近似适用区)',
                fontsize=10, va='center')
        
        # 4. 降深锥形状（径向分布）
        ax4 = axes[1, 1]
        
        t_snapshot = [0.1, 1, 10, 100]  # 不同时刻
        r_radial = np.linspace(0.1, 200, 200)
        colors_time = plt.cm.coolwarm(np.linspace(0.2, 0.9, len(t_snapshot)))
        
        for t, color in zip(t_snapshot, colors_time):
            s_radial = [self.theis_drawdown(Q, T, S, r, t) if r > 0.1 else 0 for r in r_radial]
            ax4.plot(r_radial, s_radial, color=color, linewidth=2, label=f't={t}天')
        
        ax4.set_xlabel('距离 r (m)', fontsize=11)
        ax4.set_ylabel('降深 s (m)', fontsize=11)
        ax4.set_title('降深锥演化', fontsize=13, fontweight='bold')
        ax4.legend()
        ax4.grid(True, alpha=0.3)
        ax4.invert_yaxis()  # 降深向下
        
        plt.tight_layout()
        plt.savefig('well_flow_analysis.png', dpi=300)
        plt.show()

# 示例1：Thiem公式（承压井）
print("="*60)
print("示例1：Thiem公式-承压井稳定流")
print("="*60)

well = WellHydraulics()

Q = 1000  # m³/d
K = 10    # m/d
M = 20    # m
r1 = 10   # m
r2 = 50   # m
s1 = 2.5  # m

s2 = well.thiem_confined(Q, K, M, r1, r2, s1)

print(f"抽水参数:")
print(f"  流量 Q = {Q} m³/d")
print(f"  渗透系数 K = {K} m/d")
print(f"  含水层厚度 M = {M} m")

print(f"\n观测孔:")
print(f"  孔1：r1 = {r1} m, s1 = {s1} m")
print(f"  孔2：r2 = {r2} m, s2 = {s2:.3f} m")

# 验证：反求K
K_check = well.thiem_confined(Q, K, M, r1, r2, s1, s2)
print(f"\n验证：反求渗透系数 K = {K_check:.2f} m/d（应为{K}）")

# 示例2：Dupuit公式（潜水井）
print("\n" + "="*60)
print("示例2：Dupuit公式-潜水井稳定流")
print("="*60)

Q_unc = 800  # m³/d
K_unc = 15   # m/d
r1_unc = 15  # m
r2_unc = 60  # m
h1_unc = 18  # m

h2_unc = well.thiem_unconfined(Q_unc, K_unc, r1_unc, r2_unc, h1_unc)

print(f"抽水参数:")
print(f"  流量 Q = {Q_unc} m³/d")
print(f"  渗透系数 K = {K_unc} m/d")

print(f"\n观测孔:")
print(f"  孔1：r1 = {r1_unc} m, h1 = {h1_unc} m")
print(f"  孔2：r2 = {r2_unc} m, h2 = {h2_unc:.3f} m")

# 示例3：Theis非稳定井流
print("\n" + "="*60)
print("示例3：Theis非稳定井流")
print("="*60)

Q_theis = 1200  # m³/d
T = 200         # m²/d
S = 0.0005
r = 30          # m

times = [0.1, 1, 10, 100]  # 天

print(f"抽水参数:")
print(f"  流量 Q = {Q_theis} m³/d")
print(f"  导水系数 T = {T} m²/d")
print(f"  贮水系数 S = {S}")
print(f"  观测孔距离 r = {r} m")

print(f"\n{'时间(天)':<12s} {'u':<15s} {'W(u)':<12s} {'降深s(m)':<12s}")
print("-" * 55)

for t in times:
    u = r**2 * S / (4 * T * t)
    W_u = well.well_function(u)
    s = well.theis_drawdown(Q_theis, T, S, r, t)
    
    print(f"{t:<12.1f} {u:<15.6f} {W_u:<12.4f} {s:<12.3f}")

# 示例4：Jacob直线法参数反求
print("\n" + "="*60)
print("示例4：Jacob直线法参数反求")
print("="*60)

# 模拟观测数据
t_obs = np.array([1, 2, 5, 10, 20, 50, 100])  # 天
s_obs = np.array([self.jacob_approximation(Q_theis, T, S, r, t) for t in t_obs])

# 加入少量噪声
s_obs += np.random.normal(0, 0.05, len(s_obs))

print(f"观测数据:")
print(f"  流量 Q = {Q_theis} m³/d")
print(f"  观测孔距离 r = {r} m")

T_fit, S_fit, slope, t0 = well.jacob_method_fit(t_obs, s_obs, Q_theis, r)

print(f"\nJacob直线法拟合结果:")
print(f"  斜率 i = {slope:.4f}")
print(f"  截距时间 t0 = {t0:.6f} 天")

print(f"\n反求参数:")
print(f"  导水系数 T = {T_fit:.1f} m²/d （真实值{T}）")
print(f"  贮水系数 S = {S_fit:.6f} （真实值{S}）")

error_T = abs(T_fit - T) / T * 100
error_S = abs(S_fit - S) / S * 100

print(f"\n误差:")
print(f"  T误差: {error_T:.2f}%")
print(f"  S误差: {error_S:.2f}%")

# 示例5：影响半径
print("\n" + "="*60)
print("示例5：影响半径计算")
print("="*60)

s_test = 5.0  # m
K_values = [1, 5, 10, 20, 50]

print(f"降深 s = {s_test} m\n")
print(f"{'K(m/d)':<12s} {'Sichardt R(m)':<18s}")
print("-" * 32)

for K_val in K_values:
    R = well.influence_radius_sichardt(s_test, K_val)
    print(f"{K_val:<12.0f} {R:<18.1f}")

# 绘制井流分析图
print("\n绘制井流综合分析图...")
well.plot_well_flow_analysis(Q_theis, T, S, r)
```

---

## 六、典型考题

### 【例题1】Thiem公式（12分）

**题目**：承压井抽水$Q=1500$m³/d，$M=25$m。观测孔1：$r_1=20$m，$s_1=3.2$m；观测孔2：$r_2=80$m，$s_2=1.5$m。求渗透系数$K$。

**【解答】**

$$K = \frac{Q\ln(r_2/r_1)}{2\pi M(s_1 - s_2)} = \frac{1500 \times \ln(80/20)}{2\pi \times 25 \times (3.2 - 1.5)}$$

$$= \frac{1500 \times 1.386}{2\pi \times 25 \times 1.7} = \frac{2079}{267.0} = 7.79 \text{ m/d}$$

---

### 【例题2】Theis井函数（15分）

**题目**：$Q=1000$m³/d，$T=150$m²/d，$S=0.001$，$r=50$m，$t=10$d。求降深$s$。

**【解答】**

$$u = \frac{r^2S}{4Tt} = \frac{50^2 \times 0.001}{4 \times 150 \times 10} = \frac{2.5}{6000} = 0.000417$$

$u < 0.01$，可用Jacob近似：

$$s = \frac{0.183Q}{T}\lg\frac{2.25Tt}{r^2S} = \frac{0.183 \times 1000}{150}\lg\frac{2.25 \times 150 \times 10}{2500 \times 0.001}$$

$$= 1.22 \times \lg(13500) = 1.22 \times 4.13 = 5.04 \text{ m}$$

---

**本章重点**：
- Thiem公式（稳定流）
- Theis井流理论（非稳定流）
- Jacob近似与直线法
- 井函数计算

**下一章**：地下水资源评价
