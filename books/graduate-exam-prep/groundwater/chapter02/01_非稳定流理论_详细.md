# 第2章：地下水非稳定流

**难度**: ⭐⭐⭐⭐⭐  
**应用**: 抽水试验、地下水资源评价

---

## 一、基本概念

### 1.1 稳定流 vs 非稳定流

| 类型 | 特征 | 方程 |
|------|------|------|
| 稳定流 | $\frac{\partial h}{\partial t} = 0$ | 拉普拉斯方程 |
| 非稳定流 | $\frac{\partial h}{\partial t} \neq 0$ | 扩散方程 |

### 1.2 贮水释放

**承压水**：弹性贮水

**潜水**：重力排水

---

## 二、Theis井流理论

### 2.1 基本假设

1. 承压含水层均质各向同性
2. 完整井，等流量抽水
3. 井径很小，忽略井储
4. 含水层无限延伸

### 2.2 Theis公式

$$s(r,t) = \frac{Q}{4\pi T} W(u)$$

其中：
$$u = \frac{r^2 S}{4Tt}$$

**井函数**$W(u)$：
$$W(u) = \int_u^{\infty} \frac{e^{-y}}{y} dy$$

### 2.3 近似展开

**$u < 0.01$时**（大时间或小距离）：

$$W(u) \approx -0.5772 - \ln u = \ln\frac{2.25Tt}{r^2 S}$$

$$s = \frac{Q}{4\pi T}\ln\frac{2.25Tt}{r^2 S}$$

### Python实现

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy.special import exp1  # 指数积分
from scipy.optimize import curve_fit

class UnsteadyGroundwater:
    """非稳定地下水流动"""
    
    @staticmethod
    def well_function(u):
        """
        井函数 W(u)
        
        W(u) = ∫_u^∞ (e^(-y)/y) dy = -Ei(-u)
        """
        return exp1(u)  # scipy中的exp1就是Ei积分
    
    @staticmethod
    def theis_drawdown(r, t, Q, T, S):
        """
        Theis非稳定井流降深
        
        s = (Q/4πT) W(u)
        u = r²S / (4Tt)
        
        参数:
            r: 径向距离 (m)
            t: 时间 (d)
            Q: 抽水量 (m³/d)
            T: 导水系数 (m²/d)
            S: 贮水系数 (无量纲)
        
        返回:
            s: 降深 (m)
        """
        # 计算u
        u = (r**2 * S) / (4 * T * t)
        
        # 井函数
        W_u = UnsteadyGroundwater.well_function(u)
        
        # 降深
        s = (Q / (4 * np.pi * T)) * W_u
        
        return s
    
    @staticmethod
    def jacob_approximation(r, t, Q, T, S):
        """
        Jacob近似（u < 0.01）
        
        s = (Q/4πT) ln(2.25Tt/r²S)
        """
        s = (Q / (4 * np.pi * T)) * np.log(2.25 * T * t / (r**2 * S))
        return s
    
    @staticmethod
    def theis_parameter_estimation(r, t_series, s_series, Q):
        """
        Theis配线法参数估计
        
        参数:
            r: 观测井距离 (m)
            t_series: 时间序列 (d)
            s_series: 降深序列 (m)
            Q: 抽水量 (m³/d)
        
        返回:
            T: 导水系数 (m²/d)
            S: 贮水系数
        """
        # 使用曲线拟合
        def theis_func(t, T, S):
            return UnsteadyGroundwater.theis_drawdown(r, t, Q, T, S)
        
        # 初值估计
        T0 = 100
        S0 = 0.001
        
        try:
            params, _ = curve_fit(theis_func, t_series, s_series,
                                 p0=[T0, S0], bounds=([10, 1e-5], [1000, 0.1]))
            T, S = params
            return T, S
        except:
            return None, None
    
    @staticmethod
    def plot_theis_curve(Q=1000, T=200, S=0.001):
        """绘制Theis曲线族"""
        t = np.logspace(-2, 3, 100)  # 0.01 to 1000 days
        r_values = [10, 30, 50, 100, 200]
        
        fig, axes = plt.subplots(2, 2, figsize=(14, 10))
        
        # 不同距离的时间-降深曲线
        for r in r_values:
            s = [UnsteadyGroundwater.theis_drawdown(r, ti, Q, T, S) 
                 for ti in t]
            axes[0, 0].plot(t, s, linewidth=2, label=f'r={r}m')
        
        axes[0, 0].set_xscale('log')
        axes[0, 0].set_xlabel('时间 (天)', fontsize=12)
        axes[0, 0].set_ylabel('降深 (m)', fontsize=12)
        axes[0, 0].set_title('时间-降深曲线', fontsize=14)
        axes[0, 0].legend()
        axes[0, 0].grid(True, alpha=0.3)
        
        # 不同时刻的距离-降深曲线
        r = np.linspace(5, 300, 100)
        t_values = [1, 10, 30, 100, 300]
        
        for ti in t_values:
            s = [UnsteadyGroundwater.theis_drawdown(ri, ti, Q, T, S)
                 for ri in r]
            axes[0, 1].plot(r, s, linewidth=2, label=f't={ti}d')
        
        axes[0, 1].set_xlabel('距离 (m)', fontsize=12)
        axes[0, 1].set_ylabel('降深 (m)', fontsize=12)
        axes[0, 1].set_title('距离-降深曲线', fontsize=14)
        axes[0, 1].legend()
        axes[0, 1].grid(True, alpha=0.3)
        
        # 降落漏斗演化
        r = np.linspace(1, 300, 100)
        t_snapshots = [1, 10, 50, 200]
        
        for ti in t_snapshots:
            s = [UnsteadyGroundwater.theis_drawdown(ri, ti, Q, T, S)
                 for ri in r]
            axes[1, 0].plot(r, -np.array(s), linewidth=2, 
                           label=f't={ti}d')
        
        axes[1, 0].set_xlabel('距离 (m)', fontsize=12)
        axes[1, 0].set_ylabel('水位相对变化 (m)', fontsize=12)
        axes[1, 0].set_title('降落漏斗演化', fontsize=14)
        axes[1, 0].legend()
        axes[1, 0].grid(True, alpha=0.3)
        axes[1, 0].axhline(0, color='blue', linestyle='--', 
                          linewidth=1, alpha=0.5)
        
        # Theis vs Jacob近似
        r_test = 50
        t_compare = np.logspace(-1, 3, 100)
        
        s_theis = [UnsteadyGroundwater.theis_drawdown(r_test, ti, Q, T, S)
                  for ti in t_compare]
        s_jacob = [UnsteadyGroundwater.jacob_approximation(r_test, ti, Q, T, S)
                  if ti > 0.1 else np.nan
                  for ti in t_compare]
        
        axes[1, 1].plot(t_compare, s_theis, 'b-', linewidth=2,
                       label='Theis精确解')
        axes[1, 1].plot(t_compare, s_jacob, 'r--', linewidth=2,
                       label='Jacob近似')
        axes[1, 1].set_xscale('log')
        axes[1, 1].set_xlabel('时间 (天)', fontsize=12)
        axes[1, 1].set_ylabel('降深 (m)', fontsize=12)
        axes[1, 1].set_title(f'Theis vs Jacob (r={r_test}m)', fontsize=14)
        axes[1, 1].legend()
        axes[1, 1].grid(True, alpha=0.3)
        
        plt.tight_layout()
        plt.savefig('theis_curves.png', dpi=300)
        plt.show()

# 示例
print("="*60)
print("Theis非稳定井流分析")
print("="*60)

# 参数
Q = 1000  # m³/d
T = 200   # m²/d
S = 0.001

print(f"参数:")
print(f"  抽水量 Q = {Q} m³/d")
print(f"  导水系数 T = {T} m²/d")
print(f"  贮水系数 S = {S}")

# 计算特定点的降深
r = 50  # m
t = 10  # d

s = UnsteadyGroundwater.theis_drawdown(r, t, Q, T, S)

print(f"\n在r={r}m, t={t}天处:")
print(f"  降深 s = {s:.3f} m")

# 检查u值
u = (r**2 * S) / (4 * T * t)
print(f"  u = {u:.6f}")

if u < 0.01:
    s_jacob = UnsteadyGroundwater.jacob_approximation(r, t, Q, T, S)
    print(f"  Jacob近似: s ≈ {s_jacob:.3f} m")
    print(f"  相对误差: {abs(s - s_jacob)/s * 100:.2f}%")

# 不同时刻对比
print(f"\n时间发展:")
print(f"{'时间(d)':>10s} {'降深(m)':>10s} {'u值':>12s}")
print("-" * 35)

for ti in [0.1, 1, 10, 100]:
    si = UnsteadyGroundwater.theis_drawdown(r, ti, Q, T, S)
    ui = (r**2 * S) / (4 * T * ti)
    print(f"{ti:10.1f} {si:10.3f} {ui:12.6f}")

# 可视化
UnsteadyGroundwater.plot_theis_curve(Q, T, S)

# 模拟抽水试验数据
print("\n" + "="*60)
print("参数估计（配线法）")
print("="*60)

# 生成模拟数据
r_obs = 30  # m
t_obs = np.array([0.1, 0.5, 1, 2, 5, 10, 20, 50, 100])
s_obs = np.array([UnsteadyGroundwater.theis_drawdown(r_obs, ti, Q, T, S)
                 for ti in t_obs])

# 加入少量噪声
s_obs += np.random.normal(0, 0.05, len(s_obs))

print(f"观测数据（r={r_obs}m）:")
print(f"{'时间(d)':>10s} {'降深(m)':>10s}")
print("-" * 22)
for ti, si in zip(t_obs, s_obs):
    print(f"{ti:10.2f} {si:10.3f}")

# 参数估计
T_est, S_est = UnsteadyGroundwater.theis_parameter_estimation(
    r_obs, t_obs, s_obs, Q
)

if T_est is not None:
    print(f"\n参数估计结果:")
    print(f"  导水系数 T = {T_est:.1f} m²/d (真值: {T})")
    print(f"  贮水系数 S = {S_est:.6f} (真值: {S})")
    print(f"  T相对误差: {abs(T_est-T)/T*100:.1f}%")
    print(f"  S相对误差: {abs(S_est-S)/S*100:.1f}%")
```

---

## 三、Jacob直线图解法

### 3.1 原理

当$u < 0.01$时：
$$s = \frac{2.303Q}{4\pi T}\log\frac{2.25Tt}{r^2 S}$$

### 3.2 作图

**时间-降深半对数图**：
- 斜率：$\Delta s = \frac{2.303Q}{4\pi T}$
- 截距：$t_0$（$s=0$时）

**求参数**：
$$T = \frac{2.303Q}{4\pi \Delta s}$$

$$S = \frac{2.25Tt_0}{r^2}$$

---

## 四、典型考题

### 【例题】Theis井流计算

**题目**：抽水Q=800m³/d，T=150m²/d，S=0.002，求r=40m处t=5d的降深

**解**：

$$u = \frac{40^2 \times 0.002}{4 \times 150 \times 5} = 0.00533$$

查表或计算：$W(0.00533) \approx 4.73$

$$s = \frac{800}{4\pi \times 150} \times 4.73 = 2.01 \text{ m}$$

---

**本章重点**：
- Theis公式
- 井函数
- Jacob近似
- 参数估计（配线法、直线图解法）
