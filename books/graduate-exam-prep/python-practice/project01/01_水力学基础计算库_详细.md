# 项目1：水力学基础计算库开发

**项目难度**: ⭐⭐⭐  
**预计时间**: 8小时  
**知识点**: Python OOP、NumPy、数值计算、工程应用

---

## 一、项目目标

开发一个完整的水力学计算Python库，包含：
1. 静水力学计算模块
2. 明渠均匀流模块
3. 管道水力计算模块
4. 数据可视化模块

---

## 二、项目结构设计

```
hydraulics/
│
├── __init__.py
├── hydrostatics.py      # 静水力学
├── open_channel.py      # 明渠流
├── pipe_flow.py         # 管流
├── visualization.py     # 可视化
└── utils.py             # 工具函数
```

---

## 三、详细实现

### 3.1 核心模块：hydrostatics.py

```python
"""
hydraulics/hydrostatics.py
静水力学计算模块
"""

import numpy as np
from typing import Union, Tuple

class HydrostaticPressure:
    """
    静水压强计算类
    """
    
    def __init__(self, rho=1000, g=9.8):
        """
        初始化
        
        参数:
            rho: 流体密度 (kg/m³)
            g: 重力加速度 (m/s²)
        """
        self.rho = rho
        self.g = g
    
    def absolute_pressure(self, h: float, p0: float = 101325) -> float:
        """
        计算绝对压强
        
        参数:
            h: 水深 (m)
            p0: 大气压强 (Pa)
        
        返回:
            绝对压强 (Pa)
        """
        p_relative = self.rho * self.g * h
        p_absolute = p0 + p_relative
        return p_absolute
    
    def pressure_head(self, p: float, p0: float = 101325) -> float:
        """
        压强水头
        
        参数:
            p: 绝对压强 (Pa)
            p0: 大气压强 (Pa)
        
        返回:
            压强水头 (m)
        """
        p_relative = p - p0
        h = p_relative / (self.rho * self.g)
        return h
    
    def hydrostatic_force(self, h: float, width: float, 
                         shape: str = 'rectangular') -> Tuple[float, float]:
        """
        平面上的静水总压力
        
        参数:
            h: 水深 (m)
            width: 宽度 (m)
            shape: 形状 ('rectangular', 'triangular')
        
        返回:
            (总压力 F, 压力中心深度 h_c)
        """
        if shape == 'rectangular':
            # 矩形
            A = h * width
            h_c_centroid = h / 2
            F = self.rho * self.g * h_c_centroid * A
            
            # 压力中心
            I_c = (width * h**3) / 12
            h_c = h_c_centroid + I_c / (h_c_centroid * A)
            
        elif shape == 'triangular':
            # 三角形
            A = (h * width) / 2
            h_c_centroid = 2 * h / 3
            F = self.rho * self.g * h_c_centroid * A
            
            # 压力中心
            I_c = (width * h**3) / 36
            h_c = h_c_centroid + I_c / (h_c_centroid * A)
        
        else:
            raise ValueError(f"Unsupported shape: {shape}")
        
        return F, h_c
    
    def buoyancy(self, volume: float, rho_object: float = None) -> float:
        """
        浮力计算（阿基米德原理）
        
        参数:
            volume: 物体体积 (m³)
            rho_object: 物体密度 (kg/m³)，可选
        
        返回:
            浮力 (N)
        """
        F_buoyancy = self.rho * self.g * volume
        
        if rho_object is not None:
            # 物体重力
            W = rho_object * self.g * volume
            # 净浮力
            F_net = F_buoyancy - W
            return F_buoyancy, W, F_net
        
        return F_buoyancy


class RelativeEquilibrium:
    """
    相对平衡
    """
    
    def __init__(self, rho=1000, g=9.8):
        self.rho = rho
        self.g = g
    
    def uniform_linear_acceleration(self, a_x: float, h0: float) -> callable:
        """
        等加速直线运动水面
        
        参数:
            a_x: 水平加速度 (m/s²)
            h0: 初始水深 (m)
        
        返回:
            水面方程函数 h(x)
        """
        theta = np.arctan(a_x / self.g)
        
        def water_surface(x):
            return h0 - x * np.tan(theta)
        
        return water_surface, theta
    
    def rotation(self, omega: float, R: float) -> callable:
        """
        等角速度旋转水面（抛物面）
        
        参数:
            omega: 角速度 (rad/s)
            R: 半径 (m)
        
        返回:
            水面方程函数 z(r)
        """
        def water_surface(r):
            return (omega**2 * r**2) / (2 * self.g)
        
        # 最大水面高差
        delta_h_max = water_surface(R)
        
        return water_surface, delta_h_max


# ============ 使用示例 ============

def example_hydrostatic_pressure():
    """
    示例1：静水压强计算
    """
    print("=" * 50)
    print("示例1：静水压强计算")
    print("=" * 50)
    
    hydro = HydrostaticPressure(rho=1000, g=9.8)
    
    # 计算不同水深的压强
    depths = [1, 5, 10, 20, 50]
    
    print(f"{'水深(m)':<10} {'相对压强(kPa)':<15} {'绝对压强(kPa)':<15} {'压强水头(m)':<15}")
    print("-" * 60)
    
    for h in depths:
        p_abs = hydro.absolute_pressure(h)
        p_rel = p_abs - 101325
        h_calc = hydro.pressure_head(p_abs)
        
        print(f"{h:<10} {p_rel/1000:<15.2f} {p_abs/1000:<15.2f} {h_calc:<15.2f}")


def example_hydrostatic_force():
    """
    示例2：静水总压力
    """
    print("\n" + "=" * 50)
    print("示例2：闸门静水总压力")
    print("=" * 50)
    
    hydro = HydrostaticPressure()
    
    # 矩形闸门
    h = 4.0  # m
    width = 3.0  # m
    
    F, h_c = hydro.hydrostatic_force(h, width, shape='rectangular')
    
    print(f"矩形闸门:")
    print(f"  水深: {h} m")
    print(f"  宽度: {width} m")
    print(f"  总压力: {F/1000:.2f} kN")
    print(f"  压力中心深度: {h_c:.3f} m")
    print(f"  压力中心距底部: {h - h_c:.3f} m")


def example_buoyancy():
    """
    示例3：浮力计算
    """
    print("\n" + "=" * 50)
    print("示例3：浮体平衡")
    print("=" * 50)
    
    hydro = HydrostaticPressure(rho=1000)
    
    # 长方体浮体
    length = 2.0  # m
    width = 1.0   # m
    height = 0.5  # m
    volume = length * width * height
    
    rho_object = 600  # kg/m³（木材）
    
    F_b, W, F_net = hydro.buoyancy(volume, rho_object)
    
    print(f"浮体参数:")
    print(f"  尺寸: {length}m × {width}m × {height}m")
    print(f"  体积: {volume} m³")
    print(f"  密度: {rho_object} kg/m³")
    print(f"\n力学分析:")
    print(f"  浮力: {F_b/1000:.2f} kN")
    print(f"  重力: {W/1000:.2f} kN")
    print(f"  净浮力: {F_net/1000:.2f} kN")
    
    # 吃水深度
    draft = (W / (length * width)) / (1000 * 9.8)
    print(f"  吃水深度: {draft:.3f} m")
    print(f"  露出水面: {height - draft:.3f} m")


def example_relative_equilibrium():
    """
    示例4：相对平衡
    """
    print("\n" + "=" * 50)
    print("示例4：等加速直线运动水面")
    print("=" * 50)
    
    rel_eq = RelativeEquilibrium()
    
    # 水平加速
    a_x = 2.0  # m/s²
    h0 = 1.0   # m
    
    water_surface, theta = rel_eq.uniform_linear_acceleration(a_x, h0)
    
    print(f"加速度: {a_x} m/s²")
    print(f"初始水深: {h0} m")
    print(f"水面倾角: {np.degrees(theta):.2f}°")
    
    # 不同位置的水深
    x_positions = np.linspace(0, 5, 6)
    print(f"\n{'位置x(m)':<12} {'水深h(m)':<12}")
    print("-" * 24)
    for x in x_positions:
        h = water_surface(x)
        print(f"{x:<12.1f} {h:<12.3f}")


# 运行所有示例
if __name__ == "__main__":
    example_hydrostatic_pressure()
    example_hydrostatic_force()
    example_buoyancy()
    example_relative_equilibrium()
```

---

## 四、测试用例

```python
"""
tests/test_hydrostatics.py
单元测试
"""

import unittest
import numpy as np
from hydraulics.hydrostatics import HydrostaticPressure, RelativeEquilibrium

class TestHydrostaticPressure(unittest.TestCase):
    
    def setUp(self):
        self.hydro = HydrostaticPressure(rho=1000, g=9.8)
    
    def test_absolute_pressure(self):
        """测试绝对压强计算"""
        # 水深10m
        p = self.hydro.absolute_pressure(10, p0=101325)
        expected = 101325 + 1000 * 9.8 * 10
        self.assertAlmostEqual(p, expected, places=1)
    
    def test_pressure_head(self):
        """测试压强水头"""
        p = 101325 + 98000  # 10m水头
        h = self.hydro.pressure_head(p, p0=101325)
        self.assertAlmostEqual(h, 10.0, places=2)
    
    def test_hydrostatic_force_rectangular(self):
        """测试矩形面板静水总压力"""
        F, h_c = self.hydro.hydrostatic_force(4, 3, shape='rectangular')
        
        # 理论值
        A = 4 * 3
        h_centroid = 2
        F_expected = 1000 * 9.8 * h_centroid * A
        
        self.assertAlmostEqual(F, F_expected, places=0)
        self.assertTrue(h_c > 2.0)  # 压力中心低于形心
    
    def test_buoyancy(self):
        """测试浮力"""
        volume = 1.0  # 1m³
        F_b = self.hydro.buoyancy(volume)
        expected = 1000 * 9.8 * 1.0
        self.assertAlmostEqual(F_b, expected, places=1)

if __name__ == '__main__':
    unittest.main()
```

---

## 五、项目作业

### 作业1：扩展功能（必做）
1. 添加圆形面板静水总压力计算
2. 实现潜体（完全淹没）浮心计算
3. 添加数据可视化功能

### 作业2：综合应用（选做）
开发一个闸门设计小程序，输入闸门尺寸和水深，自动计算：
- 总压力
- 压力中心
- 所需铰链力矩
- 绘制压强分布图

---

**预计完成时间**: 8小时  
**下一项目**: 明渠均匀流计算库
