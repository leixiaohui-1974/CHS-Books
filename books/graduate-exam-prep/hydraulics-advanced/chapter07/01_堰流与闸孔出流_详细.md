# 第7章：堰流与闸孔出流

**学习时间**: 4小时  
**考试频率**: ⭐⭐⭐⭐⭐  
**难度**: ⭐⭐⭐⭐

---

## 一、堰流基本理论

### 1.1 堰的分类

**(1) 按堰顶形式**：
- **薄壁堰**：堰顶厚度$\delta < 0.67H$
- **实用堰**：$0.67H < \delta < 2H$
- **宽顶堰**：$\delta > 2H$

**(2) 按溢流方式**：
- **自由溢流**：下游水位不影响上游
- **淹没溢流**：下游水位壅高上游

**(3) 按堰型**：
- 矩形堰、三角堰、梯形堰
- WES堰（标准溢流堰）

### 1.2 基本方程

**能量方程**（堰顶临界流）：

$$H_0 = h_c + \frac{v_c^2}{2g} = \frac{3}{2}h_c$$

$$h_c = \frac{2}{3}H_0$$

---

## 二、薄壁堰

### 2.1 矩形薄壁堰

**流量公式**：

$$Q = m b \sqrt{2g} H^{3/2}$$

**参数**：
- $m$：流量系数（0.35~0.45，一般取0.40）
- $b$：堰宽（m）
- $H$：堰上水头（m）

**侧收缩修正**（两侧有边墙）：

$$Q = m (b - 0.1nH) \sqrt{2g} H^{3/2}$$

其中$n$为侧收缩数（$n=2$）

### 2.2 三角形薄壁堰

**流量公式**：

$$Q = \frac{8}{15}m \tan\frac{\theta}{2} \sqrt{2g} H^{5/2}$$

**参数**：
- $\theta$：堰口角度（常用90°）
- $\theta = 90°$时，$\tan 45° = 1$

$$Q = 1.4H^{5/2} \quad (\theta = 90°, m \approx 0.58)$$

**优点**：适用于小流量，对水头变化敏感

---

## 三、宽顶堰

### 3.1 自由溢流

**流量公式**：

$$Q = m b \sqrt{2g} H^{3/2}$$

**流量系数**：$m = 0.32 \sim 0.48$（取决于堰型）

**堰顶压强**：

$$p = \rho g\left(h_c - \frac{v_c^2}{2g}\right) = \rho g \cdot \frac{h_c}{3}$$

### 3.2 淹没溢流

**淹没度**：

$$\sigma_s = \frac{h_s - h_c}{H}$$

其中$h_s$为下游水深

**流量折减**：

$$Q_s = \varphi Q_0$$

**折减系数**：

$$\varphi = \sqrt{1 - \sigma_s}$$

---

## 四、WES堰（标准溢流堰）

### 4.1 堰面曲线

**设计水头$H_d$下的堰面方程**：

$$\frac{x^n}{H_d^{n-1}} = KY$$

**常用参数**（上游铅直面）：
- $n = 1.85$
- $K = 2.0$

**简化**：

$$Y = 0.5 \frac{x^{1.85}}{H_d^{0.85}}$$

### 4.2 流量系数

**设计水头**（$H = H_d$）：

$$m = 0.502$$

**非设计水头**：

$$m = m_d \left(\frac{H}{H_d}\right)^{0.15}$$

---

## 五、闸孔出流

### 5.1 平板闸门

**自由出流**（$h_下 < h_c$）：

$$Q = \mu b e \sqrt{2g(H - e/2)}$$

**参数**：
- $\mu$：流量系数（0.60~0.65）
- $e$：闸门开度（m）
- $H$：上游水深（m）

**收缩断面**：

$$h_c = \varphi e$$

收缩系数$\varphi = 0.61 \sim 0.64$

### 5.2 淹没出流

**判别**：$h_下 > h_c$

**流量公式**：

$$Q = \mu_s b e \sqrt{2g(H - h_下)}$$

**淹没流量系数**：$\mu_s = 0.80 \sim 0.90$

---

## 六、侧堰

### 6.1 基本方程

**连续方程**：

$$\frac{dQ}{dx} = -q = -m\sqrt{2g}(h - P)^{3/2}$$

其中$P$为堰顶高程

**动量方程**：

$$v\frac{dv}{dx} = -g\frac{dh}{dx}$$

### 6.2 实用计算

**侧堰长度**：

$$L = \frac{Q}{m\sqrt{2g}\bar{H}^{3/2}}$$

其中$\bar{H}$为平均堰上水头

---

## 七、Python实现

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy.optimize import fsolve

class WeirAndGateFlow:
    """堰流与闸孔出流"""
    
    def __init__(self, g=9.81):
        self.g = g
    
    def rectangular_thin_wall_weir(self, m, b, H):
        """
        矩形薄壁堰流量
        
        Q = m·b·√(2g)·H^(3/2)
        """
        Q = m * b * np.sqrt(2 * self.g) * H**1.5
        return Q
    
    def triangular_weir(self, theta, m, H):
        """
        三角形堰流量
        
        Q = (8/15)·m·tan(θ/2)·√(2g)·H^(5/2)
        """
        Q = (8/15) * m * np.tan(np.radians(theta/2)) * np.sqrt(2*self.g) * H**2.5
        return Q
    
    def broad_crested_weir(self, m, b, H):
        """宽顶堰流量"""
        Q = m * b * np.sqrt(2 * self.g) * H**1.5
        return Q
    
    def submerged_weir_coefficient(self, sigma_s):
        """
        淹没系数
        
        φ = √(1 - σs)
        """
        phi = np.sqrt(1 - sigma_s)
        return phi
    
    def wes_weir_surface(self, x, Hd):
        """
        WES堰面曲线
        
        Y = 0.5·x^1.85 / Hd^0.85
        """
        Y = 0.5 * x**1.85 / Hd**0.85
        return Y
    
    def wes_discharge_coefficient(self, H, Hd, md=0.502):
        """
        WES堰流量系数
        
        m = md·(H/Hd)^0.15
        """
        m = md * (H / Hd)**0.15
        return m
    
    def sluice_gate_free_flow(self, mu, b, e, H):
        """
        平板闸门自由出流
        
        Q = μ·b·e·√(2g(H-e/2))
        """
        Q = mu * b * e * np.sqrt(2 * self.g * (H - e/2))
        return Q
    
    def sluice_gate_submerged_flow(self, mu_s, b, e, H, h_down):
        """
        平板闸门淹没出流
        
        Q = μs·b·e·√(2g(H-h_down))
        """
        Q = mu_s * b * e * np.sqrt(2 * self.g * (H - h_down))
        return Q
    
    def contracted_depth(self, e, phi=0.62):
        """收缩断面水深"""
        h_c = phi * e
        return h_c
    
    def plot_weir_gate_analysis(self):
        """绘制堰流与闸流分析图"""
        fig, axes = plt.subplots(2, 2, figsize=(16, 12))
        
        # 1. 不同堰型流量对比
        ax1 = axes[0, 0]
        
        H_range = np.linspace(0.1, 2, 100)
        
        # 矩形薄壁堰
        m_rect = 0.40
        b_rect = 3.0
        Q_rect = [self.rectangular_thin_wall_weir(m_rect, b_rect, H) for H in H_range]
        
        # 三角堰（90°）
        m_tri = 0.58
        theta = 90
        Q_tri = [self.triangular_weir(theta, m_tri, H) for H in H_range]
        
        # 宽顶堰
        m_broad = 0.45
        b_broad = 3.0
        Q_broad = [self.broad_crested_weir(m_broad, b_broad, H) for H in H_range]
        
        ax1.plot(H_range, Q_rect, 'b-', linewidth=2.5, label=f'矩形堰(b={b_rect}m)')
        ax1.plot(H_range, Q_tri, 'r-', linewidth=2.5, label=f'三角堰(θ={theta}°)')
        ax1.plot(H_range, Q_broad, 'g-', linewidth=2.5, label=f'宽顶堰(b={b_broad}m)')
        
        ax1.set_xlabel('堰上水头 H (m)', fontsize=11)
        ax1.set_ylabel('流量 Q (m³/s)', fontsize=11)
        ax1.set_title('不同堰型流量对比', fontsize=13, fontweight='bold')
        ax1.legend()
        ax1.grid(True, alpha=0.3)
        
        # 2. WES堰面曲线
        ax2 = axes[0, 1]
        
        Hd = 1.5  # 设计水头
        x_range = np.linspace(0, 3, 100)
        Y_wes = [self.wes_weir_surface(x, Hd) for x in x_range]
        
        ax2.plot(x_range, -np.array(Y_wes), 'b-', linewidth=2.5, label='WES堰面')
        ax2.axhline(0, color='k', linewidth=1)
        
        # 标注设计水头
        ax2.axhline(Hd, color='cyan', linestyle='--', linewidth=2, alpha=0.7,
                   label=f'设计水头Hd={Hd}m')
        ax2.fill_between(x_range, 0, Hd, alpha=0.2, color='cyan')
        
        ax2.text(1.5, Hd/2, '水流', ha='center', fontsize=12,
                bbox=dict(boxstyle='round', facecolor='lightblue', alpha=0.7))
        
        ax2.set_xlabel('水平距离 x (m)', fontsize=11)
        ax2.set_ylabel('高程 (m)', fontsize=11)
        ax2.set_title(f'WES标准溢流堰面曲线\nHd={Hd}m', fontsize=13, fontweight='bold')
        ax2.legend()
        ax2.grid(True, alpha=0.3)
        ax2.set_ylim([-Hd*1.5, Hd*1.5])
        ax2.invert_yaxis()
        
        # 3. 闸门自由出流vs淹没出流
        ax3 = axes[1, 0]
        
        mu_free = 0.62
        mu_sub = 0.85
        b_gate = 4.0
        e_gate = 1.0
        H_gate = 3.0
        
        h_down_range = np.linspace(0.1, 2.5, 100)
        
        # 收缩水深
        h_c_gate = self.contracted_depth(e_gate)
        
        Q_values = []
        flow_types = []
        
        for h_down in h_down_range:
            if h_down < h_c_gate:
                # 自由出流
                Q = self.sluice_gate_free_flow(mu_free, b_gate, e_gate, H_gate)
                flow_types.append('free')
            else:
                # 淹没出流
                Q = self.sluice_gate_submerged_flow(mu_sub, b_gate, e_gate, H_gate, h_down)
                flow_types.append('submerged')
            Q_values.append(Q)
        
        # 分段绘制
        free_mask = np.array(flow_types) == 'free'
        sub_mask = np.array(flow_types) == 'submerged'
        
        ax3.plot(h_down_range[free_mask], np.array(Q_values)[free_mask],
                'b-', linewidth=2.5, label='自由出流')
        ax3.plot(h_down_range[sub_mask], np.array(Q_values)[sub_mask],
                'r-', linewidth=2.5, label='淹没出流')
        
        ax3.axvline(h_c_gate, color='g', linestyle='--', linewidth=2,
                   label=f'收缩水深hc={h_c_gate:.2f}m')
        
        ax3.set_xlabel('下游水深 h_down (m)', fontsize=11)
        ax3.set_ylabel('流量 Q (m³/s)', fontsize=11)
        ax3.set_title(f'闸门出流特性\nH={H_gate}m, e={e_gate}m, b={b_gate}m',
                     fontsize=13, fontweight='bold')
        ax3.legend()
        ax3.grid(True, alpha=0.3)
        
        # 4. 淹没影响
        ax4 = axes[1, 1]
        
        sigma_s_range = np.linspace(0, 0.8, 100)
        phi_values = [self.submerged_weir_coefficient(sigma) for sigma in sigma_s_range]
        
        ax4.plot(sigma_s_range * 100, phi_values, 'b-', linewidth=2.5)
        
        # 标注区域
        ax4.axhspan(0.9, 1.0, alpha=0.2, color='green', label='轻微淹没')
        ax4.axhspan(0.7, 0.9, alpha=0.2, color='yellow', label='中度淹没')
        ax4.axhspan(0, 0.7, alpha=0.2, color='red', label='严重淹没')
        
        ax4.set_xlabel('淹没度 σs (%)', fontsize=11)
        ax4.set_ylabel('流量折减系数 φ', fontsize=11)
        ax4.set_title('堰流淹没系数', fontsize=13, fontweight='bold')
        ax4.legend()
        ax4.grid(True, alpha=0.3)
        ax4.set_ylim([0, 1.2])
        
        plt.tight_layout()
        plt.savefig('weir_gate_flow_analysis.png', dpi=300)
        plt.show()

# 示例计算
print("="*60)
print("堰流与闸孔出流分析")
print("="*60)

wgf = WeirAndGateFlow()

# 1. 矩形薄壁堰
print("1. 矩形薄壁堰:")
m_rect = 0.40
b_rect = 2.5
H_rect = 0.8

Q_rect = wgf.rectangular_thin_wall_weir(m_rect, b_rect, H_rect)

print(f"  流量系数 m = {m_rect}")
print(f"  堰宽 b = {b_rect} m")
print(f"  堰上水头 H = {H_rect} m")
print(f"  流量 Q = {Q_rect:.3f} m³/s")

# 2. 三角堰
print("\n2. 三角堰（90°）:")
m_tri = 0.58
theta = 90
H_tri = 0.5

Q_tri = wgf.triangular_weir(theta, m_tri, H_tri)

print(f"  堰口角度 θ = {theta}°")
print(f"  流量系数 m = {m_tri}")
print(f"  堰上水头 H = {H_tri} m")
print(f"  流量 Q = {Q_tri:.3f} m³/s")

# 3. 闸门自由出流
print("\n3. 平板闸门自由出流:")
mu_free = 0.62
b_gate = 3.0
e_gate = 0.8
H_gate = 2.5

h_c = wgf.contracted_depth(e_gate)
Q_gate_free = wgf.sluice_gate_free_flow(mu_free, b_gate, e_gate, H_gate)

print(f"  流量系数 μ = {mu_free}")
print(f"  闸孔宽度 b = {b_gate} m")
print(f"  闸门开度 e = {e_gate} m")
print(f"  上游水深 H = {H_gate} m")
print(f"  收缩水深 hc = {h_c:.3f} m")
print(f"  流量 Q = {Q_gate_free:.3f} m³/s")

# 4. 闸门淹没出流
print("\n4. 平板闸门淹没出流:")
mu_sub = 0.85
h_down = 1.8

Q_gate_sub = wgf.sluice_gate_submerged_flow(mu_sub, b_gate, e_gate, H_gate, h_down)

print(f"  淹没流量系数 μs = {mu_sub}")
print(f"  下游水深 h_down = {h_down} m")
print(f"  流量 Q = {Q_gate_sub:.3f} m³/s")

if h_down > h_c:
    print(f"  判断：h_down > hc，淹没出流")
else:
    print(f"  判断：h_down < hc，自由出流")

# 绘图
print("\n绘制堰流与闸流分析图...")
wgf.plot_weir_gate_analysis()
```

---

## 八、典型考题

### 【例题1】矩形堰流量（10分）

**题目**：矩形薄壁堰，$b=3$m，$H=0.6$m，$m=0.40$。求流量。

**【解答】**

$$Q = m b \sqrt{2g} H^{3/2}$$

$$= 0.40 \times 3 \times \sqrt{2 \times 9.81} \times 0.6^{1.5}$$

$$= 1.2 \times 4.43 \times 0.465 = 2.47 \text{ m}^3\text{/s}$$

---

### 【例题2】闸门出流判别（12分）

**题目**：平板闸门，$e=0.8$m，上游$H=3.0$m，下游$h_{下}=1.2$m。判断出流型式。

**【解答】**

收缩水深：$h_c = 0.62 \times 0.8 = 0.496$m

$h_{下} = 1.2 > h_c = 0.496$m

**判断**：淹没出流

---

**本章重点**：
- 堰流流量公式
- WES堰面曲线
- 闸门自由与淹没出流
- 淹没系数

**下一章**：水力相似与模型试验
