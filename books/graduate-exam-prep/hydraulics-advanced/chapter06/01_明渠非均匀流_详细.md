# 第6章：明渠非均匀流

**学习时间**: 4小时  
**考试频率**: ⭐⭐⭐⭐⭐  
**难度**: ⭐⭐⭐⭐⭐

---

## 一、非均匀流基本概念

### 1.1 定义与分类

**非均匀流**：水深、流速沿程变化的流动

**分类**：

**(1) 按变化速率**：
- **渐变流**（GVF）：流线接近平行，$\frac{dh}{dx} \ll 1$
- **急变流**：流线曲率大（如水跃、跌水）

**(2) 按时间**：
- **恒定非均匀流**：$\frac{\partial}{\partial t} = 0$
- **非恒定非均匀流**：$\frac{\partial}{\partial t} \neq 0$

### 1.2 基本方程

**能量方程**：

$$\frac{d}{dx}\left(z + h + \frac{\alpha v^2}{2g}\right) = -i_f$$

**动量方程**：

$$\frac{d}{dx}\left(\rho Q v\right) = \rho g A(i_0 - i_f) - \frac{dP}{dx}$$

---

## 二、渐变流微分方程

### 2.1 推导

**能量方程展开**：

$$\frac{dz}{dx} + \frac{dh}{dx} + \frac{d}{dx}\left(\frac{Q^2}{2gA^2}\right) = -i_f$$

底坡：$i_0 = -\frac{dz}{dx}$

流速水头变化：

$$\frac{d}{dx}\left(\frac{v^2}{2g}\right) = \frac{v^2}{gA}\frac{dA}{dh}\frac{dh}{dx} = -\frac{v^2}{gA}b\frac{dh}{dx}$$

其中$b$为水面宽度，$\frac{dA}{dh} = b$

代入得：

$$i_0 + \frac{dh}{dx} - \frac{v^2}{gA}b\frac{dh}{dx} = -i_f$$

整理：

$$\frac{dh}{dx}\left(1 - \frac{v^2 b}{gA}\right) = i_0 - i_f$$

**矩形断面**：$A = bh$，$\frac{v^2 b}{gA} = \frac{v^2}{gh} = Fr^2$

$$\frac{dh}{dx} = \frac{i_0 - i_f}{1 - Fr^2}$$

### 2.2 方程分析

**分子**（$i_0 - i_f$）：
- $i_0 > i_f$：底坡大于摩阻，有加速趋势
- $i_0 < i_f$：摩阻大于底坡，有减速趋势
- $i_0 = i_f$：均匀流

**分母**（$1 - Fr^2$）：
- $Fr < 1$（缓流）：$\frac{dh}{dx}$与分子同号
- $Fr > 1$（急流）：$\frac{dh}{dx}$与分子异号
- $Fr = 1$（临界流）：$\frac{dh}{dx} \to \infty$

---

## 三、水面曲线分类

### 3.1 三区五坡十二曲线

**三区**（根据$h$与$h_0$、$h_c$关系）：
- **I区**：$h > \max(h_0, h_c)$
- **II区**：$\min(h_0, h_c) < h < \max(h_0, h_c)$
- **III区**：$h < \min(h_0, h_c)$

**五坡**（根据$i_0$与$i_c$关系）：
- **M**（缓坡）：$i_0 < i_c$，$h_0 > h_c$
- **S**（陡坡）：$i_0 > i_c$，$h_0 < h_c$
- **C**（临界坡）：$i_0 = i_c$，$h_0 = h_c$
- **H**（平坡）：$i_0 = 0$
- **A**（逆坡）：$i_0 < 0$

### 3.2 典型水面曲线

**(1) M1曲线**（缓坡壅水）：
- 位置：I区（$h > h_0 > h_c$）
- 特征：$\frac{dh}{dx} > 0$（水深增加）
- 形成：水库回水、闸前壅水

**(2) M2曲线**（缓坡降水）：
- 位置：II区（$h_0 > h > h_c$）
- 特征：$\frac{dh}{dx} < 0$（水深减小）
- 形成：渠道收窄、跌水上游

**(3) M3曲线**（缓坡降水）：
- 位置：III区（$h_0 > h_c > h$）
- 特征：$\frac{dh}{dx} < 0$
- 形成：陡坡进入缓坡（少见）

**(4) S1曲线**（陡坡壅水）：
- 位置：I区（$h > h_c > h_0$）
- 特征：$\frac{dh}{dx} > 0$
- 形成：陡坡进入缓坡

**(5) S2曲线**（陡坡降水）：
- 位置：II区（$h_c > h > h_0$）
- 特征：$\frac{dh}{dx} < 0$
- 形成：陡坡末端

**(6) S3曲线**（陡坡降水）：
- 位置：III区（$h_c > h_0 > h$）
- 特征：$\frac{dh}{dx} < 0$
- 形成：闸下急流（少见）

---

## 四、水面曲线计算

### 4.1 逐段求和法

**基本公式**：

$$\Delta x = \frac{\Delta E}{i_0 - \bar{i}_f}$$

**步骤**：
1. 从已知断面开始（边界条件）
2. 假设相邻断面水深
3. 计算$\Delta E = E_2 - E_1$
4. 计算平均摩阻$\bar{i}_f = \frac{i_{f1} + i_{f2}}{2}$
5. 求$\Delta x$
6. 调整水深，迭代至收敛

### 4.2 边界条件

**缓流**（下游控制）：
- 从下游已知水深向上游推算
- 边界：水库、闸门、堰

**急流**（上游控制）：
- 从上游已知水深向下游推算
- 边界：溢流堰、陡坡起点

### 4.3 控制断面

**定义**：唯一确定水深的断面

**类型**：
1. 临界断面（宽顶堰、陡坡过渡）
2. 闸门断面
3. 跌水断面

---

## 五、急变流

### 5.1 水跃

**发生条件**：急流→缓流

**能量关系**：
- 动能→势能（升高水位）
- 强烈湍动（消能）

**工程应用**：
- 消能池
- 护坦设计

### 5.2 跌水

**自由跌水**：
- 跌坎上游临界水深
- 跌坎下游射流

**淹没跌水**：
- 下游水位影响上游
- 消能效果差

---

## 六、Python实现

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy.integrate import odeint
from scipy.optimize import fsolve

class NonUniformOpenChannelFlow:
    """明渠非均匀流"""
    
    def __init__(self, g=9.81):
        self.g = g
    
    def manning_friction_slope(self, Q, A, R, n):
        """Manning公式摩阻坡度"""
        v = Q / A
        i_f = (n * v / R**(2/3))**2
        return i_f
    
    def froude_number(self, v, h):
        """弗劳德数"""
        return v / np.sqrt(self.g * h)
    
    def water_surface_slope(self, h, Q, b, i0, n):
        """
        水面坡度 dh/dx
        
        dh/dx = (i0 - if) / (1 - Fr²)
        """
        A = b * h
        P = b + 2 * h
        R = A / P
        v = Q / A
        
        i_f = self.manning_friction_slope(Q, A, R, n)
        Fr = self.froude_number(v, h)
        
        numerator = i0 - i_f
        denominator = 1 - Fr**2
        
        if abs(denominator) < 1e-6:
            return np.inf * np.sign(numerator)
        
        dh_dx = numerator / denominator
        return dh_dx
    
    def classify_slope(self, i0, Q, b, n):
        """
        判断坡度类型
        
        返回: 'M'(缓坡), 'S'(陡坡), 'C'(临界坡), 'H'(平坡), 'A'(逆坡)
        """
        if abs(i0) < 1e-8:
            return 'H'
        elif i0 < 0:
            return 'A'
        
        # 计算临界坡度
        h_c = (Q**2 / (self.g * b**2))**(1/3)
        A_c = b * h_c
        P_c = b + 2 * h_c
        R_c = A_c / P_c
        
        i_c = (n * Q / (A_c * R_c**(2/3)))**2
        
        if abs(i0 - i_c) / i_c < 0.05:
            return 'C'
        elif i0 < i_c:
            return 'M'
        else:
            return 'S'
    
    def classify_profile(self, h, h0, hc, slope_type):
        """
        判断水面曲线类型
        
        返回: 如'M1', 'S2'等
        """
        if slope_type in ['M', 'S']:
            if h > max(h0, hc):
                zone = '1'
            elif min(h0, hc) < h < max(h0, hc):
                zone = '2'
            else:
                zone = '3'
        elif slope_type == 'C':
            zone = '1' if h > hc else '3'
        else:  # H or A
            zone = '2' if h > hc else '3'
        
        return slope_type + zone
    
    def compute_water_surface_profile(self, h_start, Q, b, i0, n, L, n_steps=100, direction='downstream'):
        """
        计算水面曲线（数值积分）
        
        参数:
            h_start: 起始水深 (m)
            Q: 流量 (m³/s)
            b: 渠宽 (m)
            i0: 底坡
            n: 糙率
            L: 计算长度 (m)
            n_steps: 步数
            direction: 'downstream'下游, 'upstream'上游
        """
        x = np.linspace(0, L, n_steps)
        dx = x[1] - x[0]
        
        h = np.zeros(n_steps)
        h[0] = h_start
        
        for i in range(n_steps - 1):
            dh_dx = self.water_surface_slope(h[i], Q, b, i0, n)
            
            if direction == 'downstream':
                h[i+1] = h[i] + dh_dx * dx
            else:
                h[i+1] = h[i] - dh_dx * dx
            
            # 防止非物理值
            if h[i+1] < 0.01:
                h[i+1] = 0.01
        
        if direction == 'upstream':
            x = -x[::-1]
            h = h[::-1]
        
        return x, h
    
    def plot_water_surface_profiles(self):
        """绘制水面曲线分类"""
        fig, axes = plt.subplots(2, 2, figsize=(16, 12))
        
        Q = 15  # m³/s
        b = 5   # m
        n = 0.025
        
        # 1. 缓坡水面曲线
        ax1 = axes[0, 0]
        
        i0_mild = 0.0008
        
        # 计算正常水深和临界水深
        def normal_depth_eq(h):
            A = b * h
            P = b + 2 * h
            R = A / P
            Q_calc = (1/n) * A * R**(2/3) * i0_mild**0.5
            return Q_calc - Q
        
        h0 = fsolve(normal_depth_eq, 1.0)[0]
        hc = (Q**2 / (self.g * b**2))**(1/3)
        
        # M1曲线
        x_M1, h_M1 = self.compute_water_surface_profile(
            h0 * 1.5, Q, b, i0_mild, n, 500, 100, 'upstream')
        
        # M2曲线
        x_M2, h_M2 = self.compute_water_surface_profile(
            (h0 + hc) / 2, Q, b, i0_mild, n, 300, 100, 'downstream')
        
        ax1.plot(x_M1, h_M1, 'b-', linewidth=2.5, label='M1曲线（壅水）')
        ax1.plot(x_M2, h_M2, 'g-', linewidth=2.5, label='M2曲线（降水）')
        ax1.axhline(h0, color='r', linestyle='--', linewidth=1.5, label=f'正常水深h₀={h0:.2f}m')
        ax1.axhline(hc, color='orange', linestyle='--', linewidth=1.5, label=f'临界水深hc={hc:.2f}m')
        
        ax1.set_xlabel('距离 x (m)', fontsize=11)
        ax1.set_ylabel('水深 h (m)', fontsize=11)
        ax1.set_title(f'缓坡水面曲线（M型）\ni₀={i0_mild}, h₀={h0:.2f}m > hc={hc:.2f}m',
                     fontsize=13, fontweight='bold')
        ax1.legend()
        ax1.grid(True, alpha=0.3)
        
        # 2. 陡坡水面曲线
        ax2 = axes[0, 1]
        
        i0_steep = 0.005
        
        h0_steep = fsolve(lambda h: (1/n) * b*h * (b*h/(b+2*h))**(2/3) * i0_steep**0.5 - Q, 0.5)[0]
        
        # S1曲线
        x_S1, h_S1 = self.compute_water_surface_profile(
            hc * 1.3, Q, b, i0_steep, n, 300, 100, 'upstream')
        
        # S2曲线
        x_S2, h_S2 = self.compute_water_surface_profile(
            (hc + h0_steep) / 2, Q, b, i0_steep, n, 200, 100, 'downstream')
        
        ax2.plot(x_S1, h_S1, 'b-', linewidth=2.5, label='S1曲线（壅水）')
        ax2.plot(x_S2, h_S2, 'g-', linewidth=2.5, label='S2曲线（降水）')
        ax2.axhline(h0_steep, color='r', linestyle='--', linewidth=1.5,
                   label=f'正常水深h₀={h0_steep:.2f}m')
        ax2.axhline(hc, color='orange', linestyle='--', linewidth=1.5,
                   label=f'临界水深hc={hc:.2f}m')
        
        ax2.set_xlabel('距离 x (m)', fontsize=11)
        ax2.set_ylabel('水深 h (m)', fontsize=11)
        ax2.set_title(f'陡坡水面曲线（S型）\ni₀={i0_steep}, h₀={h0_steep:.2f}m < hc={hc:.2f}m',
                     fontsize=13, fontweight='bold')
        ax2.legend()
        ax2.grid(True, alpha=0.3)
        
        # 3. 水面坡度分析
        ax3 = axes[1, 0]
        
        h_range = np.linspace(0.2, 2.5, 200)
        dh_dx_mild = []
        dh_dx_steep = []
        
        for h in h_range:
            try:
                slope_m = self.water_surface_slope(h, Q, b, i0_mild, n)
                slope_s = self.water_surface_slope(h, Q, b, i0_steep, n)
                
                # 限制范围
                dh_dx_mild.append(np.clip(slope_m, -0.05, 0.05))
                dh_dx_steep.append(np.clip(slope_s, -0.05, 0.05))
            except:
                dh_dx_mild.append(0)
                dh_dx_steep.append(0)
        
        ax3.plot(h_range, dh_dx_mild, 'b-', linewidth=2.5, label=f'缓坡(i₀={i0_mild})')
        ax3.plot(h_range, dh_dx_steep, 'r-', linewidth=2.5, label=f'陡坡(i₀={i0_steep})')
        ax3.axhline(0, color='k', linewidth=0.5)
        ax3.axvline(h0, color='b', linestyle=':', alpha=0.5)
        ax3.axvline(h0_steep, color='r', linestyle=':', alpha=0.5)
        ax3.axvline(hc, color='orange', linestyle='--', linewidth=1.5)
        
        ax3.set_xlabel('水深 h (m)', fontsize=11)
        ax3.set_ylabel('水面坡度 dh/dx', fontsize=11)
        ax3.set_title('水面坡度与水深关系', fontsize=13, fontweight='bold')
        ax3.legend()
        ax3.grid(True, alpha=0.3)
        
        # 4. 典型工程应用
        ax4 = axes[1, 1]
        
        # 水库回水曲线（M1）
        x_backwater = np.linspace(-500, 0, 100)
        h_backwater = h0 + (2.0 - h0) * (1 - np.exp(x_backwater / 200))
        
        # 渠底
        z_bottom = np.linspace(0, -500*i0_mild, 100)
        
        ax4.plot(x_backwater, h_backwater + z_bottom, 'b-', linewidth=2.5, label='水面线')
        ax4.plot(x_backwater, z_bottom, 'k-', linewidth=2, label='渠底')
        ax4.fill_between(x_backwater, z_bottom, h_backwater + z_bottom,
                        alpha=0.3, color='cyan')
        
        # 标注
        ax4.axhline(h0, color='r', linestyle='--', alpha=0.5, label='正常水深线')
        ax4.text(-400, h0 + 0.5, f'水库回水\nM1曲线', fontsize=10,
                bbox=dict(boxstyle='round', facecolor='wheat', alpha=0.7))
        
        ax4.set_xlabel('距离 x (m)', fontsize=11)
        ax4.set_ylabel('高程 (m)', fontsize=11)
        ax4.set_title('工程应用：水库回水曲线', fontsize=13, fontweight='bold')
        ax4.legend()
        ax4.grid(True, alpha=0.3)
        
        plt.tight_layout()
        plt.savefig('non_uniform_open_channel_flow.png', dpi=300)
        plt.show()

# 示例计算
print("="*60)
print("明渠非均匀流分析")
print("="*60)

nuc = NonUniformOpenChannelFlow()

Q = 15
b = 5
n = 0.025

# 缓坡
i0_mild = 0.0008
slope_type_mild = nuc.classify_slope(i0_mild, Q, b, n)

print(f"缓坡渠道:")
print(f"  流量 Q = {Q} m³/s")
print(f"  渠宽 b = {b} m")
print(f"  底坡 i₀ = {i0_mild}")
print(f"  糙率 n = {n}")
print(f"  坡度类型: {slope_type_mild}型（缓坡）")

# 陡坡
i0_steep = 0.005
slope_type_steep = nuc.classify_slope(i0_steep, Q, b, n)

print(f"\n陡坡渠道:")
print(f"  底坡 i₀ = {i0_steep}")
print(f"  坡度类型: {slope_type_steep}型（陡坡）")

# 绘图
print("\n绘制水面曲线图...")
nuc.plot_water_surface_profiles()
```

---

## 七、典型考题

### 【例题1】水面曲线判别（10分）

**题目**：矩形渠道，$i_0=0.001$，$h_0=2.0$m，$h_c=1.2$m。某断面水深$h=2.5$m。判断水面曲线类型。

**【解答】**

$h_0 > h_c$，缓坡（M型）

$h = 2.5 > h_0 = 2.0 > h_c = 1.2$，I区

**答案**：M1曲线（缓坡壅水曲线）

---

**本章重点**：
- 渐变流微分方程
- 水面曲线分类
- 逐段求和法
- 边界条件与控制断面

**下一章**：堰流与闸孔出流
