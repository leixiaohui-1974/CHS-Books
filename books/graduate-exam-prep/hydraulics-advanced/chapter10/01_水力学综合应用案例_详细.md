# 第10章：水力学综合应用案例

**学习时间**: 6小时  
**考试频率**: ⭐⭐⭐⭐⭐  
**难度**: ⭐⭐⭐⭐⭐

---

## 一、案例1：梯级水库联合调度

### 1.1 问题背景

**流域**：某河流，3级梯级水库

| 水库 | 正常蓄水位(m) | 死水位(m) | 库容(亿m³) | 装机容量(MW) |
|------|--------------|---------|-----------|-------------|
| 上库 | 180 | 160 | 10 | 300 |
| 中库 | 120 | 100 | 5 | 200 |
| 下库 | 60 | 50 | 3 | 150 |

**调度目标**：
1. 最大化总发电量
2. 保证防洪安全
3. 满足生态流量

### 1.2 水力联系

**上库**：
$$V_1(t+1) = V_1(t) + (Q_{in,1}(t) - Q_{out,1}(t))\Delta t$$

**中库**（上库下泄为入流）：
$$V_2(t+1) = V_2(t) + (Q_{out,1}(t) - Q_{out,2}(t))\Delta t$$

**下库**：
$$V_3(t+1) = V_3(t) + (Q_{out,2}(t) - Q_{out,3}(t))\Delta t$$

**发电量**：
$$P_i = 9.81 \eta_i Q_{out,i} H_i \quad \text{(kW)}$$

其中：
- $\eta_i$：效率（0.85-0.9）
- $H_i$：水头（水库水位-尾水位）

**例题1**：上库水位175 m，尾水位155 m，出库流量$Q = 500$ m³/s，效率0.88。
求发电功率。

**解**：
水头：$H = 175 - 155 = 20$ m

发电功率：
$$P = 9.81 \times 0.88 \times 500 \times 20 = 86,328 \text{ kW} \approx 86.3 \text{ MW}$$

---

### 1.3 优化模型

**目标函数**（最大总发电量）：
$$\max \sum_{i=1}^3 \sum_{t=1}^T P_i(t) \cdot \Delta t$$

**约束条件**：

1. **水量平衡**：$V_i(t+1) = V_i(t) + (I_i(t) - O_i(t))\Delta t$

2. **库容限制**：$V_{min,i} \leq V_i(t) \leq V_{max,i}$

3. **出力限制**：$P_i(t) \leq P_{installed,i}$

4. **生态流量**：$Q_{out,3}(t) \geq Q_{eco}$

5. **防洪约束**：$Z_i(t) \leq Z_{flood,i}$（汛期）

**求解方法**：
- 动态规划（DP）
- 逐次逼近法
- 遗传算法（GA）
- 粒子群优化（PSO）

---

## 二、案例2：长距离调水工程

### 2.1 工程概况

**方案**：从水源地调水至受水区，距离$L = 100$ km

**线路**：
- 渠道段：50 km，梯形断面
- 管道段：30 km，$D = 3$ m钢管
- 隧洞段：20 km，$D = 4$ m无压隧洞

**设计流量**：$Q = 50$ m³/s

### 2.2 水力计算

#### (1) 渠道段

**梯形断面设计**：
- 底宽$b = 8$ m
- 边坡$m = 2$（1:2）
- 曼宁糙率$n = 0.022$
- 纵坡$i = 0.0003$

**正常水深**（Manning公式）：
$$Q = \frac{1}{n}A R^{2/3} i^{1/2}$$

其中：
$$A = (b + mh)h, \quad P = b + 2h\sqrt{1+m^2}, \quad R = A/P$$

**迭代求解**$h$：
设$h = 2.5$ m（试算）
$$A = (8 + 2 \times 2.5) \times 2.5 = 31.25 \text{ m}^2$$
$$P = 8 + 2 \times 2.5 \times \sqrt{5} = 8 + 11.18 = 19.18 \text{ m}$$
$$R = 31.25 / 19.18 = 1.63 \text{ m}$$

$$Q_{calc} = \frac{1}{0.022} \times 31.25 \times 1.63^{2/3} \times 0.0003^{1/2} = 51.2 \text{ m}^3/\text{s}$$

接近50 m³/s ✓

**水头损失**（沿程）：
$$h_f = i \cdot L = 0.0003 \times 50000 = 15 \text{ m}$$

---

#### (2) 管道段

**流速**：
$$v = \frac{Q}{A} = \frac{50}{\pi \times 1.5^2} = 7.07 \text{ m/s}$$

**雷诺数**：
$$Re = \frac{vD}{\nu} = \frac{7.07 \times 3}{1 \times 10^{-6}} = 2.12 \times 10^7$$

（紊流）

**摩阻系数**（Colebrook-White，取$\Delta = 0.05$ mm）：
$$\frac{1}{\sqrt{\lambda}} = -2\log_{10}\left(\frac{\Delta/D}{3.7} + \frac{2.51}{Re\sqrt{\lambda}}\right)$$

迭代求解：$\lambda \approx 0.013$

**水头损失**：
$$h_f = \lambda \frac{L}{D} \frac{v^2}{2g} = 0.013 \times \frac{30000}{3} \times \frac{7.07^2}{2 \times 9.81} = 338 \text{ m}$$

---

#### (3) 隧洞段

**断面**：圆形，$D = 4$ m，$A = 12.57$ m²

**流速**：$v = 50 / 12.57 = 3.98$ m/s

**曼宁公式**（混凝土衬砌，$n = 0.014$）：
$$v = \frac{1}{n}R^{2/3}i^{1/2}$$

所需坡度：
$$i = \left(\frac{vn}{R^{2/3}}\right)^2 = \left(\frac{3.98 \times 0.014}{1^{2/3}}\right)^2 = 0.00311$$

**水头损失**：
$$h_f = i \cdot L = 0.00311 \times 20000 = 62.2 \text{ m}$$

---

**总水头损失**：
$$h_{f,total} = 15 + 338 + 62.2 = 415.2 \text{ m}$$

**所需扬程**（考虑地形高差+10 m）：
$$H_{pump} = h_{f,total} + \Delta Z = 415.2 + 10 = 425.2 \text{ m}$$

**泵站功率**（效率0.85）：
$$P = \frac{\rho g Q H}{\eta} = \frac{1000 \times 9.81 \times 50 \times 425.2}{0.85 \times 10^6} = 244 \text{ MW}$$

---

## 三、案例3：河口潮汐水力学

### 3.1 潮汐特性

**潮位变化**（简化正弦）：
$$\eta(t) = A \sin(\omega t + \phi)$$

其中：
- $A$：潮差振幅（m）
- $\omega = 2\pi / T$：角频率（$T = 12.42$ h，半日潮）
- $\phi$：初相位

**例题2**：某河口，潮差$2A = 3$ m（振幅1.5 m），周期12.42 h。
求最大潮流速（断面积$A_0 = 1000$ m²）。

**解**：
最大潮位变化率：
$$\frac{d\eta}{dt}\bigg|_{max} = A \omega = 1.5 \times \frac{2\pi}{12.42 \times 3600} = 2.11 \times 10^{-4} \text{ m/s}$$

（水位变化速度）

潮流速估算（连续性）：
$$v \approx \frac{dQ/dt}{A_0} = \frac{B \cdot L \cdot d\eta/dt}{A_0}$$

（$B$：河宽，$L$：潮波影响长度）

简化估算（取$BL / A_0 \approx 5000$）：
$$v \approx 5000 \times 2.11 \times 10^{-4} = 1.06 \text{ m/s}$$

---

### 3.2 潮波传播

**潮波方程**（小振幅长波）：
$$\frac{\partial \eta}{\partial t} + \frac{\partial (hv)}{\partial x} = 0$$
$$\frac{\partial v}{\partial t} + v\frac{\partial v}{\partial x} + g\frac{\partial \eta}{\partial x} + \frac{gn^2v|v|}{h^{4/3}} = 0$$

**潮波速度**（浅水波）：
$$c = \sqrt{gh}$$

**潮波长**：
$$\lambda = cT = \sqrt{gh} \cdot T$$

**例题3**：河口平均水深$h = 10$ m，半日潮周期$T = 12.42$ h。
求潮波长和Froude数（流速$v = 0.5$ m/s）。

**解**：
潮波速度：
$$c = \sqrt{9.81 \times 10} = 9.90 \text{ m/s}$$

潮波长：
$$\lambda = 9.90 \times 12.42 \times 3600 = 442,238 \text{ m} \approx 442 \text{ km}$$

Froude数：
$$Fr = \frac{v}{c} = \frac{0.5}{9.90} = 0.05$$

（远小于1，亚临界流）

---

### 3.3 潮汐边界条件

**Saint-Venant方程数值模拟**：

**上游边界**（河流入流）：
$$Q(0, t) = Q_{river}(t)$$

**下游边界**（潮位）：
$$\eta(L, t) = A\sin(\omega t)$$

**模拟要点**：
1. 时间步长需满足CFL条件
2. 考虑底摩阻（Manning或Chezy）
3. 模拟涨潮、落潮过程
4. 计算盐水楔入侵（密度流）

---

## 四、案例4：山洪灾害模拟

### 4.1 流域特征

**小流域**：面积$A = 50$ km²，主河道长$L = 15$ km

**暴雨**：设计重现期$P = 100$年，最大1小时雨强$i = 80$ mm/h

**地形**：山区，平均坡度$15\%$

### 4.2 洪峰流量计算

**推理公式法**：
$$Q_p = 0.278 \varphi i F$$

其中：
- $\varphi$：径流系数（山区取0.6）
- $i$：暴雨强度（mm/h）
- $F$：流域面积（km²）

$$Q_p = 0.278 \times 0.6 \times 80 \times 50 = 668 \text{ m}^3/\text{s}$$

**汇流时间**（经验公式）：
$$\tau = 0.278 \frac{L}{J^{0.2}} = 0.278 \times \frac{15000}{0.15^{0.2}} = 6210 \text{ s} \approx 1.73 \text{ h}$$

---

### 4.3 洪水演进（Saint-Venant）

**河道参数**：
- 宽度：$b = 30$ m
- 曼宁糙率：$n = 0.035$（天然河道）
- 纵坡：$i_0 = 0.005$

**初始条件**：
- 基流：$Q_0 = 10$ m³/s
- 水深：$h_0 = 0.5$ m

**入流过程线**（三角形）：
- 起涨时刻：$t = 0$
- 洪峰时刻：$t = 1.73$ h，$Q_p = 668$ m³/s
- 退水时刻：$t = 6$ h，回到$Q_0$

**数值模拟**：
用MacCormack格式求解Saint-Venant方程，计算：
1. 洪峰传播速度
2. 洪峰衰减
3. 各断面最高水位
4. 淹没范围

**结果**（示例）：
- 洪峰传播速度：$\approx 4$ m/s
- 传播至下游10 km：$\approx 42$分钟
- 洪峰衰减：$668 \to 620$ m³/s（$\approx 7\%$）
- 最大水深：$5.2$ m

---

## 五、案例5：水工模型试验

### 5.1 溢洪道水力模型

**原型**：
- 堰顶高程：$100$ m
- 设计水头：$H_0 = 5$ m
- 设计流量：$Q_0 = 10000$ m³/s
- 溢流前缘宽度：$B = 100$ m

**模型**：
- 比尺：$\lambda_L = 50$（长度）
- 模型类型：重力相似（Froude准则）

**比尺推导**：

**Froude数相似**：
$$Fr_p = Fr_m \quad \Rightarrow \quad \frac{v_p}{\sqrt{gL_p}} = \frac{v_m}{\sqrt{gL_m}}$$

**速度比尺**：
$$\lambda_v = \frac{v_p}{v_m} = \sqrt{\lambda_L} = \sqrt{50} = 7.07$$

**流量比尺**：
$$\lambda_Q = \lambda_L^2 \times \lambda_v = 50^2 \times 7.07 = 17678$$

**时间比尺**：
$$\lambda_t = \frac{\lambda_L}{\lambda_v} = \frac{50}{7.07} = 7.07$$

**模型参数**：

| 参数 | 原型 | 比尺 | 模型 |
|------|------|------|------|
| 水头 | 5 m | 50 | 0.1 m |
| 流量 | 10000 m³/s | 17678 | 0.566 m³/s |
| 宽度 | 100 m | 50 | 2 m |

---

### 5.2 尺度效应修正

**雷诺数差异**：
$$Re_p = \frac{v_p L_p}{\nu}, \quad Re_m = \frac{v_m L_m}{\nu}$$

$$\frac{Re_p}{Re_m} = \frac{v_p L_p}{v_m L_m} = \lambda_v \cdot \lambda_L = 7.07 \times 50 = 354$$

**粗糙度影响**：
模型中相对粗糙度$\Delta / L_m$增大，摩阻增大

**修正方法**：
1. **Manning糙率换算**：
   $$n_m = \frac{n_p}{\lambda_L^{1/6}}$$

2. **流量系数修正**：
   $$m_p = m_m \times f(\lambda_L, Re)$$

**经验公式**（宽顶堰）：
$$\frac{m_p}{m_m} = 1 + 0.01\sqrt{\lambda_L}$$

---

## 六、Python综合案例

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy.integrate import odeint
from scipy.optimize import minimize

class HydraulicsComprehensive:
    """水力学综合应用工具"""
    
    @staticmethod
    def cascade_reservoir_operation(Q_in, V0, P_installed, eta=0.88, H_avg=50):
        """
        梯级水库联合调度（简化）
        
        参数:
            Q_in: 入库流量序列 (m³/s)
            V0: 初始库容 (m³)
            P_installed: 装机容量 (MW)
            eta: 效率
            H_avg: 平均水头 (m)
        
        返回:
            Q_out: 出库流量序列
            P: 发电功率序列
            V: 库容过程
        """
        n_steps = len(Q_in)
        dt = 3600  # 1小时步长
        
        Q_out = []
        P = []
        V = [V0]
        
        for i in range(n_steps):
            # 最大发电流量
            Q_max_power = P_installed * 1e6 / (9.81 * eta * H_avg)
            
            # 调度决策（简化：尽量满发）
            Q_release = min(Q_max_power, Q_in[i])
            
            # 发电功率
            P_gen = 9.81 * eta * Q_release * H_avg / 1e6  # MW
            
            # 库容更新
            V_new = V[-1] + (Q_in[i] - Q_release) * dt
            
            Q_out.append(Q_release)
            P.append(P_gen)
            V.append(V_new)
        
        return np.array(Q_out), np.array(P), np.array(V[:-1])
    
    @staticmethod
    def water_transfer_headloss(L_channel, L_pipe, L_tunnel, Q,
                                b, h, m, n_channel, D_pipe, D_tunnel, n_tunnel):
        """
        长距离调水水头损失计算
        
        参数:
            L_channel: 渠道长度 (m)
            L_pipe: 管道长度 (m)
            L_tunnel: 隧洞长度 (m)
            Q: 流量 (m³/s)
            b: 渠道底宽 (m)
            h: 渠道水深 (m)
            m: 渠道边坡
            n_channel: 渠道糙率
            D_pipe: 管道直径 (m)
            D_tunnel: 隧洞直径 (m)
            n_tunnel: 隧洞糙率
        
        返回:
            h_f_total: 总水头损失 (m)
            breakdown: 各段损失字典
        """
        g = 9.81
        
        # 1. 渠道段
        A_channel = (b + m * h) * h
        P_channel = b + 2 * h * np.sqrt(1 + m**2)
        R_channel = A_channel / P_channel
        
        v_channel = Q / A_channel
        
        # Manning公式反算坡度
        i_channel = (Q * n_channel / (A_channel * R_channel**(2/3)))**2
        h_f_channel = i_channel * L_channel
        
        # 2. 管道段
        A_pipe = np.pi * (D_pipe / 2)**2
        v_pipe = Q / A_pipe
        
        # 假设摩阻系数（光滑管）
        Re = v_pipe * D_pipe / 1e-6
        lambda_pipe = 0.3164 / Re**0.25 if Re < 1e5 else 0.013
        
        h_f_pipe = lambda_pipe * (L_pipe / D_pipe) * (v_pipe**2 / (2 * g))
        
        # 3. 隧洞段
        A_tunnel = np.pi * (D_tunnel / 2)**2
        R_tunnel = D_tunnel / 4
        v_tunnel = Q / A_tunnel
        
        i_tunnel = (v_tunnel * n_tunnel / R_tunnel**(2/3))**2
        h_f_tunnel = i_tunnel * L_tunnel
        
        h_f_total = h_f_channel + h_f_pipe + h_f_tunnel
        
        breakdown = {
            'channel': h_f_channel,
            'pipe': h_f_pipe,
            'tunnel': h_f_tunnel,
            'total': h_f_total
        }
        
        return h_f_total, breakdown
    
    @staticmethod
    def tidal_wave_propagation(A_tide, T_tide, h_avg, L, nx=100):
        """
        潮波传播模拟（简化线性模型）
        
        参数:
            A_tide: 潮差振幅 (m)
            T_tide: 潮汐周期 (s)
            h_avg: 平均水深 (m)
            L: 河口长度 (m)
            nx: 空间网格数
        
        返回:
            x, eta_max, eta_min: 位置、最高潮位、最低潮位
        """
        x = np.linspace(0, L, nx)
        
        # 潮波速度
        c = np.sqrt(9.81 * h_avg)
        
        # 波长
        lambda_tide = c * T_tide
        
        # 潮位分布（简化正弦传播）
        omega = 2 * np.pi / T_tide
        k = 2 * np.pi / lambda_tide
        
        # 最高潮位（涨潮）
        eta_max = A_tide * np.cos(k * x)
        
        # 最低潮位（退潮）
        eta_min = -A_tide * np.cos(k * x)
        
        return x, eta_max, eta_min, c
    
    @staticmethod
    def mountain_flood_simulation(A_basin, i_rain, phi, L_main, J_main):
        """
        山洪洪峰计算
        
        参数:
            A_basin: 流域面积 (km²)
            i_rain: 暴雨强度 (mm/h)
            phi: 径流系数
            L_main: 主河道长度 (km)
            J_main: 主河道平均坡度
        
        返回:
            Q_peak: 洪峰流量 (m³/s)
            tau: 汇流时间 (h)
        """
        # 推理公式
        Q_peak = 0.278 * phi * i_rain * A_basin
        
        # 汇流时间（经验公式）
        tau = 0.278 * L_main / J_main**0.2 / 3600  # 转为小时
        
        return Q_peak, tau
    
    @staticmethod
    def hydraulic_model_scaling(lambda_L):
        """
        水工模型比尺计算（Froude相似）
        
        参数:
            lambda_L: 长度比尺
        
        返回:
            scales: 各物理量比尺字典
        """
        lambda_v = np.sqrt(lambda_L)
        lambda_t = lambda_L / lambda_v
        lambda_Q = lambda_L**2 * lambda_v
        lambda_F = lambda_L**3  # 力比尺
        lambda_P = lambda_L**3.5  # 功率比尺
        
        scales = {
            'length': lambda_L,
            'velocity': lambda_v,
            'time': lambda_t,
            'discharge': lambda_Q,
            'force': lambda_F,
            'power': lambda_P
        }
        
        return scales
    
    @staticmethod
    def plot_comprehensive_cases():
        """可视化综合案例"""
        fig = plt.figure(figsize=(16, 12))
        
        # 1. 梯级水库调度
        ax1 = plt.subplot(3, 3, 1)
        
        np.random.seed(42)
        hours = 168  # 一周
        Q_in = 200 + 100 * np.sin(2 * np.pi * np.arange(hours) / 24) + np.random.randn(hours) * 30
        Q_in = np.maximum(Q_in, 50)
        
        V0 = 5e8  # 5亿m³
        P_installed = 300  # MW
        
        Q_out, P, V = HydraulicsComprehensive.cascade_reservoir_operation(
            Q_in, V0, P_installed
        )
        
        ax1.plot(np.arange(hours), Q_in, linewidth=2, label='入库流量', alpha=0.7)
        ax1.plot(np.arange(hours), Q_out, linewidth=2, label='出库流量')
        
        ax1.set_xlabel('时间 (小时)', fontsize=11)
        ax1.set_ylabel('流量 (m³/s)', fontsize=11)
        ax1.set_title('梯级水库调度', fontsize=12, fontweight='bold')
        ax1.legend()
        ax1.grid(True, alpha=0.3)
        
        # 2. 发电功率
        ax2 = plt.subplot(3, 3, 2)
        
        ax2.plot(np.arange(hours), P, linewidth=2, color='green')
        ax2.axhline(P_installed, color='red', linestyle='--', linewidth=2,
                   label=f'装机容量 {P_installed}MW')
        
        ax2.fill_between(np.arange(hours), 0, P, alpha=0.3, color='lightgreen')
        
        ax2.set_xlabel('时间 (小时)', fontsize=11)
        ax2.set_ylabel('发电功率 (MW)', fontsize=11)
        ax2.set_title('发电过程', fontsize=12, fontweight='bold')
        ax2.legend()
        ax2.grid(True, alpha=0.3)
        
        # 3. 调水工程损失分解
        ax3 = plt.subplot(3, 3, 3)
        
        Q = 50  # m³/s
        
        h_f_total, breakdown = HydraulicsComprehensive.water_transfer_headloss(
            L_channel=50000, L_pipe=30000, L_tunnel=20000, Q=Q,
            b=8, h=2.5, m=2, n_channel=0.022,
            D_pipe=3, D_tunnel=4, n_tunnel=0.014
        )
        
        segments = ['渠道\n50km', '管道\n30km', '隧洞\n20km']
        losses = [breakdown['channel'], breakdown['pipe'], breakdown['tunnel']]
        colors = ['lightblue', 'lightcoral', 'lightgreen']
        
        bars = ax3.bar(segments, losses, color=colors, edgecolor='black', width=0.6)
        
        for bar, loss in zip(bars, losses):
            height = bar.get_height()
            ax3.text(bar.get_x() + bar.get_width()/2, height + 5,
                    f'{loss:.1f}m', ha='center', va='bottom', fontsize=10, fontweight='bold')
        
        ax3.set_ylabel('水头损失 (m)', fontsize=11)
        ax3.set_title(f'长距离调水水头损失\n总计：{h_f_total:.1f}m', fontsize=12, fontweight='bold')
        ax3.grid(True, alpha=0.3, axis='y')
        
        # 4. 潮波传播
        ax4 = plt.subplot(3, 3, 4)
        
        A_tide = 1.5  # m
        T_tide = 12.42 * 3600  # s
        h_avg = 10  # m
        L_estuary = 100000  # m
        
        x, eta_max, eta_min, c = HydraulicsComprehensive.tidal_wave_propagation(
            A_tide, T_tide, h_avg, L_estuary
        )
        
        ax4.plot(x/1000, eta_max, linewidth=2, label='最高潮位', color='blue')
        ax4.plot(x/1000, eta_min, linewidth=2, label='最低潮位', color='red')
        ax4.fill_between(x/1000, eta_min, eta_max, alpha=0.3, color='lightblue')
        ax4.axhline(0, color='black', linestyle=':', linewidth=1)
        
        ax4.set_xlabel('距河口距离 (km)', fontsize=11)
        ax4.set_ylabel('潮位 (m)', fontsize=11)
        ax4.set_title(f'潮波传播 (波速{c:.1f}m/s)', fontsize=12, fontweight='bold')
        ax4.legend()
        ax4.grid(True, alpha=0.3)
        
        # 5. 山洪过程线
        ax5 = plt.subplot(3, 3, 5)
        
        A_basin = 50  # km²
        i_rain = 80  # mm/h
        phi = 0.6
        L_main = 15  # km
        J_main = 0.15
        
        Q_peak, tau = HydraulicsComprehensive.mountain_flood_simulation(
            A_basin, i_rain, phi, L_main, J_main
        )
        
        # 生成三角形过程线
        t_rise = tau
        t_fall = 3 * tau
        
        t_hydro = np.concatenate([
            np.linspace(0, t_rise, 50),
            np.linspace(t_rise, t_rise + t_fall, 100)
        ])
        
        Q_hydro = np.concatenate([
            np.linspace(10, Q_peak, 50),
            np.linspace(Q_peak, 10, 100)
        ])
        
        ax5.plot(t_hydro, Q_hydro, linewidth=2.5, color='darkblue')
        ax5.fill_between(t_hydro, 0, Q_hydro, alpha=0.3, color='lightblue')
        
        ax5.axhline(Q_peak, color='red', linestyle='--', linewidth=1.5,
                   label=f'洪峰 {Q_peak:.0f}m³/s')
        ax5.axvline(tau, color='green', linestyle=':', linewidth=1.5,
                   label=f'汇流时间 {tau:.2f}h')
        
        ax5.set_xlabel('时间 (小时)', fontsize=11)
        ax5.set_ylabel('流量 (m³/s)', fontsize=11)
        ax5.set_title('山洪过程线', fontsize=12, fontweight='bold')
        ax5.legend()
        ax5.grid(True, alpha=0.3)
        
        # 6. 模型比尺
        ax6 = plt.subplot(3, 3, 6)
        
        lambda_L_values = [10, 25, 50, 75, 100]
        
        lambda_v_values = [np.sqrt(l) for l in lambda_L_values]
        lambda_Q_values = [l**2.5 for l in lambda_L_values]
        
        x_pos = np.arange(len(lambda_L_values))
        width = 0.35
        
        bars1 = ax6.bar(x_pos - width/2, lambda_v_values, width,
                       label='速度比尺 √λ', color='lightblue', edgecolor='black')
        ax6_twin = ax6.twinx()
        bars2 = ax6_twin.bar(x_pos + width/2, np.array(lambda_Q_values)/1000, width,
                            label='流量比尺 λ^2.5 (×1000)', color='lightcoral', edgecolor='black')
        
        ax6.set_xlabel('长度比尺 λL', fontsize=11)
        ax6.set_ylabel('速度比尺', fontsize=11, color='blue')
        ax6_twin.set_ylabel('流量比尺 (×1000)', fontsize=11, color='red')
        ax6.set_title('Froude模型比尺关系', fontsize=12, fontweight='bold')
        ax6.set_xticks(x_pos)
        ax6.set_xticklabels(lambda_L_values)
        ax6.grid(True, alpha=0.3, axis='y')
        
        # 图例
        lines1, labels1 = ax6.get_legend_handles_labels()
        lines2, labels2 = ax6_twin.get_legend_handles_labels()
        ax6.legend(lines1 + lines2, labels1 + labels2, loc='upper left')
        
        # 7. 泵站扬程分解
        ax7 = plt.subplot(3, 3, 7)
        
        components = ['沿程\n损失', '局部\n损失', '地形\n高差', '出口\n动能']
        heights = [350, 40, 10, 15]
        colors_pump = ['lightcoral', 'orange', 'lightblue', 'lightgreen']
        
        bars_pump = ax7.bar(components, heights, color=colors_pump,
                           edgecolor='black', width=0.6)
        
        # 累积标注
        cumsum = 0
        for bar, h in zip(bars_pump, heights):
            cumsum += h
            ax7.text(bar.get_x() + bar.get_width()/2, cumsum + 5,
                    f'{cumsum:.0f}m', ha='center', fontsize=10, fontweight='bold')
        
        ax7.axhline(sum(heights), color='red', linestyle='--', linewidth=2)
        
        ax7.set_ylabel('水头 (m)', fontsize=11)
        ax7.set_title(f'泵站扬程组成\n总扬程：{sum(heights)}m', fontsize=12, fontweight='bold')
        ax7.grid(True, alpha=0.3, axis='y')
        
        # 8. 库容过程
        ax8 = plt.subplot(3, 3, 8)
        
        ax8.plot(np.arange(hours), V / 1e8, linewidth=2, color='darkblue')
        ax8.axhline(V0 / 1e8, color='green', linestyle='--', linewidth=1.5,
                   label='初始库容')
        
        ax8.fill_between(np.arange(hours), V0 / 1e8, V / 1e8,
                        where=(V >= V0), alpha=0.3, color='lightgreen', label='蓄水')
        ax8.fill_between(np.arange(hours), V / 1e8, V0 / 1e8,
                        where=(V < V0), alpha=0.3, color='lightcoral', label='泄水')
        
        ax8.set_xlabel('时间 (小时)', fontsize=11)
        ax8.set_ylabel('库容 (亿m³)', fontsize=11)
        ax8.set_title('水库库容变化', fontsize=12, fontweight='bold')
        ax8.legend()
        ax8.grid(True, alpha=0.3)
        
        # 9. 综合评价
        ax9 = plt.subplot(3, 3, 9)
        
        # 各案例指标
        cases = ['梯级\n水库', '长距离\n调水', '潮汐\n河口', '山洪\n灾害', '水工\n模型']
        
        complexity = [85, 90, 75, 65, 80]
        importance = [95, 85, 70, 90, 75]
        
        angles = np.linspace(0, 2 * np.pi, len(cases), endpoint=False).tolist()
        complexity += complexity[:1]
        importance += importance[:1]
        angles += angles[:1]
        
        ax9 = plt.subplot(3, 3, 9, projection='polar')
        
        ax9.plot(angles, complexity, 'o-', linewidth=2, label='复杂度', color='blue')
        ax9.fill(angles, complexity, alpha=0.25, color='blue')
        
        ax9.plot(angles, importance, 'o-', linewidth=2, label='工程重要性', color='red')
        ax9.fill(angles, importance, alpha=0.25, color='red')
        
        ax9.set_xticks(angles[:-1])
        ax9.set_xticklabels(cases, fontsize=10)
        ax9.set_ylim(0, 100)
        ax9.set_title('综合案例评价', fontsize=12, fontweight='bold', pad=20)
        ax9.legend(loc='upper right', bbox_to_anchor=(1.3, 1.1))
        ax9.grid(True)
        
        plt.tight_layout()
        plt.savefig('hydraulics_comprehensive_applications.png', dpi=300)
        plt.show()

# 示例使用
print("="*60)
print("水力学综合应用案例")
print("="*60)

hc = HydraulicsComprehensive()

# 1. 梯级水库调度
print("\n1. 梯级水库发电计算")

H = 20  # m
Q = 500  # m³/s
eta = 0.88

P = 9.81 * eta * Q * H / 1000  # kW → MW
print(f"  水头: {H} m")
print(f"  流量: {Q} m³/s")
print(f"  效率: {eta}")
print(f"  发电功率: {P:.1f} MW")

# 2. 长距离调水
print("\n" + "="*60)
print("2. 长距离调水水头损失")

Q_transfer = 50  # m³/s

h_f_total, breakdown = hc.water_transfer_headloss(
    L_channel=50000, L_pipe=30000, L_tunnel=20000, Q=Q_transfer,
    b=8, h=2.5, m=2, n_channel=0.022,
    D_pipe=3, D_tunnel=4, n_tunnel=0.014
)

print(f"  设计流量: {Q_transfer} m³/s")
print(f"  渠道段损失: {breakdown['channel']:.1f} m")
print(f"  管道段损失: {breakdown['pipe']:.1f} m")
print(f"  隧洞段损失: {breakdown['tunnel']:.1f} m")
print(f"  总水头损失: {h_f_total:.1f} m")

# 泵站功率
P_pump = 1000 * 9.81 * Q_transfer * h_f_total / (0.85 * 1e6)
print(f"  所需泵站功率: {P_pump:.1f} MW")

# 3. 山洪计算
print("\n" + "="*60)
print("3. 山洪洪峰计算")

A_basin = 50  # km²
i_rain = 80  # mm/h
phi = 0.6
L_main = 15  # km
J_main = 0.15

Q_peak, tau = hc.mountain_flood_simulation(A_basin, i_rain, phi, L_main, J_main)

print(f"  流域面积: {A_basin} km²")
print(f"  暴雨强度: {i_rain} mm/h")
print(f"  径流系数: {phi}")
print(f"  洪峰流量: {Q_peak:.0f} m³/s")
print(f"  汇流时间: {tau:.2f} 小时")

# 4. 模型比尺
print("\n" + "="*60)
print("4. 水工模型比尺（Froude相似）")

lambda_L = 50

scales = hc.hydraulic_model_scaling(lambda_L)

print(f"  长度比尺 λL: {scales['length']}")
print(f"  速度比尺 λv: {scales['velocity']:.2f}")
print(f"  时间比尺 λt: {scales['time']:.2f}")
print(f"  流量比尺 λQ: {scales['discharge']:.0f}")
print(f"  力比尺 λF: {scales['force']:.0f}")
print(f"  功率比尺 λP: {scales['power']:.0f}")

# 原型转模型
Q_prototype = 10000  # m³/s
H_prototype = 5  # m

Q_model = Q_prototype / scales['discharge']
H_model = H_prototype / scales['length']

print(f"\n  原型流量 {Q_prototype} m³/s → 模型流量 {Q_model:.3f} m³/s")
print(f"  原型水头 {H_prototype} m → 模型水头 {H_model:.2f} m")

# 可视化
print("\n绘制综合应用案例可视化...")
hc.plot_comprehensive_cases()
```

---

## 七、本章总结

### 综合案例要点

1. **梯级水库调度**：
   - 水量平衡、水力联系
   - 发电功率：$P = 9.81 \eta Q H$
   - 多目标优化（DP、GA、PSO）

2. **长距离调水**：
   - 渠道+管道+隧洞组合
   - 水头损失分段计算
   - 泵站扬程和功率

3. **潮汐水力学**：
   - 潮波速度：$c = \sqrt{gh}$
   - 潮波长：$\lambda = cT$
   - Saint-Venant方程数值模拟

4. **山洪灾害**：
   - 推理公式：$Q_p = 0.278 \varphi i F$
   - 汇流时间估算
   - 洪水演进模拟

5. **水工模型**：
   - Froude相似：$Fr_p = Fr_m$
   - 比尺关系：$\lambda_v = \sqrt{\lambda_L}$，$\lambda_Q = \lambda_L^{2.5}$
   - 尺度效应修正

---

**本章重点**：
- 梯级水库联合调度（水量平衡、发电优化）
- 长距离调水工程（水头损失、泵站设计）
- 河口潮汐水力学（潮波传播、潮流模拟）
- 山洪灾害模拟（洪峰计算、洪水演进）
- 水工模型试验（相似律、比尺换算、尺度效应）
- Python综合应用工具

**课程总结**：本书系统介绍了高等水力学的理论和数值方法，涵盖渐变流、急变流、非恒定流、水跃、溃坝波、河网模拟等核心内容，并通过综合工程案例展示了水力学在实际工程中的应用，为深入研究和工程实践奠定坚实基础。
