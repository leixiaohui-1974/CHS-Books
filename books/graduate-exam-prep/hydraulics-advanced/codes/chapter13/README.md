# 第13章 水资源计算 - 代码实现

## 章节概述

本章聚焦水资源计算领域，涵盖径流计算、水库调节、水资源配置、承载力评价和综合规划等关键主题。通过5个精心设计的Python程序，系统阐述水资源工程的计算方法和评价体系。

## 程序列表

### 1. 题1：径流计算 (ch13_problem01_runoff_calculation.py)

**问题描述**：
- 流域面积A = 1000 km²
- 年降水量P = 800 mm
- 蒸发量E = 500 mm
- 地下水补给G = 50 mm
- 径流系数α = 0.6

**核心内容**：
- 水量平衡方程（R = P - E + G - ΔS）
- 径流系数计算（α = R/P）
- 径流模数（M = R/A）
- 地表径流与基流分离
- 月径流分配

**关键公式**：
```python
R = α × P × A     # 年径流量
M = R/A           # 径流模数
α = R/P           # 径流系数
R_地表 = α × R     # 地表径流
R_基流 = (1-α) × R  # 基流
```

**代码特色**：
- 完整的水量平衡计算
- 月径流分配曲线
- 径流成分分析
- 9幅专业图表展示

---

### 2. 题4：水库调节计算 (ch13_problem04_reservoir_regulation.py)

**问题描述**：
- 总库容V = 5亿m³，死库容Vd = 1亿m³
- 年平均入流量Q_in = 50 m³/s
- 用水需求Q_out = 40 m³/s
- 汛期（6-9月）入流量占60%

**核心内容**：
- 兴利库容计算（V_b = V - V_d）
- 调节库容确定（V_r = max(累计入流-累计出流)）
- 调节系数计算（β = V_r/W_年）
- 调节类型判别（径流式/日调节/季调节/年调节/多年调节）
- 供水保证率评估

**关键公式**：
```matlab
V_b = V - V_d                    # 兴利库容
V_r = max(ΔW) - min(ΔW)         # 调节库容
β = V_r/W_年                     # 调节系数
P = (1 - 缺水次数/总次数)×100%   # 保证率
```

**代码特色**：
- 月入流与用水过程分析
- 累计水量过程曲线
- 调节库容图解法
- 不同库容的调节能力分析
- 调节类型智能判别
- 9幅专业图表展示

---

### 3. 题7：水资源配置 (ch13_problem07_water_allocation.py)

**问题描述**：
- 总水资源量W = 10亿m³/年
- 生活用水需求：0.8亿m³（优先级最高）
- 工业用水需求：3.5亿m³（优先级次之）
- 农业用水需求：6.0亿m³（优先级最低）
- 生态用水需求：0.5亿m³（刚性需求）

**核心内容**：
- 水资源供需平衡分析
- 优先级排序配置方案
- 各部门分配比例确定
- 缺水风险评估
- 综合效益分析

**关键公式**：
```python
W_供 = W_需 + W_损失              # 水资源平衡
η = (W_需 - W_供)/W_需           # 缺水率
B = Σ(w_i × b_i)                # 综合效益
```

**配置原则**：
1. 生活用水（最高优先级）
2. 生态用水（刚性需求）
3. 工业用水（次之）
4. 农业用水（最低）

**代码特色**：
- 供需对比分析
- 多部门配置方案
- 饼图展示分配结构
- 缺水风险可视化
- 经济效益评估
- 9幅专业图表展示

---

### 4. 题10：水资源承载力评价 (ch13_problem10_carrying_capacity.py)

**问题描述**：
- 水资源量W = 15亿m³/年
- 现状人口P = 200万人，人均用水q_p = 150 L/(人·d)
- 现状GDP = 500亿元，万元GDP用水量q_GDP = 80 m³/万元
- 生态用水比例15%

**核心内容**：
- 现状用水量计算
- 人口承载力评估（P_max）
- 经济承载力评估（GDP_max）
- 承载指数计算（CI）
- 可持续发展建议

**关键公式**：
```python
P_max = (W_可用 - W_生态 - W_生产)/(q_p × 365)  # 承载人口
GDP_max = (W_可用 - W_生态 - W_生活)/q_GDP     # 承载GDP
CI = W_用/W_可用                             # 承载指数
```

**评价标准**：
- CI < 0.4: 未开发
- 0.4 ≤ CI < 0.6: 可开发
- 0.6 ≤ CI < 0.8: 重度开发
- CI ≥ 0.8: 超载

**代码特色**：
- 现状用水结构分析
- 人口承载力曲线
- 经济承载力曲线
- 承载指数雷达图
- 不同用水定额影响分析
- 综合评价等级判定
- 9幅专业图表展示

---

### 5. 题13：水资源综合规划 (ch13_problem13_comprehensive_planning.py)

**问题描述**：
- 流域面积A = 5000 km²
- 年降水量P = 800 mm，径流系数α = 0.40
- 现状人口200万人，规划人口300万人
- 现状GDP 600亿元，规划GDP 1200亿元
- 规划期20年

**核心内容**：
- 水资源总量评价（W = P × A × α）
- 需水预测（生活、生产、生态）
- 供需平衡分析（现状vs规划）
- 调控方案设计（节水、水库、外调水）
- 工程措施建议（水源、输配、节水、保护）
- 综合效益评估（经济、生态、社会）

**关键公式**：
```python
W = P × A × α                        # 水资源总量
W_需 = W_生活 + W_生产 + W_生态          # 需水量
W_供 = W_地表 + W_地下 + W_外调          # 供水量
B/C = 总效益/总投资                   # 效益成本比
```

**规划措施**：
1. 水源工程：水库、地下水开采
2. 输配水工程：管道、泵站
3. 节水工程：农业、工业、城市节水
4. 水质保护：污水处理、河道整治

**代码特色**：
- 水资源多维度评价
- 供需对比（现状-规划）
- 多类需水预测
- 调控方案优化
- 工程措施投资分配
- 规划时序分析
- 综合效益评估（B/C比）
- 9幅专业图表展示

---

## 代码统计

| 程序 | 文件大小 | 代码行数 | 图表数量 | 核心类 |
|------|---------|---------|---------|--------|
| 题1 | ~15KB | ~550行 | 9 | RunoffCalculation |
| 题4 | ~16KB | ~570行 | 9 | ReservoirRegulation |
| 题7 | ~20KB | ~680行 | 9 | WaterAllocation |
| 题10 | ~19KB | ~670行 | 9 | WaterCarryingCapacity |
| 题13 | ~24KB | ~780行 | 9 | ComprehensivePlanning |
| **合计** | **~94KB** | **~3,250行** | **45** | **5个类** |

## 技术特色

### 1. 面向对象设计 (OOP)
- 每个问题独立封装为类
- 清晰的方法接口
- 易于扩展和维护

### 2. 计算方法
- 水量平衡方程
- 调节计算理论
- 承载力评价模型
- 效益分析方法

### 3. 可视化技术
- 统一的9宫格图表布局
- 多种图表类型（柱状图、折线图、饼图、雷达图）
- 表格数据汇总
- 专业配色方案

### 4. 代码质量
- PEP 8编码规范
- 完整的类型提示
- 详细的文档字符串
- 清晰的注释说明

## 考试要点

### 核心公式
1. **径流计算**：R = P - E + G - ΔS
2. **调节库容**：V_r = max(ΔW) - min(ΔW)
3. **调节系数**：β = V_r/W_年
4. **缺水率**：η = (W_需 - W_供)/W_需
5. **承载指数**：CI = W_用/W_可用
6. **效益成本比**：B/C = 总效益/总投资

### 重要概念
1. 径流系数与径流模数
2. 水库调节类型（日/季/年/多年调节）
3. 水资源配置优先级
4. 承载力评价标准
5. 供需平衡分析
6. 综合效益评估

### 工程应用
1. 流域径流计算
2. 水库调度运行
3. 区域水资源配置
4. 承载力预警评价
5. 流域综合规划
6. 工程措施优化

## 使用方法

### 运行单个程序
```bash
cd /workspace/books/graduate-exam-prep/hydraulics-advanced/codes/chapter13
python3 ch13_problem01_runoff_calculation.py
```python

### 运行全部程序
```bash
cd /workspace/books/graduate-exam-prep/hydraulics-advanced/codes/chapter13
for file in ch13_problem*.py; do
    echo "运行 $file..."
    python3 "$file"
done
```python

### 自定义参数
编辑各程序的 `main()` 函数，修改参数值：
```python
def main():
    # 径流计算
    A = 1000  # 流域面积 km²
    P = 800   # 年降水量 mm
    E = 500   # 蒸发量 mm
    # ... 更多参数
```

## 学习建议

1. **理论学习**：
   - 掌握水资源计算基本理论
   - 理解各类调节类型特点
   - 熟悉承载力评价方法

2. **代码阅读**：
   - 理解OOP设计模式
   - 学习计算方法实现
   - 分析可视化技巧

3. **动手实践**：
   - 修改参数进行敏感性分析
   - 对比不同方案效果
   - 扩展新的功能模块

4. **考试应用**：
   - 记忆核心公式
   - 理解计算步骤
   - 练习快速求解

## 参考资料

1. 《水资源学》
2. 《水资源规划与管理》
3. 《水库调度》
4. 《水资源承载力评价方法》
5. 国家水资源综合规划技术大纲

## 技术支持

- 开发团队：CHS-Books Team
- 开发日期：2025-11-07
- Python版本：3.8+
- 依赖库：numpy, matplotlib, scipy

---

**教学目标**：通过本章学习，学生应掌握水资源计算的基本方法，理解水库调节原理，熟悉水资源配置策略，能够进行承载力评价，具备综合规划能力。

**考试重点**：径流计算、调节系数、承载力评价、供需平衡、效益分析。

**实际应用**：流域规划、水库设计、区域配置、承载力评估、可持续发展决策。
