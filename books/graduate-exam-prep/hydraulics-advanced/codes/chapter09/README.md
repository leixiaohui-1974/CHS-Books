# 第09章 渠系水力计算 - 代码实现

## 完成状态
- **章节**: 第09章 渠系水力计算
- **完成度**: 100% ✓
- **代码文件**: 5个
- **总代码量**: ~3,850行
- **可视化**: 45个子图
- **开发时间**: 2025-11-07

## 章节概述

本章实现明渠水力学的核心计算方法，涵盖：
1. **均匀流计算**：Manning公式、Froude数、流态判别
2. **水力最优断面**：梯形断面优化设计
3. **非均匀流**：水面曲线、壅水分析
4. **渠道设计**：防冲防淤、多方案比选
5. **临界流**：临界水深、临界坡度、坡度分类

## 文件清单

### 1. 渠道均匀流 (ch09_problem01_uniform_flow.py)
**功能**：
- Manning公式计算流速和流量
- Froude数计算与流态判别
- 底坡和糙率影响分析
- Chezy公式对比

**核心公式**：
```
v = (1/n)R^(2/3)·i^(1/2)  (Manning)
Fr = v/√(g·hm)            (Froude数)
Q = A·v                    (流量)
```

**可视化**（9个子图）：
1. 断面示意图
2. 计算流程
3. 参数对比表
4. 底坡影响
5. 糙率影响
6. Fr数与流态
7. 材料对比
8. 公式对比
9. 结果汇总

### 2. 优化断面设计 (ch09_problem03_optimal_section.py)
**功能**：
- 梯形断面水力最优条件推导
- 最优b-h关系计算
- 与矩形断面对比
- 土方量和造价分析

**核心公式**：
```
最优条件: b = 2h(√(1+m²)-m)
R = A/χ → 最大
χ = b + 2h√(1+m²) → 最小（A固定）
```

**可视化**（9个子图）：
1. 优化梯形断面
2. 优化条件推导
3. b-h最优关系
4. 断面形式对比
5. 参数对比柱状图
6. 湿周随b变化
7. 水力半径随b变化
8. 土方量对比
9. 优化结果汇总表

### 3. 非均匀流水面曲线 (ch09_problem06_surface_profile.py)
**功能**：
- 正常水深与临界水深计算
- 水面曲线类型判别（M1/M2/M3/S1/S2/S3）
- 逐段求和法计算水面线
- 壅水高度分析

**核心公式**：
```
dh/dx = (i - J)/(1 - Fr²)
临界水深: A³/B = Q²/g
水面曲线分类: 基于h₀与hc比较
```

**可视化**（9个子图）：
1. 断面示意图
2. 水深分析
3. 上游水面曲线
4. 底坡变化示意
5. Fr数沿程变化
6. 能坡与底坡比较
7. 壅水高度分布
8. 水面曲线分类图
9. 计算结果汇总表

### 4. 渠道综合设计 (ch09_problem09_channel_design.py)
**功能**：
- 多方案设计（最优、不同b/h比）
- 防冲防淤流速验证
- 土方量与造价估算
- 综合评价（雷达图）

**核心公式**：
```
v_min = 0.6 m/s  （不淤流速）
v_max = 2.5 m/s  （不冲流速，土渠）
土方量 = 断面积×长度
造价 = 开挖费 + 衬砌费
```

**可视化**（9个子图）：
1. 方案1断面图
2. 设计要求
3. 方案断面尺寸对比
4. 流速对比（防冲防淤）
5. 断面参数对比
6. 土方量对比
7. 工程造价对比
8. 综合评价雷达图
9. 方案汇总表

### 5. 临界水深与临界坡度 (ch09_problem12_critical_flow.py)
**功能**：
- 临界水深计算（A³/B = Q²/g）
- 临界坡度计算
- 坡度分类（缓坡/陡坡/临界坡）
- Fr-h关系分析

**核心公式**：
```
临界条件: Fr = 1
临界水深: A³/B = Q²/g
临界坡度: h₀(ic) = hc
缓坡: i < ic, h₀ > hc
陡坡: i > ic, h₀ < hc
```

**可视化**（9个子图）：
1. 临界流断面
2. 临界流参数
3. Fr-h关系曲线
4. 坡度分类图
5. 比能E-h曲线
6. h₀与hc对比
7. 流速-水深关系
8. 坡度分类表
9. 临界流参数汇总表

## 技术特点

### 1. 核心算法
- **Manning公式**：明渠均匀流基本方程
- **临界流条件**：Fr = 1，A³/B = Q²/g
- **水面曲线微分方程**：dh/dx = (i-J)/(1-Fr²)
- **水力最优条件**：R最大（χ最小，A固定）
- **数值求解**：`scipy.optimize.fsolve`求解非线性方程

### 2. 工程应用
- **断面设计**：底宽、水深、边坡优化
- **流态判别**：Froude数、缓流/急流
- **防冲防淤**：流速范围控制
- **经济分析**：土方量、造价估算
- **多方案比选**：综合评价、雷达图

### 3. 考试要点
- **Manning公式**：参数含义、适用条件
- **临界流**：Fr=1的物理意义
- **坡度分类**：h₀与hc关系、流态
- **水面曲线**：12种类型（M/S/C/H/A）
- **最优断面**：推导过程、应用场景

## 代码统计

| 程序 | 文件名 | 代码行数 | 类/函数 | 可视化 |
|------|--------|---------|---------|--------|
| 题1 | ch09_problem01_uniform_flow.py | ~680 | 1类/11方法 | 9子图 |
| 题3 | ch09_problem03_optimal_section.py | ~850 | 1类/9方法 | 9子图 |
| 题6 | ch09_problem06_surface_profile.py | ~960 | 1类/10方法 | 9子图 |
| 题9 | ch09_problem09_channel_design.py | ~780 | 1类/13方法 | 9子图 |
| 题12 | ch09_problem12_critical_flow.py | ~580 | 1类/11方法 | 9子图 |
| **合计** | - | **~3,850** | **5类/54方法** | **45子图** |

## 运行方法

```python
# 运行单个程序
python ch09_problem01_uniform_flow.py
python ch09_problem03_optimal_section.py
python ch09_problem06_surface_profile.py
python ch09_problem09_channel_design.py
python ch09_problem12_critical_flow.py

# 或在Python中导入使用
from ch09_problem01_uniform_flow import UniformFlow

uf = UniformFlow(b=5, h=2, i=0.001, n=0.025)
uf.print_results()
uf.plot_analysis()
```

## 依赖库

```python
numpy >= 1.19.0
matplotlib >= 3.3.0
scipy >= 1.5.0
```

## 开发规范

1. **代码风格**：遵循PEP 8，中文注释
2. **类设计**：OOP封装，参数化配置
3. **文档字符串**：详细的docstring
4. **可视化**：统一9子图布局，16x12英寸
5. **输出格式**：结构化文本 + 高清图表

## 知识覆盖

### 水力学基础
- ✓ Manning公式与Chezy公式
- ✓ 水力半径、湿周、断面面积
- ✓ Froude数与流态
- ✓ 能坡与底坡

### 明渠流动
- ✓ 均匀流与非均匀流
- ✓ 正常水深与临界水深
- ✓ 缓流、急流、临界流
- ✓ 水面曲线分类（12种）

### 渠道设计
- ✓ 梯形、矩形、三角形断面
- ✓ 水力最优断面
- ✓ 防冲流速与不淤流速
- ✓ 土方量计算
- ✓ 经济性分析

### 坡度分类
- ✓ 缓坡（Mild）：i < ic, h₀ > hc
- ✓ 陡坡（Steep）：i > ic, h₀ < hc
- ✓ 临界坡（Critical）：i = ic, h₀ = hc
- ✓ 平坡（Horizontal）：i = 0
- ✓ 负坡（Adverse）：i < 0

## 更新日志

### 2025-11-07
- ✓ 完成题1：渠道均匀流（680行，9子图）
- ✓ 完成题3：优化断面设计（850行，9子图）
- ✓ 完成题6：非均匀流水面曲线（960行，9子图）
- ✓ 完成题9：渠道综合设计（780行，9子图）
- ✓ 完成题12：临界水深与临界坡度（580行，9子图）
- ✓ 第09章代码开发100%完成

## 考研应用价值

本章代码对考研复习的价值：
1. **核心知识点**：涵盖明渠水力学90%以上考点
2. **公式记忆**：通过代码理解公式物理意义
3. **计算训练**：典型题目完整求解过程
4. **快速验证**：考试计算结果验证工具
5. **工程应用**：实际工程设计思路

---

**开发团队**：CHS-Books Team  
**联系方式**：见项目主README  
**版本**：v1.0  
**最后更新**：2025-11-07
