# 第4章：灌溉排水工程

**目标**: 农业水资源高效利用  
**重要性**: ⭐⭐⭐⭐⭐

---

## 一、灌溉制度

### 1.1 作物需水量

**农田水量平衡**：
$$ET = P + I + U - D - R$$

- $ET$：腾发量（蒸发+蒸腾）
- $P$：降雨
- $I$：灌溉
- $U$：地下水补给
- $D$：深层渗漏
- $R$：地表径流

**净灌溉定额**：
$$m_{净} = ET - P_{有效}$$

**毛灌溉定额**：
$$m_{毛} = \frac{m_{净}}{\eta}$$

$\eta$：灌溉水利用系数

### 1.2 灌溉制度要素

**灌水次数**：$n$次  
**灌水定额**：$m_i$ (m³/亩)  
**灌水周期**：$T$ (天)  
**灌溉定额**：$M = \sum m_i$ (m³/亩)

---

## 二、灌溉方式

### 2.1 地面灌溉

**畦灌**：
- 适用：水稻、小麦
- 效率：60-70%

**沟灌**：
- 适用：玉米、果树
- 效率：65-75%

**淹灌**：
- 适用：水稻
- 效率：40-50%

### 2.2 喷灌

**优点**：
- 节水30-50%
- 适应性强
- 可施肥

**喷头间距**：
$$S = 0.5 \sim 0.8 \times R$$

$R$：喷头射程

**喷灌强度**：
$$i_{喷} < i_{入渗}$$

### 2.3 滴灌

**优点**：
- 节水50-70%
- 精准控制
- 适用水源不足地区

**设计参数**：
- 滴头流量：2-8 L/h
- 滴头间距：0.3-0.6 m
- 管道间距：作物行距

### Python实现

```python
import numpy as np
import matplotlib.pyplot as plt

class IrrigationDesign:
    """灌溉工程设计"""
    
    def __init__(self):
        pass
    
    def crop_water_requirement(self, ET0, Kc, P_eff, A, days):
        """
        作物需水量计算
        
        ET_c = ET₀ × K_c
        
        净灌溉定额 m_净 = ET_c - P_eff
        
        参数:
            ET0: 参考腾发量 (mm/d)
            Kc: 作物系数
            P_eff: 有效降雨 (mm)
            A: 灌溉面积 (亩)
            days: 生育期天数
        
        返回:
            需水量 (m³)
        """
        # 作物腾发量
        ET_c = ET0 * Kc * days
        
        # 净灌溉定额
        m_net = max(0, ET_c - P_eff)
        
        # 总需水量（1亩=666.67m²）
        A_m2 = A * 666.67
        V = m_net / 1000 * A_m2
        
        return {
            'ET_c': ET_c,
            'm_net': m_net,
            'V_total': V
        }
    
    def irrigation_schedule(self, m_net, theta_fc, theta_wp, 
                           theta_target, Z, p):
        """
        灌溉制度设计
        
        参数:
            m_net: 净灌溉定额 (mm)
            theta_fc: 田间持水率
            theta_wp: 凋萎系数
            theta_target: 目标含水率（灌前）
            Z: 计划湿润层深度 (m)
            p: 土壤密度 (kg/m³)
        
        返回:
            灌水次数、灌水定额
        """
        # 单次灌水定额（补充到田间持水率）
        m_single = (theta_fc - theta_target) * Z * 1000  # mm
        
        # 灌水次数
        n = int(np.ceil(m_net / m_single))
        
        # 实际单次灌水定额
        m_single_actual = m_net / n if n > 0 else 0
        
        # 灌水周期（假设作物生育期120天）
        T = 120 / n if n > 0 else 0
        
        return {
            'n': n,
            'm_single': m_single_actual,
            'T': T
        }
    
    def sprinkler_design(self, R, S_factor=0.65):
        """
        喷灌系统设计
        
        喷头间距 S = factor × R
        
        参数:
            R: 喷头射程 (m)
            S_factor: 间距系数 (0.5-0.8)
        
        返回:
            S: 喷头间距 (m)
        """
        S = S_factor * R
        
        return S
    
    def sprinkler_intensity(self, q, S):
        """
        喷灌强度
        
        i = q / S² (mm/h)
        
        参数:
            q: 喷头流量 (m³/h)
            S: 喷头间距 (m)
        
        返回:
            i: 喷灌强度 (mm/h)
        """
        i = q / S**2 * 1000  # mm/h
        
        return i
    
    def drip_irrigation_design(self, A_row, L_row, q_dripper, 
                               S_dripper, S_lateral):
        """
        滴灌系统设计
        
        参数:
            A_row: 行距 (m)
            L_row: 行长 (m)
            q_dripper: 滴头流量 (L/h)
            S_dripper: 滴头间距 (m)
            S_lateral: 毛管间距 (m)
        
        返回:
            系统参数
        """
        # 每行滴头数量
        n_drippers_per_row = int(L_row / S_dripper)
        
        # 每亩毛管数量（1亩=666.67m²）
        n_laterals_per_mu = 666.67 / (S_lateral * L_row)
        
        # 每亩滴头数量
        n_drippers_per_mu = n_drippers_per_row * n_laterals_per_mu
        
        # 每亩总流量
        Q_per_mu = n_drippers_per_mu * q_dripper  # L/h
        
        # 灌溉强度
        i_drip = Q_per_mu / 666.67 * 1000  # mm/h
        
        return {
            'n_drippers_per_row': n_drippers_per_row,
            'n_laterals_per_mu': n_laterals_per_mu,
            'n_drippers_per_mu': n_drippers_per_mu,
            'Q_per_mu': Q_per_mu,
            'i_drip': i_drip
        }
    
    def water_use_efficiency(self, eta_canal, eta_field, eta_method):
        """
        灌溉水利用系数
        
        η = η_渠道 × η_田间 × η_灌水
        
        参数:
            eta_canal: 渠系水利用系数
            eta_field: 田间水利用系数
            eta_method: 灌水方法系数
        """
        eta_total = eta_canal * eta_field * eta_method
        
        return eta_total
    
    def plot_irrigation_methods_comparison(self):
        """对比不同灌溉方式"""
        methods = ['淹灌', '畦灌', '沟灌', '喷灌', '滴灌', '微喷']
        efficiency = [45, 65, 70, 80, 90, 85]
        cost = [100, 150, 180, 500, 800, 600]
        
        fig, axes = plt.subplots(1, 2, figsize=(16, 6))
        
        # (a) 效率对比
        bars1 = axes[0].bar(methods, efficiency, color='skyblue', 
                           edgecolor='navy', linewidth=1.5)
        
        # 标注数值
        for bar, eff in zip(bars1, efficiency):
            height = bar.get_height()
            axes[0].text(bar.get_x() + bar.get_width()/2, height + 2,
                        f'{eff}%', ha='center', fontsize=11, fontweight='bold')
        
        axes[0].axhline(70, color='r', linestyle='--', linewidth=2,
                       label='节水灌溉阈值70%')
        axes[0].set_ylabel('水利用系数 (%)', fontsize=12)
        axes[0].set_title('不同灌溉方式水利用效率对比', fontsize=14)
        axes[0].legend()
        axes[0].grid(True, axis='y', alpha=0.3)
        axes[0].set_ylim([0, 100])
        
        # (b) 成本对比
        bars2 = axes[1].bar(methods, cost, color='lightcoral',
                           edgecolor='darkred', linewidth=1.5)
        
        for bar, c in zip(bars2, cost):
            height = bar.get_height()
            axes[1].text(bar.get_x() + bar.get_width()/2, height + 30,
                        f'{c}', ha='center', fontsize=11, fontweight='bold')
        
        axes[1].set_ylabel('投资成本 (元/亩)', fontsize=12)
        axes[1].set_title('不同灌溉方式投资成本对比', fontsize=14)
        axes[1].grid(True, axis='y', alpha=0.3)
        
        plt.tight_layout()
        plt.savefig('irrigation_methods_comparison.png', dpi=300)
        plt.show()
    
    def plot_crop_water_curve(self):
        """绘制作物生育期需水曲线"""
        days = np.arange(0, 121)
        
        # 作物系数（简化，实际更复杂）
        # 初期、发育期、中期、后期
        Kc_stages = [0.4, 0.7, 1.2, 0.6]
        stage_days = [0, 30, 60, 90, 120]
        
        Kc = np.interp(days, stage_days, [0.4, 0.7, 1.2, 0.6, 0.6])
        
        # 参考腾发量（假设）
        ET0 = 5  # mm/d
        
        # 作物需水量
        ET_c = ET0 * Kc
        
        # 累计需水量
        ET_c_cumulative = np.cumsum(ET_c)
        
        fig, axes = plt.subplots(2, 1, figsize=(14, 10))
        
        # (a) 日需水量
        axes[0].plot(days, ET_c, 'b-', linewidth=2.5, label='日需水量')
        axes[0].fill_between(days, 0, ET_c, alpha=0.3, color='blue')
        
        # 标注生育期
        stage_names = ['初期', '发育期', '中期', '后期']
        for i, (start, end, name) in enumerate(zip(stage_days[:-1], 
                                                   stage_days[1:], 
                                                   stage_names)):
            mid = (start + end) / 2
            axes[0].text(mid, max(ET_c) - 1, name, ha='center',
                        fontsize=11, bbox=dict(boxstyle='round', 
                        facecolor='wheat', alpha=0.7))
        
        axes[0].set_xlabel('生育期 (天)', fontsize=12)
        axes[0].set_ylabel('日需水量 (mm/d)', fontsize=12)
        axes[0].set_title('作物生育期日需水量', fontsize=14)
        axes[0].legend()
        axes[0].grid(True, alpha=0.3)
        
        # (b) 累计需水量
        axes[1].plot(days, ET_c_cumulative, 'g-', linewidth=2.5,
                    label='累计需水量')
        axes[1].fill_between(days, 0, ET_c_cumulative, alpha=0.3, color='green')
        
        # 灌水时刻（示意）
        irrigation_days = [20, 45, 70, 95]
        for irr_day in irrigation_days:
            idx = np.argmin(np.abs(days - irr_day))
            axes[1].plot(irr_day, ET_c_cumulative[idx], 'ro', markersize=12)
            axes[1].axvline(irr_day, color='r', linestyle='--', alpha=0.5)
        
        axes[1].set_xlabel('生育期 (天)', fontsize=12)
        axes[1].set_ylabel('累计需水量 (mm)', fontsize=12)
        axes[1].set_title('作物生育期累计需水量与灌水时刻', fontsize=14)
        axes[1].legend()
        axes[1].grid(True, alpha=0.3)
        
        plt.tight_layout()
        plt.savefig('crop_water_curve.png', dpi=300)
        plt.show()

# 示例1：作物需水量计算
print("="*60)
print("示例1：小麦需水量与灌溉制度")
print("="*60)

id_design = IrrigationDesign()

# 参数
ET0 = 4.5  # mm/d
Kc = 1.1   # 小麦旺盛生长期
P_eff = 80  # 有效降雨 (mm)
A = 1000   # 灌溉面积 (亩)
days = 120  # 生育期 (天)

print(f"小麦生育期参数:")
print(f"  参考腾发量 ET₀ = {ET0} mm/d")
print(f"  作物系数 K_c = {Kc}")
print(f"  有效降雨 P_eff = {P_eff} mm")
print(f"  灌溉面积 = {A} 亩")
print(f"  生育期 = {days} 天")

# 需水量
result = id_design.crop_water_requirement(ET0, Kc, P_eff, A, days)

print(f"\n需水量计算:")
print(f"  作物腾发量 ET_c = {result['ET_c']:.1f} mm")
print(f"  净灌溉定额 m_净 = {result['m_net']:.1f} mm")
print(f"  总需水量 = {result['V_total']:.0f} m³ = {result['V_total']/10000:.2f} 万m³")

# 灌溉制度
theta_fc = 0.28   # 田间持水率
theta_wp = 0.12   # 凋萎系数
theta_target = 0.20  # 灌前目标含水率
Z = 0.6  # 计划湿润层 (m)
p = 1400  # 土壤密度 (kg/m³)

schedule = id_design.irrigation_schedule(
    result['m_net'], theta_fc, theta_wp, theta_target, Z, p)

print(f"\n灌溉制度:")
print(f"  灌水次数 = {schedule['n']} 次")
print(f"  单次灌水定额 = {schedule['m_single']:.1f} mm = {schedule['m_single']*0.667:.1f} m³/亩")
print(f"  灌水周期 = {schedule['T']:.1f} 天")

# 毛灌溉定额
eta = 0.70  # 灌溉水利用系数（畦灌）
m_gross = result['m_net'] / eta

print(f"\n毛灌溉定额（η={eta}）:")
print(f"  m_毛 = {m_gross:.1f} mm = {m_gross*0.667:.1f} m³/亩")
print(f"  总供水量 = {m_gross*0.667*A/10000:.2f} 万m³")

# 示例2：喷灌设计
print("\n" + "="*60)
print("示例2：喷灌系统设计")
print("="*60)

R = 15  # 喷头射程 (m)
q = 2.5  # 喷头流量 (m³/h)

print(f"喷头参数:")
print(f"  射程 R = {R} m")
print(f"  流量 q = {q} m³/h")

# 喷头间距
S = id_design.sprinkler_design(R, S_factor=0.65)

print(f"\n设计结果:")
print(f"  喷头间距 S = {S:.1f} m")

# 喷灌强度
i_sprinkler = id_design.sprinkler_intensity(q, S)

print(f"  喷灌强度 i = {i_sprinkler:.2f} mm/h")

# 土壤入渗率检查
i_infiltration = 10  # mm/h（壤土）

if i_sprinkler < i_infiltration:
    print(f"  ✓ 喷灌强度 < 土壤入渗率（{i_infiltration}mm/h），无积水")
else:
    print(f"  ✗ 喷灌强度 > 土壤入渗率，可能积水")

# 示例3：滴灌设计
print("\n" + "="*60)
print("示例3：滴灌系统设计")
print("="*60)

A_row = 0.6  # 行距 (m)
L_row = 50   # 行长 (m)
q_dripper = 4  # 滴头流量 (L/h)
S_dripper = 0.4  # 滴头间距 (m)
S_lateral = 0.6  # 毛管间距（等于行距）

print(f"滴灌参数:")
print(f"  作物行距 = {A_row} m")
print(f"  行长 = {L_row} m")
print(f"  滴头流量 = {q_dripper} L/h")
print(f"  滴头间距 = {S_dripper} m")
print(f"  毛管间距 = {S_lateral} m")

drip_result = id_design.drip_irrigation_design(
    A_row, L_row, q_dripper, S_dripper, S_lateral)

print(f"\n设计结果:")
print(f"  每行滴头数 = {drip_result['n_drippers_per_row']} 个")
print(f"  每亩毛管数 = {drip_result['n_laterals_per_mu']:.1f} 条")
print(f"  每亩滴头数 = {drip_result['n_drippers_per_mu']:.0f} 个")
print(f"  每亩总流量 = {drip_result['Q_per_mu']:.1f} L/h")
print(f"  灌溉强度 = {drip_result['i_drip']:.2f} mm/h")

# 示例4：不同灌溉方式对比
print("\n" + "="*60)
print("示例4：灌溉方式效率与成本对比")
print("="*60)

print("绘制对比图...")
id_design.plot_irrigation_methods_comparison()

print("\n绘制作物需水曲线...")
id_design.plot_crop_water_curve()
```

---

## 三、排水工程

### 3.1 排水标准

**农田排水模数**：
$$q = \frac{h}{T} = \frac{24h}{T \times 86.4}$$ (m³/s·km²)

- $h$：排水深度 (mm)
- $T$：排水时间 (h)

### 3.2 排水方式

**明沟排水**：
- 适用：低洼地
- 占地：1-2%

**暗管排水**：
- 适用：盐碱地
- 埋深：1.0-1.5 m
- 间距：20-50 m

---

## 四、典型考题

### 【例题】灌溉制度设计

**题目**（25分）

某地小麦，ET_c=450mm，P_eff=100mm，田间持水率0.30，凋萎系数0.15，计划湿润层0.6m。设计灌溉制度。

**【解答】**（见Python示例）

---

**本章重点**：
- 作物需水量计算
- 灌溉制度（次数、定额、周期）
- 喷灌、滴灌设计
- 灌溉水利用系数
