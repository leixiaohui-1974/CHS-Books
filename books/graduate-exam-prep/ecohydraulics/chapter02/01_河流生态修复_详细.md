# 第2章：河流生态修复

**交叉领域**: 生态学 + 水力学 + 景观学  
**重要性**: ⭐⭐⭐⭐⭐

---

## 一、河流健康评价

### 1.1 评价指标体系

**水文指标**（IHA - Indicators of Hydrologic Alteration）：
1. 流量大小
2. 流量时间
3. 流量频率
4. 流量历时
5. 流量变化率

**生物指标**：
- 鱼类多样性（Shannon指数）
- 大型底栖动物
- 着生藻类

**物理栖息地指标**：
- 河床底质多样性
- 河流连通性
- 河岸带完整性

### 1.2 Shannon多样性指数

$$H' = -\sum_{i=1}^{S} p_i \ln p_i$$

- $S$：物种数
- $p_i$：第$i$种的个体比例

---

## 二、生态基流

### 2.1 计算方法

**Tennant法**（Montana法）：

| 生态状况 | 推荐流量（%年均流量） |
|---------|-------------------|
| 优良 | 60-100 |
| 满意 | 30-60 |
| 最小可接受 | 10-30 |
| 极差 | <10 |

**7Q10法**（美国）：
- 10年一遇的连续7天最小流量

**湿周法**：
$$Q_{eco} = Q(\text{湿周-流量曲线拐点})$$

### Python实现

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy.interpolate import interp1d

class RiverRestoration:
    """河流生态修复"""
    
    @staticmethod
    def shannon_diversity(abundances):
        """
        Shannon多样性指数
        
        H' = -Σ p_i ln(p_i)
        
        参数:
            abundances: 各物种个体数
        
        返回:
            多样性指数
        """
        total = np.sum(abundances)
        
        if total == 0:
            return 0
        
        p = abundances / total
        
        # 去除0值
        p = p[p > 0]
        
        H = -np.sum(p * np.log(p))
        
        return H
    
    @staticmethod
    def tennant_method(Q_mean, season='growing'):
        """
        Tennant生态流量法
        
        参数:
            Q_mean: 年平均流量 (m³/s)
            season: 'growing'(生长季) 或 'base'(非生长季)
        
        返回:
            各等级生态流量
        """
        if season == 'growing':
            levels = {
                '冲刷流量': (1.6, 2.0),
                '最优': (0.6, 1.0),
                '满意': (0.4, 0.6),
                '良好': (0.3, 0.4),
                '一般': (0.2, 0.3),
                '较差': (0.1, 0.2),
                '极差': (0.0, 0.1)
            }
        else:  # base flow
            levels = {
                '最优': (0.4, 0.6),
                '满意': (0.3, 0.4),
                '良好': (0.2, 0.3),
                '一般': (0.1, 0.2),
                '极差': (0.0, 0.1)
            }
        
        eco_flows = {}
        for level, (min_pct, max_pct) in levels.items():
            eco_flows[level] = (Q_mean * min_pct, Q_mean * max_pct)
        
        return eco_flows
    
    @staticmethod
    def wetted_perimeter_method(Q_range, WP_range):
        """
        湿周法
        
        找湿周-流量曲线的拐点
        
        参数:
            Q_range: 流量范围
            WP_range: 对应湿周
        
        返回:
            生态流量（拐点处）
        """
        # 计算斜率
        dWP = np.gradient(WP_range)
        dQ = np.gradient(Q_range)
        
        slope = dWP / dQ
        
        # 找斜率最大点
        idx_max = np.argmax(slope)
        
        Q_eco = Q_range[idx_max]
        WP_eco = WP_range[idx_max]
        
        return Q_eco, WP_eco, idx_max
    
    @staticmethod
    def habitat_suitability_index(velocity, depth, substrate_size):
        """
        栖息地适宜度指数（HSI）
        
        HSI = f(v) × f(h) × f(d50)
        
        参数:
            velocity: 流速 (m/s)
            depth: 水深 (m)
            substrate_size: 底质粒径 (mm)
        
        返回:
            HSI (0-1)
        """
        # 流速适宜度（以鲤鱼产卵为例）
        if velocity < 0.2:
            f_v = 0.3
        elif 0.2 <= velocity <= 0.8:
            f_v = 1.0
        elif 0.8 < velocity <= 1.5:
            f_v = 0.8 - 0.4 * (velocity - 0.8) / 0.7
        else:
            f_v = 0.4
        
        # 水深适宜度
        if depth < 0.3:
            f_h = depth / 0.3
        elif 0.3 <= depth <= 1.5:
            f_h = 1.0
        elif 1.5 < depth <= 3.0:
            f_h = 1.0 - 0.5 * (depth - 1.5) / 1.5
        else:
            f_h = 0.5
        
        # 底质适宜度（砾石最好）
        if substrate_size < 2:
            f_d = 0.3
        elif 2 <= substrate_size <= 64:
            f_d = 1.0
        elif 64 < substrate_size <= 256:
            f_d = 0.8
        else:
            f_d = 0.5
        
        HSI = f_v * f_h * f_d
        
        return HSI
    
    @staticmethod
    def plot_eco_flow_recommendation(Q_mean):
        """绘制生态流量推荐"""
        # 生长季
        eco_flows_grow = RiverRestoration.tennant_method(Q_mean, 'growing')
        
        fig, axes = plt.subplots(1, 2, figsize=(14, 6))
        
        # 生长季
        levels_grow = list(eco_flows_grow.keys())
        Q_mins_grow = [eco_flows_grow[l][0] for l in levels_grow]
        Q_maxs_grow = [eco_flows_grow[l][1] for l in levels_grow]
        
        y_pos = np.arange(len(levels_grow))
        
        for i in range(len(levels_grow)):
            axes[0].barh(i, Q_maxs_grow[i] - Q_mins_grow[i],
                        left=Q_mins_grow[i], height=0.6,
                        alpha=0.7)
        
        axes[0].set_yticks(y_pos)
        axes[0].set_yticklabels(levels_grow, fontsize=10)
        axes[0].set_xlabel('流量 (m³/s)', fontsize=12)
        axes[0].set_title(f'生长季生态流量 (年均={Q_mean} m³/s)', fontsize=14)
        axes[0].axvline(Q_mean, color='red', linestyle='--',
                       linewidth=2, label='年均流量')
        axes[0].legend()
        axes[0].grid(True, alpha=0.3, axis='x')
        
        # 湿周法示例
        Q_test = np.linspace(1, 100, 50)
        # 假设的湿周-流量关系（幂函数）
        WP_test = 5 * Q_test**0.4
        
        Q_eco, WP_eco, idx = RiverRestoration.wetted_perimeter_method(
            Q_test, WP_test
        )
        
        axes[1].plot(Q_test, WP_test, 'b-', linewidth=2)
        axes[1].plot(Q_eco, WP_eco, 'ro', markersize=12,
                    label=f'拐点: Q={Q_eco:.1f} m³/s')
        
        # 标注切线
        if idx > 0 and idx < len(Q_test) - 1:
            slope = (WP_test[idx+1] - WP_test[idx-1]) / (Q_test[idx+1] - Q_test[idx-1])
            Q_tangent = np.array([Q_test[idx] - 10, Q_test[idx] + 10])
            WP_tangent = WP_test[idx] + slope * (Q_tangent - Q_test[idx])
            axes[1].plot(Q_tangent, WP_tangent, 'r--', alpha=0.5)
        
        axes[1].set_xlabel('流量 (m³/s)', fontsize=12)
        axes[1].set_ylabel('湿周 (m)', fontsize=12)
        axes[1].set_title('湿周法', fontsize=14)
        axes[1].legend()
        axes[1].grid(True, alpha=0.3)
        
        plt.tight_layout()
        plt.savefig('eco_flow_recommendation.png', dpi=300)
        plt.show()

# 示例1：Shannon多样性
print("="*60)
print("示例1：生物多样性评价")
print("="*60)

# 两个河段的鱼类调查数据
abundances_A = np.array([50, 30, 20, 15, 10, 5, 3, 2])  # 8种鱼
abundances_B = np.array([80, 15, 10, 8, 2])  # 5种鱼

H_A = RiverRestoration.shannon_diversity(abundances_A)
H_B = RiverRestoration.shannon_diversity(abundances_B)

print(f"河段A:")
print(f"  物种数: {len(abundances_A)}")
print(f"  总个体数: {abundances_A.sum()}")
print(f"  Shannon指数: {H_A:.3f}")

print(f"\n河段B:")
print(f"  物种数: {len(abundances_B)}")
print(f"  总个体数: {abundances_B.sum()}")
print(f"  Shannon指数: {H_B:.3f}")

if H_A > H_B:
    print(f"\n结论: 河段A多样性更高")
else:
    print(f"\n结论: 河段B多样性更高")

# 示例2：生态流量计算
print("\n" + "="*60)
print("示例2：生态流量推荐")
print("="*60)

Q_mean = 50  # m³/s

eco_flows = RiverRestoration.tennant_method(Q_mean, 'growing')

print(f"河流年平均流量: {Q_mean} m³/s")
print(f"\n生长季生态流量推荐:")

for level, (Q_min, Q_max) in eco_flows.items():
    print(f"  {level:12s}: {Q_min:6.1f} - {Q_max:6.1f} m³/s "
          f"({Q_min/Q_mean*100:.0f}% - {Q_max/Q_mean*100:.0f}%)")

# 可视化
RiverRestoration.plot_eco_flow_recommendation(Q_mean)

# 示例3：栖息地适宜度
print("\n" + "="*60)
print("示例3：栖息地适宜度评价")
print("="*60)

# 三个断面的水力条件
sections = [
    {'name': 'A', 'v': 0.5, 'h': 0.8, 'd50': 32},
    {'name': 'B', 'v': 1.2, 'h': 0.4, 'd50': 8},
    {'name': 'C', 'v': 0.3, 'h': 2.0, 'd50': 128}
]

print(f"鱼类产卵栖息地评价（以鲤鱼为例）:")
print(f"{'断面':^6s} {'流速(m/s)':>10s} {'水深(m)':>10s} {'底质(mm)':>10s} {'HSI':>8s}")
print("-" * 48)

for sec in sections:
    HSI = RiverRestoration.habitat_suitability_index(
        sec['v'], sec['h'], sec['d50']
    )
    print(f"{sec['name']:^6s} {sec['v']:10.2f} {sec['h']:10.2f} "
          f"{sec['d50']:10.1f} {HSI:8.3f}")

# 找最适宜断面
HSI_values = [RiverRestoration.habitat_suitability_index(
    s['v'], s['h'], s['d50']) for s in sections]

best_idx = np.argmax(HSI_values)
print(f"\n最适宜产卵断面: {sections[best_idx]['name']} (HSI={HSI_values[best_idx]:.3f})")
```

---

## 三、河流连通性修复

### 3.1 鱼道设计

**类型**：
1. **竖缝式鱼道**：适合中小型鱼类
2. **池坝式鱼道**：分级消能
3. **鱼道涵管**：简易型

**设计要点**：
- 流速：0.6-1.2 m/s（依鱼种）
- 水深：≥0.6 m
- 休息池：间隔10-15 m

### 3.2 过鱼设施效率

**过鱼效率**：
$$E = \frac{N_{上行}}{N_{尝试}} \times 100\%$$

目标：E > 80%

---

## 四、典型修复措施

### 4.1 河道形态修复

- 恢复河流弯曲度
- 增加深潭-浅滩序列
- 设置人工鱼礁

### 4.2 河岸带修复

- 植被缓冲带（宽度≥30m）
- 生物护岸
- 湿地恢复

---

**本章重点**：
- 生态流量计算
- 栖息地评价
- 河流健康评价
- 生态修复措施
