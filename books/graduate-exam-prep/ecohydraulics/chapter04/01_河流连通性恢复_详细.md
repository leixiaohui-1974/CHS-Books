# 第4章：河流连通性恢复工程

**目标**: 恢复河流纵向、横向、垂向连通性  
**难度**: ⭐⭐⭐⭐⭐

---

## 一、河流连通性概念

### 1.1 四维连通性

**纵向连通性**：上下游连接  
**横向连通性**：河道与漫滩连接  
**垂向连通性**：地表水与地下水交换  
**时间连通性**：季节性、年际变化

### 1.2 连通性阻隔

**主要障碍**：
- 大坝、水闸
- 渠化河道
- 道路涵洞
- 堰坝

**生态影响**：
- 鱼类洄游受阻
- 泥沙淤积
- 栖息地破碎化
- 基因交流中断

---

## 二、鱼道设计（详细）

### 2.1 设计流程

**步骤1：确定目标鱼种**
- 鱼类体长、游泳能力
- 洄游时间、路径
- 种群规模

**步骤2：选择鱼道类型**
- 池坝式：通用性好
- 竖缝式：适应水位变化
- 自然式：生态性好
- 升鱼机：大坝高差

**步骤3：水力设计**
- 池间落差：0.15-0.30 m
- 过鱼孔流速：<0.8×鱼类持续游泳速度
- 池内流速：<0.3 m/s（休息区）
- 水深：>1.5×鱼体高

**步骤4：结构设计**
- 鱼道长度、宽度
- 池室尺寸
- 进出口设置
- 辅助措施（诱鱼流、照明）

### Python实现

```python
import numpy as np
import matplotlib.pyplot as plt

class RiverConnectivity:
    """河流连通性恢复"""
    
    def __init__(self, g=9.81):
        self.g = g
    
    def fishway_hydraulic_design(self, H_total, h_drop, b, fish_length, 
                                 fish_type='cyprinid'):
        """
        鱼道水力设计
        
        参数:
            H_total: 总落差 (m)
            h_drop: 设计池间落差 (m)
            b: 鱼道宽度 (m)
            fish_length: 目标鱼种体长 (cm)
            fish_type: 鱼类类型
        
        返回:
            设计参数dict
        """
        # 池数
        n_pools = int(np.ceil(H_total / h_drop))
        
        # 实际池间落差
        h_drop_actual = H_total / n_pools
        
        # 鱼类游泳能力
        L = fish_length / 100  # m
        
        if fish_type == 'cyprinid':  # 鲤科
            v_sustained = 0.5 * L**0.5  # 持续速度
            v_burst = 3.0 * L**0.5      # 突进速度
        elif fish_type == 'salmonid':  # 鲑科
            v_sustained = 0.8 * L**0.5
            v_burst = 4.0 * L**0.5
        else:
            v_sustained = 0.6 * L**0.5
            v_burst = 3.5 * L**0.5
        
        # 过鱼孔流速（<80%持续速度）
        v_orifice = 0.75 * v_sustained
        
        # 池长（经验：4-6倍宽度）
        L_pool = 5 * b
        
        # 总长度
        L_total = n_pools * L_pool
        
        # 坡度
        slope = H_total / L_total
        
        # 过鱼孔尺寸（假设流量0.2 m³/s）
        Q_design = 0.2
        A_orifice = Q_design / v_orifice
        
        # 矩形孔口（高×宽）
        h_orifice = 0.4  # m
        w_orifice = A_orifice / h_orifice
        
        # 水深要求
        h_min = 1.5 * fish_length / 100  # m
        
        results = {
            'n_pools': n_pools,
            'h_drop_actual': h_drop_actual,
            'v_sustained': v_sustained,
            'v_burst': v_burst,
            'v_orifice': v_orifice,
            'L_pool': L_pool,
            'L_total': L_total,
            'slope': slope,
            'w_orifice': w_orifice,
            'h_orifice': h_orifice,
            'h_min': h_min
        }
        
        return results
    
    def culvert_passability(self, d, L, i, Q, fish_speed):
        """
        涵洞通行性评估
        
        判断涵洞内流速是否超过鱼类游泳能力
        
        参数:
            d: 涵洞直径 (m)
            L: 涵洞长度 (m)
            i: 坡度
            Q: 流量 (m³/s)
            fish_speed: 鱼类持续游泳速度 (m/s)
        
        返回:
            passable: 是否可通行
            v_culvert: 涵洞流速 (m/s)
            time_required: 需要游泳时间 (s)
        """
        # 涵洞流速（简化为满流）
        A = np.pi * d**2 / 4
        v_culvert = Q / A
        
        # 判断
        passable = v_culvert < fish_speed
        
        # 所需时间
        if passable:
            time_required = L / (fish_speed - v_culvert)
        else:
            time_required = np.inf
        
        return {
            'passable': passable,
            'v_culvert': v_culvert,
            'time_required': time_required
        }
    
    def dam_removal_impact(self, H_dam, A_reservoir, L_river):
        """
        大坝拆除影响评估
        
        参数:
            H_dam: 坝高 (m)
            A_reservoir: 水库面积 (km²)
            L_river: 河段长度 (km)
        
        返回:
            影响评估dict
        """
        # 恢复河流长度
        L_restored = L_river  # km
        
        # 释放淤积泥沙（经验公式）
        V_sediment = A_reservoir * H_dam * 0.3  # m³（假设30%淤积）
        
        # 栖息地增加
        A_habitat_gained = A_reservoir  # km²
        
        # 连通性恢复指数（简化）
        CI = (L_restored / 10) * (1 + A_habitat_gained / 100)
        
        results = {
            'L_restored': L_restored,
            'V_sediment': V_sediment,
            'A_habitat_gained': A_habitat_gained,
            'connectivity_index': CI
        }
        
        return results
    
    def plot_fishway_3d_profile(self, n_pools, h_drop, L_pool, b):
        """绘制鱼道3D剖面"""
        from mpl_toolkits.mplot3d import Axes3D
        
        fig = plt.figure(figsize=(16, 8))
        ax = fig.add_subplot(111, projection='3d')
        
        # 底板
        for i in range(n_pools):
            # 池底四角
            x_corners = [i*L_pool, (i+1)*L_pool, (i+1)*L_pool, i*L_pool, i*L_pool]
            y_corners = [0, 0, b, b, 0]
            z_corners = [-i*h_drop]*5
            
            ax.plot(x_corners, y_corners, z_corners, 'k-', linewidth=2)
        
        # 隔墙
        for i in range(1, n_pools):
            x_wall = [i*L_pool, i*L_pool, i*L_pool, i*L_pool]
            y_wall = [0, b, b, 0]
            z_wall = [-(i-1)*h_drop, -(i-1)*h_drop, -i*h_drop, -i*h_drop]
            
            ax.plot_surface(
                np.array([[i*L_pool, i*L_pool], [i*L_pool, i*L_pool]]),
                np.array([[0, b], [0, b]]),
                np.array([[-(i-1)*h_drop, -(i-1)*h_drop], [-i*h_drop, -i*h_drop]]),
                alpha=0.5, color='gray')
        
        # 水面
        for i in range(n_pools):
            x_water = [i*L_pool, (i+1)*L_pool, (i+1)*L_pool, i*L_pool]
            y_water = [0, 0, b, b]
            z_water = [-(i-0.5)*h_drop]*4
            
            ax.plot_surface(
                np.array([[i*L_pool, (i+1)*L_pool], [i*L_pool, (i+1)*L_pool]]),
                np.array([[0, 0], [b, b]]),
                np.array([[-(i-0.5)*h_drop, -(i-0.5)*h_drop],
                         [-(i-0.5)*h_drop, -(i-0.5)*h_drop]]),
                alpha=0.3, color='blue')
        
        ax.set_xlabel('纵向距离 (m)', fontsize=12)
        ax.set_ylabel('横向宽度 (m)', fontsize=12)
        ax.set_zlabel('高程 (m)', fontsize=12)
        ax.set_title('鱼道三维结构', fontsize=14)
        
        plt.tight_layout()
        plt.savefig('fishway_3d_profile.png', dpi=300)
        plt.show()

# 示例1：鱼道设计
print("="*60)
print("示例1：池坝式鱼道完整设计")
print("="*60)

rc = RiverConnectivity()

# 设计条件
H_total = 8.0  # m（坝高）
h_drop = 0.25  # m（设计池间落差）
b = 3.0  # m（鱼道宽度）
fish_length = 40  # cm（草鱼）

print(f"设计条件:")
print(f"  总落差: {H_total} m")
print(f"  设计池间落差: {h_drop} m")
print(f"  鱼道宽度: {b} m")
print(f"  目标鱼种: 草鱼（体长{fish_length}cm）")

# 设计计算
design = rc.fishway_hydraulic_design(
    H_total, h_drop, b, fish_length, 'cyprinid')

print(f"\n设计结果:")
print(f"  池数: {design['n_pools']} 个")
print(f"  实际池间落差: {design['h_drop_actual']:.3f} m")
print(f"  鱼类持续游泳速度: {design['v_sustained']:.2f} m/s")
print(f"  鱼类突进速度: {design['v_burst']:.2f} m/s")
print(f"  过鱼孔流速: {design['v_orifice']:.2f} m/s")
print(f"  池长: {design['L_pool']:.1f} m")
print(f"  鱼道总长: {design['L_total']:.1f} m")
print(f"  鱼道坡度: {design['slope']*100:.2f}%")
print(f"  过鱼孔尺寸: {design['w_orifice']:.2f}m × {design['h_orifice']:.2f}m")
print(f"  最小水深: {design['h_min']:.2f} m")

# 设计检查
print(f"\n设计检查:")
check_items = [
    ('池间落差', design['h_drop_actual'], 0.15, 0.30, 'm'),
    ('过鱼孔流速/持续速度', design['v_orifice']/design['v_sustained'], 0.6, 0.8, ''),
    ('鱼道坡度', design['slope']*100, 3, 10, '%')
]

for name, value, min_val, max_val, unit in check_items:
    if min_val <= value <= max_val:
        status = '✓ 合格'
    else:
        status = '✗ 超标'
    print(f"  {name}: {value:.2f}{unit} [{min_val}-{max_val}] {status}")

# 示例2：涵洞通行性
print("\n" + "="*60)
print("示例2：道路涵洞鱼类通行性评估")
print("="*60)

d_culvert = 1.2  # m
L_culvert = 30  # m
i_culvert = 0.02  # 2%坡度
Q_culvert = 1.5  # m³/s
fish_speed = 1.0  # m/s（鲤鱼）

print(f"涵洞参数:")
print(f"  直径: {d_culvert} m")
print(f"  长度: {L_culvert} m")
print(f"  坡度: {i_culvert*100}%")
print(f"  流量: {Q_culvert} m³/s")
print(f"  目标鱼种持续游泳速度: {fish_speed} m/s")

passability = rc.culvert_passability(
    d_culvert, L_culvert, i_culvert, Q_culvert, fish_speed)

print(f"\n评估结果:")
print(f"  涵洞流速: {passability['v_culvert']:.2f} m/s")
print(f"  通行性: {'可通行' if passability['passable'] else '不可通行'}")

if passability['passable']:
    print(f"  通过时间: {passability['time_required']:.1f} 秒")
    
    # 改善建议
    if passability['time_required'] > 60:
        print(f"\n改善建议:")
        print(f"  - 通过时间较长，建议设置休息池")
else:
    print(f"\n改善建议:")
    print(f"  - 降低坡度")
    print(f"  - 增大涵洞直径")
    print(f"  - 设置鱼道绕行")

# 示例3：大坝拆除影响
print("\n" + "="*60)
print("示例3：大坝拆除生态效益评估")
print("="*60)

H_dam = 15  # m
A_reservoir = 5  # km²
L_river = 25  # km

print(f"大坝特征:")
print(f"  坝高: {H_dam} m")
print(f"  水库面积: {A_reservoir} km²")
print(f"  河段长度: {L_river} km")

impact = rc.dam_removal_impact(H_dam, A_reservoir, L_river)

print(f"\n拆除效益:")
print(f"  恢复河流长度: {impact['L_restored']} km")
print(f"  释放淤积泥沙: {impact['V_sediment']:.0f} m³")
print(f"  栖息地增加: {impact['A_habitat_gained']} km²")
print(f"  连通性恢复指数: {impact['connectivity_index']:.2f}")

# 绘制鱼道3D结构
print("\n绘制鱼道三维结构...")
rc.plot_fishway_3d_profile(
    design['n_pools'], design['h_drop_actual'], 
    design['L_pool'], b)
```

---

## 三、涵洞改造

### 3.1 现状问题

**典型涵洞**：
- 高流速（>2 m/s）
- 无水深
- 跌水

### 3.2 改造措施

**方案1：坡度调整**
- 降低坡度至<3%
- 设置休息池

**方案2：底部改造**
- 铺设天然河床材料
- 增加糙率，降低流速

**方案3：挡板设置**
- 横向挡板形成水池
- 类似池坝式鱼道

---

## 四、典型考题

### 【例题】鱼道设计计算

**题目**（30分）

某水闸，闸高H=12m，设计鱼道。目标鱼种为鲤鱼（体长35cm，持续游泳速度0.9m/s）。鱼道宽度b=2.5m。

求：
1) 推荐池间落差
2) 池数
3) 过鱼孔流速
4) 鱼道总长（池长取5m）

**【解答】**（见Python示例）

---

**本章重点**：
- 鱼道水力设计
- 涵洞通行性评估
- 大坝拆除影响
- 连通性指标
