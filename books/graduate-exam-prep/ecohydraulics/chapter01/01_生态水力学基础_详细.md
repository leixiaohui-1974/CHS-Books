# 第1章：生态水力学基础

**交叉学科**: 水力学 + 生态学  
**重要性**: ⭐⭐⭐⭐⭐

---

## 一、生态水力学概念

### 1.1 定义

研究**水流与水生生态系统**相互作用的科学

### 1.2 核心要素

```
水力学要素           生态学要素
  ↓                    ↓
流速、水深、底床  ←→  栖息地、鱼类、植被
  ↓                    ↓
     生态水力学过程
```

---

## 二、生态流量

### 2.1 定义

维持河流生态系统健康所需的**最小流量**

### 2.2 计算方法

**Tennant法**：
- 优良：60-100%年均流量
- 满意：30-60%
- 最低：10%

**湿周法**：
$$Q_{eco} = f(P_{湿周})$$

### Python实现

```python
import numpy as np
import matplotlib.pyplot as plt

class EcohydraulicFlow:
    """生态流量计算"""
    
    @staticmethod
    def tennant_method(Q_avg, level='good'):
        """
        Tennant法
        
        参数:
            Q_avg: 年平均流量 (m³/s)
            level: 等级 ('excellent', 'good', 'fair', 'minimum')
        
        返回:
            生态流量 (m³/s)
        """
        levels = {
            'excellent': (0.6, 1.0),
            'good': (0.3, 0.6),
            'fair': (0.1, 0.3),
            'minimum': (0.1, 0.1)
        }
        
        ratio = levels.get(level, (0.3, 0.6))
        Q_eco_min = Q_avg * ratio[0]
        Q_eco_max = Q_avg * ratio[1]
        
        return Q_eco_min, Q_eco_max
    
    @staticmethod
    def wetted_perimeter_method(Q_range, P_range):
        """
        湿周法
        
        寻找湿周-流量曲线拐点
        """
        # 计算曲率
        dP = np.gradient(P_range)
        dQ = np.gradient(Q_range)
        
        slope = dP / dQ
        
        # 找到斜率最大点（拐点）
        idx = np.argmax(slope)
        
        Q_eco = Q_range[idx]
        
        return Q_eco, idx
    
    @staticmethod
    def plot_eco_flow(Q_avg):
        """绘制生态流量需求"""
        levels = ['minimum', 'fair', 'good', 'excellent']
        Q_mins = []
        Q_maxs = []
        
        for level in levels:
            Q_min, Q_max = EcohydraulicFlow.tennant_method(Q_avg, level)
            Q_mins.append(Q_min)
            Q_maxs.append(Q_max)
        
        fig, ax = plt.subplots(figsize=(10, 6))
        
        x = np.arange(len(levels))
        width = 0.6
        
        # 绘制范围
        for i in range(len(levels)):
            ax.barh(i, Q_maxs[i] - Q_mins[i], 
                   left=Q_mins[i], height=width,
                   alpha=0.7, label=levels[i])
        
        ax.set_yticks(x)
        ax.set_yticklabels(levels)
        ax.set_xlabel('流量 (m³/s)', fontsize=12)
        ax.set_title(f'生态流量分级 (年均流量={Q_avg} m³/s)', fontsize=14)
        ax.axvline(Q_avg, color='red', linestyle='--', 
                  linewidth=2, label=f'年均流量')
        ax.grid(True, alpha=0.3, axis='x')
        ax.legend(loc='lower right')
        
        plt.tight_layout()
        plt.savefig('eco_flow_levels.png', dpi=300)
        plt.show()

# 示例
print("="*60)
print("生态流量计算")
print("="*60)

Q_avg = 50  # m³/s

for level in ['minimum', 'fair', 'good', 'excellent']:
    Q_min, Q_max = EcohydraulicFlow.tennant_method(Q_avg, level)
    print(f"{level:12s}: {Q_min:.1f} - {Q_max:.1f} m³/s")

# 可视化
EcohydraulicFlow.plot_eco_flow(Q_avg)
```

---

## 三、栖息地适宜度

### 3.1 水力学栖息地指数

**HSI (Habitat Suitability Index)**：

$$HSI = f(v) \times f(h) \times f(d_{50})$$

- $f(v)$：流速适宜度 (0-1)
- $f(h)$：水深适宜度 (0-1)
- $f(d_{50})$：底质适宜度 (0-1)

### 3.2 适宜度曲线

**鱼类**（例：鲤鱼产卵）：
- 最佳流速：0.3-0.8 m/s
- 最佳水深：0.5-1.5 m
- 最佳底质：砾石

---

## 四、典型应用

### 应用1：梯级水电站生态调度

**目标**：平衡发电与生态

**约束**：
$$Q(t) \geq Q_{eco}$$

### 应用2：河流生态修复

- 增设鱼道
- 恢复河流连通性
- 优化流量过程

---

**本章重点**：
- 生态流量概念与计算
- Tennant法
- 栖息地评价
