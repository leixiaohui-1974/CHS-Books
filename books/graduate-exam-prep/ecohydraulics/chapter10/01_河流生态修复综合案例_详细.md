# 第10章：河流生态修复综合案例

**学习时间**: 6小时  
**考试频率**: ⭐⭐⭐⭐⭐  
**难度**: ⭐⭐⭐⭐⭐

---

## 一、河流生态修复概述

### 1.1 退化原因

**自然因素**：
- 干旱、洪水等极端事件
- 泥沙淤积
- 自然侵蚀

**人为因素**：
1. **水文改变**：水坝、引水导致流量减少
2. **河道工程**：渠化、硬化、裁弯取直
3. **水质污染**：工业、农业、生活污水
4. **栖息地破坏**：采砂、围垦
5. **外来物种**：破坏生态平衡

### 1.2 修复目标

**生态目标**：
- 恢复河流连通性
- 增加栖息地多样性
- 恢复生物多样性
- 改善水质

**社会目标**：
- 防洪安全
- 景观美化
- 亲水空间
- 科普教育

---

## 二、案例1：城市河流生态修复

### 2.1 项目背景

**河流**：某城市内河，长5 km，平均宽15 m

**退化状况**：
- 两岸混凝土硬化
- 水流单一（梯形断面）
- 水质污染（COD 40 mg/L，氨氮 2.5 mg/L）
- 生物多样性低

**修复目标**：
- 恢复水生生物栖息地
- 改善水质至地表水Ⅲ类
- 提供亲水空间

### 2.2 修复方案

#### (1) 河道形态修复

**断面设计**：复式断面

```
       生态缓坡
      ／￣￣￣＼
     ／         ＼     
    ／  深槽    ＼
———              ———
    |          |
    |  主槽  |
    |          |
```

**设计参数**：
- 主槽宽度：$b_1 = 8$ m（洪水通道）
- 滩地宽度：$b_2 = 3$ m（两侧各）
- 主槽水深：$h_1 = 2.0$ m
- 滩地高程：$h_2 = 1.0$ m
- 边坡：1:3（水平:竖直）

**流量计算**（分段求和）：

主槽：$Q_1 = \frac{1}{n_1}A_1 R_1^{2/3} i^{1/2}$

滩地：$Q_2 = 2 \times \frac{1}{n_2}A_2 R_2^{2/3} i^{1/2}$

总流量：$Q = Q_1 + Q_2$

**例题1**：设计流量$Q_design = 30$ m³/s，坡度$i = 0.0005$，
主槽$n_1 = 0.025$，滩地$n_2 = 0.035$（植被）。
验证断面是否满足。

**解**：

主槽（水深$h_1 = 2.0$ m）：
$$A_1 = 8 \times 2 = 16 \text{ m}^2$$
$$P_1 = 8 + 2 \times 2 = 12 \text{ m}$$
$$R_1 = 16/12 = 1.33 \text{ m}$$
$$Q_1 = \frac{1}{0.025} \times 16 \times 1.33^{2/3} \times 0.0005^{1/2} = 18.5 \text{ m}^3/\text{s}$$

滩地（水深$\Delta h = 1.0$ m）：
$$A_2 = 3 \times 1 = 3 \text{ m}^2$$
$$P_2 = 3 + 1\sqrt{1+3^2} = 3 + 3.16 = 6.16 \text{ m}$$
$$R_2 = 3/6.16 = 0.487 \text{ m}$$
$$Q_2 = 2 \times \frac{1}{0.035} \times 3 \times 0.487^{2/3} \times 0.0005^{1/2} = 2.8 \text{ m}^3/\text{s}$$

总流量：
$$Q = 18.5 + 2.8 = 21.3 \text{ m}^3/\text{s} < 30 \text{ m}^3/\text{s}$$

**结论**：需加深主槽或增加宽度

---

#### (2) 河岸带修复

**植被配置**（由水到陆）：

| 区域 | 水深范围 | 植物类型 | 代表种 |
|------|----------|----------|--------|
| 挺水区 | 0-0.5 m | 挺水植物 | 芦苇、香蒲、菖蒲 |
| 浅水区 | 0.5-1.0 m | 沉水植物 | 苦草、黑藻 |
| 浮叶区 | 0.5-1.5 m | 浮叶植物 | 睡莲 |
| 滩地 | >洪水位 | 灌木+草本 | 柳树、狗牙根 |

**生态护坡**：
- 植生毯：椰丝+草籽，固定在1:3边坡
- 生态袋：装填土壤+植物，堆砌
- 木桩+柳枝：传统生态工法

**抗冲稳定性**：
$$\tau = \gamma R i \leq \tau_{allow}$$

其中：
- $\gamma = 9800$ N/m³
- $R$：水力半径
- $i$：坡度
- $\tau_{allow}$：植被+土壤允许切应力（50-100 Pa）

---

#### (3) 水质净化

**人工湿地**：
- 面积：1000 m²
- 类型：表面流湿地
- 植物：芦苇、美人蕉
- 停留时间：3天

**去除率模型**：
$$C_{out} = C_{in} \cdot e^{-k \cdot HRT}$$

其中：
- $k$：去除速率常数（COD：0.5 d⁻¹，NH₃-N：0.3 d⁻¹）
- $HRT$：水力停留时间（天）

**例题2**：入水COD = 40 mg/L，氨氮 = 2.5 mg/L，HRT = 3天。
计算出水浓度。

**解**：

COD：
$$C_{out,COD} = 40 \times e^{-0.5 \times 3} = 40 \times 0.223 = 8.9 \text{ mg/L}$$

氨氮：
$$C_{out,NH_3} = 2.5 \times e^{-0.3 \times 3} = 2.5 \times 0.407 = 1.0 \text{ mg/L}$$

**对比标准**（地表水Ⅲ类）：
- COD ≤ 20 mg/L ✓
- 氨氮 ≤ 1.0 mg/L ✓

---

#### (4) 鱼类栖息地营造

**深潭-浅滩序列**：
- 深潭：水深1.5-2.0 m，鱼类越冬、避暑
- 浅滩：水深0.3-0.6 m，产卵、觅食
- 间距：50-100 m

**鱼巢**：
- 沉木鱼巢：树枝捆扎，沉入深潭
- 石笼鱼巢：乱石堆砌，孔隙丰富
- 人工鱼礁：混凝土预制件

**流速多样性**：
$$\text{Froude Number: } Fr = \frac{v}{\sqrt{gh}}$$

- 急流区（$Fr > 0.5$）：5%
- 中流区（$0.2 < Fr < 0.5$）：70%
- 缓流区（$Fr < 0.2$）：25%

---

### 2.3 效果评估

**监测指标**：

1. **水文指标**：
   - 流量：日均、最大、最小
   - 流速：断面测量

2. **水质指标**：
   - DO、COD、氨氮、TP、TN
   - 频率：枯水期每周

3. **生物指标**：
   - 鱼类：种类、数量、Shannon-Wiener指数
   - 底栖动物：EPT（蜉蝣、石蛾、石蝇）分类单元数

**Shannon-Wiener指数**：
$$H' = -\sum_{i=1}^S p_i \ln p_i$$

其中$p_i = n_i / N$（第$i$种比例）

**例题3**：某河段鱼类调查，共捕获100尾：
- 鲫鱼：40尾
- 鲤鱼：30尾
- 草鱼：20尾
- 其他：10尾

计算多样性指数。

**解**：
$$p_1 = 0.4, p_2 = 0.3, p_3 = 0.2, p_4 = 0.1$$

$$H' = -(0.4\ln0.4 + 0.3\ln0.3 + 0.2\ln0.2 + 0.1\ln0.1)$$
$$= -(-0.366 - 0.361 - 0.322 - 0.230) = 1.28$$

**评价**：$H' > 1$，多样性中等

---

## 三、案例2：水坝鱼道设计

### 3.1 背景

**工程**：某水电站，坝高$H = 15$ m

**问题**：阻断洄游鱼类通道

**目标鱼种**：
- 草鱼、鲢鱼、鳙鱼（上行能力中等）
- 爬流速度：1.5 m/s（持续），2.5 m/s（冲刺）

### 3.2 鱼道类型选择

| 类型 | 原理 | 适用 | 缺点 |
|------|------|------|------|
| 竖缝式 | 竖缝消能 | 通用 | 占地大 |
| 池堰式 | 池室休息 | 中小鱼 | 水头损失大 |
| 仿自然 | 模拟天然河道 | 多种鱼类 | 造价高 |
| 升鱼机 | 机械提升 | 高坝 | 维护成本高 |

**选择**：竖缝式鱼道（适应性广，运行稳定）

### 3.3 竖缝式鱼道设计

**设计参数**：
- 鱼道坡度：$i_f = 1:10$（10%）
- 池室长度：$L = 3.0$ m
- 池室宽度：$B = 2.0$ m
- 竖缝宽度：$b = 0.4$ m
- 池室水深：$h = 1.5$ m

**水头差（单池）**：
$$\Delta H = L \cdot i_f = 3.0 \times 0.1 = 0.3 \text{ m}$$

**池室数量**：
$$N = \frac{H_{total}}{\Delta H} = \frac{15}{0.3} = 50$$

**竖缝流速**：
$$v = C \sqrt{2g \Delta H}$$

取$C = 0.6$（流量系数）：
$$v = 0.6 \times \sqrt{2 \times 9.81 \times 0.3} = 1.46 \text{ m/s}$$

**验证**：$v = 1.46$ m/s < 爬流速度1.5 m/s ✓

**流量**：
$$Q_f = b \cdot h \cdot v = 0.4 \times 1.5 \times 1.46 = 0.88 \text{ m}^3/\text{s}$$

**池内流速**（休息区）：
$$v_{pool} = \frac{Q_f}{A_{pool}} = \frac{0.88}{2 \times 1.5} = 0.29 \text{ m/s}$$

$v_{pool} < 0.5$ m/s ✓（鱼类可休息）

---

**鱼道总长**：
$$L_{total} = N \times L = 50 \times 3 = 150 \text{ m}$$

**占地**：$150 \times 2 = 300$ m²

---

### 3.4 鱼道运行管理

**诱鱼流量**：
入口设置诱鱼水流，流量为主河道的2-5%

**监测**：
- 视频监控：记录过鱼数量、种类
- 水质监测：DO > 5 mg/L
- 水温监测：15-25°C（适宜期）

**季节性运行**：
- 3-6月（产卵期）：全天开启
- 7-10月：间歇运行
- 11-2月：关闭（鱼类不活跃）

---

## 四、案例3：河流生态调度

### 4.1 背景

**流域**：某水库下游河段，长50 km

**现状**：
- 水库建成后，下游流量减少60%
- 洪峰削减，泥沙淤积
- 河漫滩植被旱生化

**生态需求**：
- 常态流量：$Q_{base} = 20$ m³/s
- 产卵流量：$Q_{spawn} = 50$ m³/s（4-5月，持续7天）
- 生态洪峰：$Q_{flood} = 100$ m³/s（每年1次，持续3天）

### 4.2 调度方案

**年内流量过程**：

| 月份 | 流量目标 | 生态目标 |
|------|---------|---------|
| 1-3月 | 20 m³/s | 基础流量（越冬） |
| 4月 | 50 m³/s（7天） | 鱼类产卵刺激 |
| 5-6月 | 30 m³/s | 幼鱼生长 |
| 7-8月 | 100 m³/s（3天） | 生态洪峰（冲刷） |
| 9-12月 | 20 m³/s | 恢复基础流量 |

**优化模型**：

目标函数（多目标）：
$$\max \left\{ f_1(发电效益), f_2(生态效益) \right\}$$

约束条件：
1. 水量平衡：$V_{t+1} = V_t + (Q_{in,t} - Q_{out,t}) \Delta t$
2. 库容约束：$V_{min} \leq V_t \leq V_{max}$
3. 生态流量：$Q_{out,t} \geq Q_{eco,t}$
4. 出力约束：$P_{min} \leq P_t \leq P_{max}$

**求解方法**：
- 遗传算法（GA）
- 粒子群优化（PSO）
- 多目标进化算法（NSGA-II）

---

### 4.3 效益分析

**生态效益**：

1. **栖息地改善**：
   - WUA增加40%
   - 鱼类种类从5种恢复到12种

2. **水质改善**：
   - DO提高至7.5 mg/L
   - 透明度增加30%

3. **河道冲刷**：
   - 生态洪峰冲刷淤积泥沙3000 m³
   - 河床多样性恢复

**经济效益**：

发电损失：
$$\Delta E = \sum_{t=1}^T (P_{before} - P_{after}) \cdot \Delta t$$

生态价值（旅游、渔业）：
$$V_{eco} = 200 \text{ 万元/年}$$

**投入产出比**：
$$\frac{V_{eco}}{\Delta E + C_{operation}} = 1.5$$

（生态价值大于损失）

---

## 五、Python实现

```python
import numpy as np
import matplotlib.pyplot as plt
from scipy.optimize import minimize

class RiverRestorationTool:
    """河流生态修复综合工具"""
    
    def __init__(self, g=9.81):
        self.g = g
    
    @staticmethod
    def compound_channel_discharge(b1, h1, n1, b2, h2, n2, i):
        """
        复式断面流量计算
        
        参数:
            b1: 主槽宽度 (m)
            h1: 主槽水深 (m)
            n1: 主槽糙率
            b2: 滩地宽度 (m，单侧)
            h2: 滩地水深 (m)
            n2: 滩地糙率
            i: 河床坡度
        
        返回:
            Q: 总流量 (m³/s)
            Q1: 主槽流量
            Q2: 滩地流量（双侧）
        """
        # 主槽
        A1 = b1 * h1
        P1 = b1 + 2 * h1
        R1 = A1 / P1
        Q1 = (1 / n1) * A1 * R1**(2/3) * i**0.5
        
        # 滩地（简化为矩形）
        if h2 > 0:
            A2 = b2 * h2
            P2 = b2 + h2  # 一侧
            R2 = A2 / P2
            Q2 = 2 * (1 / n2) * A2 * R2**(2/3) * i**0.5
        else:
            Q2 = 0
        
        Q = Q1 + Q2
        
        return Q, Q1, Q2
    
    @staticmethod
    def wetland_removal_model(C_in, k, HRT):
        """
        湿地污染物去除模型
        
        参数:
            C_in: 进水浓度 (mg/L)
            k: 去除速率常数 (1/d)
            HRT: 水力停留时间 (d)
        
        返回:
            C_out: 出水浓度 (mg/L)
            removal_rate: 去除率 (%)
        """
        C_out = C_in * np.exp(-k * HRT)
        removal_rate = (1 - C_out / C_in) * 100
        
        return C_out, removal_rate
    
    @staticmethod
    def shannon_diversity_index(abundance):
        """
        Shannon-Wiener多样性指数
        
        参数:
            abundance: 各物种丰度列表
        
        返回:
            H: Shannon指数
            evenness: 均匀度
        """
        abundance = np.array(abundance)
        N = abundance.sum()
        
        if N == 0:
            return 0, 0
        
        p = abundance / N
        p = p[p > 0]  # 去除0
        
        H = -np.sum(p * np.log(p))
        
        S = len(p)
        H_max = np.log(S)
        evenness = H / H_max if H_max > 0 else 0
        
        return H, evenness
    
    @staticmethod
    def fishway_design(H_total, i_fishway, L_pool, b_slot, h_pool, C=0.6, g=9.81):
        """
        竖缝式鱼道设计
        
        参数:
            H_total: 总水头 (m)
            i_fishway: 鱼道坡度
            L_pool: 池室长度 (m)
            b_slot: 竖缝宽度 (m)
            h_pool: 池室水深 (m)
            C: 流量系数
            g: 重力加速度 (m/s²)
        
        返回:
            N: 池室数量
            v_slot: 竖缝流速 (m/s)
            Q_fishway: 鱼道流量 (m³/s)
            L_total: 鱼道总长 (m)
        """
        # 单池水头差
        delta_H = L_pool * i_fishway
        
        # 池室数量
        N = int(np.ceil(H_total / delta_H))
        
        # 竖缝流速
        v_slot = C * np.sqrt(2 * g * delta_H)
        
        # 鱼道流量
        Q_fishway = b_slot * h_pool * v_slot
        
        # 鱼道总长
        L_total = N * L_pool
        
        return N, v_slot, Q_fishway, L_total
    
    @staticmethod
    def ecological_dispatch_optimization(V0, Q_in, Q_eco_series, V_min, V_max, eta=0.9):
        """
        水库生态调度优化（简化）
        
        参数:
            V0: 初始库容 (m³)
            Q_in: 入库流量序列 (m³/s)
            Q_eco_series: 生态流量需求序列 (m³/s)
            V_min, V_max: 库容约束 (m³)
            eta: 发电效率
        
        返回:
            Q_out: 优化后的泄流量序列 (m³/s)
            V: 库容过程 (m³)
            penalty: 生态流量不满足惩罚
        """
        n_steps = len(Q_in)
        dt = 86400  # 1天
        
        # 初始化
        Q_out = np.zeros(n_steps)
        V = np.zeros(n_steps + 1)
        V[0] = V0
        
        penalty = 0
        
        for t in range(n_steps):
            # 尝试满足生态流量
            Q_out_trial = Q_eco_series[t]
            
            # 水量平衡
            V_new = V[t] + (Q_in[t] - Q_out_trial) * dt
            
            # 库容约束
            if V_new > V_max:
                # 弃水
                Q_out_trial += (V_new - V_max) / dt
                V_new = V_max
            elif V_new < V_min:
                # 库容不足，减少泄流
                Q_out_trial = max(0, Q_in[t] + (V[t] - V_min) / dt)
                V_new = V_min
                # 惩罚
                penalty += (Q_eco_series[t] - Q_out_trial) ** 2
            
            Q_out[t] = Q_out_trial
            V[t+1] = V_new
        
        return Q_out, V[:-1], penalty
    
    @staticmethod
    def plot_restoration_results():
        """可视化修复效果"""
        fig = plt.figure(figsize=(16, 10))
        
        # 1. 复式断面
        ax1 = plt.subplot(2, 3, 1)
        
        # 绘制断面
        b1, h1 = 8, 2.0
        b2, h2 = 3, 1.0
        
        x = [-b2-b1/2, -b1/2, -b1/2, b1/2, b1/2, b1/2+b2]
        y = [0, 0, -h1, -h1, 0, 0]
        
        ax1.fill(x, y, color='lightblue', alpha=0.5, edgecolor='black', linewidth=2)
        ax1.plot(x, y, 'k-', linewidth=2)
        
        # 水位
        x_water = [-b2-b1/2, b1/2+b2]
        y_water = [-h2, -h2]
        ax1.plot(x_water, y_water, 'b--', linewidth=2, label='设计水位')
        
        ax1.axhline(0, color='brown', linestyle=':', linewidth=1.5, label='地面')
        
        ax1.set_xlabel('宽度 (m)', fontsize=11)
        ax1.set_ylabel('高程 (m)', fontsize=11)
        ax1.set_title('复式断面设计', fontsize=12, fontweight='bold')
        ax1.legend()
        ax1.grid(True, alpha=0.3)
        ax1.axis('equal')
        ax1.set_ylim(-2.5, 0.5)
        
        # 2. 湿地去除效果
        ax2 = plt.subplot(2, 3, 2)
        
        HRT_range = np.linspace(0, 10, 100)
        
        C_in_COD = 40
        k_COD = 0.5
        C_out_COD = C_in_COD * np.exp(-k_COD * HRT_range)
        
        C_in_NH3 = 2.5
        k_NH3 = 0.3
        C_out_NH3 = C_in_NH3 * np.exp(-k_NH3 * HRT_range)
        
        ax2.plot(HRT_range, C_out_COD, linewidth=2, label='COD')
        ax2.plot(HRT_range, C_out_NH3, linewidth=2, label='氨氮')
        
        ax2.axhline(20, color='red', linestyle='--', linewidth=1.5, label='Ⅲ类标准（COD）')
        ax2.axhline(1.0, color='orange', linestyle='--', linewidth=1.5, label='Ⅲ类标准（NH₃-N）')
        
        ax2.set_xlabel('水力停留时间HRT (天)', fontsize=11)
        ax2.set_ylabel('出水浓度 (mg/L)', fontsize=11)
        ax2.set_title('人工湿地去除效果', fontsize=12, fontweight='bold')
        ax2.legend()
        ax2.grid(True, alpha=0.3)
        
        # 3. 生物多样性对比
        ax3 = plt.subplot(2, 3, 3)
        
        categories = ['修复前', '修复后']
        H_values = [0.85, 1.65]
        S_values = [5, 12]
        
        x_pos = np.arange(len(categories))
        width = 0.35
        
        bars1 = ax3.bar(x_pos - width/2, H_values, width, label="Shannon指数", color='lightblue', edgecolor='black')
        ax3_twin = ax3.twinx()
        bars2 = ax3_twin.bar(x_pos + width/2, S_values, width, label="物种数", color='lightcoral', edgecolor='black')
        
        ax3.set_xlabel('时期', fontsize=11)
        ax3.set_ylabel("Shannon指数 H'", fontsize=11, color='blue')
        ax3_twin.set_ylabel('物种数 S', fontsize=11, color='red')
        ax3.set_title('生物多样性改善', fontsize=12, fontweight='bold')
        ax3.set_xticks(x_pos)
        ax3.set_xticklabels(categories)
        ax3.grid(True, alpha=0.3, axis='y')
        
        # 图例
        lines1, labels1 = ax3.get_legend_handles_labels()
        lines2, labels2 = ax3_twin.get_legend_handles_labels()
        ax3.legend(lines1 + lines2, labels1 + labels2, loc='upper left')
        
        # 4. 鱼道纵剖面
        ax4 = plt.subplot(2, 3, 4)
        
        N = 50
        L_pool = 3.0
        delta_H = 0.3
        
        x_fishway = np.arange(0, N+1) * L_pool
        y_fishway = -np.arange(0, N+1) * delta_H
        
        ax4.plot(x_fishway, y_fishway, 'b-', linewidth=2, label='鱼道坡度')
        
        # 绘制池室
        for i in range(0, N, 5):
            xi = i * L_pool
            yi = -i * delta_H
            ax4.plot([xi, xi], [yi, yi-1], 'k-', linewidth=1)
        
        ax4.set_xlabel('水平距离 (m)', fontsize=11)
        ax4.set_ylabel('高程 (m)', fontsize=11)
        ax4.set_title('竖缝式鱼道纵剖面', fontsize=12, fontweight='bold')
        ax4.legend()
        ax4.grid(True, alpha=0.3)
        
        # 5. 生态调度
        ax5 = plt.subplot(2, 3, 5)
        
        np.random.seed(42)
        days = 365
        t = np.arange(days)
        
        # 模拟入库流量
        Q_in = 50 + 30*np.sin(2*np.pi*t/365) + np.random.randn(days)*10
        Q_in = np.maximum(Q_in, 10)
        
        # 生态流量需求
        Q_eco_series = np.full(days, 20.0)
        Q_eco_series[90:120] = 50  # 4-5月产卵期
        Q_eco_series[180:183] = 100  # 7月生态洪峰
        
        # 优化调度
        V0 = 5e8
        V_min, V_max = 2e8, 1e9
        
        Q_out, V, _ = RiverRestorationTool.ecological_dispatch_optimization(
            V0, Q_in, Q_eco_series, V_min, V_max
        )
        
        ax5.plot(t, Q_in, linewidth=1, alpha=0.5, label='入库流量', color='blue')
        ax5.plot(t, Q_out, linewidth=2, label='泄流量', color='red')
        ax5.plot(t, Q_eco_series, linewidth=2, linestyle='--', label='生态流量需求', color='green')
        
        ax5.set_xlabel('时间 (天)', fontsize=11)
        ax5.set_ylabel('流量 (m³/s)', fontsize=11)
        ax5.set_title('水库生态调度过程', fontsize=12, fontweight='bold')
        ax5.legend()
        ax5.grid(True, alpha=0.3)
        
        # 6. WUA-Q曲线
        ax6 = plt.subplot(2, 3, 6)
        
        Q_range = np.linspace(5, 100, 50)
        WUA_before = 50 + 20 * np.log(Q_range)  # 修复前
        WUA_after = 80 + 40 * np.log(Q_range)   # 修复后
        
        ax6.plot(Q_range, WUA_before, linewidth=2, linestyle='--', label='修复前', color='gray')
        ax6.plot(Q_range, WUA_after, linewidth=2, label='修复后', color='green')
        
        ax6.fill_between(Q_range, WUA_before, WUA_after, alpha=0.3, color='lightgreen',
                        label='改善区域')
        
        ax6.set_xlabel('流量 (m³/s)', fontsize=11)
        ax6.set_ylabel('WUA (m²)', fontsize=11)
        ax6.set_title('栖息地适宜性改善', fontsize=12, fontweight='bold')
        ax6.legend()
        ax6.grid(True, alpha=0.3)
        
        plt.tight_layout()
        plt.savefig('river_restoration_comprehensive.png', dpi=300)
        plt.show()

# 示例使用
print("="*60)
print("河流生态修复综合案例")
print("="*60)

rrt = RiverRestorationTool()

# 1. 复式断面流量
print("\n1. 复式断面流量计算")
b1, h1, n1 = 8, 2.0, 0.025
b2, h2, n2 = 3, 1.0, 0.035
i = 0.0005

Q, Q1, Q2 = rrt.compound_channel_discharge(b1, h1, n1, b2, h2, n2, i)
print(f"  主槽: 宽{b1}m × 深{h1}m, n={n1}")
print(f"  滩地: 宽{b2}m × 深{h2}m, n={n2} (双侧)")
print(f"  坡度i = {i}")
print(f"  主槽流量Q₁ = {Q1:.2f} m³/s")
print(f"  滩地流量Q₂ = {Q2:.2f} m³/s")
print(f"  总流量Q = {Q:.2f} m³/s")

# 2. 湿地去除效果
print("\n" + "="*60)
print("2. 人工湿地水质净化")

C_in_COD, k_COD, HRT = 40, 0.5, 3
C_out_COD, removal_COD = rrt.wetland_removal_model(C_in_COD, k_COD, HRT)

C_in_NH3, k_NH3 = 2.5, 0.3
C_out_NH3, removal_NH3 = rrt.wetland_removal_model(C_in_NH3, k_NH3, HRT)

print(f"  COD: {C_in_COD} mg/L → {C_out_COD:.2f} mg/L (去除率{removal_COD:.1f}%)")
print(f"  氨氮: {C_in_NH3} mg/L → {C_out_NH3:.2f} mg/L (去除率{removal_NH3:.1f}%)")
print(f"  地表水Ⅲ类标准: COD ≤ 20 mg/L, 氨氮 ≤ 1.0 mg/L")
print(f"  达标情况: COD {'✓' if C_out_COD <= 20 else '✗'}, 氨氮 {'✓' if C_out_NH3 <= 1.0 else '✗'}")

# 3. 生物多样性
print("\n" + "="*60)
print("3. 生物多样性评估")

abundance_before = [40, 30, 20, 10]
abundance_after = [15, 12, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1]

H_before, E_before = rrt.shannon_diversity_index(abundance_before)
H_after, E_after = rrt.shannon_diversity_index(abundance_after)

print(f"  修复前: 4种, H' = {H_before:.3f}, 均匀度 = {E_before:.3f}")
print(f"  修复后: 12种, H' = {H_after:.3f}, 均匀度 = {E_after:.3f}")
print(f"  改善: ΔH' = +{H_after - H_before:.3f} (+{(H_after/H_before-1)*100:.1f}%)")

# 4. 鱼道设计
print("\n" + "="*60)
print("4. 竖缝式鱼道设计")

H_total = 15
i_fishway = 0.1
L_pool = 3.0
b_slot = 0.4
h_pool = 1.5

N, v_slot, Q_fishway, L_total = rrt.fishway_design(
    H_total, i_fishway, L_pool, b_slot, h_pool
)

print(f"  总水头: {H_total} m")
print(f"  鱼道坡度: 1:{1/i_fishway:.0f}")
print(f"  池室数量: {N}")
print(f"  竖缝流速: {v_slot:.2f} m/s")
print(f"  鱼道流量: {Q_fishway:.2f} m³/s")
print(f"  鱼道总长: {L_total:.0f} m")
print(f"  爬流速度要求: ≤ 1.5 m/s → {'✓ 满足' if v_slot <= 1.5 else '✗ 不满足'}")

# 可视化
print("\n绘制河流生态修复综合可视化...")
rrt.plot_restoration_results()
```

---

## 六、本章要点

### 修复技术总结

| 修复类型 | 技术措施 | 效果 |
|----------|---------|------|
| 河道形态 | 复式断面、深潭浅滩 | 流速多样性+30% |
| 河岸带 | 植生毯、生态袋 | 植被覆盖+60% |
| 水质净化 | 人工湿地 | COD去除80% |
| 栖息地 | 鱼巢、鱼礁 | WUA+40% |
| 连通性 | 鱼道 | 洄游通道恢复 |
| 生态调度 | 流量过程模拟 | 生物多样性+150% |

### 核心公式

1. **复式断面流量**：$Q = Q_1 + Q_2$

2. **湿地去除模型**：$C_{out} = C_{in} \cdot e^{-k \cdot HRT}$

3. **Shannon指数**：$H' = -\sum p_i \ln p_i$

4. **鱼道竖缝流速**：$v = C\sqrt{2g\Delta H}$

5. **水量平衡**：$V_{t+1} = V_t + (Q_{in} - Q_{out})\Delta t$

---

**本章重点**：
- 城市河流生态修复（复式断面、植被配置、湿地净化）
- 鱼道设计（竖缝式、池堰式、仿自然）
- 水库生态调度（流量过程、多目标优化）
- 效果评估（水文、水质、生物指标）
- 综合Python工具开发

**课程总结**：本书系统介绍了生态水力学的基础理论、计算方法和工程应用，涵盖生态流量计算、栖息地评估、鱼类洄游、河流生态修复等核心内容，为河流生态保护与恢复提供科学依据和技术支撑。
