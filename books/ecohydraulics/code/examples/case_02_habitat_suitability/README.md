# 案例2：鱼类栖息地适宜性评价

## 案例概述

**难度等级**: ⭐⭐ 基础  
**工程背景**: 河流生态修复中的栖息地质量评估  
**核心理论**: PHABSIM方法、HSI、WUA计算

## 问题描述

某河段进行生态修复，需评估不同流量下鱼类栖息地质量，确定最优生态流量范围。

### 基本参数

- 目标鱼类: 鲤鱼（成鱼和幼鱼）
- 河段长度: L = 1000 m
- 河道宽度: b = 15 m
- 河床坡度: S0 = 0.0008
- Manning糙率: n = 0.030
- 边坡系数: m = 2.0
- 流量范围: 2-20 m³/s

## 计算目标

1. 绘制鱼类适宜性曲线
2. 计算不同流量下的WUA（加权可利用面积）
3. 找到最优生态流量
4. 评估栖息地质量等级

## 涉及理论

### 1. 栖息地适宜性指数（HSI）

栖息地适宜性指数表示生物对某一环境因子的偏好程度。

**数值范围**: 0-1
- 0: 完全不适宜
- 1: 最适宜

**主要因子**:
- 水深（Depth）
- 流速（Velocity）
- 底质（Substrate）
- 水温（Temperature）

**适宜性曲线**:
```python
SI = f(环境因子值)
```

### 2. 综合适宜性指数（CSI）

综合多个因子的适宜性。

**公式**:
```python
CSI = HSI_depth × HSI_velocity × HSI_substrate × ...
```

使用乘积形式，因为任何一个因子不适宜都会显著降低总体适宜性。

### 3. 加权可利用面积（WUA）

WUA是栖息地质量的定量指标。

**公式**:
```python
WUA = Σ(CSI_i × A_i)
```

其中：
- CSI_i: 第i个单元的综合适宜性指数
- A_i: 第i个单元的面积

**物理意义**:
- WUA越大，表示可利用的高质量栖息地越多
- WUA随流量变化，存在最优流量

### 4. PHABSIM方法

PHABSIM（Physical Habitat Simulation）是美国地质调查局开发的栖息地模拟方法。

**步骤**:
1. 建立水力模型（水深、流速计算）
2. 构建适宜性曲线（基于调查和文献）
3. 计算CSI和WUA
4. 分析WUA-流量关系
5. 确定最优流量范围

## 学习目标

完成本案例后，你应能够：

1. ✅ 理解栖息地适宜性评价的基本概念
2. ✅ 掌握HSI、CSI、WUA的计算方法
3. ✅ 学会构建和应用适宜性曲线
4. ✅ 理解不同生活史阶段的生境需求差异
5. ✅ 能够确定最优生态流量

## 运行方式

### 命令行运行

```bash
cd /workspace/books/ecohydraulics/code/examples/case_02_habitat_suitability
python main.py
```matlab

### 预期输出

程序会输出：
1. 河段参数信息
2. 鱼类栖息地模型信息
3. 典型流量下的栖息地质量
4. WUA-流量关系计算
5. 最优流量推荐
6. 横断面栖息地分布分析
7. 四张可视化图表（PNG格式）

### 输出文件

- `suitability_curves.png` - 适宜性曲线（水深、流速、综合）
- `wua_vs_flow.png` - WUA-流量关系和栖息地质量
- `habitat_distribution.png` - 横断面栖息地分布
- `habitat_summary.png` - 栖息地质量综合对比

## 典型结果

### 计算结果

| 指标 | 成鱼 | 幼鱼 |
|------|------|------|
| 最优流量 (m³/s) | 5.31 | 2.00 |
| 最大WUA (m²) | 13,241 | 8,121 |
| 栖息地质量 | 0.822 | 0.520 |

**综合推荐**: 3.65 m³/s (兼顾成鱼和幼鱼)  
**推荐范围**: 2.00 ~ 5.31 m³/s

### 栖息地质量分析（Q = 10 m³/s）

| 鱼类 | 平均CSI | 最大CSI | 适宜面积比例 |
|------|---------|---------|--------------|
| 成鱼 | 0.661 | 0.708 | 92.0% |
| 幼鱼 | 0.123 | 0.147 | 0% |

**分析**: 
- 在10 m³/s流量下，对成鱼非常适宜
- 但对幼鱼不适宜（水深太深，流速太快）
- 说明需要保持流量的多样性

### 适宜性曲线特征

**成鱼（鲤鱼）**:
- 最适水深: 1.0-1.5 m
- 最适流速: 0.4-0.6 m/s
- 偏好中等水深的缓流环境

**幼鱼（鲤鱼）**:
- 最适水深: 0.2-0.6 m
- 最适流速: 0.1-0.2 m/s
- 偏好浅水低流速环境

## 工程应用

### 适用场景

1. **生态流量确定**: 基于栖息地需求确定生态流量
2. **河流修复设计**: 评估不同修复方案的生境质量
3. **水库调度优化**: 制定生态友好的调度方案
4. **环境影响评价**: 量化水利工程对鱼类生境的影响

### 设计建议

1. **流量管理**:
   - 维持推荐流量范围（2-5 m³/s）
   - 产卵期（4-6月）: 提高到5-6 m³/s
   - 越冬期（12-2月）: 可降至2-3 m³/s

2. **生境营造**:
   - 保留深潭-浅滩序列
   - 创造流速多样性
   - 维护岸边浅水区（幼鱼庇护所）

3. **监测建议**:
   - 定期调查鱼类群落结构
   - 监测不同流量下的生境利用
   - 根据监测结果调整适宜性曲线

4. **多物种考虑**:
   - 本案例仅考虑鲤鱼
   - 实际应用需评估多个指示物种
   - 寻找多物种共同的适宜流量范围

## 扩展思考

1. **适宜性曲线构建**:
   - 如何通过野外调查获取适宜性数据？
   - 不同河流的适宜性曲线是否相同？

2. **季节变化**:
   - 产卵期、生长期、越冬期的需求有何不同？
   - 如何设计动态的生态流量过程？

3. **多物种平衡**:
   - 肉食性鱼类vs草食性鱼类的需求差异？
   - 如何兼顾不同食性、不同大小的鱼类？

4. **气候变化**:
   - 水温上升对栖息地适宜性的影响？
   - 流量减少情景下如何保障关键生境？

5. **不确定性分析**:
   - 适宜性曲线的不确定性有多大？
   - 如何量化WUA计算的不确定性？

## 参考文献

### 主要文献

1. Bovee, K.D. (1982). *A Guide to Stream Habitat Analysis Using the Instream Flow Incremental Methodology*. US Fish and Wildlife Service, FWS/OBS-82/26.

2. Bovee, K.D. & Milhous, R.T. (1978). *Hydraulic Simulation in Instream Flow Studies: Theory and Techniques*. Instream Flow Information Paper 5, US Fish and Wildlife Service.

3. 常剑波等. (2007). 栖息地模拟在河流生态需水量计算中的应用. *长江流域资源与环境*, 16(5), 652-656.

4. 董哲仁. (2003). 河流生态恢复的目标. *中国水利*, (10), 6-8.

### 技术规范

- PHABSIM Manual - USGS
- Instream Flow Council Guidelines
- 《河道生态修复技术导则》（水利部）

## 代码结构

```
case_02_habitat_suitability/
├── main.py              # 主程序
├── README.md            # 本文档
└── [输出文件]
    ├── suitability_curves.png
    ├── wua_vs_flow.png
    ├── habitat_distribution.png
    └── habitat_summary.png
```python

## 核心代码说明

### 适宜性曲线定义

```python
depth_curve = SuitabilityCurve(
    variable_name='depth',
    points=[
        (0.0, 0.0),    # (水深m, 适宜性0-1)
        (0.5, 0.8),
        (1.0, 1.0),    # 最适水深
        (2.0, 0.9),
        (3.0, 0.6)
    ]
)
```python

### WUA计算

```python
result = model.calculate_wua(
    reach,        # 河段对象
    Q=5.0,       # 流量
    n_cells=50   # 横向网格数
)
print(f"WUA = {result['wua']:.0f} m²")
```python

### 最优流量查找

```python
optimal = model.find_optimal_flow(
    reach,
    flow_range=(2.0, 20.0),
    n_flows=50
)
print(f"最优流量 = {optimal['optimal_flow']:.2f} m³/s")
```

## 常见问题

### Q1: WUA的单位是什么？

**A**: WUA的单位是面积单位（m²），表示"加权"的可利用面积。它不是实际的物理面积，而是质量×面积的综合指标。

### Q2: 为什么成鱼和幼鱼的最优流量不同？

**A**: 因为它们的生境需求不同：
- 幼鱼体型小，游泳能力弱，偏好浅水低流速
- 成鱼体型大，游泳能力强，可以利用较深和较快的水流

### Q3: 如何获取适宜性曲线数据？

**A**: 主要途径：
1. 文献查阅（已发表的研究）
2. 野外调查（记录鱼类出现位置的水深流速）
3. 专家咨询
4. 实验室研究（水槽试验）

### Q4: WUA-流量曲线为什么不是单调的？

**A**: 因为随着流量增加：
- 水深增加（可能提高或降低适宜性）
- 流速增加（可能降低适宜性）
- 可利用面积增加
- 这些因素综合作用，导致存在最优流量

### Q5: 本案例结果能否直接用于其他河流？

**A**: 不能直接使用，因为：
- 河道形态不同
- 鱼类种群可能不同
- 适宜性曲线需要根据当地情况调整
但方法可以迁移应用

## 联系方式

如有问题，请通过GitHub Issues反馈。

---

**案例完成日期**: 2025-11-02  
**版本**: v1.0  
**作者**: CHS-Books 生态水力学课程组
