# 案例13：明渠非恒定流基础

## 案例背景

某矩形明渠，长度L=10000m，初始为恒定均匀流。在上游边界突然增加流量，形成洪水波向下游传播。

工程参数：
- 渠道长度 L = 10000 m
- 渠道宽度 b = 20 m
- 渠底坡度 S₀ = 0.0002
- 糙率 n = 0.025
- 初始流量 Q₀ = 100 m³/s
- 初始水深 h₀ = 2.5 m
- 上游增加流量 Q₁ = 150 m³/s（阶跃变化）

计算要求：
1. 建立Saint-Venant方程组
2. 采用数值方法求解
3. 计算洪水波传播过程
4. 分析波速和波形变化
5. 研究数值稳定性条件

## 学习目标

1. 理解明渠非恒定流基本概念
2. 掌握Saint-Venant方程组
3. 学会数值求解方法
4. 了解洪水波传播特性
5. 掌握数值稳定性判别

## 核心理论

### 1. 非恒定流基本概念

**定义：**
```
非恒定流：流动要素（流量Q、水深h、流速v）
         随时间和空间变化

∂Q/∂t ≠ 0  或  ∂h/∂t ≠ 0

t - 时间
x - 空间位置
```

**分类：**
1. **渐变非恒定流**：水面坡度较缓，可用Saint-Venant方程
2. **急变非恒定流**：水面坡度陡峭，需考虑垂直加速度

**特点：**
- 质量守恒（连续方程）
- 动量守恒（动量方程）
- 波动传播
- 滞后效应

### 2. Saint-Venant方程组

**连续方程（质量守恒）：**
```
∂A/∂t + ∂Q/∂x = 0

或展开形式（矩形断面）：
∂h/∂t + ∂(vh)/∂x = 0
∂h/∂t + h·∂v/∂x + v·∂h/∂x = 0

A - 过水断面面积 (m²)
Q - 流量 (m³/s)
h - 水深 (m)
v - 流速 (m/s)
t - 时间 (s)
x - 空间坐标 (m)
```

**动量方程（牛顿第二定律）：**
```
∂Q/∂t + ∂(Q²/A)/∂x + gA·∂h/∂x = gA(S₀ - Sf)

或展开形式：
∂v/∂t + v·∂v/∂x + g·∂h/∂x = g(S₀ - Sf)

g - 重力加速度 (m/s²)
S₀ - 渠底坡度
Sf - 摩阻坡度 = n²v²/(R^(4/3))
```

**方程组性质：**
- 双曲型偏微分方程组
- 非线性
- 一阶偏导数
- 两个方程、两个未知数（h和Q或v）

### 3. 守恒型方程组

**向量形式：**
```
∂U/∂t + ∂F/∂x = S

U = [A  ]  - 守恒变量
    [Q  ]

F = [Q      ]  - 通量项
    [Q²/A+I ]

S = [0           ]  - 源项
    [gA(S₀-Sf)  ]

I = gA²/(2b) - 压力项（矩形断面）
```

### 4. 波速和特征线

**扰动波速（小扰动理论）：**
```
c = √(g·h_mean)  - 重力波速度

实际波速（绝对波速）：
λ₁ = v + c  - 顺流波速
λ₂ = v - c  - 逆流波速
```

**Froude数判别：**
```
Fr = v/c = v/√(gh)

Fr < 1：缓流，两个波都能向下游传播
Fr = 1：临界流
Fr > 1：急流，逆流波无法向上游传播
```

**CFL条件（数值稳定性）：**
```
Δt ≤ Δx / max(|v + c|, |v - c|)

Courant数：Cr = (|v| + c) · Δt / Δx ≤ 1
```

### 5. 数值求解方法

**显式有限差分（Lax格式）：**

```
连续方程：
A[i]^(n+1) = (A[i-1]^n + A[i+1]^n)/2
           - (Δt/2Δx)·(Q[i+1]^n - Q[i-1]^n)

动量方程：
Q[i]^(n+1) = (Q[i-1]^n + Q[i+1]^n)/2
           - (Δt/2Δx)·(F[i+1]^n - F[i-1]^n)
           + Δt·S[i]^n

其中：
F = Q²/A + gA²/(2b)
S = gA(S₀ - Sf)
Sf = n²Q²/(A²R^(4/3))
```

**算法步骤：**
1. 初始条件：t=0时刻的h和Q分布
2. 边界条件：上下游边界的h或Q
3. 时间推进：从第n层推进到第n+1层
4. 稳定性检查：验证CFL条件
5. 结果输出：指定时刻的水深和流量

### 6. 边界条件

**上游边界（x=0）：**
- 流量边界：Q(0,t) = Q_up(t)
- 水位边界：h(0,t) = h_up(t)
- 常用：给定流量过程线

**下游边界（x=L）：**
- 水位边界：h(L,t) = h_down(t)
- 流量边界：Q(L,t) = Q_down(t)
- 常用：给定水位或Q-h关系

**内部边界：**
- 闸门：Q = f(h_up, h_down, 闸门开度)
- 跌水：能量方程
- 汇流：流量叠加

### 7. 初始条件

**恒定流初始条件：**
```
t = 0:
  h(x,0) = h₀(x)  - 初始水深分布
  Q(x,0) = Q₀     - 初始流量（均匀）

常用：正常水深分布
h₀ = h_n（由Manning公式计算）
```

**静水初始条件：**
```
v(x,0) = 0
h(x,0) = 常数
```

### 8. 洪水波传播特性

**波速：**
```
正向波速：c_+ = v + √(gh)
负向波速：c_- = v - √(gh)

平均波速：c_avg = Q/A + √(gh)
```

**波形变化：**
- 高水部分传播快
- 低水部分传播慢
- 波前变陡
- 波后变缓
- 最终形成激波（水跃）

**峰值衰减：**
- 摩阻作用
- 河道蓄水
- 峰现流量 < 峰入流量
- 峰现时间滞后

### 9. 数值耗散和色散

**数值耗散：**
- 峰值人为降低
- 波形展宽
- 一阶精度格式严重

**数值色散：**
- 波后产生振荡
- 高频分量放大
- 二阶精度格式可能出现

**改善方法：**
- 加密网格（减小Δx和Δt）
- 使用高精度格式
- 人工粘性项

### 10. 典型应用

**洪水演进：**
- 河道洪水传播
- 溃坝波计算
- 防洪调度

**水库调度：**
- 防洪预报
- 发电优化
- 应急调度

**灌溉渠道：**
- 非恒定流调度
- 闸门控制
- 流量分配

**城市排水：**
- 暴雨径流
- 管网模拟
- 内涝预警

## 计算任务

### 任务1：建立方程组

建立Saint-Venant方程组并理解各项物理意义。

### 任务2：数值格式实现

实现Lax显式差分格式求解。

### 任务3：洪水波传播

计算上游流量阶跃变化后的波传播过程。

### 任务4：稳定性分析

研究时间步长和空间步长对稳定性的影响。

### 任务5：结果可视化

绘制不同时刻的水深和流量分布。

## 使用方法

```python
# 运行主程序
python main.py

# 运行实验
python experiments.py
```

## 预期结果

**初始状态：**
- 均匀流：Q₀=100 m³/s, h₀=2.5m
- 流速：v₀=2.0 m/s
- Froude数：Fr₀=0.40（缓流）
- 波速：c₀=4.95 m/s

**上游流量阶跃（Q=150 m³/s）：**
- 洪峰传播速度：约5-6 m/s
- 到达下游时间：约30-35分钟
- 峰值衰减：约10-15%
- 水深增加：约0.5-0.7m

**数值稳定性：**
- Δx = 100m
- Δt ≤ 14s（CFL条件）
- 推荐：Δt = 10s（Cr≈0.7）

## 工程意义

本案例展示了：
1. 非恒定流的基本理论
2. Saint-Venant方程组的建立
3. 数值求解的具体方法
4. 洪水波传播的物理过程
5. 数值计算的稳定性条件

## 设计要点

1. **网格划分**：
   - 空间步长：Δx = 50-200m
   - 时间步长：满足CFL条件
   - 网格比：避免过大或过小

2. **数值格式选择**：
   - 显式格式：简单，但时间步长受限
   - 隐式格式：稳定，但计算复杂
   - 本案例：Lax显式格式

3. **边界条件**：
   - 上游：流量过程线
   - 下游：水位或流量
   - 准确性影响结果

4. **初始条件**：
   - 尽量接近实际
   - 恒定流初始化
   - 避免初始激波

5. **计算精度**：
   - 空间精度：O(Δx²)
   - 时间精度：O(Δt)
   - 总体精度：一阶

## 注意事项

1. **CFL条件**：
   - 必须满足
   - 否则计算发散
   - 自动调整Δt

2. **数值振荡**：
   - 初始条件不连续
   - 边界条件突变
   - 可能产生非物理振荡

3. **守恒性**：
   - 检查质量守恒
   - 检查能量变化
   - 验证物理合理性

4. **边界处理**：
   - 上下游边界需特殊处理
   - 避免反射波
   - 保证稳定性

5. **物理合理性**：
   - 水深必须>0
   - 流速合理范围
   - Froude数检查

## 进阶主题

1. **高阶格式**：
   - MacCormack格式
   - TVD格式
   - 有限体积法

2. **隐式格式**：
   - Preissmann四点格式
   - 追赶法求解
   - 无条件稳定

3. **特征线法**：
   - 特征方向
   - Riemann问题
   - 激波捕捉

4. **实际应用**：
   - 复杂断面
   - 支流汇流
   - 闸门控制
   - 二维扩展
