# 案例7：渠道水面曲线计算

## 案例背景

某灌溉渠道遇到下游闸门抬高水位，需要计算上游壅水曲线，评估壅水影响范围和最高水位。

工程参数：
- 渠道底宽 b = 3.0 m
- 边坡系数 m = 1.5
- 渠底坡度 S₀ = 0.0008
- 糙率系数 n = 0.020
- 设计流量 Q = 6.0 m³/s
- 下游控制水深 h₀ = 2.5 m（闸前水深）

设计要求：
1. 计算正常水深和临界水深
2. 判断水面曲线类型
3. 计算壅水曲线（向上游推算）
4. 确定壅水影响范围
5. 分析不同流量下的水面线变化

## 学习目标

1. 理解非均匀渐变流的基本概念
2. 掌握水面曲线分类方法
3. 学会标准步长法计算水面线
4. 了解壅水和落水曲线的特点
5. 掌握工程中的水面线分析

## 核心理论

### 1. 非均匀渐变流基本方程

**能量方程（微分形式）：**
```
dh/dx = (S₀ - Sf) / (1 - Fr²)

其中：
h - 水深 (m)
x - 沿程距离 (m)
S₀ - 渠底坡度
Sf - 摩阻坡度
Fr - 弗劳德数
```

**摩阻坡度计算（Manning公式）：**
```
Sf = (n²v²) / (R^(4/3))
   = (n²Q²) / (A²R^(4/3))

R - 水力半径 (m)
A - 过流断面积 (m²)
v - 流速 (m/s)
```

**弗劳德数：**
```
Fr² = Q²B / (gA³)

B - 水面宽度 (m)
g - 重力加速度 (9.81 m/s²)
```

### 2. 水面曲线分类

根据渠底坡度和水深关系，水面曲线分为3个区域和9种类型：

**缓坡渠道 (S₀ < Sc)：**
```
M1 区：h > hn > hc  （壅水曲线，向上游渐近hn）
M2 区：hn > h > hc  （落水曲线，向上游渐近hn）
M3 区：hn > hc > h  （急流，向下游渐近hc）
```

**陡坡渠道 (S₀ > Sc)：**
```
S1 区：h > hc > hn  （壅水曲线，向上游渐近hc）
S2 区：hc > h > hn  （急流，向下游渐近hc）
S3 区：hc > hn > h  （急流，向下游渐近hn）
```

**临界坡渠道 (S₀ = Sc)：**
```
C1 区：h > hc = hn  （壅水曲线）
C3 区：h < hc = hn  （落水曲线）
```

其中：
- hn：正常水深（均匀流水深）
- hc：临界水深
- Sc：临界坡度

### 3. 标准步长法

**基本原理：**
从已知断面的水深，逐步推算相邻断面的水深。

**计算步骤（向上游推算）：**

1. 已知下游断面水深 h₁
2. 计算该断面的比能 E₁ = h₁ + v₁²/(2g)
3. 假设上游断面水深 h₂
4. 计算平均摩阻坡度 Sf_avg = (Sf₁ + Sf₂) / 2
5. 计算步长：
   ```
   Δx = (E₂ - E₁ + Δz) / (Sf_avg - S₀)
   ```
6. 检查步长是否合适，调整h₂重复计算

**迭代方法：**
- 给定步长Δx，反算上游水深h₂
- 使用牛顿迭代法求解
- 收敛判据：|h₂_new - h₂_old| < 1e-6

### 4. 水面曲线特性

**M1型壅水曲线：**
- 缓坡渠道，下游控制（如闸门、水库）
- 水深向上游逐渐降低
- 最终渐近于正常水深
- 常见于闸前、坝前

**M2型落水曲线：**
- 缓坡渠道，上游控制
- 水深向下游逐渐降低
- 最终渐近于正常水深或临界水深
- 常见于渠道进口

**S1型壅水曲线：**
- 陡坡渠道，下游控制
- 水深向上游降低
- 渐近于临界水深
- 常见于陡坡渠道末端

### 5. 壅水计算

**壅水高度：**
```
Δh = h - hn

h - 实际水深
hn - 正常水深
```

**壅水长度：**
从控制断面到水深恢复正常（Δh < 0.05m）的距离

**壅水影响因素：**
1. 下游控制水深（越高壅水越大）
2. 渠道糙率（越大壅水越大）
3. 渠底坡度（越小壅水越远）
4. 流量（越大壅水越远）

## 计算任务

### 任务1：正常水深和临界水深计算

计算渠道的正常水深hn和临界水深hc。

### 任务2：水面曲线类型判别

根据S₀、hn、hc判断渠道类型和水面曲线类型。

### 任务3：壅水曲线计算

从下游控制断面向上游逐步推算水面线。

### 任务4：壅水影响分析

确定壅水影响范围和最大壅水高度。

### 任务5：不同条件对比

分析不同流量、糙率对水面曲线的影响。

## 使用方法

```python
# 运行主程序
python main.py

# 运行实验
python experiments.py
```

## 预期结果

- 正常水深 hn ≈ 1.5-2.0 m
- 临界水深 hc ≈ 1.0-1.2 m
- 水面曲线类型：M1（缓坡壅水）
- 壅水影响范围：500-1000 m
- 最大壅水高度：Δh = 0.5-1.0 m

## 工程意义

本案例展示了：
1. 非均匀流水面曲线计算方法
2. 壅水影响的定量分析
3. 渠道设计中的水位控制
4. 闸门调度对上游水位的影响
5. 防洪水位的确定

## 设计要点

1. **渠道分类判别**：
   - 计算临界坡度Sc
   - 比较S₀与Sc
   - 确定缓坡或陡坡

2. **水面线计算**：
   - 确定边界条件
   - 选择推算方向
   - 合理选择步长（10-50m）
   - 注意收敛性

3. **壅水控制**：
   - 抬高渠堤高度
   - 控制下游水位
   - 优化渠道断面
   - 降低糙率

4. **计算精度**：
   - 步长不宜过大（ΔE < 0.1m）
   - 迭代精度1e-6
   - 特殊断面加密步长
   - 检查能量守恒

5. **工程应用**：
   - 闸前壅水分析
   - 渠道超高确定
   - 桥涵过水能力
   - 堤防高度设计
