# 案例15：溃坝波计算

## 案例背景

某水库大坝突然溃决，下游为水平矩形河道。上游水库水深h₀=10m，下游河道初始水深hd=2m（湿河床）或0m（干河床）。

工程参数：
- 上游水深 h₀ = 10.0 m
- 下游水深 hd = 2.0 m（湿河床）或 0 m（干河床）
- 河道宽度 b = 50.0 m
- 河道长度 L = 10000 m
- 河床坡度 S₀ = 0（水平）
- 溃坝位置 x = 5000 m（河道中部）

计算要求：
1. 建立溃坝波理论解（Riemann问题）
2. 计算波前传播速度
3. 分析干湿河床的差异
4. 数值模拟溃坝波传播
5. 对比理论解与数值解

## 学习目标

1. 理解溃坝波的物理机制
2. 掌握Riemann问题的理论解
3. 学会特征线方法
4. 了解激波的产生条件
5. 掌握moving boundary处理

## 核心理论

### 1. 溃坝波基本概念

**定义：**
```
溃坝波：大坝瞬间溃决产生的急剧非恒定流动

特点：
- 水深梯度极大
- 波前传播迅速
- 产生激波（bore）
- 具有理论解（特定条件下）
```

**物理过程：**
1. **t=0时刻**：大坝瞬间溃决
2. **t>0**：产生三个区域
   - 左区（静水区）：h=h₀, v=0
   - 中区（膨胀波）：h和v连续变化
   - 右区（初始状态）：h=hd, v=0

**Saint-Venant方程（无摩阻）：**
```
∂h/∂t + ∂(hv)/∂x = 0              (连续方程)
∂v/∂t + v·∂v/∂x + g·∂h/∂x = 0     (动量方程，无摩阻)
```

### 2. Riemann问题

**定义：**
```
Riemann问题：初始条件为分段常数的间断问题

初始条件：
  h(x,0) = h₀  (x < 0)
  h(x,0) = hd  (x > 0)
  v(x,0) = 0   (全域)
```

**解的结构：**

**情况1：干河床（hd=0）**
```
区域划分（自相似解）：

1. 左区（静水区）：x/t < -c₀
   h = h₀
   v = 0

2. 膨胀波区：-c₀ < x/t < 2c₀
   h = (1/9g) * (2c₀ - x/t)²
   v = (2/3) * (c₀ + x/t)

3. 右区（干河床）：x/t > 2c₀
   h = 0
   v = 0

波速：
  c₀ = √(gh₀)  - 左侧静水区波速
  波前速度 = 2c₀
```

**情况2：湿河床（hd>0）**
```
区域划分：

1. 左区（静水区）：x/t < -c₀
   h = h₀
   v = 0

2. 膨胀波区：-c₀ < x/t < v* - c*
   h = (1/9g) * (2c₀ - x/t)²
   v = (2/3) * (c₀ + x/t)

3. 中间恒定区：v* - c* < x/t < U
   h = h*
   v = v*

4. 激波（bore）：x/t = U
   [h], [v] 满足Rankine-Hugoniot条件

5. 右区（初始状态）：x/t > U
   h = hd
   v = 0

其中：
  c₀ = √(gh₀)
  cd = √(ghd)
  v* = 2(c₀ - c*)  - 中间区流速
  c* = √(gh*)      - 中间区波速
  U = v* + c* * √((h* + hd)/(2hd))  - 激波速度
```

### 3. 特征线方程

**特征线：**
```
dx/dt = λ = v ± c

正向特征线：dx/dt = v + c
负向特征线：dx/dt = v - c
```

**沿特征线的不变量（Riemann不变量）：**
```
正向特征线 (dx/dt = v + c)：
  R⁺ = v + 2c = const

负向特征线 (dx/dt = v - c)：
  R⁻ = v - 2c = const

其中 c = √(gh)
```

**膨胀波解：**
```
初始左侧：v=0, c=c₀ → R⁺ = 2c₀
初始右侧：v=0, c=cd → R⁻ = -2cd

膨胀波区：
  R⁺ = v + 2c = 2c₀
  R⁻ = v - 2c = -2cd

解得：
  v = c₀ - cd
  c = (c₀ + cd)/2
  h = [(c₀ + cd)/2]² / g
```

### 4. 激波（Bore）

**产生条件：**
```
当下游有初始水深（hd>0）时，
波前形成激波（moving shock）

激波性质：
- 间断面
- 能量耗散
- 不可逆过程
```

**Rankine-Hugoniot条件：**
```
质量守恒：
  [hv] = U[h]

动量守恒：
  [hv² + gh²/2] = U[hv]

其中：
  [φ] = φ右 - φ左 = φd - φ*
  U = 激波传播速度
```

**激波速度公式：**
```
U = vd + cd * √((h* + hd)/(2hd))

或简化为（当vd=0）：
U = cd * √((h* + hd)/(2hd))

当h* >> hd时：
U ≈ cd * √(h*/(2hd))
```

### 5. 自相似解

**相似变量：**
```
ξ = x/t

所有物理量仅为ξ的函数：
h = h(ξ)
v = v(ξ)
```

**干河床情况的完整解：**
```
区域1（x/t < -c₀）：
  h = h₀
  v = 0

区域2（-c₀ < x/t < 2c₀）：
  ξ = x/t
  v(ξ) = (2/3)(c₀ + ξ)
  c(ξ) = (1/3)(2c₀ - ξ)
  h(ξ) = c²/g = (1/9g)(2c₀ - ξ)²

区域3（x/t > 2c₀）：
  h = 0
  v = 0（无定义）

波前位置：
  x_f = 2c₀·t = 2√(gh₀)·t
```

### 6. 数值解法

**初始条件设置：**
```
在x=x_dam处：
  左侧：h = h₀, Q = 0
  右侧：h = hd, Q = 0
```

**边界条件：**
```
上游（左）：外推边界
下游（右）：外推边界

（自然边界，波在内部传播）
```

**网格要求：**
```
空间步长：Δx = 20-50 m
时间步长：满足CFL条件
  Δt < Δx / max(|v| + c)
```

**激波捕捉：**
```
Lax格式的人工粘性可以自动捕捉激波
但会产生数值耗散，导致激波展宽
```

### 7. 特征参数计算

**波速：**
```
重力波速：c = √(gh)

膨胀波传播速度：
  向上游：-c₀ = -√(gh₀)
  向下游：2c₀ = 2√(gh₀)

激波速度（湿河床）：
  U = cd√((h* + hd)/(2hd))
```

**到达时间：**
```
波前到达下游距离L处的时间：
  t = L / (2c₀)  （干河床）
  t = L / U       （湿河床，激波）
```

**中间区水深（湿河床）：**
```
由Riemann不变量：
  v* + 2c* = 2c₀
  v* - 2c* = -2cd

解得：
  v* = c₀ - cd
  c* = (c₀ + cd) / 2
  h* = [(c₀ + cd)/2]² / g
```

### 8. 能量分析

**初始势能（以坝址为基准）：**
```
E₀ = (1/2) * ρgbL₁h₀²

L₁ = 上游水库长度
```

**波传播后能量：**
```
动能：
  EK = ∫∫ (1/2)ρhv² dx

势能：
  EP = ∫∫ (1/2)ρgh² dx
```

**能量耗散：**
```
激波耗散：
  ΔE = E₀ - (EK + EP)

主要发生在激波处
```

### 9. 安全距离分析

**危险区判定：**
```
给定水深阈值 h_crit（如2m）

危险区：h > h_crit 的范围
安全区：h ≤ h_crit 的范围
```

**撤离时间：**
```
波前到达时间：
  t_arrival = x / U

预警时间 = t_arrival - t_detection
```

**淹没深度：**
```
在距坝址x处，水深为：
  h(x,t) = 由理论解或数值解给出
```

### 10. 工程应用

**溃坝风险评估：**
- 下游淹没范围预测
- 到达时间计算
- 最大水深估算
- 流速分布

**应急措施：**
- 预警系统设计
- 撤离路线规划
- 安全区划定
- 避难所选址

**工程设计：**
- 防洪堤设计
- 排水系统
- 应急泄洪设施
- 监测系统

**模型限制：**
- 忽略摩阻（短期可接受）
- 假设矩形断面
- 水平河床
- 一维流动

## 计算任务

### 任务1：理论解计算

计算干河床和湿河床情况的Riemann解。

### 任务2：特征线绘制

绘制x-t平面上的特征线族。

### 任务3：数值模拟

使用Saint-Venant求解器模拟溃坝波传播。

### 任务4：结果对比

对比理论解与数值解的差异。

### 任务5：参数分析

分析上下游水深比对波传播的影响。

## 使用方法

```python
# 运行主程序
python main.py

# 运行实验
python experiments.py
```

## 预期结果

**干河床情况（hd=0）：**
- 波前速度：2c₀ = 2√(10×9.81) = 19.8 m/s
- 到达下游5km：约253秒
- 最大流速：v_max ≈ 6.6 m/s
- 膨胀波区宽度：随时间线性增长

**湿河床情况（hd=2m）：**
- 中间区水深：h* ≈ 5.8 m
- 中间区流速：v* ≈ 5.5 m/s
- 激波速度：U ≈ 10.5 m/s
- 激波到达5km：约476秒

**数值解特点：**
- 激波会展宽（数值耗散）
- 波前位置接近理论值
- 需要精细网格捕捉激波

## 工程意义

本案例展示了：
1. 溃坝波的基本理论
2. Riemann问题的求解方法
3. 特征线理论的应用
4. 激波的产生和传播
5. 理论解与数值解的对比

## 设计要点

1. **初始条件**：
   - 左右状态明确定义
   - 速度初始为0
   - 间断位置准确

2. **网格设置**：
   - 间断处加密
   - 满足CFL条件
   - 足够长的计算域

3. **边界条件**：
   - 使用外推边界
   - 避免反射波
   - 计算域足够大

4. **结果验证**：
   - 对比理论解
   - 检查守恒性
   - 波速验证

## 注意事项

1. **理论解适用条件**：
   - 无摩阻
   - 水平河床
   - 矩形断面
   - 一维流动

2. **数值解问题**：
   - 激波展宽
   - 数值耗散
   - 网格敏感性
   - CFL限制

3. **物理合理性**：
   - 水深非负
   - Froude数检查
   - 能量守恒
   - 质量守恒

4. **实际应用**：
   - 考虑摩阻
   - 真实地形
   - 建筑物影响
   - 二维效应

## 进阶主题

1. **高阶格式**：
   - TVD格式
   - Godunov格式
   - WENO格式
   - 激波捕捉

2. **复杂地形**：
   - 变坡河道
   - 弯道效应
   - 障碍物
   - 二维扩展

3. **溃坝过程**：
   - 渐进溃决
   - 部分溃决
   - 漫顶溃坝
   - 管涌溃坝

4. **耦合模型**：
   - 库区-河道耦合
   - 水沙耦合
   - 结构-流体相互作用
   - 多尺度模型
