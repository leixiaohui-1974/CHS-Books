# 案例4：灌区量水堰流量测量

## 案例背景

某灌区需要准确测量各条支渠的引水流量，以实现精准灌溉和水资源管理。设计采用矩形薄壁堰作为量水建筑物。

堰的参数：
- 堰顶宽度 b = 0.8 m
- 堰型：薄壁堰（thin-plate weir）
- 流量系数 m = 0.40
- 测量范围：0.05-0.50 m³/s

设计要求：
1. 建立堰顶水头与流量的关系
2. 绘制流量标定曲线
3. 分析测量精度
4. 考虑侧收缩的影响

## 学习目标

1. 理解堰流的基本原理
2. 掌握堰流公式的应用
3. 学会流量系数的确定
4. 了解侧收缩的影响
5. 建立流量率定曲线

## 核心理论

### 1. 堰流基本概念

**堰的定义：**
- 垂直于水流方向的挡水建筑物
- 水流从堰顶溢流而过
- 用于量水、溢流、调节水位

**堰流特点：**
- 水流跌落，形成跌流
- 堰前壅水，水位升高
- 流态稳定，便于测量
- 测量精度高（2-5%）

### 2. 堰流公式

**矩形薄壁堰：**
```
Q = m * b * sqrt(2g) * H^(3/2)

其中：
Q - 流量 (m³/s)
m - 流量系数（0.35-0.45）
b - 堰顶宽度 (m)
g - 重力加速度 (9.81 m/s²)
H - 堰顶水头 (m)
```

**流量系数 m：**
- 薄壁堰：m = 0.40-0.42
- 宽顶堰：m = 0.32-0.38
- 实用堰：m = 0.30-0.35

### 3. 侧收缩影响

当堰的侧墙与渠道侧墙不齐时，会产生侧收缩：

**修正公式：**
```
Q = m * (b - 0.1*n*H) * sqrt(2g) * H^(3/2)

n - 收缩边数（两侧收缩 n=2）
```

**有效宽度：**
```
b_eff = b - 0.1*n*H
```

### 4. 三角形堰

90度三角形堰（V型堰）：
```
Q = (8/15) * m * sqrt(2g) * tan(45°) * H^(5/2)
  = 1.343 * m * H^(5/2)  (g=9.81, m=0.40)
```

**特点：**
- 小流量测量精度高
- 不受侧收缩影响
- 自冲刷能力强

### 5. 水头测量

**测量位置：**
- 距堰前 3-4倍最大水头处
- 避免壅水曲线影响
- 水面平稳，便于读数

**水头 H：**
```
H = h - P

h - 上游水面高程
P - 堰顶高程
```

## 计算任务

### 任务1：流量计算

给定堰顶水头，计算通过流量。

### 任务2：水头反算

给定流量，反算所需的堰顶水头。

### 任务3：流量曲线

绘制 Q-H 关系曲线（率定曲线）。

### 任务4：侧收缩影响

分析有无侧收缩对流量的影响。

## 使用方法

```python
# 运行主程序
python main.py

# 运行实验
python experiments.py
```

## 预期结果

- 建立完整的Q-H关系
- 流量系数合理（m ≈ 0.40）
- 侧收缩使流量减少5-10%
- 测量精度满足要求

## 工程意义

本案例展示了：
1. 量水堰的设计和应用
2. 堰流公式的实际计算
3. 流量率定曲线的建立
4. 侧收缩的工程处理
5. 灌区水量计量方法

## 设计要点

1. **堰型选择**：
   - 小流量：三角形堰（<0.1 m³/s）
   - 中流量：矩形堰（0.1-1.0 m³/s）
   - 大流量：宽顶堰（>1.0 m³/s）

2. **堰顶高程**：
   - 保证通气良好
   - 避免淹没出流
   - 堰高 P > 0.1 m

3. **测量精度**：
   - 水头测量精度 ±1 mm
   - 流量误差 <5%
   - 定期率定校核

4. **维护管理**：
   - 保持堰顶锐利
   - 清除泥沙淤积
   - 防止杂草生长
   - 定期清洗水尺
