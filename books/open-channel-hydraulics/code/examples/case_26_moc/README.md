# 案例26：特征线法MOC

## 案例背景

某管道系统长度L=1200 m，管径D=0.6 m，初始流速v₀=1.5 m/s，初始压力水头H₀=60 m。下游阀门在2秒内线性关闭。需要使用特征线法（Method of Characteristics, MOC）模拟水锤过程，计算管道各点的压力和流速随时间的变化。

工程参数：
- 管道长度 L = 1200 m
- 管径 D = 0.6 m
- 壁厚 e = 0.012 m
- 初始流速 v₀ = 1.5 m/s
- 初始压力水头 H₀ = 60 m
- 波速 a = 1000 m/s
- 摩阻系数 λ = 0.02
- 阀门关闭时间 t_c = 2.0 s

分析目标：
1. 建立特征线方程
2. 离散化管道（空间步长）
3. 确定时间步长（满足Courant条件）
4. 计算内部节点
5. 处理边界条件（水库、阀门）
6. 绘制压力-时间历程曲线

## 学习目标

1. 理解特征线法的基本原理
2. 掌握特征方程的推导
3. 学会离散化和数值求解
4. 了解Courant稳定性条件
5. 掌握边界条件的处理方法

## 核心理论

### 1. 基本方程

**连续性方程：**
```
∂H/∂t + (a²/g) * ∂v/∂x = 0
```

**动量方程：**
```
∂v/∂t + g * ∂H/∂x + (λ*v*|v|)/(2D) = 0
```

其中：
- H：压力水头（m）
- v：流速（m/s）
- a：波速（m/s）
- g：重力加速度（m/s²）
- λ：摩阻系数
- D：管径（m）

### 2. 特征线方程

通过线性组合消去偏导数，得到特征线方程。

**C⁺特征线（向右传播）：**
```
dx/dt = +a
```

沿C⁺线：
```
dH + (a/g)*dv + (λ*v*|v|)/(2gD)*a*dt = 0
```

**C⁻特征线（向左传播）：**
```
dx/dt = -a
```

沿C⁻线：
```
dH - (a/g)*dv + (λ*v*|v|)/(2gD)*a*dt = 0
```

### 3. 有限差分格式

**C⁺方程离散化：**
```
H_P = H_A - (a/g)*(v_P - v_A) - R_A
```

其中：
```
R_A = (λ*v_A*|v_A|)/(2gD) * a * Δt
```

**C⁻方程离散化：**
```
H_P = H_B + (a/g)*(v_P - v_B) - R_B
```

其中：
```
R_B = (λ*v_B*|v_B|)/(2gD) * a * Δt
```

### 4. 内部节点计算

对于管道内部节点P，有C⁺和C⁻两条特征线交汇。

联立两方程：
```
H_A - (a/g)*v_A - R_A = H_B + (a/g)*v_B - R_B
```

解得：
```
v_P = (H_A - H_B + (a/g)*(v_A + v_B) - R_A - R_B) / (2a/g)
```

```
H_P = (H_A + H_B)/2 + (a/2g)*(v_A - v_B) - (R_A + R_B)/2
```

### 5. 边界条件

#### 水库（上游边界）

已知：H = H_reservoir（常数）

只用C⁻方程：
```
H_reservoir = H_B + (a/g)*(v_1 - v_B) - R_B
```

解得：
```
v_1 = v_B + (g/a)*(H_reservoir - H_B) + (g/a)*R_B
```

#### 阀门（下游边界）

**阀门方程：**
```
v_N = C_v(t) * √(2g*H_N)
```

其中C_v(t)是阀门开度系数（随时间变化）。

只用C⁺方程：
```
H_N = H_A - (a/g)*(v_N - v_A) - R_A
```

联立求解H_N和v_N。

**线性关闭：**
```
C_v(t) = C_v0 * (1 - t/t_c)  (t ≤ t_c)
C_v(t) = 0  (t > t_c)
```

### 6. Courant条件

**稳定性条件：**
```
Δt = Δx / a
```

这样可保证特征线正好连接相邻节点。

**空间步长：**
```
Δx = L / N
```

其中N是管道分段数。

**时间步长：**
```
Δt = L / (N * a)
```

### 7. 计算流程

1. **初始化**：设定H和v的初值
2. **空间离散**：划分N段，得到N+1个节点
3. **时间步进**：循环计算每个时间步
4. **内部节点**：用C⁺和C⁻方程
5. **上游边界**：水库边界条件
6. **下游边界**：阀门边界条件
7. **更新**：保存结果，进入下一时间步

## 计算任务

### 任务1：特征线离散化

将管道分为N=12段，计算Δx和Δt。

### 任务2：摩阻项计算

计算典型节点的摩阻项R。

### 任务3：内部节点计算

给定A、B两点的H和v，计算P点的H_P和v_P。

### 任务4：上游水库边界

已知H_reservoir=60m，计算第一个节点的流速v_1。

### 任务5：下游阀门边界

计算不同开度下的流速v_N和压力H_N。

### 任务6：完整MOC模拟

模拟0~10秒的水锤过程，输出各节点压力历程。

## 使用方法

```python
# 运行主程序
python main.py

# 运行实验
python experiments.py
```

## 预期结果

- 掌握特征线法的计算步骤
- 理解数值稳定性条件
- 学会处理不同边界条件
- 能够模拟完整水锤过程

## 工程意义

本案例展示了：
1. 特征线法的数值实现
2. 水锤过程的动态模拟
3. 边界条件的正确处理
4. 压力历程的精确计算
5. 工程设计的数值工具

## MOC法的优势

### 1. 精确性

- 沿特征线精确满足微分方程
- 无数值耗散（对流项）
- 适合双曲型方程

### 2. 适应性

- 可处理复杂边界条件
- 可模拟任意关闭规律
- 可耦合泵、阀、调压井等设备

### 3. 物理意义清晰

- 特征线对应压力波传播路径
- C⁺对应向右传播的波
- C⁻对应向左传播的波

## MOC法的局限

### 1. 网格限制

必须满足Courant条件，网格不能任意选择。

### 2. 复杂系统

分支管道、环状管网需要特殊处理。

### 3. 计算量

对于大型系统，计算量较大。

## 改进方法

### 1. 插值MOC

不严格满足Courant条件，用插值处理。

### 2. 波速调节

人为调整波速，使Δt满足要求。

### 3. 隐式MOC

结合隐式格式，提高稳定性。

## 典型结果分析

### 压力历程曲线

**阀门处（下游）：**
- t = 0：压力开始升高
- t = T_c/2：压力达到第一个峰值
- t = T_c：反射波返回，压力下降
- 周期性振荡，逐渐衰减

**中点：**
- 压力变化滞后于阀门
- 振幅略小（摩阻衰减）

**上游水库：**
- 压力恒定（边界条件）

### 流速历程曲线

**阀门处：**
- 逐渐减小至0（关闭）

**中点：**
- 振荡变化
- 可能出现倒流（负流速）

## 工程应用

### 1. 水电站

引水管道水锤计算，调压井设计。

### 2. 泵站

泵突然停机的水锤保护。

### 3. 长距离输水

分段阀门操作的水锤影响。

### 4. 城市供水

管网水锤分析，阀门操作规程。

## 常见问题

### 1. 如何选择分段数N？

一般取N=10~20即可获得较好精度。过多增加计算量，过少降低精度。

### 2. 摩阻项是否必须考虑？

对于短管道和短时间模拟，摩阻影响小，可忽略。长管道和长时间模拟必须考虑。

### 3. 阀门方程如何处理？

阀门方程是非线性的，需要迭代求解或Newton-Raphson法。简化方法是直接给定v_N=f(t)。

### 4. 如何验证计算正确性？

- 检查Courant条件
- 验证质量守恒
- 与解析解对比（简单工况）
- 与实测数据对比

## 扩展阅读

- Wylie, E. B., & Streeter, V. L. (1993). *Fluid Transients in Systems*
- Chaudhry, M. H. (2014). *Applied Hydraulic Transients*
- 《水力过渡过程》（严拱柱）
- 《水电站过渡过程计算》
- ISO 10631: Pipelines - Water hammer and surge
